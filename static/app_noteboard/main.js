(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))p(v);new MutationObserver(v=>{for(const k of v)if(k.type==="childList")for(const S of k.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&p(S)}).observe(document,{childList:!0,subtree:!0});function l(v){const k={};return v.integrity&&(k.integrity=v.integrity),v.referrerPolicy&&(k.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?k.credentials="include":v.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function p(v){if(v.ep)return;v.ep=!0;const k=l(v);fetch(v.href,k)}})();var Xb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ex(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Px={exports:{}},Mp={},Ax={exports:{}},Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bh=Symbol.for("react.element"),Kb=Symbol.for("react.portal"),Yb=Symbol.for("react.fragment"),Jb=Symbol.for("react.strict_mode"),Qb=Symbol.for("react.profiler"),e2=Symbol.for("react.provider"),t2=Symbol.for("react.context"),r2=Symbol.for("react.forward_ref"),n2=Symbol.for("react.suspense"),i2=Symbol.for("react.memo"),s2=Symbol.for("react.lazy"),pv=Symbol.iterator;function o2(r){return r===null||typeof r!="object"?null:(r=pv&&r[pv]||r["@@iterator"],typeof r=="function"?r:null)}var Mx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},zx=Object.assign,Dx={};function Mu(r,i,l){this.props=r,this.context=i,this.refs=Dx,this.updater=l||Mx}Mu.prototype.isReactComponent={};Mu.prototype.setState=function(r,i){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,i,"setState")};Mu.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Lx(){}Lx.prototype=Mu.prototype;function Mg(r,i,l){this.props=r,this.context=i,this.refs=Dx,this.updater=l||Mx}var zg=Mg.prototype=new Lx;zg.constructor=Mg;zx(zg,Mu.prototype);zg.isPureReactComponent=!0;var fv=Array.isArray,Rx=Object.prototype.hasOwnProperty,Dg={current:null},Fx={key:!0,ref:!0,__self:!0,__source:!0};function Bx(r,i,l){var p,v={},k=null,S=null;if(i!=null)for(p in i.ref!==void 0&&(S=i.ref),i.key!==void 0&&(k=""+i.key),i)Rx.call(i,p)&&!Fx.hasOwnProperty(p)&&(v[p]=i[p]);var d=arguments.length-2;if(d===1)v.children=l;else if(1<d){for(var V=Array(d),se=0;se<d;se++)V[se]=arguments[se+2];v.children=V}if(r&&r.defaultProps)for(p in d=r.defaultProps,d)v[p]===void 0&&(v[p]=d[p]);return{$$typeof:bh,type:r,key:k,ref:S,props:v,_owner:Dg.current}}function a2(r,i){return{$$typeof:bh,type:r.type,key:i,ref:r.ref,props:r.props,_owner:r._owner}}function Lg(r){return typeof r=="object"&&r!==null&&r.$$typeof===bh}function l2(r){var i={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(l){return i[l]})}var mv=/\/+/g;function nm(r,i){return typeof r=="object"&&r!==null&&r.key!=null?l2(""+r.key):i.toString(36)}function Ud(r,i,l,p,v){var k=typeof r;(k==="undefined"||k==="boolean")&&(r=null);var S=!1;if(r===null)S=!0;else switch(k){case"string":case"number":S=!0;break;case"object":switch(r.$$typeof){case bh:case Kb:S=!0}}if(S)return S=r,v=v(S),r=p===""?"."+nm(S,0):p,fv(v)?(l="",r!=null&&(l=r.replace(mv,"$&/")+"/"),Ud(v,i,l,"",function(se){return se})):v!=null&&(Lg(v)&&(v=a2(v,l+(!v.key||S&&S.key===v.key?"":(""+v.key).replace(mv,"$&/")+"/")+r)),i.push(v)),1;if(S=0,p=p===""?".":p+":",fv(r))for(var d=0;d<r.length;d++){k=r[d];var V=p+nm(k,d);S+=Ud(k,i,l,V,v)}else if(V=o2(r),typeof V=="function")for(r=V.call(r),d=0;!(k=r.next()).done;)k=k.value,V=p+nm(k,d++),S+=Ud(k,i,l,V,v);else if(k==="object")throw i=String(r),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return S}function Sd(r,i,l){if(r==null)return r;var p=[],v=0;return Ud(r,p,"","",function(k){return i.call(l,k,v++)}),p}function u2(r){if(r._status===-1){var i=r._result;i=i(),i.then(function(l){(r._status===0||r._status===-1)&&(r._status=1,r._result=l)},function(l){(r._status===0||r._status===-1)&&(r._status=2,r._result=l)}),r._status===-1&&(r._status=0,r._result=i)}if(r._status===1)return r._result.default;throw r._result}var hi={current:null},$d={transition:null},c2={ReactCurrentDispatcher:hi,ReactCurrentBatchConfig:$d,ReactCurrentOwner:Dg};function Ox(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:Sd,forEach:function(r,i,l){Sd(r,function(){i.apply(this,arguments)},l)},count:function(r){var i=0;return Sd(r,function(){i++}),i},toArray:function(r){return Sd(r,function(i){return i})||[]},only:function(r){if(!Lg(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Yt.Component=Mu;Yt.Fragment=Yb;Yt.Profiler=Qb;Yt.PureComponent=Mg;Yt.StrictMode=Jb;Yt.Suspense=n2;Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=c2;Yt.act=Ox;Yt.cloneElement=function(r,i,l){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var p=zx({},r.props),v=r.key,k=r.ref,S=r._owner;if(i!=null){if(i.ref!==void 0&&(k=i.ref,S=Dg.current),i.key!==void 0&&(v=""+i.key),r.type&&r.type.defaultProps)var d=r.type.defaultProps;for(V in i)Rx.call(i,V)&&!Fx.hasOwnProperty(V)&&(p[V]=i[V]===void 0&&d!==void 0?d[V]:i[V])}var V=arguments.length-2;if(V===1)p.children=l;else if(1<V){d=Array(V);for(var se=0;se<V;se++)d[se]=arguments[se+2];p.children=d}return{$$typeof:bh,type:r.type,key:v,ref:k,props:p,_owner:S}};Yt.createContext=function(r){return r={$$typeof:t2,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:e2,_context:r},r.Consumer=r};Yt.createElement=Bx;Yt.createFactory=function(r){var i=Bx.bind(null,r);return i.type=r,i};Yt.createRef=function(){return{current:null}};Yt.forwardRef=function(r){return{$$typeof:r2,render:r}};Yt.isValidElement=Lg;Yt.lazy=function(r){return{$$typeof:s2,_payload:{_status:-1,_result:r},_init:u2}};Yt.memo=function(r,i){return{$$typeof:i2,type:r,compare:i===void 0?null:i}};Yt.startTransition=function(r){var i=$d.transition;$d.transition={};try{r()}finally{$d.transition=i}};Yt.unstable_act=Ox;Yt.useCallback=function(r,i){return hi.current.useCallback(r,i)};Yt.useContext=function(r){return hi.current.useContext(r)};Yt.useDebugValue=function(){};Yt.useDeferredValue=function(r){return hi.current.useDeferredValue(r)};Yt.useEffect=function(r,i){return hi.current.useEffect(r,i)};Yt.useId=function(){return hi.current.useId()};Yt.useImperativeHandle=function(r,i,l){return hi.current.useImperativeHandle(r,i,l)};Yt.useInsertionEffect=function(r,i){return hi.current.useInsertionEffect(r,i)};Yt.useLayoutEffect=function(r,i){return hi.current.useLayoutEffect(r,i)};Yt.useMemo=function(r,i){return hi.current.useMemo(r,i)};Yt.useReducer=function(r,i,l){return hi.current.useReducer(r,i,l)};Yt.useRef=function(r){return hi.current.useRef(r)};Yt.useState=function(r){return hi.current.useState(r)};Yt.useSyncExternalStore=function(r,i,l){return hi.current.useSyncExternalStore(r,i,l)};Yt.useTransition=function(){return hi.current.useTransition()};Yt.version="18.3.1";Ax.exports=Yt;var Ce=Ax.exports;const h2=Ex(Ce);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d2=Ce,p2=Symbol.for("react.element"),f2=Symbol.for("react.fragment"),m2=Object.prototype.hasOwnProperty,g2=d2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y2={key:!0,ref:!0,__self:!0,__source:!0};function Nx(r,i,l){var p,v={},k=null,S=null;l!==void 0&&(k=""+l),i.key!==void 0&&(k=""+i.key),i.ref!==void 0&&(S=i.ref);for(p in i)m2.call(i,p)&&!y2.hasOwnProperty(p)&&(v[p]=i[p]);if(r&&r.defaultProps)for(p in i=r.defaultProps,i)v[p]===void 0&&(v[p]=i[p]);return{$$typeof:p2,type:r,key:k,ref:S,props:v,_owner:g2.current}}Mp.Fragment=f2;Mp.jsx=Nx;Mp.jsxs=Nx;Px.exports=Mp;var de=Px.exports,zm={},jx={exports:{}},Gi={},Vx={exports:{}},Ux={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function i(Pe,lt){var He=Pe.length;Pe.push(lt);e:for(;0<He;){var Rt=He-1>>>1,kt=Pe[Rt];if(0<v(kt,lt))Pe[Rt]=lt,Pe[He]=kt,He=Rt;else break e}}function l(Pe){return Pe.length===0?null:Pe[0]}function p(Pe){if(Pe.length===0)return null;var lt=Pe[0],He=Pe.pop();if(He!==lt){Pe[0]=He;e:for(var Rt=0,kt=Pe.length,An=kt>>>1;Rt<An;){var $r=2*(Rt+1)-1,ct=Pe[$r],_t=$r+1,rt=Pe[_t];if(0>v(ct,He))_t<kt&&0>v(rt,ct)?(Pe[Rt]=rt,Pe[_t]=He,Rt=_t):(Pe[Rt]=ct,Pe[$r]=He,Rt=$r);else if(_t<kt&&0>v(rt,He))Pe[Rt]=rt,Pe[_t]=He,Rt=_t;else break e}}return lt}function v(Pe,lt){var He=Pe.sortIndex-lt.sortIndex;return He!==0?He:Pe.id-lt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var k=performance;r.unstable_now=function(){return k.now()}}else{var S=Date,d=S.now();r.unstable_now=function(){return S.now()-d}}var V=[],se=[],ue=1,Q=null,U=3,Le=!1,Ee=!1,Fe=!1,gt=typeof setTimeout=="function"?setTimeout:null,le=typeof clearTimeout=="function"?clearTimeout:null,te=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ce(Pe){for(var lt=l(se);lt!==null;){if(lt.callback===null)p(se);else if(lt.startTime<=Pe)p(se),lt.sortIndex=lt.expirationTime,i(V,lt);else break;lt=l(se)}}function Ie(Pe){if(Fe=!1,ce(Pe),!Ee)if(l(V)!==null)Ee=!0,nr(Ne);else{var lt=l(se);lt!==null&&er(Ie,lt.startTime-Pe)}}function Ne(Pe,lt){Ee=!1,Fe&&(Fe=!1,le(Je),Je=-1),Le=!0;var He=U;try{for(ce(lt),Q=l(V);Q!==null&&(!(Q.expirationTime>lt)||Pe&&!St());){var Rt=Q.callback;if(typeof Rt=="function"){Q.callback=null,U=Q.priorityLevel;var kt=Rt(Q.expirationTime<=lt);lt=r.unstable_now(),typeof kt=="function"?Q.callback=kt:Q===l(V)&&p(V),ce(lt)}else p(V);Q=l(V)}if(Q!==null)var An=!0;else{var $r=l(se);$r!==null&&er(Ie,$r.startTime-lt),An=!1}return An}finally{Q=null,U=He,Le=!1}}var Ke=!1,qe=null,Je=-1,Et=5,wt=-1;function St(){return!(r.unstable_now()-wt<Et)}function or(){if(qe!==null){var Pe=r.unstable_now();wt=Pe;var lt=!0;try{lt=qe(!0,Pe)}finally{lt?yt():(Ke=!1,qe=null)}}else Ke=!1}var yt;if(typeof te=="function")yt=function(){te(or)};else if(typeof MessageChannel<"u"){var Mt=new MessageChannel,$t=Mt.port2;Mt.port1.onmessage=or,yt=function(){$t.postMessage(null)}}else yt=function(){gt(or,0)};function nr(Pe){qe=Pe,Ke||(Ke=!0,yt())}function er(Pe,lt){Je=gt(function(){Pe(r.unstable_now())},lt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Pe){Pe.callback=null},r.unstable_continueExecution=function(){Ee||Le||(Ee=!0,nr(Ne))},r.unstable_forceFrameRate=function(Pe){0>Pe||125<Pe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Et=0<Pe?Math.floor(1e3/Pe):5},r.unstable_getCurrentPriorityLevel=function(){return U},r.unstable_getFirstCallbackNode=function(){return l(V)},r.unstable_next=function(Pe){switch(U){case 1:case 2:case 3:var lt=3;break;default:lt=U}var He=U;U=lt;try{return Pe()}finally{U=He}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Pe,lt){switch(Pe){case 1:case 2:case 3:case 4:case 5:break;default:Pe=3}var He=U;U=Pe;try{return lt()}finally{U=He}},r.unstable_scheduleCallback=function(Pe,lt,He){var Rt=r.unstable_now();switch(typeof He=="object"&&He!==null?(He=He.delay,He=typeof He=="number"&&0<He?Rt+He:Rt):He=Rt,Pe){case 1:var kt=-1;break;case 2:kt=250;break;case 5:kt=1073741823;break;case 4:kt=1e4;break;default:kt=5e3}return kt=He+kt,Pe={id:ue++,callback:lt,priorityLevel:Pe,startTime:He,expirationTime:kt,sortIndex:-1},He>Rt?(Pe.sortIndex=He,i(se,Pe),l(V)===null&&Pe===l(se)&&(Fe?(le(Je),Je=-1):Fe=!0,er(Ie,He-Rt))):(Pe.sortIndex=kt,i(V,Pe),Ee||Le||(Ee=!0,nr(Ne))),Pe},r.unstable_shouldYield=St,r.unstable_wrapCallback=function(Pe){var lt=U;return function(){var He=U;U=lt;try{return Pe.apply(this,arguments)}finally{U=He}}}})(Ux);Vx.exports=Ux;var _2=Vx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v2=Ce,Zi=_2;function Oe(r){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+r,l=1;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+r+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var $x=new Set,ih={};function fl(r,i){ku(r,i),ku(r+"Capture",i)}function ku(r,i){for(ih[r]=i,r=0;r<i.length;r++)$x.add(i[r])}var vo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Dm=Object.prototype.hasOwnProperty,x2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gv={},yv={};function w2(r){return Dm.call(yv,r)?!0:Dm.call(gv,r)?!1:x2.test(r)?yv[r]=!0:(gv[r]=!0,!1)}function b2(r,i,l,p){if(l!==null&&l.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return p?!1:l!==null?!l.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function S2(r,i,l,p){if(i===null||typeof i>"u"||b2(r,i,l,p))return!0;if(p)return!1;if(l!==null)switch(l.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function di(r,i,l,p,v,k,S){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=p,this.attributeNamespace=v,this.mustUseProperty=l,this.propertyName=r,this.type=i,this.sanitizeURL=k,this.removeEmptyString=S}var On={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){On[r]=new di(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var i=r[0];On[i]=new di(i,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){On[r]=new di(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){On[r]=new di(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){On[r]=new di(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){On[r]=new di(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){On[r]=new di(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){On[r]=new di(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){On[r]=new di(r,5,!1,r.toLowerCase(),null,!1,!1)});var Rg=/[\-:]([a-z])/g;function Fg(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var i=r.replace(Rg,Fg);On[i]=new di(i,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var i=r.replace(Rg,Fg);On[i]=new di(i,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var i=r.replace(Rg,Fg);On[i]=new di(i,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){On[r]=new di(r,1,!1,r.toLowerCase(),null,!1,!1)});On.xlinkHref=new di("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){On[r]=new di(r,1,!1,r.toLowerCase(),null,!0,!0)});function Bg(r,i,l,p){var v=On.hasOwnProperty(i)?On[i]:null;(v!==null?v.type!==0:p||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(S2(i,l,v,p)&&(l=null),p||v===null?w2(i)&&(l===null?r.removeAttribute(i):r.setAttribute(i,""+l)):v.mustUseProperty?r[v.propertyName]=l===null?v.type===3?!1:"":l:(i=v.attributeName,p=v.attributeNamespace,l===null?r.removeAttribute(i):(v=v.type,l=v===3||v===4&&l===!0?"":""+l,p?r.setAttributeNS(p,i,l):r.setAttribute(i,l))))}var So=v2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,kd=Symbol.for("react.element"),su=Symbol.for("react.portal"),ou=Symbol.for("react.fragment"),Og=Symbol.for("react.strict_mode"),Lm=Symbol.for("react.profiler"),qx=Symbol.for("react.provider"),Zx=Symbol.for("react.context"),Ng=Symbol.for("react.forward_ref"),Rm=Symbol.for("react.suspense"),Fm=Symbol.for("react.suspense_list"),jg=Symbol.for("react.memo"),la=Symbol.for("react.lazy"),Gx=Symbol.for("react.offscreen"),_v=Symbol.iterator;function Rc(r){return r===null||typeof r!="object"?null:(r=_v&&r[_v]||r["@@iterator"],typeof r=="function"?r:null)}var Ur=Object.assign,im;function qc(r){if(im===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);im=i&&i[1]||""}return`
`+im+r}var sm=!1;function om(r,i){if(!r||sm)return"";sm=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(se){var p=se}Reflect.construct(r,[],i)}else{try{i.call()}catch(se){p=se}r.call(i.prototype)}else{try{throw Error()}catch(se){p=se}r()}}catch(se){if(se&&p&&typeof se.stack=="string"){for(var v=se.stack.split(`
`),k=p.stack.split(`
`),S=v.length-1,d=k.length-1;1<=S&&0<=d&&v[S]!==k[d];)d--;for(;1<=S&&0<=d;S--,d--)if(v[S]!==k[d]){if(S!==1||d!==1)do if(S--,d--,0>d||v[S]!==k[d]){var V=`
`+v[S].replace(" at new "," at ");return r.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",r.displayName)),V}while(1<=S&&0<=d);break}}}finally{sm=!1,Error.prepareStackTrace=l}return(r=r?r.displayName||r.name:"")?qc(r):""}function k2(r){switch(r.tag){case 5:return qc(r.type);case 16:return qc("Lazy");case 13:return qc("Suspense");case 19:return qc("SuspenseList");case 0:case 2:case 15:return r=om(r.type,!1),r;case 11:return r=om(r.type.render,!1),r;case 1:return r=om(r.type,!0),r;default:return""}}function Bm(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case ou:return"Fragment";case su:return"Portal";case Lm:return"Profiler";case Og:return"StrictMode";case Rm:return"Suspense";case Fm:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case Zx:return(r.displayName||"Context")+".Consumer";case qx:return(r._context.displayName||"Context")+".Provider";case Ng:var i=r.render;return r=r.displayName,r||(r=i.displayName||i.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case jg:return i=r.displayName||null,i!==null?i:Bm(r.type)||"Memo";case la:i=r._payload,r=r._init;try{return Bm(r(i))}catch{}}return null}function T2(r){var i=r.type;switch(r.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=i.render,r=r.displayName||r.name||"",i.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bm(i);case 8:return i===Og?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Sa(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Hx(r){var i=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function C2(r){var i=Hx(r)?"checked":"value",l=Object.getOwnPropertyDescriptor(r.constructor.prototype,i),p=""+r[i];if(!r.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var v=l.get,k=l.set;return Object.defineProperty(r,i,{configurable:!0,get:function(){return v.call(this)},set:function(S){p=""+S,k.call(this,S)}}),Object.defineProperty(r,i,{enumerable:l.enumerable}),{getValue:function(){return p},setValue:function(S){p=""+S},stopTracking:function(){r._valueTracker=null,delete r[i]}}}}function Td(r){r._valueTracker||(r._valueTracker=C2(r))}function Wx(r){if(!r)return!1;var i=r._valueTracker;if(!i)return!0;var l=i.getValue(),p="";return r&&(p=Hx(r)?r.checked?"true":"false":r.value),r=p,r!==l?(i.setValue(r),!0):!1}function op(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Om(r,i){var l=i.checked;return Ur({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??r._wrapperState.initialChecked})}function vv(r,i){var l=i.defaultValue==null?"":i.defaultValue,p=i.checked!=null?i.checked:i.defaultChecked;l=Sa(i.value!=null?i.value:l),r._wrapperState={initialChecked:p,initialValue:l,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Xx(r,i){i=i.checked,i!=null&&Bg(r,"checked",i,!1)}function Nm(r,i){Xx(r,i);var l=Sa(i.value),p=i.type;if(l!=null)p==="number"?(l===0&&r.value===""||r.value!=l)&&(r.value=""+l):r.value!==""+l&&(r.value=""+l);else if(p==="submit"||p==="reset"){r.removeAttribute("value");return}i.hasOwnProperty("value")?jm(r,i.type,l):i.hasOwnProperty("defaultValue")&&jm(r,i.type,Sa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(r.defaultChecked=!!i.defaultChecked)}function xv(r,i,l){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var p=i.type;if(!(p!=="submit"&&p!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+r._wrapperState.initialValue,l||i===r.value||(r.value=i),r.defaultValue=i}l=r.name,l!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,l!==""&&(r.name=l)}function jm(r,i,l){(i!=="number"||op(r.ownerDocument)!==r)&&(l==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+l&&(r.defaultValue=""+l))}var Zc=Array.isArray;function yu(r,i,l,p){if(r=r.options,i){i={};for(var v=0;v<l.length;v++)i["$"+l[v]]=!0;for(l=0;l<r.length;l++)v=i.hasOwnProperty("$"+r[l].value),r[l].selected!==v&&(r[l].selected=v),v&&p&&(r[l].defaultSelected=!0)}else{for(l=""+Sa(l),i=null,v=0;v<r.length;v++){if(r[v].value===l){r[v].selected=!0,p&&(r[v].defaultSelected=!0);return}i!==null||r[v].disabled||(i=r[v])}i!==null&&(i.selected=!0)}}function Vm(r,i){if(i.dangerouslySetInnerHTML!=null)throw Error(Oe(91));return Ur({},i,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function wv(r,i){var l=i.value;if(l==null){if(l=i.children,i=i.defaultValue,l!=null){if(i!=null)throw Error(Oe(92));if(Zc(l)){if(1<l.length)throw Error(Oe(93));l=l[0]}i=l}i==null&&(i=""),l=i}r._wrapperState={initialValue:Sa(l)}}function Kx(r,i){var l=Sa(i.value),p=Sa(i.defaultValue);l!=null&&(l=""+l,l!==r.value&&(r.value=l),i.defaultValue==null&&r.defaultValue!==l&&(r.defaultValue=l)),p!=null&&(r.defaultValue=""+p)}function bv(r){var i=r.textContent;i===r._wrapperState.initialValue&&i!==""&&i!==null&&(r.value=i)}function Yx(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Um(r,i){return r==null||r==="http://www.w3.org/1999/xhtml"?Yx(i):r==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Cd,Jx=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,l,p,v){MSApp.execUnsafeLocalFunction(function(){return r(i,l,p,v)})}:r}(function(r,i){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=i;else{for(Cd=Cd||document.createElement("div"),Cd.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Cd.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;i.firstChild;)r.appendChild(i.firstChild)}});function sh(r,i){if(i){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=i;return}}r.textContent=i}var Xc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},I2=["Webkit","ms","Moz","O"];Object.keys(Xc).forEach(function(r){I2.forEach(function(i){i=i+r.charAt(0).toUpperCase()+r.substring(1),Xc[i]=Xc[r]})});function Qx(r,i,l){return i==null||typeof i=="boolean"||i===""?"":l||typeof i!="number"||i===0||Xc.hasOwnProperty(r)&&Xc[r]?(""+i).trim():i+"px"}function e0(r,i){r=r.style;for(var l in i)if(i.hasOwnProperty(l)){var p=l.indexOf("--")===0,v=Qx(l,i[l],p);l==="float"&&(l="cssFloat"),p?r.setProperty(l,v):r[l]=v}}var E2=Ur({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $m(r,i){if(i){if(E2[r]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(Oe(137,r));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(Oe(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(Oe(61))}if(i.style!=null&&typeof i.style!="object")throw Error(Oe(62))}}function qm(r,i){if(r.indexOf("-")===-1)return typeof i.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zm=null;function Vg(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Gm=null,_u=null,vu=null;function Sv(r){if(r=Th(r)){if(typeof Gm!="function")throw Error(Oe(280));var i=r.stateNode;i&&(i=Fp(i),Gm(r.stateNode,r.type,i))}}function t0(r){_u?vu?vu.push(r):vu=[r]:_u=r}function r0(){if(_u){var r=_u,i=vu;if(vu=_u=null,Sv(r),i)for(r=0;r<i.length;r++)Sv(i[r])}}function n0(r,i){return r(i)}function i0(){}var am=!1;function s0(r,i,l){if(am)return r(i,l);am=!0;try{return n0(r,i,l)}finally{am=!1,(_u!==null||vu!==null)&&(i0(),r0())}}function oh(r,i){var l=r.stateNode;if(l===null)return null;var p=Fp(l);if(p===null)return null;l=p[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(Oe(231,i,typeof l));return l}var Hm=!1;if(vo)try{var Fc={};Object.defineProperty(Fc,"passive",{get:function(){Hm=!0}}),window.addEventListener("test",Fc,Fc),window.removeEventListener("test",Fc,Fc)}catch{Hm=!1}function P2(r,i,l,p,v,k,S,d,V){var se=Array.prototype.slice.call(arguments,3);try{i.apply(l,se)}catch(ue){this.onError(ue)}}var Kc=!1,ap=null,lp=!1,Wm=null,A2={onError:function(r){Kc=!0,ap=r}};function M2(r,i,l,p,v,k,S,d,V){Kc=!1,ap=null,P2.apply(A2,arguments)}function z2(r,i,l,p,v,k,S,d,V){if(M2.apply(this,arguments),Kc){if(Kc){var se=ap;Kc=!1,ap=null}else throw Error(Oe(198));lp||(lp=!0,Wm=se)}}function ml(r){var i=r,l=r;if(r.alternate)for(;i.return;)i=i.return;else{r=i;do i=r,i.flags&4098&&(l=i.return),r=i.return;while(r)}return i.tag===3?l:null}function o0(r){if(r.tag===13){var i=r.memoizedState;if(i===null&&(r=r.alternate,r!==null&&(i=r.memoizedState)),i!==null)return i.dehydrated}return null}function kv(r){if(ml(r)!==r)throw Error(Oe(188))}function D2(r){var i=r.alternate;if(!i){if(i=ml(r),i===null)throw Error(Oe(188));return i!==r?null:r}for(var l=r,p=i;;){var v=l.return;if(v===null)break;var k=v.alternate;if(k===null){if(p=v.return,p!==null){l=p;continue}break}if(v.child===k.child){for(k=v.child;k;){if(k===l)return kv(v),r;if(k===p)return kv(v),i;k=k.sibling}throw Error(Oe(188))}if(l.return!==p.return)l=v,p=k;else{for(var S=!1,d=v.child;d;){if(d===l){S=!0,l=v,p=k;break}if(d===p){S=!0,p=v,l=k;break}d=d.sibling}if(!S){for(d=k.child;d;){if(d===l){S=!0,l=k,p=v;break}if(d===p){S=!0,p=k,l=v;break}d=d.sibling}if(!S)throw Error(Oe(189))}}if(l.alternate!==p)throw Error(Oe(190))}if(l.tag!==3)throw Error(Oe(188));return l.stateNode.current===l?r:i}function a0(r){return r=D2(r),r!==null?l0(r):null}function l0(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var i=l0(r);if(i!==null)return i;r=r.sibling}return null}var u0=Zi.unstable_scheduleCallback,Tv=Zi.unstable_cancelCallback,L2=Zi.unstable_shouldYield,R2=Zi.unstable_requestPaint,Xr=Zi.unstable_now,F2=Zi.unstable_getCurrentPriorityLevel,Ug=Zi.unstable_ImmediatePriority,c0=Zi.unstable_UserBlockingPriority,up=Zi.unstable_NormalPriority,B2=Zi.unstable_LowPriority,h0=Zi.unstable_IdlePriority,zp=null,Gs=null;function O2(r){if(Gs&&typeof Gs.onCommitFiberRoot=="function")try{Gs.onCommitFiberRoot(zp,r,void 0,(r.current.flags&128)===128)}catch{}}var As=Math.clz32?Math.clz32:V2,N2=Math.log,j2=Math.LN2;function V2(r){return r>>>=0,r===0?32:31-(N2(r)/j2|0)|0}var Id=64,Ed=4194304;function Gc(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function cp(r,i){var l=r.pendingLanes;if(l===0)return 0;var p=0,v=r.suspendedLanes,k=r.pingedLanes,S=l&268435455;if(S!==0){var d=S&~v;d!==0?p=Gc(d):(k&=S,k!==0&&(p=Gc(k)))}else S=l&~v,S!==0?p=Gc(S):k!==0&&(p=Gc(k));if(p===0)return 0;if(i!==0&&i!==p&&!(i&v)&&(v=p&-p,k=i&-i,v>=k||v===16&&(k&4194240)!==0))return i;if(p&4&&(p|=l&16),i=r.entangledLanes,i!==0)for(r=r.entanglements,i&=p;0<i;)l=31-As(i),v=1<<l,p|=r[l],i&=~v;return p}function U2(r,i){switch(r){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $2(r,i){for(var l=r.suspendedLanes,p=r.pingedLanes,v=r.expirationTimes,k=r.pendingLanes;0<k;){var S=31-As(k),d=1<<S,V=v[S];V===-1?(!(d&l)||d&p)&&(v[S]=U2(d,i)):V<=i&&(r.expiredLanes|=d),k&=~d}}function Xm(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function d0(){var r=Id;return Id<<=1,!(Id&4194240)&&(Id=64),r}function lm(r){for(var i=[],l=0;31>l;l++)i.push(r);return i}function Sh(r,i,l){r.pendingLanes|=i,i!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,i=31-As(i),r[i]=l}function q2(r,i){var l=r.pendingLanes&~i;r.pendingLanes=i,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=i,r.mutableReadLanes&=i,r.entangledLanes&=i,i=r.entanglements;var p=r.eventTimes;for(r=r.expirationTimes;0<l;){var v=31-As(l),k=1<<v;i[v]=0,p[v]=-1,r[v]=-1,l&=~k}}function $g(r,i){var l=r.entangledLanes|=i;for(r=r.entanglements;l;){var p=31-As(l),v=1<<p;v&i|r[p]&i&&(r[p]|=i),l&=~v}}var _r=0;function p0(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var f0,qg,m0,g0,y0,Km=!1,Pd=[],fa=null,ma=null,ga=null,ah=new Map,lh=new Map,ca=[],Z2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Cv(r,i){switch(r){case"focusin":case"focusout":fa=null;break;case"dragenter":case"dragleave":ma=null;break;case"mouseover":case"mouseout":ga=null;break;case"pointerover":case"pointerout":ah.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":lh.delete(i.pointerId)}}function Bc(r,i,l,p,v,k){return r===null||r.nativeEvent!==k?(r={blockedOn:i,domEventName:l,eventSystemFlags:p,nativeEvent:k,targetContainers:[v]},i!==null&&(i=Th(i),i!==null&&qg(i)),r):(r.eventSystemFlags|=p,i=r.targetContainers,v!==null&&i.indexOf(v)===-1&&i.push(v),r)}function G2(r,i,l,p,v){switch(i){case"focusin":return fa=Bc(fa,r,i,l,p,v),!0;case"dragenter":return ma=Bc(ma,r,i,l,p,v),!0;case"mouseover":return ga=Bc(ga,r,i,l,p,v),!0;case"pointerover":var k=v.pointerId;return ah.set(k,Bc(ah.get(k)||null,r,i,l,p,v)),!0;case"gotpointercapture":return k=v.pointerId,lh.set(k,Bc(lh.get(k)||null,r,i,l,p,v)),!0}return!1}function _0(r){var i=il(r.target);if(i!==null){var l=ml(i);if(l!==null){if(i=l.tag,i===13){if(i=o0(l),i!==null){r.blockedOn=i,y0(r.priority,function(){m0(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function qd(r){if(r.blockedOn!==null)return!1;for(var i=r.targetContainers;0<i.length;){var l=Ym(r.domEventName,r.eventSystemFlags,i[0],r.nativeEvent);if(l===null){l=r.nativeEvent;var p=new l.constructor(l.type,l);Zm=p,l.target.dispatchEvent(p),Zm=null}else return i=Th(l),i!==null&&qg(i),r.blockedOn=l,!1;i.shift()}return!0}function Iv(r,i,l){qd(r)&&l.delete(i)}function H2(){Km=!1,fa!==null&&qd(fa)&&(fa=null),ma!==null&&qd(ma)&&(ma=null),ga!==null&&qd(ga)&&(ga=null),ah.forEach(Iv),lh.forEach(Iv)}function Oc(r,i){r.blockedOn===i&&(r.blockedOn=null,Km||(Km=!0,Zi.unstable_scheduleCallback(Zi.unstable_NormalPriority,H2)))}function uh(r){function i(v){return Oc(v,r)}if(0<Pd.length){Oc(Pd[0],r);for(var l=1;l<Pd.length;l++){var p=Pd[l];p.blockedOn===r&&(p.blockedOn=null)}}for(fa!==null&&Oc(fa,r),ma!==null&&Oc(ma,r),ga!==null&&Oc(ga,r),ah.forEach(i),lh.forEach(i),l=0;l<ca.length;l++)p=ca[l],p.blockedOn===r&&(p.blockedOn=null);for(;0<ca.length&&(l=ca[0],l.blockedOn===null);)_0(l),l.blockedOn===null&&ca.shift()}var xu=So.ReactCurrentBatchConfig,hp=!0;function W2(r,i,l,p){var v=_r,k=xu.transition;xu.transition=null;try{_r=1,Zg(r,i,l,p)}finally{_r=v,xu.transition=k}}function X2(r,i,l,p){var v=_r,k=xu.transition;xu.transition=null;try{_r=4,Zg(r,i,l,p)}finally{_r=v,xu.transition=k}}function Zg(r,i,l,p){if(hp){var v=Ym(r,i,l,p);if(v===null)_m(r,i,p,dp,l),Cv(r,p);else if(G2(v,r,i,l,p))p.stopPropagation();else if(Cv(r,p),i&4&&-1<Z2.indexOf(r)){for(;v!==null;){var k=Th(v);if(k!==null&&f0(k),k=Ym(r,i,l,p),k===null&&_m(r,i,p,dp,l),k===v)break;v=k}v!==null&&p.stopPropagation()}else _m(r,i,p,null,l)}}var dp=null;function Ym(r,i,l,p){if(dp=null,r=Vg(p),r=il(r),r!==null)if(i=ml(r),i===null)r=null;else if(l=i.tag,l===13){if(r=o0(i),r!==null)return r;r=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;r=null}else i!==r&&(r=null);return dp=r,null}function v0(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(F2()){case Ug:return 1;case c0:return 4;case up:case B2:return 16;case h0:return 536870912;default:return 16}default:return 16}}var da=null,Gg=null,Zd=null;function x0(){if(Zd)return Zd;var r,i=Gg,l=i.length,p,v="value"in da?da.value:da.textContent,k=v.length;for(r=0;r<l&&i[r]===v[r];r++);var S=l-r;for(p=1;p<=S&&i[l-p]===v[k-p];p++);return Zd=v.slice(r,1<p?1-p:void 0)}function Gd(r){var i=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&i===13&&(r=13)):r=i,r===10&&(r=13),32<=r||r===13?r:0}function Ad(){return!0}function Ev(){return!1}function Hi(r){function i(l,p,v,k,S){this._reactName=l,this._targetInst=v,this.type=p,this.nativeEvent=k,this.target=S,this.currentTarget=null;for(var d in r)r.hasOwnProperty(d)&&(l=r[d],this[d]=l?l(k):k[d]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?Ad:Ev,this.isPropagationStopped=Ev,this}return Ur(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ad)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ad)},persist:function(){},isPersistent:Ad}),i}var zu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hg=Hi(zu),kh=Ur({},zu,{view:0,detail:0}),K2=Hi(kh),um,cm,Nc,Dp=Ur({},kh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wg,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Nc&&(Nc&&r.type==="mousemove"?(um=r.screenX-Nc.screenX,cm=r.screenY-Nc.screenY):cm=um=0,Nc=r),um)},movementY:function(r){return"movementY"in r?r.movementY:cm}}),Pv=Hi(Dp),Y2=Ur({},Dp,{dataTransfer:0}),J2=Hi(Y2),Q2=Ur({},kh,{relatedTarget:0}),hm=Hi(Q2),eS=Ur({},zu,{animationName:0,elapsedTime:0,pseudoElement:0}),tS=Hi(eS),rS=Ur({},zu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),nS=Hi(rS),iS=Ur({},zu,{data:0}),Av=Hi(iS),sS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},aS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lS(r){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(r):(r=aS[r])?!!i[r]:!1}function Wg(){return lS}var uS=Ur({},kh,{key:function(r){if(r.key){var i=sS[r.key]||r.key;if(i!=="Unidentified")return i}return r.type==="keypress"?(r=Gd(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?oS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wg,charCode:function(r){return r.type==="keypress"?Gd(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Gd(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),cS=Hi(uS),hS=Ur({},Dp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mv=Hi(hS),dS=Ur({},kh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wg}),pS=Hi(dS),fS=Ur({},zu,{propertyName:0,elapsedTime:0,pseudoElement:0}),mS=Hi(fS),gS=Ur({},Dp,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),yS=Hi(gS),_S=[9,13,27,32],Xg=vo&&"CompositionEvent"in window,Yc=null;vo&&"documentMode"in document&&(Yc=document.documentMode);var vS=vo&&"TextEvent"in window&&!Yc,w0=vo&&(!Xg||Yc&&8<Yc&&11>=Yc),zv=" ",Dv=!1;function b0(r,i){switch(r){case"keyup":return _S.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function S0(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var au=!1;function xS(r,i){switch(r){case"compositionend":return S0(i);case"keypress":return i.which!==32?null:(Dv=!0,zv);case"textInput":return r=i.data,r===zv&&Dv?null:r;default:return null}}function wS(r,i){if(au)return r==="compositionend"||!Xg&&b0(r,i)?(r=x0(),Zd=Gg=da=null,au=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return w0&&i.locale!=="ko"?null:i.data;default:return null}}var bS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lv(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i==="input"?!!bS[r.type]:i==="textarea"}function k0(r,i,l,p){t0(p),i=pp(i,"onChange"),0<i.length&&(l=new Hg("onChange","change",null,l,p),r.push({event:l,listeners:i}))}var Jc=null,ch=null;function SS(r){R0(r,0)}function Lp(r){var i=cu(r);if(Wx(i))return r}function kS(r,i){if(r==="change")return i}var T0=!1;if(vo){var dm;if(vo){var pm="oninput"in document;if(!pm){var Rv=document.createElement("div");Rv.setAttribute("oninput","return;"),pm=typeof Rv.oninput=="function"}dm=pm}else dm=!1;T0=dm&&(!document.documentMode||9<document.documentMode)}function Fv(){Jc&&(Jc.detachEvent("onpropertychange",C0),ch=Jc=null)}function C0(r){if(r.propertyName==="value"&&Lp(ch)){var i=[];k0(i,ch,r,Vg(r)),s0(SS,i)}}function TS(r,i,l){r==="focusin"?(Fv(),Jc=i,ch=l,Jc.attachEvent("onpropertychange",C0)):r==="focusout"&&Fv()}function CS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Lp(ch)}function IS(r,i){if(r==="click")return Lp(i)}function ES(r,i){if(r==="input"||r==="change")return Lp(i)}function PS(r,i){return r===i&&(r!==0||1/r===1/i)||r!==r&&i!==i}var zs=typeof Object.is=="function"?Object.is:PS;function hh(r,i){if(zs(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;var l=Object.keys(r),p=Object.keys(i);if(l.length!==p.length)return!1;for(p=0;p<l.length;p++){var v=l[p];if(!Dm.call(i,v)||!zs(r[v],i[v]))return!1}return!0}function Bv(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Ov(r,i){var l=Bv(r);r=0;for(var p;l;){if(l.nodeType===3){if(p=r+l.textContent.length,r<=i&&p>=i)return{node:l,offset:i-r};r=p}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Bv(l)}}function I0(r,i){return r&&i?r===i?!0:r&&r.nodeType===3?!1:i&&i.nodeType===3?I0(r,i.parentNode):"contains"in r?r.contains(i):r.compareDocumentPosition?!!(r.compareDocumentPosition(i)&16):!1:!1}function E0(){for(var r=window,i=op();i instanceof r.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)r=i.contentWindow;else break;i=op(r.document)}return i}function Kg(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i&&(i==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||i==="textarea"||r.contentEditable==="true")}function AS(r){var i=E0(),l=r.focusedElem,p=r.selectionRange;if(i!==l&&l&&l.ownerDocument&&I0(l.ownerDocument.documentElement,l)){if(p!==null&&Kg(l)){if(i=p.start,r=p.end,r===void 0&&(r=i),"selectionStart"in l)l.selectionStart=i,l.selectionEnd=Math.min(r,l.value.length);else if(r=(i=l.ownerDocument||document)&&i.defaultView||window,r.getSelection){r=r.getSelection();var v=l.textContent.length,k=Math.min(p.start,v);p=p.end===void 0?k:Math.min(p.end,v),!r.extend&&k>p&&(v=p,p=k,k=v),v=Ov(l,k);var S=Ov(l,p);v&&S&&(r.rangeCount!==1||r.anchorNode!==v.node||r.anchorOffset!==v.offset||r.focusNode!==S.node||r.focusOffset!==S.offset)&&(i=i.createRange(),i.setStart(v.node,v.offset),r.removeAllRanges(),k>p?(r.addRange(i),r.extend(S.node,S.offset)):(i.setEnd(S.node,S.offset),r.addRange(i)))}}for(i=[],r=l;r=r.parentNode;)r.nodeType===1&&i.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<i.length;l++)r=i[l],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var MS=vo&&"documentMode"in document&&11>=document.documentMode,lu=null,Jm=null,Qc=null,Qm=!1;function Nv(r,i,l){var p=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Qm||lu==null||lu!==op(p)||(p=lu,"selectionStart"in p&&Kg(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Qc&&hh(Qc,p)||(Qc=p,p=pp(Jm,"onSelect"),0<p.length&&(i=new Hg("onSelect","select",null,i,l),r.push({event:i,listeners:p}),i.target=lu)))}function Md(r,i){var l={};return l[r.toLowerCase()]=i.toLowerCase(),l["Webkit"+r]="webkit"+i,l["Moz"+r]="moz"+i,l}var uu={animationend:Md("Animation","AnimationEnd"),animationiteration:Md("Animation","AnimationIteration"),animationstart:Md("Animation","AnimationStart"),transitionend:Md("Transition","TransitionEnd")},fm={},P0={};vo&&(P0=document.createElement("div").style,"AnimationEvent"in window||(delete uu.animationend.animation,delete uu.animationiteration.animation,delete uu.animationstart.animation),"TransitionEvent"in window||delete uu.transitionend.transition);function Rp(r){if(fm[r])return fm[r];if(!uu[r])return r;var i=uu[r],l;for(l in i)if(i.hasOwnProperty(l)&&l in P0)return fm[r]=i[l];return r}var A0=Rp("animationend"),M0=Rp("animationiteration"),z0=Rp("animationstart"),D0=Rp("transitionend"),L0=new Map,jv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ta(r,i){L0.set(r,i),fl(i,[r])}for(var mm=0;mm<jv.length;mm++){var gm=jv[mm],zS=gm.toLowerCase(),DS=gm[0].toUpperCase()+gm.slice(1);Ta(zS,"on"+DS)}Ta(A0,"onAnimationEnd");Ta(M0,"onAnimationIteration");Ta(z0,"onAnimationStart");Ta("dblclick","onDoubleClick");Ta("focusin","onFocus");Ta("focusout","onBlur");Ta(D0,"onTransitionEnd");ku("onMouseEnter",["mouseout","mouseover"]);ku("onMouseLeave",["mouseout","mouseover"]);ku("onPointerEnter",["pointerout","pointerover"]);ku("onPointerLeave",["pointerout","pointerover"]);fl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fl("onBeforeInput",["compositionend","keypress","textInput","paste"]);fl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),LS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hc));function Vv(r,i,l){var p=r.type||"unknown-event";r.currentTarget=l,z2(p,i,void 0,r),r.currentTarget=null}function R0(r,i){i=(i&4)!==0;for(var l=0;l<r.length;l++){var p=r[l],v=p.event;p=p.listeners;e:{var k=void 0;if(i)for(var S=p.length-1;0<=S;S--){var d=p[S],V=d.instance,se=d.currentTarget;if(d=d.listener,V!==k&&v.isPropagationStopped())break e;Vv(v,d,se),k=V}else for(S=0;S<p.length;S++){if(d=p[S],V=d.instance,se=d.currentTarget,d=d.listener,V!==k&&v.isPropagationStopped())break e;Vv(v,d,se),k=V}}}if(lp)throw r=Wm,lp=!1,Wm=null,r}function Ar(r,i){var l=i[ig];l===void 0&&(l=i[ig]=new Set);var p=r+"__bubble";l.has(p)||(F0(i,r,2,!1),l.add(p))}function ym(r,i,l){var p=0;i&&(p|=4),F0(l,r,p,i)}var zd="_reactListening"+Math.random().toString(36).slice(2);function dh(r){if(!r[zd]){r[zd]=!0,$x.forEach(function(l){l!=="selectionchange"&&(LS.has(l)||ym(l,!1,r),ym(l,!0,r))});var i=r.nodeType===9?r:r.ownerDocument;i===null||i[zd]||(i[zd]=!0,ym("selectionchange",!1,i))}}function F0(r,i,l,p){switch(v0(i)){case 1:var v=W2;break;case 4:v=X2;break;default:v=Zg}l=v.bind(null,i,l,r),v=void 0,!Hm||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(v=!0),p?v!==void 0?r.addEventListener(i,l,{capture:!0,passive:v}):r.addEventListener(i,l,!0):v!==void 0?r.addEventListener(i,l,{passive:v}):r.addEventListener(i,l,!1)}function _m(r,i,l,p,v){var k=p;if(!(i&1)&&!(i&2)&&p!==null)e:for(;;){if(p===null)return;var S=p.tag;if(S===3||S===4){var d=p.stateNode.containerInfo;if(d===v||d.nodeType===8&&d.parentNode===v)break;if(S===4)for(S=p.return;S!==null;){var V=S.tag;if((V===3||V===4)&&(V=S.stateNode.containerInfo,V===v||V.nodeType===8&&V.parentNode===v))return;S=S.return}for(;d!==null;){if(S=il(d),S===null)return;if(V=S.tag,V===5||V===6){p=k=S;continue e}d=d.parentNode}}p=p.return}s0(function(){var se=k,ue=Vg(l),Q=[];e:{var U=L0.get(r);if(U!==void 0){var Le=Hg,Ee=r;switch(r){case"keypress":if(Gd(l)===0)break e;case"keydown":case"keyup":Le=cS;break;case"focusin":Ee="focus",Le=hm;break;case"focusout":Ee="blur",Le=hm;break;case"beforeblur":case"afterblur":Le=hm;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Le=Pv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Le=J2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Le=pS;break;case A0:case M0:case z0:Le=tS;break;case D0:Le=mS;break;case"scroll":Le=K2;break;case"wheel":Le=yS;break;case"copy":case"cut":case"paste":Le=nS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Le=Mv}var Fe=(i&4)!==0,gt=!Fe&&r==="scroll",le=Fe?U!==null?U+"Capture":null:U;Fe=[];for(var te=se,ce;te!==null;){ce=te;var Ie=ce.stateNode;if(ce.tag===5&&Ie!==null&&(ce=Ie,le!==null&&(Ie=oh(te,le),Ie!=null&&Fe.push(ph(te,Ie,ce)))),gt)break;te=te.return}0<Fe.length&&(U=new Le(U,Ee,null,l,ue),Q.push({event:U,listeners:Fe}))}}if(!(i&7)){e:{if(U=r==="mouseover"||r==="pointerover",Le=r==="mouseout"||r==="pointerout",U&&l!==Zm&&(Ee=l.relatedTarget||l.fromElement)&&(il(Ee)||Ee[xo]))break e;if((Le||U)&&(U=ue.window===ue?ue:(U=ue.ownerDocument)?U.defaultView||U.parentWindow:window,Le?(Ee=l.relatedTarget||l.toElement,Le=se,Ee=Ee?il(Ee):null,Ee!==null&&(gt=ml(Ee),Ee!==gt||Ee.tag!==5&&Ee.tag!==6)&&(Ee=null)):(Le=null,Ee=se),Le!==Ee)){if(Fe=Pv,Ie="onMouseLeave",le="onMouseEnter",te="mouse",(r==="pointerout"||r==="pointerover")&&(Fe=Mv,Ie="onPointerLeave",le="onPointerEnter",te="pointer"),gt=Le==null?U:cu(Le),ce=Ee==null?U:cu(Ee),U=new Fe(Ie,te+"leave",Le,l,ue),U.target=gt,U.relatedTarget=ce,Ie=null,il(ue)===se&&(Fe=new Fe(le,te+"enter",Ee,l,ue),Fe.target=ce,Fe.relatedTarget=gt,Ie=Fe),gt=Ie,Le&&Ee)t:{for(Fe=Le,le=Ee,te=0,ce=Fe;ce;ce=iu(ce))te++;for(ce=0,Ie=le;Ie;Ie=iu(Ie))ce++;for(;0<te-ce;)Fe=iu(Fe),te--;for(;0<ce-te;)le=iu(le),ce--;for(;te--;){if(Fe===le||le!==null&&Fe===le.alternate)break t;Fe=iu(Fe),le=iu(le)}Fe=null}else Fe=null;Le!==null&&Uv(Q,U,Le,Fe,!1),Ee!==null&&gt!==null&&Uv(Q,gt,Ee,Fe,!0)}}e:{if(U=se?cu(se):window,Le=U.nodeName&&U.nodeName.toLowerCase(),Le==="select"||Le==="input"&&U.type==="file")var Ne=kS;else if(Lv(U))if(T0)Ne=ES;else{Ne=CS;var Ke=TS}else(Le=U.nodeName)&&Le.toLowerCase()==="input"&&(U.type==="checkbox"||U.type==="radio")&&(Ne=IS);if(Ne&&(Ne=Ne(r,se))){k0(Q,Ne,l,ue);break e}Ke&&Ke(r,U,se),r==="focusout"&&(Ke=U._wrapperState)&&Ke.controlled&&U.type==="number"&&jm(U,"number",U.value)}switch(Ke=se?cu(se):window,r){case"focusin":(Lv(Ke)||Ke.contentEditable==="true")&&(lu=Ke,Jm=se,Qc=null);break;case"focusout":Qc=Jm=lu=null;break;case"mousedown":Qm=!0;break;case"contextmenu":case"mouseup":case"dragend":Qm=!1,Nv(Q,l,ue);break;case"selectionchange":if(MS)break;case"keydown":case"keyup":Nv(Q,l,ue)}var qe;if(Xg)e:{switch(r){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else au?b0(r,l)&&(Je="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(Je="onCompositionStart");Je&&(w0&&l.locale!=="ko"&&(au||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&au&&(qe=x0()):(da=ue,Gg="value"in da?da.value:da.textContent,au=!0)),Ke=pp(se,Je),0<Ke.length&&(Je=new Av(Je,r,null,l,ue),Q.push({event:Je,listeners:Ke}),qe?Je.data=qe:(qe=S0(l),qe!==null&&(Je.data=qe)))),(qe=vS?xS(r,l):wS(r,l))&&(se=pp(se,"onBeforeInput"),0<se.length&&(ue=new Av("onBeforeInput","beforeinput",null,l,ue),Q.push({event:ue,listeners:se}),ue.data=qe))}R0(Q,i)})}function ph(r,i,l){return{instance:r,listener:i,currentTarget:l}}function pp(r,i){for(var l=i+"Capture",p=[];r!==null;){var v=r,k=v.stateNode;v.tag===5&&k!==null&&(v=k,k=oh(r,l),k!=null&&p.unshift(ph(r,k,v)),k=oh(r,i),k!=null&&p.push(ph(r,k,v))),r=r.return}return p}function iu(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Uv(r,i,l,p,v){for(var k=i._reactName,S=[];l!==null&&l!==p;){var d=l,V=d.alternate,se=d.stateNode;if(V!==null&&V===p)break;d.tag===5&&se!==null&&(d=se,v?(V=oh(l,k),V!=null&&S.unshift(ph(l,V,d))):v||(V=oh(l,k),V!=null&&S.push(ph(l,V,d)))),l=l.return}S.length!==0&&r.push({event:i,listeners:S})}var RS=/\r\n?/g,FS=/\u0000|\uFFFD/g;function $v(r){return(typeof r=="string"?r:""+r).replace(RS,`
`).replace(FS,"")}function Dd(r,i,l){if(i=$v(i),$v(r)!==i&&l)throw Error(Oe(425))}function fp(){}var eg=null,tg=null;function rg(r,i){return r==="textarea"||r==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var ng=typeof setTimeout=="function"?setTimeout:void 0,BS=typeof clearTimeout=="function"?clearTimeout:void 0,qv=typeof Promise=="function"?Promise:void 0,OS=typeof queueMicrotask=="function"?queueMicrotask:typeof qv<"u"?function(r){return qv.resolve(null).then(r).catch(NS)}:ng;function NS(r){setTimeout(function(){throw r})}function vm(r,i){var l=i,p=0;do{var v=l.nextSibling;if(r.removeChild(l),v&&v.nodeType===8)if(l=v.data,l==="/$"){if(p===0){r.removeChild(v),uh(i);return}p--}else l!=="$"&&l!=="$?"&&l!=="$!"||p++;l=v}while(l);uh(i)}function ya(r){for(;r!=null;r=r.nextSibling){var i=r.nodeType;if(i===1||i===3)break;if(i===8){if(i=r.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return r}function Zv(r){r=r.previousSibling;for(var i=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"){if(i===0)return r;i--}else l==="/$"&&i++}r=r.previousSibling}return null}var Du=Math.random().toString(36).slice(2),Zs="__reactFiber$"+Du,fh="__reactProps$"+Du,xo="__reactContainer$"+Du,ig="__reactEvents$"+Du,jS="__reactListeners$"+Du,VS="__reactHandles$"+Du;function il(r){var i=r[Zs];if(i)return i;for(var l=r.parentNode;l;){if(i=l[xo]||l[Zs]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(r=Zv(r);r!==null;){if(l=r[Zs])return l;r=Zv(r)}return i}r=l,l=r.parentNode}return null}function Th(r){return r=r[Zs]||r[xo],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function cu(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Oe(33))}function Fp(r){return r[fh]||null}var sg=[],hu=-1;function Ca(r){return{current:r}}function Mr(r){0>hu||(r.current=sg[hu],sg[hu]=null,hu--)}function kr(r,i){hu++,sg[hu]=r.current,r.current=i}var ka={},Qn=Ca(ka),Ti=Ca(!1),ul=ka;function Tu(r,i){var l=r.type.contextTypes;if(!l)return ka;var p=r.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===i)return p.__reactInternalMemoizedMaskedChildContext;var v={},k;for(k in l)v[k]=i[k];return p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=v),v}function Ci(r){return r=r.childContextTypes,r!=null}function mp(){Mr(Ti),Mr(Qn)}function Gv(r,i,l){if(Qn.current!==ka)throw Error(Oe(168));kr(Qn,i),kr(Ti,l)}function B0(r,i,l){var p=r.stateNode;if(i=i.childContextTypes,typeof p.getChildContext!="function")return l;p=p.getChildContext();for(var v in p)if(!(v in i))throw Error(Oe(108,T2(r)||"Unknown",v));return Ur({},l,p)}function gp(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||ka,ul=Qn.current,kr(Qn,r),kr(Ti,Ti.current),!0}function Hv(r,i,l){var p=r.stateNode;if(!p)throw Error(Oe(169));l?(r=B0(r,i,ul),p.__reactInternalMemoizedMergedChildContext=r,Mr(Ti),Mr(Qn),kr(Qn,r)):Mr(Ti),kr(Ti,l)}var mo=null,Bp=!1,xm=!1;function O0(r){mo===null?mo=[r]:mo.push(r)}function US(r){Bp=!0,O0(r)}function Ia(){if(!xm&&mo!==null){xm=!0;var r=0,i=_r;try{var l=mo;for(_r=1;r<l.length;r++){var p=l[r];do p=p(!0);while(p!==null)}mo=null,Bp=!1}catch(v){throw mo!==null&&(mo=mo.slice(r+1)),u0(Ug,Ia),v}finally{_r=i,xm=!1}}return null}var du=[],pu=0,yp=null,_p=0,ns=[],is=0,cl=null,go=1,yo="";function rl(r,i){du[pu++]=_p,du[pu++]=yp,yp=r,_p=i}function N0(r,i,l){ns[is++]=go,ns[is++]=yo,ns[is++]=cl,cl=r;var p=go;r=yo;var v=32-As(p)-1;p&=~(1<<v),l+=1;var k=32-As(i)+v;if(30<k){var S=v-v%5;k=(p&(1<<S)-1).toString(32),p>>=S,v-=S,go=1<<32-As(i)+v|l<<v|p,yo=k+r}else go=1<<k|l<<v|p,yo=r}function Yg(r){r.return!==null&&(rl(r,1),N0(r,1,0))}function Jg(r){for(;r===yp;)yp=du[--pu],du[pu]=null,_p=du[--pu],du[pu]=null;for(;r===cl;)cl=ns[--is],ns[is]=null,yo=ns[--is],ns[is]=null,go=ns[--is],ns[is]=null}var qi=null,$i=null,Or=!1,Ps=null;function j0(r,i){var l=as(5,null,null,0);l.elementType="DELETED",l.stateNode=i,l.return=r,i=r.deletions,i===null?(r.deletions=[l],r.flags|=16):i.push(l)}function Wv(r,i){switch(r.tag){case 5:var l=r.type;return i=i.nodeType!==1||l.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(r.stateNode=i,qi=r,$i=ya(i.firstChild),!0):!1;case 6:return i=r.pendingProps===""||i.nodeType!==3?null:i,i!==null?(r.stateNode=i,qi=r,$i=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(l=cl!==null?{id:go,overflow:yo}:null,r.memoizedState={dehydrated:i,treeContext:l,retryLane:1073741824},l=as(18,null,null,0),l.stateNode=i,l.return=r,r.child=l,qi=r,$i=null,!0):!1;default:return!1}}function og(r){return(r.mode&1)!==0&&(r.flags&128)===0}function ag(r){if(Or){var i=$i;if(i){var l=i;if(!Wv(r,i)){if(og(r))throw Error(Oe(418));i=ya(l.nextSibling);var p=qi;i&&Wv(r,i)?j0(p,l):(r.flags=r.flags&-4097|2,Or=!1,qi=r)}}else{if(og(r))throw Error(Oe(418));r.flags=r.flags&-4097|2,Or=!1,qi=r}}}function Xv(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;qi=r}function Ld(r){if(r!==qi)return!1;if(!Or)return Xv(r),Or=!0,!1;var i;if((i=r.tag!==3)&&!(i=r.tag!==5)&&(i=r.type,i=i!=="head"&&i!=="body"&&!rg(r.type,r.memoizedProps)),i&&(i=$i)){if(og(r))throw V0(),Error(Oe(418));for(;i;)j0(r,i),i=ya(i.nextSibling)}if(Xv(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Oe(317));e:{for(r=r.nextSibling,i=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"){if(i===0){$i=ya(r.nextSibling);break e}i--}else l!=="$"&&l!=="$!"&&l!=="$?"||i++}r=r.nextSibling}$i=null}}else $i=qi?ya(r.stateNode.nextSibling):null;return!0}function V0(){for(var r=$i;r;)r=ya(r.nextSibling)}function Cu(){$i=qi=null,Or=!1}function Qg(r){Ps===null?Ps=[r]:Ps.push(r)}var $S=So.ReactCurrentBatchConfig;function jc(r,i,l){if(r=l.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Oe(309));var p=l.stateNode}if(!p)throw Error(Oe(147,r));var v=p,k=""+r;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===k?i.ref:(i=function(S){var d=v.refs;S===null?delete d[k]:d[k]=S},i._stringRef=k,i)}if(typeof r!="string")throw Error(Oe(284));if(!l._owner)throw Error(Oe(290,r))}return r}function Rd(r,i){throw r=Object.prototype.toString.call(i),Error(Oe(31,r==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":r))}function Kv(r){var i=r._init;return i(r._payload)}function U0(r){function i(le,te){if(r){var ce=le.deletions;ce===null?(le.deletions=[te],le.flags|=16):ce.push(te)}}function l(le,te){if(!r)return null;for(;te!==null;)i(le,te),te=te.sibling;return null}function p(le,te){for(le=new Map;te!==null;)te.key!==null?le.set(te.key,te):le.set(te.index,te),te=te.sibling;return le}function v(le,te){return le=wa(le,te),le.index=0,le.sibling=null,le}function k(le,te,ce){return le.index=ce,r?(ce=le.alternate,ce!==null?(ce=ce.index,ce<te?(le.flags|=2,te):ce):(le.flags|=2,te)):(le.flags|=1048576,te)}function S(le){return r&&le.alternate===null&&(le.flags|=2),le}function d(le,te,ce,Ie){return te===null||te.tag!==6?(te=Im(ce,le.mode,Ie),te.return=le,te):(te=v(te,ce),te.return=le,te)}function V(le,te,ce,Ie){var Ne=ce.type;return Ne===ou?ue(le,te,ce.props.children,Ie,ce.key):te!==null&&(te.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===la&&Kv(Ne)===te.type)?(Ie=v(te,ce.props),Ie.ref=jc(le,te,ce),Ie.return=le,Ie):(Ie=Qd(ce.type,ce.key,ce.props,null,le.mode,Ie),Ie.ref=jc(le,te,ce),Ie.return=le,Ie)}function se(le,te,ce,Ie){return te===null||te.tag!==4||te.stateNode.containerInfo!==ce.containerInfo||te.stateNode.implementation!==ce.implementation?(te=Em(ce,le.mode,Ie),te.return=le,te):(te=v(te,ce.children||[]),te.return=le,te)}function ue(le,te,ce,Ie,Ne){return te===null||te.tag!==7?(te=ll(ce,le.mode,Ie,Ne),te.return=le,te):(te=v(te,ce),te.return=le,te)}function Q(le,te,ce){if(typeof te=="string"&&te!==""||typeof te=="number")return te=Im(""+te,le.mode,ce),te.return=le,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case kd:return ce=Qd(te.type,te.key,te.props,null,le.mode,ce),ce.ref=jc(le,null,te),ce.return=le,ce;case su:return te=Em(te,le.mode,ce),te.return=le,te;case la:var Ie=te._init;return Q(le,Ie(te._payload),ce)}if(Zc(te)||Rc(te))return te=ll(te,le.mode,ce,null),te.return=le,te;Rd(le,te)}return null}function U(le,te,ce,Ie){var Ne=te!==null?te.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number")return Ne!==null?null:d(le,te,""+ce,Ie);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case kd:return ce.key===Ne?V(le,te,ce,Ie):null;case su:return ce.key===Ne?se(le,te,ce,Ie):null;case la:return Ne=ce._init,U(le,te,Ne(ce._payload),Ie)}if(Zc(ce)||Rc(ce))return Ne!==null?null:ue(le,te,ce,Ie,null);Rd(le,ce)}return null}function Le(le,te,ce,Ie,Ne){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number")return le=le.get(ce)||null,d(te,le,""+Ie,Ne);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case kd:return le=le.get(Ie.key===null?ce:Ie.key)||null,V(te,le,Ie,Ne);case su:return le=le.get(Ie.key===null?ce:Ie.key)||null,se(te,le,Ie,Ne);case la:var Ke=Ie._init;return Le(le,te,ce,Ke(Ie._payload),Ne)}if(Zc(Ie)||Rc(Ie))return le=le.get(ce)||null,ue(te,le,Ie,Ne,null);Rd(te,Ie)}return null}function Ee(le,te,ce,Ie){for(var Ne=null,Ke=null,qe=te,Je=te=0,Et=null;qe!==null&&Je<ce.length;Je++){qe.index>Je?(Et=qe,qe=null):Et=qe.sibling;var wt=U(le,qe,ce[Je],Ie);if(wt===null){qe===null&&(qe=Et);break}r&&qe&&wt.alternate===null&&i(le,qe),te=k(wt,te,Je),Ke===null?Ne=wt:Ke.sibling=wt,Ke=wt,qe=Et}if(Je===ce.length)return l(le,qe),Or&&rl(le,Je),Ne;if(qe===null){for(;Je<ce.length;Je++)qe=Q(le,ce[Je],Ie),qe!==null&&(te=k(qe,te,Je),Ke===null?Ne=qe:Ke.sibling=qe,Ke=qe);return Or&&rl(le,Je),Ne}for(qe=p(le,qe);Je<ce.length;Je++)Et=Le(qe,le,Je,ce[Je],Ie),Et!==null&&(r&&Et.alternate!==null&&qe.delete(Et.key===null?Je:Et.key),te=k(Et,te,Je),Ke===null?Ne=Et:Ke.sibling=Et,Ke=Et);return r&&qe.forEach(function(St){return i(le,St)}),Or&&rl(le,Je),Ne}function Fe(le,te,ce,Ie){var Ne=Rc(ce);if(typeof Ne!="function")throw Error(Oe(150));if(ce=Ne.call(ce),ce==null)throw Error(Oe(151));for(var Ke=Ne=null,qe=te,Je=te=0,Et=null,wt=ce.next();qe!==null&&!wt.done;Je++,wt=ce.next()){qe.index>Je?(Et=qe,qe=null):Et=qe.sibling;var St=U(le,qe,wt.value,Ie);if(St===null){qe===null&&(qe=Et);break}r&&qe&&St.alternate===null&&i(le,qe),te=k(St,te,Je),Ke===null?Ne=St:Ke.sibling=St,Ke=St,qe=Et}if(wt.done)return l(le,qe),Or&&rl(le,Je),Ne;if(qe===null){for(;!wt.done;Je++,wt=ce.next())wt=Q(le,wt.value,Ie),wt!==null&&(te=k(wt,te,Je),Ke===null?Ne=wt:Ke.sibling=wt,Ke=wt);return Or&&rl(le,Je),Ne}for(qe=p(le,qe);!wt.done;Je++,wt=ce.next())wt=Le(qe,le,Je,wt.value,Ie),wt!==null&&(r&&wt.alternate!==null&&qe.delete(wt.key===null?Je:wt.key),te=k(wt,te,Je),Ke===null?Ne=wt:Ke.sibling=wt,Ke=wt);return r&&qe.forEach(function(or){return i(le,or)}),Or&&rl(le,Je),Ne}function gt(le,te,ce,Ie){if(typeof ce=="object"&&ce!==null&&ce.type===ou&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case kd:e:{for(var Ne=ce.key,Ke=te;Ke!==null;){if(Ke.key===Ne){if(Ne=ce.type,Ne===ou){if(Ke.tag===7){l(le,Ke.sibling),te=v(Ke,ce.props.children),te.return=le,le=te;break e}}else if(Ke.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===la&&Kv(Ne)===Ke.type){l(le,Ke.sibling),te=v(Ke,ce.props),te.ref=jc(le,Ke,ce),te.return=le,le=te;break e}l(le,Ke);break}else i(le,Ke);Ke=Ke.sibling}ce.type===ou?(te=ll(ce.props.children,le.mode,Ie,ce.key),te.return=le,le=te):(Ie=Qd(ce.type,ce.key,ce.props,null,le.mode,Ie),Ie.ref=jc(le,te,ce),Ie.return=le,le=Ie)}return S(le);case su:e:{for(Ke=ce.key;te!==null;){if(te.key===Ke)if(te.tag===4&&te.stateNode.containerInfo===ce.containerInfo&&te.stateNode.implementation===ce.implementation){l(le,te.sibling),te=v(te,ce.children||[]),te.return=le,le=te;break e}else{l(le,te);break}else i(le,te);te=te.sibling}te=Em(ce,le.mode,Ie),te.return=le,le=te}return S(le);case la:return Ke=ce._init,gt(le,te,Ke(ce._payload),Ie)}if(Zc(ce))return Ee(le,te,ce,Ie);if(Rc(ce))return Fe(le,te,ce,Ie);Rd(le,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"?(ce=""+ce,te!==null&&te.tag===6?(l(le,te.sibling),te=v(te,ce),te.return=le,le=te):(l(le,te),te=Im(ce,le.mode,Ie),te.return=le,le=te),S(le)):l(le,te)}return gt}var Iu=U0(!0),$0=U0(!1),vp=Ca(null),xp=null,fu=null,ey=null;function ty(){ey=fu=xp=null}function ry(r){var i=vp.current;Mr(vp),r._currentValue=i}function lg(r,i,l){for(;r!==null;){var p=r.alternate;if((r.childLanes&i)!==i?(r.childLanes|=i,p!==null&&(p.childLanes|=i)):p!==null&&(p.childLanes&i)!==i&&(p.childLanes|=i),r===l)break;r=r.return}}function wu(r,i){xp=r,ey=fu=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&i&&(ki=!0),r.firstContext=null)}function us(r){var i=r._currentValue;if(ey!==r)if(r={context:r,memoizedValue:i,next:null},fu===null){if(xp===null)throw Error(Oe(308));fu=r,xp.dependencies={lanes:0,firstContext:r}}else fu=fu.next=r;return i}var sl=null;function ny(r){sl===null?sl=[r]:sl.push(r)}function q0(r,i,l,p){var v=i.interleaved;return v===null?(l.next=l,ny(i)):(l.next=v.next,v.next=l),i.interleaved=l,wo(r,p)}function wo(r,i){r.lanes|=i;var l=r.alternate;for(l!==null&&(l.lanes|=i),l=r,r=r.return;r!==null;)r.childLanes|=i,l=r.alternate,l!==null&&(l.childLanes|=i),l=r,r=r.return;return l.tag===3?l.stateNode:null}var ua=!1;function iy(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Z0(r,i){r=r.updateQueue,i.updateQueue===r&&(i.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function _o(r,i){return{eventTime:r,lane:i,tag:0,payload:null,callback:null,next:null}}function _a(r,i,l){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,sr&2){var v=p.pending;return v===null?i.next=i:(i.next=v.next,v.next=i),p.pending=i,wo(r,l)}return v=p.interleaved,v===null?(i.next=i,ny(p)):(i.next=v.next,v.next=i),p.interleaved=i,wo(r,l)}function Hd(r,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194240)!==0)){var p=i.lanes;p&=r.pendingLanes,l|=p,i.lanes=l,$g(r,l)}}function Yv(r,i){var l=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,l===p)){var v=null,k=null;if(l=l.firstBaseUpdate,l!==null){do{var S={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};k===null?v=k=S:k=k.next=S,l=l.next}while(l!==null);k===null?v=k=i:k=k.next=i}else v=k=i;l={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:k,shared:p.shared,effects:p.effects},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=i:r.next=i,l.lastBaseUpdate=i}function wp(r,i,l,p){var v=r.updateQueue;ua=!1;var k=v.firstBaseUpdate,S=v.lastBaseUpdate,d=v.shared.pending;if(d!==null){v.shared.pending=null;var V=d,se=V.next;V.next=null,S===null?k=se:S.next=se,S=V;var ue=r.alternate;ue!==null&&(ue=ue.updateQueue,d=ue.lastBaseUpdate,d!==S&&(d===null?ue.firstBaseUpdate=se:d.next=se,ue.lastBaseUpdate=V))}if(k!==null){var Q=v.baseState;S=0,ue=se=V=null,d=k;do{var U=d.lane,Le=d.eventTime;if((p&U)===U){ue!==null&&(ue=ue.next={eventTime:Le,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Ee=r,Fe=d;switch(U=i,Le=l,Fe.tag){case 1:if(Ee=Fe.payload,typeof Ee=="function"){Q=Ee.call(Le,Q,U);break e}Q=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=Fe.payload,U=typeof Ee=="function"?Ee.call(Le,Q,U):Ee,U==null)break e;Q=Ur({},Q,U);break e;case 2:ua=!0}}d.callback!==null&&d.lane!==0&&(r.flags|=64,U=v.effects,U===null?v.effects=[d]:U.push(d))}else Le={eventTime:Le,lane:U,tag:d.tag,payload:d.payload,callback:d.callback,next:null},ue===null?(se=ue=Le,V=Q):ue=ue.next=Le,S|=U;if(d=d.next,d===null){if(d=v.shared.pending,d===null)break;U=d,d=U.next,U.next=null,v.lastBaseUpdate=U,v.shared.pending=null}}while(!0);if(ue===null&&(V=Q),v.baseState=V,v.firstBaseUpdate=se,v.lastBaseUpdate=ue,i=v.shared.interleaved,i!==null){v=i;do S|=v.lane,v=v.next;while(v!==i)}else k===null&&(v.shared.lanes=0);dl|=S,r.lanes=S,r.memoizedState=Q}}function Jv(r,i,l){if(r=i.effects,i.effects=null,r!==null)for(i=0;i<r.length;i++){var p=r[i],v=p.callback;if(v!==null){if(p.callback=null,p=l,typeof v!="function")throw Error(Oe(191,v));v.call(p)}}}var Ch={},Hs=Ca(Ch),mh=Ca(Ch),gh=Ca(Ch);function ol(r){if(r===Ch)throw Error(Oe(174));return r}function sy(r,i){switch(kr(gh,i),kr(mh,r),kr(Hs,Ch),r=i.nodeType,r){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Um(null,"");break;default:r=r===8?i.parentNode:i,i=r.namespaceURI||null,r=r.tagName,i=Um(i,r)}Mr(Hs),kr(Hs,i)}function Eu(){Mr(Hs),Mr(mh),Mr(gh)}function G0(r){ol(gh.current);var i=ol(Hs.current),l=Um(i,r.type);i!==l&&(kr(mh,r),kr(Hs,l))}function oy(r){mh.current===r&&(Mr(Hs),Mr(mh))}var jr=Ca(0);function bp(r){for(var i=r;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var wm=[];function ay(){for(var r=0;r<wm.length;r++)wm[r]._workInProgressVersionPrimary=null;wm.length=0}var Wd=So.ReactCurrentDispatcher,bm=So.ReactCurrentBatchConfig,hl=0,Vr=null,dn=null,En=null,Sp=!1,eh=!1,yh=0,qS=0;function Kn(){throw Error(Oe(321))}function ly(r,i){if(i===null)return!1;for(var l=0;l<i.length&&l<r.length;l++)if(!zs(r[l],i[l]))return!1;return!0}function uy(r,i,l,p,v,k){if(hl=k,Vr=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Wd.current=r===null||r.memoizedState===null?WS:XS,r=l(p,v),eh){k=0;do{if(eh=!1,yh=0,25<=k)throw Error(Oe(301));k+=1,En=dn=null,i.updateQueue=null,Wd.current=KS,r=l(p,v)}while(eh)}if(Wd.current=kp,i=dn!==null&&dn.next!==null,hl=0,En=dn=Vr=null,Sp=!1,i)throw Error(Oe(300));return r}function cy(){var r=yh!==0;return yh=0,r}function $s(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return En===null?Vr.memoizedState=En=r:En=En.next=r,En}function cs(){if(dn===null){var r=Vr.alternate;r=r!==null?r.memoizedState:null}else r=dn.next;var i=En===null?Vr.memoizedState:En.next;if(i!==null)En=i,dn=r;else{if(r===null)throw Error(Oe(310));dn=r,r={memoizedState:dn.memoizedState,baseState:dn.baseState,baseQueue:dn.baseQueue,queue:dn.queue,next:null},En===null?Vr.memoizedState=En=r:En=En.next=r}return En}function _h(r,i){return typeof i=="function"?i(r):i}function Sm(r){var i=cs(),l=i.queue;if(l===null)throw Error(Oe(311));l.lastRenderedReducer=r;var p=dn,v=p.baseQueue,k=l.pending;if(k!==null){if(v!==null){var S=v.next;v.next=k.next,k.next=S}p.baseQueue=v=k,l.pending=null}if(v!==null){k=v.next,p=p.baseState;var d=S=null,V=null,se=k;do{var ue=se.lane;if((hl&ue)===ue)V!==null&&(V=V.next={lane:0,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),p=se.hasEagerState?se.eagerState:r(p,se.action);else{var Q={lane:ue,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null};V===null?(d=V=Q,S=p):V=V.next=Q,Vr.lanes|=ue,dl|=ue}se=se.next}while(se!==null&&se!==k);V===null?S=p:V.next=d,zs(p,i.memoizedState)||(ki=!0),i.memoizedState=p,i.baseState=S,i.baseQueue=V,l.lastRenderedState=p}if(r=l.interleaved,r!==null){v=r;do k=v.lane,Vr.lanes|=k,dl|=k,v=v.next;while(v!==r)}else v===null&&(l.lanes=0);return[i.memoizedState,l.dispatch]}function km(r){var i=cs(),l=i.queue;if(l===null)throw Error(Oe(311));l.lastRenderedReducer=r;var p=l.dispatch,v=l.pending,k=i.memoizedState;if(v!==null){l.pending=null;var S=v=v.next;do k=r(k,S.action),S=S.next;while(S!==v);zs(k,i.memoizedState)||(ki=!0),i.memoizedState=k,i.baseQueue===null&&(i.baseState=k),l.lastRenderedState=k}return[k,p]}function H0(){}function W0(r,i){var l=Vr,p=cs(),v=i(),k=!zs(p.memoizedState,v);if(k&&(p.memoizedState=v,ki=!0),p=p.queue,hy(Y0.bind(null,l,p,r),[r]),p.getSnapshot!==i||k||En!==null&&En.memoizedState.tag&1){if(l.flags|=2048,vh(9,K0.bind(null,l,p,v,i),void 0,null),Pn===null)throw Error(Oe(349));hl&30||X0(l,i,v)}return v}function X0(r,i,l){r.flags|=16384,r={getSnapshot:i,value:l},i=Vr.updateQueue,i===null?(i={lastEffect:null,stores:null},Vr.updateQueue=i,i.stores=[r]):(l=i.stores,l===null?i.stores=[r]:l.push(r))}function K0(r,i,l,p){i.value=l,i.getSnapshot=p,J0(i)&&Q0(r)}function Y0(r,i,l){return l(function(){J0(i)&&Q0(r)})}function J0(r){var i=r.getSnapshot;r=r.value;try{var l=i();return!zs(r,l)}catch{return!0}}function Q0(r){var i=wo(r,1);i!==null&&Ms(i,r,1,-1)}function Qv(r){var i=$s();return typeof r=="function"&&(r=r()),i.memoizedState=i.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_h,lastRenderedState:r},i.queue=r,r=r.dispatch=HS.bind(null,Vr,r),[i.memoizedState,r]}function vh(r,i,l,p){return r={tag:r,create:i,destroy:l,deps:p,next:null},i=Vr.updateQueue,i===null?(i={lastEffect:null,stores:null},Vr.updateQueue=i,i.lastEffect=r.next=r):(l=i.lastEffect,l===null?i.lastEffect=r.next=r:(p=l.next,l.next=r,r.next=p,i.lastEffect=r)),r}function ew(){return cs().memoizedState}function Xd(r,i,l,p){var v=$s();Vr.flags|=r,v.memoizedState=vh(1|i,l,void 0,p===void 0?null:p)}function Op(r,i,l,p){var v=cs();p=p===void 0?null:p;var k=void 0;if(dn!==null){var S=dn.memoizedState;if(k=S.destroy,p!==null&&ly(p,S.deps)){v.memoizedState=vh(i,l,k,p);return}}Vr.flags|=r,v.memoizedState=vh(1|i,l,k,p)}function ex(r,i){return Xd(8390656,8,r,i)}function hy(r,i){return Op(2048,8,r,i)}function tw(r,i){return Op(4,2,r,i)}function rw(r,i){return Op(4,4,r,i)}function nw(r,i){if(typeof i=="function")return r=r(),i(r),function(){i(null)};if(i!=null)return r=r(),i.current=r,function(){i.current=null}}function iw(r,i,l){return l=l!=null?l.concat([r]):null,Op(4,4,nw.bind(null,i,r),l)}function dy(){}function sw(r,i){var l=cs();i=i===void 0?null:i;var p=l.memoizedState;return p!==null&&i!==null&&ly(i,p[1])?p[0]:(l.memoizedState=[r,i],r)}function ow(r,i){var l=cs();i=i===void 0?null:i;var p=l.memoizedState;return p!==null&&i!==null&&ly(i,p[1])?p[0]:(r=r(),l.memoizedState=[r,i],r)}function aw(r,i,l){return hl&21?(zs(l,i)||(l=d0(),Vr.lanes|=l,dl|=l,r.baseState=!0),i):(r.baseState&&(r.baseState=!1,ki=!0),r.memoizedState=l)}function ZS(r,i){var l=_r;_r=l!==0&&4>l?l:4,r(!0);var p=bm.transition;bm.transition={};try{r(!1),i()}finally{_r=l,bm.transition=p}}function lw(){return cs().memoizedState}function GS(r,i,l){var p=xa(r);if(l={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null},uw(r))cw(i,l);else if(l=q0(r,i,l,p),l!==null){var v=ci();Ms(l,r,p,v),hw(l,i,p)}}function HS(r,i,l){var p=xa(r),v={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null};if(uw(r))cw(i,v);else{var k=r.alternate;if(r.lanes===0&&(k===null||k.lanes===0)&&(k=i.lastRenderedReducer,k!==null))try{var S=i.lastRenderedState,d=k(S,l);if(v.hasEagerState=!0,v.eagerState=d,zs(d,S)){var V=i.interleaved;V===null?(v.next=v,ny(i)):(v.next=V.next,V.next=v),i.interleaved=v;return}}catch{}finally{}l=q0(r,i,v,p),l!==null&&(v=ci(),Ms(l,r,p,v),hw(l,i,p))}}function uw(r){var i=r.alternate;return r===Vr||i!==null&&i===Vr}function cw(r,i){eh=Sp=!0;var l=r.pending;l===null?i.next=i:(i.next=l.next,l.next=i),r.pending=i}function hw(r,i,l){if(l&4194240){var p=i.lanes;p&=r.pendingLanes,l|=p,i.lanes=l,$g(r,l)}}var kp={readContext:us,useCallback:Kn,useContext:Kn,useEffect:Kn,useImperativeHandle:Kn,useInsertionEffect:Kn,useLayoutEffect:Kn,useMemo:Kn,useReducer:Kn,useRef:Kn,useState:Kn,useDebugValue:Kn,useDeferredValue:Kn,useTransition:Kn,useMutableSource:Kn,useSyncExternalStore:Kn,useId:Kn,unstable_isNewReconciler:!1},WS={readContext:us,useCallback:function(r,i){return $s().memoizedState=[r,i===void 0?null:i],r},useContext:us,useEffect:ex,useImperativeHandle:function(r,i,l){return l=l!=null?l.concat([r]):null,Xd(4194308,4,nw.bind(null,i,r),l)},useLayoutEffect:function(r,i){return Xd(4194308,4,r,i)},useInsertionEffect:function(r,i){return Xd(4,2,r,i)},useMemo:function(r,i){var l=$s();return i=i===void 0?null:i,r=r(),l.memoizedState=[r,i],r},useReducer:function(r,i,l){var p=$s();return i=l!==void 0?l(i):i,p.memoizedState=p.baseState=i,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:i},p.queue=r,r=r.dispatch=GS.bind(null,Vr,r),[p.memoizedState,r]},useRef:function(r){var i=$s();return r={current:r},i.memoizedState=r},useState:Qv,useDebugValue:dy,useDeferredValue:function(r){return $s().memoizedState=r},useTransition:function(){var r=Qv(!1),i=r[0];return r=ZS.bind(null,r[1]),$s().memoizedState=r,[i,r]},useMutableSource:function(){},useSyncExternalStore:function(r,i,l){var p=Vr,v=$s();if(Or){if(l===void 0)throw Error(Oe(407));l=l()}else{if(l=i(),Pn===null)throw Error(Oe(349));hl&30||X0(p,i,l)}v.memoizedState=l;var k={value:l,getSnapshot:i};return v.queue=k,ex(Y0.bind(null,p,k,r),[r]),p.flags|=2048,vh(9,K0.bind(null,p,k,l,i),void 0,null),l},useId:function(){var r=$s(),i=Pn.identifierPrefix;if(Or){var l=yo,p=go;l=(p&~(1<<32-As(p)-1)).toString(32)+l,i=":"+i+"R"+l,l=yh++,0<l&&(i+="H"+l.toString(32)),i+=":"}else l=qS++,i=":"+i+"r"+l.toString(32)+":";return r.memoizedState=i},unstable_isNewReconciler:!1},XS={readContext:us,useCallback:sw,useContext:us,useEffect:hy,useImperativeHandle:iw,useInsertionEffect:tw,useLayoutEffect:rw,useMemo:ow,useReducer:Sm,useRef:ew,useState:function(){return Sm(_h)},useDebugValue:dy,useDeferredValue:function(r){var i=cs();return aw(i,dn.memoizedState,r)},useTransition:function(){var r=Sm(_h)[0],i=cs().memoizedState;return[r,i]},useMutableSource:H0,useSyncExternalStore:W0,useId:lw,unstable_isNewReconciler:!1},KS={readContext:us,useCallback:sw,useContext:us,useEffect:hy,useImperativeHandle:iw,useInsertionEffect:tw,useLayoutEffect:rw,useMemo:ow,useReducer:km,useRef:ew,useState:function(){return km(_h)},useDebugValue:dy,useDeferredValue:function(r){var i=cs();return dn===null?i.memoizedState=r:aw(i,dn.memoizedState,r)},useTransition:function(){var r=km(_h)[0],i=cs().memoizedState;return[r,i]},useMutableSource:H0,useSyncExternalStore:W0,useId:lw,unstable_isNewReconciler:!1};function Cs(r,i){if(r&&r.defaultProps){i=Ur({},i),r=r.defaultProps;for(var l in r)i[l]===void 0&&(i[l]=r[l]);return i}return i}function ug(r,i,l,p){i=r.memoizedState,l=l(p,i),l=l==null?i:Ur({},i,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var Np={isMounted:function(r){return(r=r._reactInternals)?ml(r)===r:!1},enqueueSetState:function(r,i,l){r=r._reactInternals;var p=ci(),v=xa(r),k=_o(p,v);k.payload=i,l!=null&&(k.callback=l),i=_a(r,k,v),i!==null&&(Ms(i,r,v,p),Hd(i,r,v))},enqueueReplaceState:function(r,i,l){r=r._reactInternals;var p=ci(),v=xa(r),k=_o(p,v);k.tag=1,k.payload=i,l!=null&&(k.callback=l),i=_a(r,k,v),i!==null&&(Ms(i,r,v,p),Hd(i,r,v))},enqueueForceUpdate:function(r,i){r=r._reactInternals;var l=ci(),p=xa(r),v=_o(l,p);v.tag=2,i!=null&&(v.callback=i),i=_a(r,v,p),i!==null&&(Ms(i,r,p,l),Hd(i,r,p))}};function tx(r,i,l,p,v,k,S){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,k,S):i.prototype&&i.prototype.isPureReactComponent?!hh(l,p)||!hh(v,k):!0}function dw(r,i,l){var p=!1,v=ka,k=i.contextType;return typeof k=="object"&&k!==null?k=us(k):(v=Ci(i)?ul:Qn.current,p=i.contextTypes,k=(p=p!=null)?Tu(r,v):ka),i=new i(l,k),r.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Np,r.stateNode=i,i._reactInternals=r,p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=v,r.__reactInternalMemoizedMaskedChildContext=k),i}function rx(r,i,l,p){r=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,p),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,p),i.state!==r&&Np.enqueueReplaceState(i,i.state,null)}function cg(r,i,l,p){var v=r.stateNode;v.props=l,v.state=r.memoizedState,v.refs={},iy(r);var k=i.contextType;typeof k=="object"&&k!==null?v.context=us(k):(k=Ci(i)?ul:Qn.current,v.context=Tu(r,k)),v.state=r.memoizedState,k=i.getDerivedStateFromProps,typeof k=="function"&&(ug(r,i,k,l),v.state=r.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(i=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),i!==v.state&&Np.enqueueReplaceState(v,v.state,null),wp(r,l,v,p),v.state=r.memoizedState),typeof v.componentDidMount=="function"&&(r.flags|=4194308)}function Pu(r,i){try{var l="",p=i;do l+=k2(p),p=p.return;while(p);var v=l}catch(k){v=`
Error generating stack: `+k.message+`
`+k.stack}return{value:r,source:i,stack:v,digest:null}}function Tm(r,i,l){return{value:r,source:null,stack:l??null,digest:i??null}}function hg(r,i){try{console.error(i.value)}catch(l){setTimeout(function(){throw l})}}var YS=typeof WeakMap=="function"?WeakMap:Map;function pw(r,i,l){l=_o(-1,l),l.tag=3,l.payload={element:null};var p=i.value;return l.callback=function(){Cp||(Cp=!0,wg=p),hg(r,i)},l}function fw(r,i,l){l=_o(-1,l),l.tag=3;var p=r.type.getDerivedStateFromError;if(typeof p=="function"){var v=i.value;l.payload=function(){return p(v)},l.callback=function(){hg(r,i)}}var k=r.stateNode;return k!==null&&typeof k.componentDidCatch=="function"&&(l.callback=function(){hg(r,i),typeof p!="function"&&(va===null?va=new Set([this]):va.add(this));var S=i.stack;this.componentDidCatch(i.value,{componentStack:S!==null?S:""})}),l}function nx(r,i,l){var p=r.pingCache;if(p===null){p=r.pingCache=new YS;var v=new Set;p.set(i,v)}else v=p.get(i),v===void 0&&(v=new Set,p.set(i,v));v.has(l)||(v.add(l),r=hk.bind(null,r,i,l),i.then(r,r))}function ix(r){do{var i;if((i=r.tag===13)&&(i=r.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return r;r=r.return}while(r!==null);return null}function sx(r,i,l,p,v){return r.mode&1?(r.flags|=65536,r.lanes=v,r):(r===i?r.flags|=65536:(r.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(i=_o(-1,1),i.tag=2,_a(l,i,1))),l.lanes|=1),r)}var JS=So.ReactCurrentOwner,ki=!1;function ui(r,i,l,p){i.child=r===null?$0(i,null,l,p):Iu(i,r.child,l,p)}function ox(r,i,l,p,v){l=l.render;var k=i.ref;return wu(i,v),p=uy(r,i,l,p,k,v),l=cy(),r!==null&&!ki?(i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~v,bo(r,i,v)):(Or&&l&&Yg(i),i.flags|=1,ui(r,i,p,v),i.child)}function ax(r,i,l,p,v){if(r===null){var k=l.type;return typeof k=="function"&&!xy(k)&&k.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(i.tag=15,i.type=k,mw(r,i,k,p,v)):(r=Qd(l.type,null,p,i,i.mode,v),r.ref=i.ref,r.return=i,i.child=r)}if(k=r.child,!(r.lanes&v)){var S=k.memoizedProps;if(l=l.compare,l=l!==null?l:hh,l(S,p)&&r.ref===i.ref)return bo(r,i,v)}return i.flags|=1,r=wa(k,p),r.ref=i.ref,r.return=i,i.child=r}function mw(r,i,l,p,v){if(r!==null){var k=r.memoizedProps;if(hh(k,p)&&r.ref===i.ref)if(ki=!1,i.pendingProps=p=k,(r.lanes&v)!==0)r.flags&131072&&(ki=!0);else return i.lanes=r.lanes,bo(r,i,v)}return dg(r,i,l,p,v)}function gw(r,i,l){var p=i.pendingProps,v=p.children,k=r!==null?r.memoizedState:null;if(p.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},kr(gu,Ui),Ui|=l;else{if(!(l&1073741824))return r=k!==null?k.baseLanes|l:l,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:r,cachePool:null,transitions:null},i.updateQueue=null,kr(gu,Ui),Ui|=r,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=k!==null?k.baseLanes:l,kr(gu,Ui),Ui|=p}else k!==null?(p=k.baseLanes|l,i.memoizedState=null):p=l,kr(gu,Ui),Ui|=p;return ui(r,i,v,l),i.child}function yw(r,i){var l=i.ref;(r===null&&l!==null||r!==null&&r.ref!==l)&&(i.flags|=512,i.flags|=2097152)}function dg(r,i,l,p,v){var k=Ci(l)?ul:Qn.current;return k=Tu(i,k),wu(i,v),l=uy(r,i,l,p,k,v),p=cy(),r!==null&&!ki?(i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~v,bo(r,i,v)):(Or&&p&&Yg(i),i.flags|=1,ui(r,i,l,v),i.child)}function lx(r,i,l,p,v){if(Ci(l)){var k=!0;gp(i)}else k=!1;if(wu(i,v),i.stateNode===null)Kd(r,i),dw(i,l,p),cg(i,l,p,v),p=!0;else if(r===null){var S=i.stateNode,d=i.memoizedProps;S.props=d;var V=S.context,se=l.contextType;typeof se=="object"&&se!==null?se=us(se):(se=Ci(l)?ul:Qn.current,se=Tu(i,se));var ue=l.getDerivedStateFromProps,Q=typeof ue=="function"||typeof S.getSnapshotBeforeUpdate=="function";Q||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==p||V!==se)&&rx(i,S,p,se),ua=!1;var U=i.memoizedState;S.state=U,wp(i,p,S,v),V=i.memoizedState,d!==p||U!==V||Ti.current||ua?(typeof ue=="function"&&(ug(i,l,ue,p),V=i.memoizedState),(d=ua||tx(i,l,d,p,U,V,se))?(Q||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(i.flags|=4194308)):(typeof S.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=p,i.memoizedState=V),S.props=p,S.state=V,S.context=se,p=d):(typeof S.componentDidMount=="function"&&(i.flags|=4194308),p=!1)}else{S=i.stateNode,Z0(r,i),d=i.memoizedProps,se=i.type===i.elementType?d:Cs(i.type,d),S.props=se,Q=i.pendingProps,U=S.context,V=l.contextType,typeof V=="object"&&V!==null?V=us(V):(V=Ci(l)?ul:Qn.current,V=Tu(i,V));var Le=l.getDerivedStateFromProps;(ue=typeof Le=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==Q||U!==V)&&rx(i,S,p,V),ua=!1,U=i.memoizedState,S.state=U,wp(i,p,S,v);var Ee=i.memoizedState;d!==Q||U!==Ee||Ti.current||ua?(typeof Le=="function"&&(ug(i,l,Le,p),Ee=i.memoizedState),(se=ua||tx(i,l,se,p,U,Ee,V)||!1)?(ue||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(p,Ee,V),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(p,Ee,V)),typeof S.componentDidUpdate=="function"&&(i.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(i.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(i.flags|=1024),i.memoizedProps=p,i.memoizedState=Ee),S.props=p,S.state=Ee,S.context=V,p=se):(typeof S.componentDidUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(i.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&U===r.memoizedState||(i.flags|=1024),p=!1)}return pg(r,i,l,p,k,v)}function pg(r,i,l,p,v,k){yw(r,i);var S=(i.flags&128)!==0;if(!p&&!S)return v&&Hv(i,l,!1),bo(r,i,k);p=i.stateNode,JS.current=i;var d=S&&typeof l.getDerivedStateFromError!="function"?null:p.render();return i.flags|=1,r!==null&&S?(i.child=Iu(i,r.child,null,k),i.child=Iu(i,null,d,k)):ui(r,i,d,k),i.memoizedState=p.state,v&&Hv(i,l,!0),i.child}function _w(r){var i=r.stateNode;i.pendingContext?Gv(r,i.pendingContext,i.pendingContext!==i.context):i.context&&Gv(r,i.context,!1),sy(r,i.containerInfo)}function ux(r,i,l,p,v){return Cu(),Qg(v),i.flags|=256,ui(r,i,l,p),i.child}var fg={dehydrated:null,treeContext:null,retryLane:0};function mg(r){return{baseLanes:r,cachePool:null,transitions:null}}function vw(r,i,l){var p=i.pendingProps,v=jr.current,k=!1,S=(i.flags&128)!==0,d;if((d=S)||(d=r!==null&&r.memoizedState===null?!1:(v&2)!==0),d?(k=!0,i.flags&=-129):(r===null||r.memoizedState!==null)&&(v|=1),kr(jr,v&1),r===null)return ag(i),r=i.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(i.mode&1?r.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(S=p.children,r=p.fallback,k?(p=i.mode,k=i.child,S={mode:"hidden",children:S},!(p&1)&&k!==null?(k.childLanes=0,k.pendingProps=S):k=Up(S,p,0,null),r=ll(r,p,l,null),k.return=i,r.return=i,k.sibling=r,i.child=k,i.child.memoizedState=mg(l),i.memoizedState=fg,r):py(i,S));if(v=r.memoizedState,v!==null&&(d=v.dehydrated,d!==null))return QS(r,i,S,p,d,v,l);if(k){k=p.fallback,S=i.mode,v=r.child,d=v.sibling;var V={mode:"hidden",children:p.children};return!(S&1)&&i.child!==v?(p=i.child,p.childLanes=0,p.pendingProps=V,i.deletions=null):(p=wa(v,V),p.subtreeFlags=v.subtreeFlags&14680064),d!==null?k=wa(d,k):(k=ll(k,S,l,null),k.flags|=2),k.return=i,p.return=i,p.sibling=k,i.child=p,p=k,k=i.child,S=r.child.memoizedState,S=S===null?mg(l):{baseLanes:S.baseLanes|l,cachePool:null,transitions:S.transitions},k.memoizedState=S,k.childLanes=r.childLanes&~l,i.memoizedState=fg,p}return k=r.child,r=k.sibling,p=wa(k,{mode:"visible",children:p.children}),!(i.mode&1)&&(p.lanes=l),p.return=i,p.sibling=null,r!==null&&(l=i.deletions,l===null?(i.deletions=[r],i.flags|=16):l.push(r)),i.child=p,i.memoizedState=null,p}function py(r,i){return i=Up({mode:"visible",children:i},r.mode,0,null),i.return=r,r.child=i}function Fd(r,i,l,p){return p!==null&&Qg(p),Iu(i,r.child,null,l),r=py(i,i.pendingProps.children),r.flags|=2,i.memoizedState=null,r}function QS(r,i,l,p,v,k,S){if(l)return i.flags&256?(i.flags&=-257,p=Tm(Error(Oe(422))),Fd(r,i,S,p)):i.memoizedState!==null?(i.child=r.child,i.flags|=128,null):(k=p.fallback,v=i.mode,p=Up({mode:"visible",children:p.children},v,0,null),k=ll(k,v,S,null),k.flags|=2,p.return=i,k.return=i,p.sibling=k,i.child=p,i.mode&1&&Iu(i,r.child,null,S),i.child.memoizedState=mg(S),i.memoizedState=fg,k);if(!(i.mode&1))return Fd(r,i,S,null);if(v.data==="$!"){if(p=v.nextSibling&&v.nextSibling.dataset,p)var d=p.dgst;return p=d,k=Error(Oe(419)),p=Tm(k,p,void 0),Fd(r,i,S,p)}if(d=(S&r.childLanes)!==0,ki||d){if(p=Pn,p!==null){switch(S&-S){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=v&(p.suspendedLanes|S)?0:v,v!==0&&v!==k.retryLane&&(k.retryLane=v,wo(r,v),Ms(p,r,v,-1))}return vy(),p=Tm(Error(Oe(421))),Fd(r,i,S,p)}return v.data==="$?"?(i.flags|=128,i.child=r.child,i=dk.bind(null,r),v._reactRetry=i,null):(r=k.treeContext,$i=ya(v.nextSibling),qi=i,Or=!0,Ps=null,r!==null&&(ns[is++]=go,ns[is++]=yo,ns[is++]=cl,go=r.id,yo=r.overflow,cl=i),i=py(i,p.children),i.flags|=4096,i)}function cx(r,i,l){r.lanes|=i;var p=r.alternate;p!==null&&(p.lanes|=i),lg(r.return,i,l)}function Cm(r,i,l,p,v){var k=r.memoizedState;k===null?r.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:p,tail:l,tailMode:v}:(k.isBackwards=i,k.rendering=null,k.renderingStartTime=0,k.last=p,k.tail=l,k.tailMode=v)}function xw(r,i,l){var p=i.pendingProps,v=p.revealOrder,k=p.tail;if(ui(r,i,p.children,l),p=jr.current,p&2)p=p&1|2,i.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=i.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&cx(r,l,i);else if(r.tag===19)cx(r,l,i);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break e;for(;r.sibling===null;){if(r.return===null||r.return===i)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}p&=1}if(kr(jr,p),!(i.mode&1))i.memoizedState=null;else switch(v){case"forwards":for(l=i.child,v=null;l!==null;)r=l.alternate,r!==null&&bp(r)===null&&(v=l),l=l.sibling;l=v,l===null?(v=i.child,i.child=null):(v=l.sibling,l.sibling=null),Cm(i,!1,v,l,k);break;case"backwards":for(l=null,v=i.child,i.child=null;v!==null;){if(r=v.alternate,r!==null&&bp(r)===null){i.child=v;break}r=v.sibling,v.sibling=l,l=v,v=r}Cm(i,!0,l,null,k);break;case"together":Cm(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Kd(r,i){!(i.mode&1)&&r!==null&&(r.alternate=null,i.alternate=null,i.flags|=2)}function bo(r,i,l){if(r!==null&&(i.dependencies=r.dependencies),dl|=i.lanes,!(l&i.childLanes))return null;if(r!==null&&i.child!==r.child)throw Error(Oe(153));if(i.child!==null){for(r=i.child,l=wa(r,r.pendingProps),i.child=l,l.return=i;r.sibling!==null;)r=r.sibling,l=l.sibling=wa(r,r.pendingProps),l.return=i;l.sibling=null}return i.child}function ek(r,i,l){switch(i.tag){case 3:_w(i),Cu();break;case 5:G0(i);break;case 1:Ci(i.type)&&gp(i);break;case 4:sy(i,i.stateNode.containerInfo);break;case 10:var p=i.type._context,v=i.memoizedProps.value;kr(vp,p._currentValue),p._currentValue=v;break;case 13:if(p=i.memoizedState,p!==null)return p.dehydrated!==null?(kr(jr,jr.current&1),i.flags|=128,null):l&i.child.childLanes?vw(r,i,l):(kr(jr,jr.current&1),r=bo(r,i,l),r!==null?r.sibling:null);kr(jr,jr.current&1);break;case 19:if(p=(l&i.childLanes)!==0,r.flags&128){if(p)return xw(r,i,l);i.flags|=128}if(v=i.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),kr(jr,jr.current),p)break;return null;case 22:case 23:return i.lanes=0,gw(r,i,l)}return bo(r,i,l)}var ww,gg,bw,Sw;ww=function(r,i){for(var l=i.child;l!==null;){if(l.tag===5||l.tag===6)r.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};gg=function(){};bw=function(r,i,l,p){var v=r.memoizedProps;if(v!==p){r=i.stateNode,ol(Hs.current);var k=null;switch(l){case"input":v=Om(r,v),p=Om(r,p),k=[];break;case"select":v=Ur({},v,{value:void 0}),p=Ur({},p,{value:void 0}),k=[];break;case"textarea":v=Vm(r,v),p=Vm(r,p),k=[];break;default:typeof v.onClick!="function"&&typeof p.onClick=="function"&&(r.onclick=fp)}$m(l,p);var S;l=null;for(se in v)if(!p.hasOwnProperty(se)&&v.hasOwnProperty(se)&&v[se]!=null)if(se==="style"){var d=v[se];for(S in d)d.hasOwnProperty(S)&&(l||(l={}),l[S]="")}else se!=="dangerouslySetInnerHTML"&&se!=="children"&&se!=="suppressContentEditableWarning"&&se!=="suppressHydrationWarning"&&se!=="autoFocus"&&(ih.hasOwnProperty(se)?k||(k=[]):(k=k||[]).push(se,null));for(se in p){var V=p[se];if(d=v!=null?v[se]:void 0,p.hasOwnProperty(se)&&V!==d&&(V!=null||d!=null))if(se==="style")if(d){for(S in d)!d.hasOwnProperty(S)||V&&V.hasOwnProperty(S)||(l||(l={}),l[S]="");for(S in V)V.hasOwnProperty(S)&&d[S]!==V[S]&&(l||(l={}),l[S]=V[S])}else l||(k||(k=[]),k.push(se,l)),l=V;else se==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,d=d?d.__html:void 0,V!=null&&d!==V&&(k=k||[]).push(se,V)):se==="children"?typeof V!="string"&&typeof V!="number"||(k=k||[]).push(se,""+V):se!=="suppressContentEditableWarning"&&se!=="suppressHydrationWarning"&&(ih.hasOwnProperty(se)?(V!=null&&se==="onScroll"&&Ar("scroll",r),k||d===V||(k=[])):(k=k||[]).push(se,V))}l&&(k=k||[]).push("style",l);var se=k;(i.updateQueue=se)&&(i.flags|=4)}};Sw=function(r,i,l,p){l!==p&&(i.flags|=4)};function Vc(r,i){if(!Or)switch(r.tailMode){case"hidden":i=r.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var p=null;l!==null;)l.alternate!==null&&(p=l),l=l.sibling;p===null?i||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function Yn(r){var i=r.alternate!==null&&r.alternate.child===r.child,l=0,p=0;if(i)for(var v=r.child;v!==null;)l|=v.lanes|v.childLanes,p|=v.subtreeFlags&14680064,p|=v.flags&14680064,v.return=r,v=v.sibling;else for(v=r.child;v!==null;)l|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=r,v=v.sibling;return r.subtreeFlags|=p,r.childLanes=l,i}function tk(r,i,l){var p=i.pendingProps;switch(Jg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yn(i),null;case 1:return Ci(i.type)&&mp(),Yn(i),null;case 3:return p=i.stateNode,Eu(),Mr(Ti),Mr(Qn),ay(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(r===null||r.child===null)&&(Ld(i)?i.flags|=4:r===null||r.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Ps!==null&&(kg(Ps),Ps=null))),gg(r,i),Yn(i),null;case 5:oy(i);var v=ol(gh.current);if(l=i.type,r!==null&&i.stateNode!=null)bw(r,i,l,p,v),r.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!p){if(i.stateNode===null)throw Error(Oe(166));return Yn(i),null}if(r=ol(Hs.current),Ld(i)){p=i.stateNode,l=i.type;var k=i.memoizedProps;switch(p[Zs]=i,p[fh]=k,r=(i.mode&1)!==0,l){case"dialog":Ar("cancel",p),Ar("close",p);break;case"iframe":case"object":case"embed":Ar("load",p);break;case"video":case"audio":for(v=0;v<Hc.length;v++)Ar(Hc[v],p);break;case"source":Ar("error",p);break;case"img":case"image":case"link":Ar("error",p),Ar("load",p);break;case"details":Ar("toggle",p);break;case"input":vv(p,k),Ar("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!k.multiple},Ar("invalid",p);break;case"textarea":wv(p,k),Ar("invalid",p)}$m(l,k),v=null;for(var S in k)if(k.hasOwnProperty(S)){var d=k[S];S==="children"?typeof d=="string"?p.textContent!==d&&(k.suppressHydrationWarning!==!0&&Dd(p.textContent,d,r),v=["children",d]):typeof d=="number"&&p.textContent!==""+d&&(k.suppressHydrationWarning!==!0&&Dd(p.textContent,d,r),v=["children",""+d]):ih.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&Ar("scroll",p)}switch(l){case"input":Td(p),xv(p,k,!0);break;case"textarea":Td(p),bv(p);break;case"select":case"option":break;default:typeof k.onClick=="function"&&(p.onclick=fp)}p=v,i.updateQueue=p,p!==null&&(i.flags|=4)}else{S=v.nodeType===9?v:v.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=Yx(l)),r==="http://www.w3.org/1999/xhtml"?l==="script"?(r=S.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof p.is=="string"?r=S.createElement(l,{is:p.is}):(r=S.createElement(l),l==="select"&&(S=r,p.multiple?S.multiple=!0:p.size&&(S.size=p.size))):r=S.createElementNS(r,l),r[Zs]=i,r[fh]=p,ww(r,i,!1,!1),i.stateNode=r;e:{switch(S=qm(l,p),l){case"dialog":Ar("cancel",r),Ar("close",r),v=p;break;case"iframe":case"object":case"embed":Ar("load",r),v=p;break;case"video":case"audio":for(v=0;v<Hc.length;v++)Ar(Hc[v],r);v=p;break;case"source":Ar("error",r),v=p;break;case"img":case"image":case"link":Ar("error",r),Ar("load",r),v=p;break;case"details":Ar("toggle",r),v=p;break;case"input":vv(r,p),v=Om(r,p),Ar("invalid",r);break;case"option":v=p;break;case"select":r._wrapperState={wasMultiple:!!p.multiple},v=Ur({},p,{value:void 0}),Ar("invalid",r);break;case"textarea":wv(r,p),v=Vm(r,p),Ar("invalid",r);break;default:v=p}$m(l,v),d=v;for(k in d)if(d.hasOwnProperty(k)){var V=d[k];k==="style"?e0(r,V):k==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,V!=null&&Jx(r,V)):k==="children"?typeof V=="string"?(l!=="textarea"||V!=="")&&sh(r,V):typeof V=="number"&&sh(r,""+V):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(ih.hasOwnProperty(k)?V!=null&&k==="onScroll"&&Ar("scroll",r):V!=null&&Bg(r,k,V,S))}switch(l){case"input":Td(r),xv(r,p,!1);break;case"textarea":Td(r),bv(r);break;case"option":p.value!=null&&r.setAttribute("value",""+Sa(p.value));break;case"select":r.multiple=!!p.multiple,k=p.value,k!=null?yu(r,!!p.multiple,k,!1):p.defaultValue!=null&&yu(r,!!p.multiple,p.defaultValue,!0);break;default:typeof v.onClick=="function"&&(r.onclick=fp)}switch(l){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return Yn(i),null;case 6:if(r&&i.stateNode!=null)Sw(r,i,r.memoizedProps,p);else{if(typeof p!="string"&&i.stateNode===null)throw Error(Oe(166));if(l=ol(gh.current),ol(Hs.current),Ld(i)){if(p=i.stateNode,l=i.memoizedProps,p[Zs]=i,(k=p.nodeValue!==l)&&(r=qi,r!==null))switch(r.tag){case 3:Dd(p.nodeValue,l,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Dd(p.nodeValue,l,(r.mode&1)!==0)}k&&(i.flags|=4)}else p=(l.nodeType===9?l:l.ownerDocument).createTextNode(p),p[Zs]=i,i.stateNode=p}return Yn(i),null;case 13:if(Mr(jr),p=i.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Or&&$i!==null&&i.mode&1&&!(i.flags&128))V0(),Cu(),i.flags|=98560,k=!1;else if(k=Ld(i),p!==null&&p.dehydrated!==null){if(r===null){if(!k)throw Error(Oe(318));if(k=i.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(Oe(317));k[Zs]=i}else Cu(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;Yn(i),k=!1}else Ps!==null&&(kg(Ps),Ps=null),k=!0;if(!k)return i.flags&65536?i:null}return i.flags&128?(i.lanes=l,i):(p=p!==null,p!==(r!==null&&r.memoizedState!==null)&&p&&(i.child.flags|=8192,i.mode&1&&(r===null||jr.current&1?pn===0&&(pn=3):vy())),i.updateQueue!==null&&(i.flags|=4),Yn(i),null);case 4:return Eu(),gg(r,i),r===null&&dh(i.stateNode.containerInfo),Yn(i),null;case 10:return ry(i.type._context),Yn(i),null;case 17:return Ci(i.type)&&mp(),Yn(i),null;case 19:if(Mr(jr),k=i.memoizedState,k===null)return Yn(i),null;if(p=(i.flags&128)!==0,S=k.rendering,S===null)if(p)Vc(k,!1);else{if(pn!==0||r!==null&&r.flags&128)for(r=i.child;r!==null;){if(S=bp(r),S!==null){for(i.flags|=128,Vc(k,!1),p=S.updateQueue,p!==null&&(i.updateQueue=p,i.flags|=4),i.subtreeFlags=0,p=l,l=i.child;l!==null;)k=l,r=p,k.flags&=14680066,S=k.alternate,S===null?(k.childLanes=0,k.lanes=r,k.child=null,k.subtreeFlags=0,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=S.childLanes,k.lanes=S.lanes,k.child=S.child,k.subtreeFlags=0,k.deletions=null,k.memoizedProps=S.memoizedProps,k.memoizedState=S.memoizedState,k.updateQueue=S.updateQueue,k.type=S.type,r=S.dependencies,k.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),l=l.sibling;return kr(jr,jr.current&1|2),i.child}r=r.sibling}k.tail!==null&&Xr()>Au&&(i.flags|=128,p=!0,Vc(k,!1),i.lanes=4194304)}else{if(!p)if(r=bp(S),r!==null){if(i.flags|=128,p=!0,l=r.updateQueue,l!==null&&(i.updateQueue=l,i.flags|=4),Vc(k,!0),k.tail===null&&k.tailMode==="hidden"&&!S.alternate&&!Or)return Yn(i),null}else 2*Xr()-k.renderingStartTime>Au&&l!==1073741824&&(i.flags|=128,p=!0,Vc(k,!1),i.lanes=4194304);k.isBackwards?(S.sibling=i.child,i.child=S):(l=k.last,l!==null?l.sibling=S:i.child=S,k.last=S)}return k.tail!==null?(i=k.tail,k.rendering=i,k.tail=i.sibling,k.renderingStartTime=Xr(),i.sibling=null,l=jr.current,kr(jr,p?l&1|2:l&1),i):(Yn(i),null);case 22:case 23:return _y(),p=i.memoizedState!==null,r!==null&&r.memoizedState!==null!==p&&(i.flags|=8192),p&&i.mode&1?Ui&1073741824&&(Yn(i),i.subtreeFlags&6&&(i.flags|=8192)):Yn(i),null;case 24:return null;case 25:return null}throw Error(Oe(156,i.tag))}function rk(r,i){switch(Jg(i),i.tag){case 1:return Ci(i.type)&&mp(),r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 3:return Eu(),Mr(Ti),Mr(Qn),ay(),r=i.flags,r&65536&&!(r&128)?(i.flags=r&-65537|128,i):null;case 5:return oy(i),null;case 13:if(Mr(jr),r=i.memoizedState,r!==null&&r.dehydrated!==null){if(i.alternate===null)throw Error(Oe(340));Cu()}return r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 19:return Mr(jr),null;case 4:return Eu(),null;case 10:return ry(i.type._context),null;case 22:case 23:return _y(),null;case 24:return null;default:return null}}var Bd=!1,Jn=!1,nk=typeof WeakSet=="function"?WeakSet:Set,ht=null;function mu(r,i){var l=r.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(p){Gr(r,i,p)}else l.current=null}function yg(r,i,l){try{l()}catch(p){Gr(r,i,p)}}var hx=!1;function ik(r,i){if(eg=hp,r=E0(),Kg(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var p=l.getSelection&&l.getSelection();if(p&&p.rangeCount!==0){l=p.anchorNode;var v=p.anchorOffset,k=p.focusNode;p=p.focusOffset;try{l.nodeType,k.nodeType}catch{l=null;break e}var S=0,d=-1,V=-1,se=0,ue=0,Q=r,U=null;t:for(;;){for(var Le;Q!==l||v!==0&&Q.nodeType!==3||(d=S+v),Q!==k||p!==0&&Q.nodeType!==3||(V=S+p),Q.nodeType===3&&(S+=Q.nodeValue.length),(Le=Q.firstChild)!==null;)U=Q,Q=Le;for(;;){if(Q===r)break t;if(U===l&&++se===v&&(d=S),U===k&&++ue===p&&(V=S),(Le=Q.nextSibling)!==null)break;Q=U,U=Q.parentNode}Q=Le}l=d===-1||V===-1?null:{start:d,end:V}}else l=null}l=l||{start:0,end:0}}else l=null;for(tg={focusedElem:r,selectionRange:l},hp=!1,ht=i;ht!==null;)if(i=ht,r=i.child,(i.subtreeFlags&1028)!==0&&r!==null)r.return=i,ht=r;else for(;ht!==null;){i=ht;try{var Ee=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Ee!==null){var Fe=Ee.memoizedProps,gt=Ee.memoizedState,le=i.stateNode,te=le.getSnapshotBeforeUpdate(i.elementType===i.type?Fe:Cs(i.type,Fe),gt);le.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var ce=i.stateNode.containerInfo;ce.nodeType===1?ce.textContent="":ce.nodeType===9&&ce.documentElement&&ce.removeChild(ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Oe(163))}}catch(Ie){Gr(i,i.return,Ie)}if(r=i.sibling,r!==null){r.return=i.return,ht=r;break}ht=i.return}return Ee=hx,hx=!1,Ee}function th(r,i,l){var p=i.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var v=p=p.next;do{if((v.tag&r)===r){var k=v.destroy;v.destroy=void 0,k!==void 0&&yg(i,l,k)}v=v.next}while(v!==p)}}function jp(r,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var l=i=i.next;do{if((l.tag&r)===r){var p=l.create;l.destroy=p()}l=l.next}while(l!==i)}}function _g(r){var i=r.ref;if(i!==null){var l=r.stateNode;switch(r.tag){case 5:r=l;break;default:r=l}typeof i=="function"?i(r):i.current=r}}function kw(r){var i=r.alternate;i!==null&&(r.alternate=null,kw(i)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(i=r.stateNode,i!==null&&(delete i[Zs],delete i[fh],delete i[ig],delete i[jS],delete i[VS])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function Tw(r){return r.tag===5||r.tag===3||r.tag===4}function dx(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Tw(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function vg(r,i,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,i?l.nodeType===8?l.parentNode.insertBefore(r,i):l.insertBefore(r,i):(l.nodeType===8?(i=l.parentNode,i.insertBefore(r,l)):(i=l,i.appendChild(r)),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=fp));else if(p!==4&&(r=r.child,r!==null))for(vg(r,i,l),r=r.sibling;r!==null;)vg(r,i,l),r=r.sibling}function xg(r,i,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,i?l.insertBefore(r,i):l.appendChild(r);else if(p!==4&&(r=r.child,r!==null))for(xg(r,i,l),r=r.sibling;r!==null;)xg(r,i,l),r=r.sibling}var Fn=null,Is=!1;function aa(r,i,l){for(l=l.child;l!==null;)Cw(r,i,l),l=l.sibling}function Cw(r,i,l){if(Gs&&typeof Gs.onCommitFiberUnmount=="function")try{Gs.onCommitFiberUnmount(zp,l)}catch{}switch(l.tag){case 5:Jn||mu(l,i);case 6:var p=Fn,v=Is;Fn=null,aa(r,i,l),Fn=p,Is=v,Fn!==null&&(Is?(r=Fn,l=l.stateNode,r.nodeType===8?r.parentNode.removeChild(l):r.removeChild(l)):Fn.removeChild(l.stateNode));break;case 18:Fn!==null&&(Is?(r=Fn,l=l.stateNode,r.nodeType===8?vm(r.parentNode,l):r.nodeType===1&&vm(r,l),uh(r)):vm(Fn,l.stateNode));break;case 4:p=Fn,v=Is,Fn=l.stateNode.containerInfo,Is=!0,aa(r,i,l),Fn=p,Is=v;break;case 0:case 11:case 14:case 15:if(!Jn&&(p=l.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){v=p=p.next;do{var k=v,S=k.destroy;k=k.tag,S!==void 0&&(k&2||k&4)&&yg(l,i,S),v=v.next}while(v!==p)}aa(r,i,l);break;case 1:if(!Jn&&(mu(l,i),p=l.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=l.memoizedProps,p.state=l.memoizedState,p.componentWillUnmount()}catch(d){Gr(l,i,d)}aa(r,i,l);break;case 21:aa(r,i,l);break;case 22:l.mode&1?(Jn=(p=Jn)||l.memoizedState!==null,aa(r,i,l),Jn=p):aa(r,i,l);break;default:aa(r,i,l)}}function px(r){var i=r.updateQueue;if(i!==null){r.updateQueue=null;var l=r.stateNode;l===null&&(l=r.stateNode=new nk),i.forEach(function(p){var v=pk.bind(null,r,p);l.has(p)||(l.add(p),p.then(v,v))})}}function Ss(r,i){var l=i.deletions;if(l!==null)for(var p=0;p<l.length;p++){var v=l[p];try{var k=r,S=i,d=S;e:for(;d!==null;){switch(d.tag){case 5:Fn=d.stateNode,Is=!1;break e;case 3:Fn=d.stateNode.containerInfo,Is=!0;break e;case 4:Fn=d.stateNode.containerInfo,Is=!0;break e}d=d.return}if(Fn===null)throw Error(Oe(160));Cw(k,S,v),Fn=null,Is=!1;var V=v.alternate;V!==null&&(V.return=null),v.return=null}catch(se){Gr(v,i,se)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)Iw(i,r),i=i.sibling}function Iw(r,i){var l=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Ss(i,r),Us(r),p&4){try{th(3,r,r.return),jp(3,r)}catch(Fe){Gr(r,r.return,Fe)}try{th(5,r,r.return)}catch(Fe){Gr(r,r.return,Fe)}}break;case 1:Ss(i,r),Us(r),p&512&&l!==null&&mu(l,l.return);break;case 5:if(Ss(i,r),Us(r),p&512&&l!==null&&mu(l,l.return),r.flags&32){var v=r.stateNode;try{sh(v,"")}catch(Fe){Gr(r,r.return,Fe)}}if(p&4&&(v=r.stateNode,v!=null)){var k=r.memoizedProps,S=l!==null?l.memoizedProps:k,d=r.type,V=r.updateQueue;if(r.updateQueue=null,V!==null)try{d==="input"&&k.type==="radio"&&k.name!=null&&Xx(v,k),qm(d,S);var se=qm(d,k);for(S=0;S<V.length;S+=2){var ue=V[S],Q=V[S+1];ue==="style"?e0(v,Q):ue==="dangerouslySetInnerHTML"?Jx(v,Q):ue==="children"?sh(v,Q):Bg(v,ue,Q,se)}switch(d){case"input":Nm(v,k);break;case"textarea":Kx(v,k);break;case"select":var U=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!k.multiple;var Le=k.value;Le!=null?yu(v,!!k.multiple,Le,!1):U!==!!k.multiple&&(k.defaultValue!=null?yu(v,!!k.multiple,k.defaultValue,!0):yu(v,!!k.multiple,k.multiple?[]:"",!1))}v[fh]=k}catch(Fe){Gr(r,r.return,Fe)}}break;case 6:if(Ss(i,r),Us(r),p&4){if(r.stateNode===null)throw Error(Oe(162));v=r.stateNode,k=r.memoizedProps;try{v.nodeValue=k}catch(Fe){Gr(r,r.return,Fe)}}break;case 3:if(Ss(i,r),Us(r),p&4&&l!==null&&l.memoizedState.isDehydrated)try{uh(i.containerInfo)}catch(Fe){Gr(r,r.return,Fe)}break;case 4:Ss(i,r),Us(r);break;case 13:Ss(i,r),Us(r),v=r.child,v.flags&8192&&(k=v.memoizedState!==null,v.stateNode.isHidden=k,!k||v.alternate!==null&&v.alternate.memoizedState!==null||(gy=Xr())),p&4&&px(r);break;case 22:if(ue=l!==null&&l.memoizedState!==null,r.mode&1?(Jn=(se=Jn)||ue,Ss(i,r),Jn=se):Ss(i,r),Us(r),p&8192){if(se=r.memoizedState!==null,(r.stateNode.isHidden=se)&&!ue&&r.mode&1)for(ht=r,ue=r.child;ue!==null;){for(Q=ht=ue;ht!==null;){switch(U=ht,Le=U.child,U.tag){case 0:case 11:case 14:case 15:th(4,U,U.return);break;case 1:mu(U,U.return);var Ee=U.stateNode;if(typeof Ee.componentWillUnmount=="function"){p=U,l=U.return;try{i=p,Ee.props=i.memoizedProps,Ee.state=i.memoizedState,Ee.componentWillUnmount()}catch(Fe){Gr(p,l,Fe)}}break;case 5:mu(U,U.return);break;case 22:if(U.memoizedState!==null){mx(Q);continue}}Le!==null?(Le.return=U,ht=Le):mx(Q)}ue=ue.sibling}e:for(ue=null,Q=r;;){if(Q.tag===5){if(ue===null){ue=Q;try{v=Q.stateNode,se?(k=v.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none"):(d=Q.stateNode,V=Q.memoizedProps.style,S=V!=null&&V.hasOwnProperty("display")?V.display:null,d.style.display=Qx("display",S))}catch(Fe){Gr(r,r.return,Fe)}}}else if(Q.tag===6){if(ue===null)try{Q.stateNode.nodeValue=se?"":Q.memoizedProps}catch(Fe){Gr(r,r.return,Fe)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===r)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===r)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===r)break e;ue===Q&&(ue=null),Q=Q.return}ue===Q&&(ue=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:Ss(i,r),Us(r),p&4&&px(r);break;case 21:break;default:Ss(i,r),Us(r)}}function Us(r){var i=r.flags;if(i&2){try{e:{for(var l=r.return;l!==null;){if(Tw(l)){var p=l;break e}l=l.return}throw Error(Oe(160))}switch(p.tag){case 5:var v=p.stateNode;p.flags&32&&(sh(v,""),p.flags&=-33);var k=dx(r);xg(r,k,v);break;case 3:case 4:var S=p.stateNode.containerInfo,d=dx(r);vg(r,d,S);break;default:throw Error(Oe(161))}}catch(V){Gr(r,r.return,V)}r.flags&=-3}i&4096&&(r.flags&=-4097)}function sk(r,i,l){ht=r,Ew(r)}function Ew(r,i,l){for(var p=(r.mode&1)!==0;ht!==null;){var v=ht,k=v.child;if(v.tag===22&&p){var S=v.memoizedState!==null||Bd;if(!S){var d=v.alternate,V=d!==null&&d.memoizedState!==null||Jn;d=Bd;var se=Jn;if(Bd=S,(Jn=V)&&!se)for(ht=v;ht!==null;)S=ht,V=S.child,S.tag===22&&S.memoizedState!==null?gx(v):V!==null?(V.return=S,ht=V):gx(v);for(;k!==null;)ht=k,Ew(k),k=k.sibling;ht=v,Bd=d,Jn=se}fx(r)}else v.subtreeFlags&8772&&k!==null?(k.return=v,ht=k):fx(r)}}function fx(r){for(;ht!==null;){var i=ht;if(i.flags&8772){var l=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:Jn||jp(5,i);break;case 1:var p=i.stateNode;if(i.flags&4&&!Jn)if(l===null)p.componentDidMount();else{var v=i.elementType===i.type?l.memoizedProps:Cs(i.type,l.memoizedProps);p.componentDidUpdate(v,l.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var k=i.updateQueue;k!==null&&Jv(i,k,p);break;case 3:var S=i.updateQueue;if(S!==null){if(l=null,i.child!==null)switch(i.child.tag){case 5:l=i.child.stateNode;break;case 1:l=i.child.stateNode}Jv(i,S,l)}break;case 5:var d=i.stateNode;if(l===null&&i.flags&4){l=d;var V=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":V.autoFocus&&l.focus();break;case"img":V.src&&(l.src=V.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var se=i.alternate;if(se!==null){var ue=se.memoizedState;if(ue!==null){var Q=ue.dehydrated;Q!==null&&uh(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Oe(163))}Jn||i.flags&512&&_g(i)}catch(U){Gr(i,i.return,U)}}if(i===r){ht=null;break}if(l=i.sibling,l!==null){l.return=i.return,ht=l;break}ht=i.return}}function mx(r){for(;ht!==null;){var i=ht;if(i===r){ht=null;break}var l=i.sibling;if(l!==null){l.return=i.return,ht=l;break}ht=i.return}}function gx(r){for(;ht!==null;){var i=ht;try{switch(i.tag){case 0:case 11:case 15:var l=i.return;try{jp(4,i)}catch(V){Gr(i,l,V)}break;case 1:var p=i.stateNode;if(typeof p.componentDidMount=="function"){var v=i.return;try{p.componentDidMount()}catch(V){Gr(i,v,V)}}var k=i.return;try{_g(i)}catch(V){Gr(i,k,V)}break;case 5:var S=i.return;try{_g(i)}catch(V){Gr(i,S,V)}}}catch(V){Gr(i,i.return,V)}if(i===r){ht=null;break}var d=i.sibling;if(d!==null){d.return=i.return,ht=d;break}ht=i.return}}var ok=Math.ceil,Tp=So.ReactCurrentDispatcher,fy=So.ReactCurrentOwner,ls=So.ReactCurrentBatchConfig,sr=0,Pn=null,an=null,Bn=0,Ui=0,gu=Ca(0),pn=0,xh=null,dl=0,Vp=0,my=0,rh=null,Si=null,gy=0,Au=1/0,fo=null,Cp=!1,wg=null,va=null,Od=!1,pa=null,Ip=0,nh=0,bg=null,Yd=-1,Jd=0;function ci(){return sr&6?Xr():Yd!==-1?Yd:Yd=Xr()}function xa(r){return r.mode&1?sr&2&&Bn!==0?Bn&-Bn:$S.transition!==null?(Jd===0&&(Jd=d0()),Jd):(r=_r,r!==0||(r=window.event,r=r===void 0?16:v0(r.type)),r):1}function Ms(r,i,l,p){if(50<nh)throw nh=0,bg=null,Error(Oe(185));Sh(r,l,p),(!(sr&2)||r!==Pn)&&(r===Pn&&(!(sr&2)&&(Vp|=l),pn===4&&ha(r,Bn)),Ii(r,p),l===1&&sr===0&&!(i.mode&1)&&(Au=Xr()+500,Bp&&Ia()))}function Ii(r,i){var l=r.callbackNode;$2(r,i);var p=cp(r,r===Pn?Bn:0);if(p===0)l!==null&&Tv(l),r.callbackNode=null,r.callbackPriority=0;else if(i=p&-p,r.callbackPriority!==i){if(l!=null&&Tv(l),i===1)r.tag===0?US(yx.bind(null,r)):O0(yx.bind(null,r)),OS(function(){!(sr&6)&&Ia()}),l=null;else{switch(p0(p)){case 1:l=Ug;break;case 4:l=c0;break;case 16:l=up;break;case 536870912:l=h0;break;default:l=up}l=Fw(l,Pw.bind(null,r))}r.callbackPriority=i,r.callbackNode=l}}function Pw(r,i){if(Yd=-1,Jd=0,sr&6)throw Error(Oe(327));var l=r.callbackNode;if(bu()&&r.callbackNode!==l)return null;var p=cp(r,r===Pn?Bn:0);if(p===0)return null;if(p&30||p&r.expiredLanes||i)i=Ep(r,p);else{i=p;var v=sr;sr|=2;var k=Mw();(Pn!==r||Bn!==i)&&(fo=null,Au=Xr()+500,al(r,i));do try{uk();break}catch(d){Aw(r,d)}while(!0);ty(),Tp.current=k,sr=v,an!==null?i=0:(Pn=null,Bn=0,i=pn)}if(i!==0){if(i===2&&(v=Xm(r),v!==0&&(p=v,i=Sg(r,v))),i===1)throw l=xh,al(r,0),ha(r,p),Ii(r,Xr()),l;if(i===6)ha(r,p);else{if(v=r.current.alternate,!(p&30)&&!ak(v)&&(i=Ep(r,p),i===2&&(k=Xm(r),k!==0&&(p=k,i=Sg(r,k))),i===1))throw l=xh,al(r,0),ha(r,p),Ii(r,Xr()),l;switch(r.finishedWork=v,r.finishedLanes=p,i){case 0:case 1:throw Error(Oe(345));case 2:nl(r,Si,fo);break;case 3:if(ha(r,p),(p&130023424)===p&&(i=gy+500-Xr(),10<i)){if(cp(r,0)!==0)break;if(v=r.suspendedLanes,(v&p)!==p){ci(),r.pingedLanes|=r.suspendedLanes&v;break}r.timeoutHandle=ng(nl.bind(null,r,Si,fo),i);break}nl(r,Si,fo);break;case 4:if(ha(r,p),(p&4194240)===p)break;for(i=r.eventTimes,v=-1;0<p;){var S=31-As(p);k=1<<S,S=i[S],S>v&&(v=S),p&=~k}if(p=v,p=Xr()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*ok(p/1960))-p,10<p){r.timeoutHandle=ng(nl.bind(null,r,Si,fo),p);break}nl(r,Si,fo);break;case 5:nl(r,Si,fo);break;default:throw Error(Oe(329))}}}return Ii(r,Xr()),r.callbackNode===l?Pw.bind(null,r):null}function Sg(r,i){var l=rh;return r.current.memoizedState.isDehydrated&&(al(r,i).flags|=256),r=Ep(r,i),r!==2&&(i=Si,Si=l,i!==null&&kg(i)),r}function kg(r){Si===null?Si=r:Si.push.apply(Si,r)}function ak(r){for(var i=r;;){if(i.flags&16384){var l=i.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var p=0;p<l.length;p++){var v=l[p],k=v.getSnapshot;v=v.value;try{if(!zs(k(),v))return!1}catch{return!1}}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ha(r,i){for(i&=~my,i&=~Vp,r.suspendedLanes|=i,r.pingedLanes&=~i,r=r.expirationTimes;0<i;){var l=31-As(i),p=1<<l;r[l]=-1,i&=~p}}function yx(r){if(sr&6)throw Error(Oe(327));bu();var i=cp(r,0);if(!(i&1))return Ii(r,Xr()),null;var l=Ep(r,i);if(r.tag!==0&&l===2){var p=Xm(r);p!==0&&(i=p,l=Sg(r,p))}if(l===1)throw l=xh,al(r,0),ha(r,i),Ii(r,Xr()),l;if(l===6)throw Error(Oe(345));return r.finishedWork=r.current.alternate,r.finishedLanes=i,nl(r,Si,fo),Ii(r,Xr()),null}function yy(r,i){var l=sr;sr|=1;try{return r(i)}finally{sr=l,sr===0&&(Au=Xr()+500,Bp&&Ia())}}function pl(r){pa!==null&&pa.tag===0&&!(sr&6)&&bu();var i=sr;sr|=1;var l=ls.transition,p=_r;try{if(ls.transition=null,_r=1,r)return r()}finally{_r=p,ls.transition=l,sr=i,!(sr&6)&&Ia()}}function _y(){Ui=gu.current,Mr(gu)}function al(r,i){r.finishedWork=null,r.finishedLanes=0;var l=r.timeoutHandle;if(l!==-1&&(r.timeoutHandle=-1,BS(l)),an!==null)for(l=an.return;l!==null;){var p=l;switch(Jg(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&mp();break;case 3:Eu(),Mr(Ti),Mr(Qn),ay();break;case 5:oy(p);break;case 4:Eu();break;case 13:Mr(jr);break;case 19:Mr(jr);break;case 10:ry(p.type._context);break;case 22:case 23:_y()}l=l.return}if(Pn=r,an=r=wa(r.current,null),Bn=Ui=i,pn=0,xh=null,my=Vp=dl=0,Si=rh=null,sl!==null){for(i=0;i<sl.length;i++)if(l=sl[i],p=l.interleaved,p!==null){l.interleaved=null;var v=p.next,k=l.pending;if(k!==null){var S=k.next;k.next=v,p.next=S}l.pending=p}sl=null}return r}function Aw(r,i){do{var l=an;try{if(ty(),Wd.current=kp,Sp){for(var p=Vr.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}Sp=!1}if(hl=0,En=dn=Vr=null,eh=!1,yh=0,fy.current=null,l===null||l.return===null){pn=1,xh=i,an=null;break}e:{var k=r,S=l.return,d=l,V=i;if(i=Bn,d.flags|=32768,V!==null&&typeof V=="object"&&typeof V.then=="function"){var se=V,ue=d,Q=ue.tag;if(!(ue.mode&1)&&(Q===0||Q===11||Q===15)){var U=ue.alternate;U?(ue.updateQueue=U.updateQueue,ue.memoizedState=U.memoizedState,ue.lanes=U.lanes):(ue.updateQueue=null,ue.memoizedState=null)}var Le=ix(S);if(Le!==null){Le.flags&=-257,sx(Le,S,d,k,i),Le.mode&1&&nx(k,se,i),i=Le,V=se;var Ee=i.updateQueue;if(Ee===null){var Fe=new Set;Fe.add(V),i.updateQueue=Fe}else Ee.add(V);break e}else{if(!(i&1)){nx(k,se,i),vy();break e}V=Error(Oe(426))}}else if(Or&&d.mode&1){var gt=ix(S);if(gt!==null){!(gt.flags&65536)&&(gt.flags|=256),sx(gt,S,d,k,i),Qg(Pu(V,d));break e}}k=V=Pu(V,d),pn!==4&&(pn=2),rh===null?rh=[k]:rh.push(k),k=S;do{switch(k.tag){case 3:k.flags|=65536,i&=-i,k.lanes|=i;var le=pw(k,V,i);Yv(k,le);break e;case 1:d=V;var te=k.type,ce=k.stateNode;if(!(k.flags&128)&&(typeof te.getDerivedStateFromError=="function"||ce!==null&&typeof ce.componentDidCatch=="function"&&(va===null||!va.has(ce)))){k.flags|=65536,i&=-i,k.lanes|=i;var Ie=fw(k,d,i);Yv(k,Ie);break e}}k=k.return}while(k!==null)}Dw(l)}catch(Ne){i=Ne,an===l&&l!==null&&(an=l=l.return);continue}break}while(!0)}function Mw(){var r=Tp.current;return Tp.current=kp,r===null?kp:r}function vy(){(pn===0||pn===3||pn===2)&&(pn=4),Pn===null||!(dl&268435455)&&!(Vp&268435455)||ha(Pn,Bn)}function Ep(r,i){var l=sr;sr|=2;var p=Mw();(Pn!==r||Bn!==i)&&(fo=null,al(r,i));do try{lk();break}catch(v){Aw(r,v)}while(!0);if(ty(),sr=l,Tp.current=p,an!==null)throw Error(Oe(261));return Pn=null,Bn=0,pn}function lk(){for(;an!==null;)zw(an)}function uk(){for(;an!==null&&!L2();)zw(an)}function zw(r){var i=Rw(r.alternate,r,Ui);r.memoizedProps=r.pendingProps,i===null?Dw(r):an=i,fy.current=null}function Dw(r){var i=r;do{var l=i.alternate;if(r=i.return,i.flags&32768){if(l=rk(l,i),l!==null){l.flags&=32767,an=l;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{pn=6,an=null;return}}else if(l=tk(l,i,Ui),l!==null){an=l;return}if(i=i.sibling,i!==null){an=i;return}an=i=r}while(i!==null);pn===0&&(pn=5)}function nl(r,i,l){var p=_r,v=ls.transition;try{ls.transition=null,_r=1,ck(r,i,l,p)}finally{ls.transition=v,_r=p}return null}function ck(r,i,l,p){do bu();while(pa!==null);if(sr&6)throw Error(Oe(327));l=r.finishedWork;var v=r.finishedLanes;if(l===null)return null;if(r.finishedWork=null,r.finishedLanes=0,l===r.current)throw Error(Oe(177));r.callbackNode=null,r.callbackPriority=0;var k=l.lanes|l.childLanes;if(q2(r,k),r===Pn&&(an=Pn=null,Bn=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Od||(Od=!0,Fw(up,function(){return bu(),null})),k=(l.flags&15990)!==0,l.subtreeFlags&15990||k){k=ls.transition,ls.transition=null;var S=_r;_r=1;var d=sr;sr|=4,fy.current=null,ik(r,l),Iw(l,r),AS(tg),hp=!!eg,tg=eg=null,r.current=l,sk(l),R2(),sr=d,_r=S,ls.transition=k}else r.current=l;if(Od&&(Od=!1,pa=r,Ip=v),k=r.pendingLanes,k===0&&(va=null),O2(l.stateNode),Ii(r,Xr()),i!==null)for(p=r.onRecoverableError,l=0;l<i.length;l++)v=i[l],p(v.value,{componentStack:v.stack,digest:v.digest});if(Cp)throw Cp=!1,r=wg,wg=null,r;return Ip&1&&r.tag!==0&&bu(),k=r.pendingLanes,k&1?r===bg?nh++:(nh=0,bg=r):nh=0,Ia(),null}function bu(){if(pa!==null){var r=p0(Ip),i=ls.transition,l=_r;try{if(ls.transition=null,_r=16>r?16:r,pa===null)var p=!1;else{if(r=pa,pa=null,Ip=0,sr&6)throw Error(Oe(331));var v=sr;for(sr|=4,ht=r.current;ht!==null;){var k=ht,S=k.child;if(ht.flags&16){var d=k.deletions;if(d!==null){for(var V=0;V<d.length;V++){var se=d[V];for(ht=se;ht!==null;){var ue=ht;switch(ue.tag){case 0:case 11:case 15:th(8,ue,k)}var Q=ue.child;if(Q!==null)Q.return=ue,ht=Q;else for(;ht!==null;){ue=ht;var U=ue.sibling,Le=ue.return;if(kw(ue),ue===se){ht=null;break}if(U!==null){U.return=Le,ht=U;break}ht=Le}}}var Ee=k.alternate;if(Ee!==null){var Fe=Ee.child;if(Fe!==null){Ee.child=null;do{var gt=Fe.sibling;Fe.sibling=null,Fe=gt}while(Fe!==null)}}ht=k}}if(k.subtreeFlags&2064&&S!==null)S.return=k,ht=S;else e:for(;ht!==null;){if(k=ht,k.flags&2048)switch(k.tag){case 0:case 11:case 15:th(9,k,k.return)}var le=k.sibling;if(le!==null){le.return=k.return,ht=le;break e}ht=k.return}}var te=r.current;for(ht=te;ht!==null;){S=ht;var ce=S.child;if(S.subtreeFlags&2064&&ce!==null)ce.return=S,ht=ce;else e:for(S=te;ht!==null;){if(d=ht,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:jp(9,d)}}catch(Ne){Gr(d,d.return,Ne)}if(d===S){ht=null;break e}var Ie=d.sibling;if(Ie!==null){Ie.return=d.return,ht=Ie;break e}ht=d.return}}if(sr=v,Ia(),Gs&&typeof Gs.onPostCommitFiberRoot=="function")try{Gs.onPostCommitFiberRoot(zp,r)}catch{}p=!0}return p}finally{_r=l,ls.transition=i}}return!1}function _x(r,i,l){i=Pu(l,i),i=pw(r,i,1),r=_a(r,i,1),i=ci(),r!==null&&(Sh(r,1,i),Ii(r,i))}function Gr(r,i,l){if(r.tag===3)_x(r,r,l);else for(;i!==null;){if(i.tag===3){_x(i,r,l);break}else if(i.tag===1){var p=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(va===null||!va.has(p))){r=Pu(l,r),r=fw(i,r,1),i=_a(i,r,1),r=ci(),i!==null&&(Sh(i,1,r),Ii(i,r));break}}i=i.return}}function hk(r,i,l){var p=r.pingCache;p!==null&&p.delete(i),i=ci(),r.pingedLanes|=r.suspendedLanes&l,Pn===r&&(Bn&l)===l&&(pn===4||pn===3&&(Bn&130023424)===Bn&&500>Xr()-gy?al(r,0):my|=l),Ii(r,i)}function Lw(r,i){i===0&&(r.mode&1?(i=Ed,Ed<<=1,!(Ed&130023424)&&(Ed=4194304)):i=1);var l=ci();r=wo(r,i),r!==null&&(Sh(r,i,l),Ii(r,l))}function dk(r){var i=r.memoizedState,l=0;i!==null&&(l=i.retryLane),Lw(r,l)}function pk(r,i){var l=0;switch(r.tag){case 13:var p=r.stateNode,v=r.memoizedState;v!==null&&(l=v.retryLane);break;case 19:p=r.stateNode;break;default:throw Error(Oe(314))}p!==null&&p.delete(i),Lw(r,l)}var Rw;Rw=function(r,i,l){if(r!==null)if(r.memoizedProps!==i.pendingProps||Ti.current)ki=!0;else{if(!(r.lanes&l)&&!(i.flags&128))return ki=!1,ek(r,i,l);ki=!!(r.flags&131072)}else ki=!1,Or&&i.flags&1048576&&N0(i,_p,i.index);switch(i.lanes=0,i.tag){case 2:var p=i.type;Kd(r,i),r=i.pendingProps;var v=Tu(i,Qn.current);wu(i,l),v=uy(null,i,p,r,v,l);var k=cy();return i.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Ci(p)?(k=!0,gp(i)):k=!1,i.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,iy(i),v.updater=Np,i.stateNode=v,v._reactInternals=i,cg(i,p,r,l),i=pg(null,i,p,!0,k,l)):(i.tag=0,Or&&k&&Yg(i),ui(null,i,v,l),i=i.child),i;case 16:p=i.elementType;e:{switch(Kd(r,i),r=i.pendingProps,v=p._init,p=v(p._payload),i.type=p,v=i.tag=mk(p),r=Cs(p,r),v){case 0:i=dg(null,i,p,r,l);break e;case 1:i=lx(null,i,p,r,l);break e;case 11:i=ox(null,i,p,r,l);break e;case 14:i=ax(null,i,p,Cs(p.type,r),l);break e}throw Error(Oe(306,p,""))}return i;case 0:return p=i.type,v=i.pendingProps,v=i.elementType===p?v:Cs(p,v),dg(r,i,p,v,l);case 1:return p=i.type,v=i.pendingProps,v=i.elementType===p?v:Cs(p,v),lx(r,i,p,v,l);case 3:e:{if(_w(i),r===null)throw Error(Oe(387));p=i.pendingProps,k=i.memoizedState,v=k.element,Z0(r,i),wp(i,p,null,l);var S=i.memoizedState;if(p=S.element,k.isDehydrated)if(k={element:p,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},i.updateQueue.baseState=k,i.memoizedState=k,i.flags&256){v=Pu(Error(Oe(423)),i),i=ux(r,i,p,l,v);break e}else if(p!==v){v=Pu(Error(Oe(424)),i),i=ux(r,i,p,l,v);break e}else for($i=ya(i.stateNode.containerInfo.firstChild),qi=i,Or=!0,Ps=null,l=$0(i,null,p,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Cu(),p===v){i=bo(r,i,l);break e}ui(r,i,p,l)}i=i.child}return i;case 5:return G0(i),r===null&&ag(i),p=i.type,v=i.pendingProps,k=r!==null?r.memoizedProps:null,S=v.children,rg(p,v)?S=null:k!==null&&rg(p,k)&&(i.flags|=32),yw(r,i),ui(r,i,S,l),i.child;case 6:return r===null&&ag(i),null;case 13:return vw(r,i,l);case 4:return sy(i,i.stateNode.containerInfo),p=i.pendingProps,r===null?i.child=Iu(i,null,p,l):ui(r,i,p,l),i.child;case 11:return p=i.type,v=i.pendingProps,v=i.elementType===p?v:Cs(p,v),ox(r,i,p,v,l);case 7:return ui(r,i,i.pendingProps,l),i.child;case 8:return ui(r,i,i.pendingProps.children,l),i.child;case 12:return ui(r,i,i.pendingProps.children,l),i.child;case 10:e:{if(p=i.type._context,v=i.pendingProps,k=i.memoizedProps,S=v.value,kr(vp,p._currentValue),p._currentValue=S,k!==null)if(zs(k.value,S)){if(k.children===v.children&&!Ti.current){i=bo(r,i,l);break e}}else for(k=i.child,k!==null&&(k.return=i);k!==null;){var d=k.dependencies;if(d!==null){S=k.child;for(var V=d.firstContext;V!==null;){if(V.context===p){if(k.tag===1){V=_o(-1,l&-l),V.tag=2;var se=k.updateQueue;if(se!==null){se=se.shared;var ue=se.pending;ue===null?V.next=V:(V.next=ue.next,ue.next=V),se.pending=V}}k.lanes|=l,V=k.alternate,V!==null&&(V.lanes|=l),lg(k.return,l,i),d.lanes|=l;break}V=V.next}}else if(k.tag===10)S=k.type===i.type?null:k.child;else if(k.tag===18){if(S=k.return,S===null)throw Error(Oe(341));S.lanes|=l,d=S.alternate,d!==null&&(d.lanes|=l),lg(S,l,i),S=k.sibling}else S=k.child;if(S!==null)S.return=k;else for(S=k;S!==null;){if(S===i){S=null;break}if(k=S.sibling,k!==null){k.return=S.return,S=k;break}S=S.return}k=S}ui(r,i,v.children,l),i=i.child}return i;case 9:return v=i.type,p=i.pendingProps.children,wu(i,l),v=us(v),p=p(v),i.flags|=1,ui(r,i,p,l),i.child;case 14:return p=i.type,v=Cs(p,i.pendingProps),v=Cs(p.type,v),ax(r,i,p,v,l);case 15:return mw(r,i,i.type,i.pendingProps,l);case 17:return p=i.type,v=i.pendingProps,v=i.elementType===p?v:Cs(p,v),Kd(r,i),i.tag=1,Ci(p)?(r=!0,gp(i)):r=!1,wu(i,l),dw(i,p,v),cg(i,p,v,l),pg(null,i,p,!0,r,l);case 19:return xw(r,i,l);case 22:return gw(r,i,l)}throw Error(Oe(156,i.tag))};function Fw(r,i){return u0(r,i)}function fk(r,i,l,p){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function as(r,i,l,p){return new fk(r,i,l,p)}function xy(r){return r=r.prototype,!(!r||!r.isReactComponent)}function mk(r){if(typeof r=="function")return xy(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Ng)return 11;if(r===jg)return 14}return 2}function wa(r,i){var l=r.alternate;return l===null?(l=as(r.tag,i,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=i,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&14680064,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,i=r.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l}function Qd(r,i,l,p,v,k){var S=2;if(p=r,typeof r=="function")xy(r)&&(S=1);else if(typeof r=="string")S=5;else e:switch(r){case ou:return ll(l.children,v,k,i);case Og:S=8,v|=8;break;case Lm:return r=as(12,l,i,v|2),r.elementType=Lm,r.lanes=k,r;case Rm:return r=as(13,l,i,v),r.elementType=Rm,r.lanes=k,r;case Fm:return r=as(19,l,i,v),r.elementType=Fm,r.lanes=k,r;case Gx:return Up(l,v,k,i);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case qx:S=10;break e;case Zx:S=9;break e;case Ng:S=11;break e;case jg:S=14;break e;case la:S=16,p=null;break e}throw Error(Oe(130,r==null?r:typeof r,""))}return i=as(S,l,i,v),i.elementType=r,i.type=p,i.lanes=k,i}function ll(r,i,l,p){return r=as(7,r,p,i),r.lanes=l,r}function Up(r,i,l,p){return r=as(22,r,p,i),r.elementType=Gx,r.lanes=l,r.stateNode={isHidden:!1},r}function Im(r,i,l){return r=as(6,r,null,i),r.lanes=l,r}function Em(r,i,l){return i=as(4,r.children!==null?r.children:[],r.key,i),i.lanes=l,i.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},i}function gk(r,i,l,p,v){this.tag=i,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lm(0),this.expirationTimes=lm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lm(0),this.identifierPrefix=p,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function wy(r,i,l,p,v,k,S,d,V){return r=new gk(r,i,l,d,V),i===1?(i=1,k===!0&&(i|=8)):i=0,k=as(3,null,null,i),r.current=k,k.stateNode=r,k.memoizedState={element:p,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},iy(k),r}function yk(r,i,l){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:su,key:p==null?null:""+p,children:r,containerInfo:i,implementation:l}}function Bw(r){if(!r)return ka;r=r._reactInternals;e:{if(ml(r)!==r||r.tag!==1)throw Error(Oe(170));var i=r;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Ci(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(Oe(171))}if(r.tag===1){var l=r.type;if(Ci(l))return B0(r,l,i)}return i}function Ow(r,i,l,p,v,k,S,d,V){return r=wy(l,p,!0,r,v,k,S,d,V),r.context=Bw(null),l=r.current,p=ci(),v=xa(l),k=_o(p,v),k.callback=i??null,_a(l,k,v),r.current.lanes=v,Sh(r,v,p),Ii(r,p),r}function $p(r,i,l,p){var v=i.current,k=ci(),S=xa(v);return l=Bw(l),i.context===null?i.context=l:i.pendingContext=l,i=_o(k,S),i.payload={element:r},p=p===void 0?null:p,p!==null&&(i.callback=p),r=_a(v,i,S),r!==null&&(Ms(r,v,S,k),Hd(r,v,S)),S}function Pp(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function vx(r,i){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<i?l:i}}function by(r,i){vx(r,i),(r=r.alternate)&&vx(r,i)}function _k(){return null}var Nw=typeof reportError=="function"?reportError:function(r){console.error(r)};function Sy(r){this._internalRoot=r}qp.prototype.render=Sy.prototype.render=function(r){var i=this._internalRoot;if(i===null)throw Error(Oe(409));$p(r,i,null,null)};qp.prototype.unmount=Sy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var i=r.containerInfo;pl(function(){$p(null,r,null,null)}),i[xo]=null}};function qp(r){this._internalRoot=r}qp.prototype.unstable_scheduleHydration=function(r){if(r){var i=g0();r={blockedOn:null,target:r,priority:i};for(var l=0;l<ca.length&&i!==0&&i<ca[l].priority;l++);ca.splice(l,0,r),l===0&&_0(r)}};function ky(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Zp(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function xx(){}function vk(r,i,l,p,v){if(v){if(typeof p=="function"){var k=p;p=function(){var se=Pp(S);k.call(se)}}var S=Ow(i,p,r,0,null,!1,!1,"",xx);return r._reactRootContainer=S,r[xo]=S.current,dh(r.nodeType===8?r.parentNode:r),pl(),S}for(;v=r.lastChild;)r.removeChild(v);if(typeof p=="function"){var d=p;p=function(){var se=Pp(V);d.call(se)}}var V=wy(r,0,!1,null,null,!1,!1,"",xx);return r._reactRootContainer=V,r[xo]=V.current,dh(r.nodeType===8?r.parentNode:r),pl(function(){$p(i,V,l,p)}),V}function Gp(r,i,l,p,v){var k=l._reactRootContainer;if(k){var S=k;if(typeof v=="function"){var d=v;v=function(){var V=Pp(S);d.call(V)}}$p(i,S,r,v)}else S=vk(l,i,r,v,p);return Pp(S)}f0=function(r){switch(r.tag){case 3:var i=r.stateNode;if(i.current.memoizedState.isDehydrated){var l=Gc(i.pendingLanes);l!==0&&($g(i,l|1),Ii(i,Xr()),!(sr&6)&&(Au=Xr()+500,Ia()))}break;case 13:pl(function(){var p=wo(r,1);if(p!==null){var v=ci();Ms(p,r,1,v)}}),by(r,1)}};qg=function(r){if(r.tag===13){var i=wo(r,134217728);if(i!==null){var l=ci();Ms(i,r,134217728,l)}by(r,134217728)}};m0=function(r){if(r.tag===13){var i=xa(r),l=wo(r,i);if(l!==null){var p=ci();Ms(l,r,i,p)}by(r,i)}};g0=function(){return _r};y0=function(r,i){var l=_r;try{return _r=r,i()}finally{_r=l}};Gm=function(r,i,l){switch(i){case"input":if(Nm(r,l),i=l.name,l.type==="radio"&&i!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<l.length;i++){var p=l[i];if(p!==r&&p.form===r.form){var v=Fp(p);if(!v)throw Error(Oe(90));Wx(p),Nm(p,v)}}}break;case"textarea":Kx(r,l);break;case"select":i=l.value,i!=null&&yu(r,!!l.multiple,i,!1)}};n0=yy;i0=pl;var xk={usingClientEntryPoint:!1,Events:[Th,cu,Fp,t0,r0,yy]},Uc={findFiberByHostInstance:il,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wk={bundleType:Uc.bundleType,version:Uc.version,rendererPackageName:Uc.rendererPackageName,rendererConfig:Uc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:So.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=a0(r),r===null?null:r.stateNode},findFiberByHostInstance:Uc.findFiberByHostInstance||_k,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nd.isDisabled&&Nd.supportsFiber)try{zp=Nd.inject(wk),Gs=Nd}catch{}}Gi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xk;Gi.createPortal=function(r,i){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ky(i))throw Error(Oe(200));return yk(r,i,null,l)};Gi.createRoot=function(r,i){if(!ky(r))throw Error(Oe(299));var l=!1,p="",v=Nw;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(p=i.identifierPrefix),i.onRecoverableError!==void 0&&(v=i.onRecoverableError)),i=wy(r,1,!1,null,null,l,!1,p,v),r[xo]=i.current,dh(r.nodeType===8?r.parentNode:r),new Sy(i)};Gi.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var i=r._reactInternals;if(i===void 0)throw typeof r.render=="function"?Error(Oe(188)):(r=Object.keys(r).join(","),Error(Oe(268,r)));return r=a0(i),r=r===null?null:r.stateNode,r};Gi.flushSync=function(r){return pl(r)};Gi.hydrate=function(r,i,l){if(!Zp(i))throw Error(Oe(200));return Gp(null,r,i,!0,l)};Gi.hydrateRoot=function(r,i,l){if(!ky(r))throw Error(Oe(405));var p=l!=null&&l.hydratedSources||null,v=!1,k="",S=Nw;if(l!=null&&(l.unstable_strictMode===!0&&(v=!0),l.identifierPrefix!==void 0&&(k=l.identifierPrefix),l.onRecoverableError!==void 0&&(S=l.onRecoverableError)),i=Ow(i,null,r,1,l??null,v,!1,k,S),r[xo]=i.current,dh(r),p)for(r=0;r<p.length;r++)l=p[r],v=l._getVersion,v=v(l._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[l,v]:i.mutableSourceEagerHydrationData.push(l,v);return new qp(i)};Gi.render=function(r,i,l){if(!Zp(i))throw Error(Oe(200));return Gp(null,r,i,!1,l)};Gi.unmountComponentAtNode=function(r){if(!Zp(r))throw Error(Oe(40));return r._reactRootContainer?(pl(function(){Gp(null,null,r,!1,function(){r._reactRootContainer=null,r[xo]=null})}),!0):!1};Gi.unstable_batchedUpdates=yy;Gi.unstable_renderSubtreeIntoContainer=function(r,i,l,p){if(!Zp(l))throw Error(Oe(200));if(r==null||r._reactInternals===void 0)throw Error(Oe(38));return Gp(r,i,l,!1,p)};Gi.version="18.3.1-next-f1338f8080-20240426";function jw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jw)}catch(r){console.error(r)}}jw(),jx.exports=Gi;var bk=jx.exports,wx=bk;zm.createRoot=wx.createRoot,zm.hydrateRoot=wx.hydrateRoot;const Ws=Object.create(null);Ws.open="0";Ws.close="1";Ws.ping="2";Ws.pong="3";Ws.message="4";Ws.upgrade="5";Ws.noop="6";const ep=Object.create(null);Object.keys(Ws).forEach(r=>{ep[Ws[r]]=r});const Tg={type:"error",data:"parser error"},Vw=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Uw=typeof ArrayBuffer=="function",$w=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Ty=({type:r,data:i},l,p)=>Vw&&i instanceof Blob?l?p(i):bx(i,p):Uw&&(i instanceof ArrayBuffer||$w(i))?l?p(i):bx(new Blob([i]),p):p(Ws[r]+(i||"")),bx=(r,i)=>{const l=new FileReader;return l.onload=function(){const p=l.result.split(",")[1];i("b"+(p||""))},l.readAsDataURL(r)};function Sx(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let Pm;function Sk(r,i){if(Vw&&r.data instanceof Blob)return r.data.arrayBuffer().then(Sx).then(i);if(Uw&&(r.data instanceof ArrayBuffer||$w(r.data)))return i(Sx(r.data));Ty(r,!1,l=>{Pm||(Pm=new TextEncoder),i(Pm.encode(l))})}const kx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wc=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<kx.length;r++)Wc[kx.charCodeAt(r)]=r;const kk=r=>{let i=r.length*.75,l=r.length,p,v=0,k,S,d,V;r[r.length-1]==="="&&(i--,r[r.length-2]==="="&&i--);const se=new ArrayBuffer(i),ue=new Uint8Array(se);for(p=0;p<l;p+=4)k=Wc[r.charCodeAt(p)],S=Wc[r.charCodeAt(p+1)],d=Wc[r.charCodeAt(p+2)],V=Wc[r.charCodeAt(p+3)],ue[v++]=k<<2|S>>4,ue[v++]=(S&15)<<4|d>>2,ue[v++]=(d&3)<<6|V&63;return se},Tk=typeof ArrayBuffer=="function",Cy=(r,i)=>{if(typeof r!="string")return{type:"message",data:qw(r,i)};const l=r.charAt(0);return l==="b"?{type:"message",data:Ck(r.substring(1),i)}:ep[l]?r.length>1?{type:ep[l],data:r.substring(1)}:{type:ep[l]}:Tg},Ck=(r,i)=>{if(Tk){const l=kk(r);return qw(l,i)}else return{base64:!0,data:r}},qw=(r,i)=>{switch(i){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Zw="",Ik=(r,i)=>{const l=r.length,p=new Array(l);let v=0;r.forEach((k,S)=>{Ty(k,!1,d=>{p[S]=d,++v===l&&i(p.join(Zw))})})},Ek=(r,i)=>{const l=r.split(Zw),p=[];for(let v=0;v<l.length;v++){const k=Cy(l[v],i);if(p.push(k),k.type==="error")break}return p};function Pk(){return new TransformStream({transform(r,i){Sk(r,l=>{const p=l.length;let v;if(p<126)v=new Uint8Array(1),new DataView(v.buffer).setUint8(0,p);else if(p<65536){v=new Uint8Array(3);const k=new DataView(v.buffer);k.setUint8(0,126),k.setUint16(1,p)}else{v=new Uint8Array(9);const k=new DataView(v.buffer);k.setUint8(0,127),k.setBigUint64(1,BigInt(p))}r.data&&typeof r.data!="string"&&(v[0]|=128),i.enqueue(v),i.enqueue(l)})}})}let Am;function jd(r){return r.reduce((i,l)=>i+l.length,0)}function Vd(r,i){if(r[0].length===i)return r.shift();const l=new Uint8Array(i);let p=0;for(let v=0;v<i;v++)l[v]=r[0][p++],p===r[0].length&&(r.shift(),p=0);return r.length&&p<r[0].length&&(r[0]=r[0].slice(p)),l}function Ak(r,i){Am||(Am=new TextDecoder);const l=[];let p=0,v=-1,k=!1;return new TransformStream({transform(S,d){for(l.push(S);;){if(p===0){if(jd(l)<1)break;const V=Vd(l,1);k=(V[0]&128)===128,v=V[0]&127,v<126?p=3:v===126?p=1:p=2}else if(p===1){if(jd(l)<2)break;const V=Vd(l,2);v=new DataView(V.buffer,V.byteOffset,V.length).getUint16(0),p=3}else if(p===2){if(jd(l)<8)break;const V=Vd(l,8),se=new DataView(V.buffer,V.byteOffset,V.length),ue=se.getUint32(0);if(ue>Math.pow(2,21)-1){d.enqueue(Tg);break}v=ue*Math.pow(2,32)+se.getUint32(4),p=3}else{if(jd(l)<v)break;const V=Vd(l,v);d.enqueue(Cy(k?V:Am.decode(V),i)),p=0}if(v===0||v>r){d.enqueue(Tg);break}}}})}const Gw=4;function ln(r){if(r)return Mk(r)}function Mk(r){for(var i in ln.prototype)r[i]=ln.prototype[i];return r}ln.prototype.on=ln.prototype.addEventListener=function(r,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(i),this};ln.prototype.once=function(r,i){function l(){this.off(r,l),i.apply(this,arguments)}return l.fn=i,this.on(r,l),this};ln.prototype.off=ln.prototype.removeListener=ln.prototype.removeAllListeners=ln.prototype.removeEventListener=function(r,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var l=this._callbacks["$"+r];if(!l)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var p,v=0;v<l.length;v++)if(p=l[v],p===i||p.fn===i){l.splice(v,1);break}return l.length===0&&delete this._callbacks["$"+r],this};ln.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),l=this._callbacks["$"+r],p=1;p<arguments.length;p++)i[p-1]=arguments[p];if(l){l=l.slice(0);for(var p=0,v=l.length;p<v;++p)l[p].apply(this,i)}return this};ln.prototype.emitReserved=ln.prototype.emit;ln.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};ln.prototype.hasListeners=function(r){return!!this.listeners(r).length};const Hp=typeof Promise=="function"&&typeof Promise.resolve=="function"?i=>Promise.resolve().then(i):(i,l)=>l(i,0),ss=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),zk="arraybuffer";function Hw(r,...i){return i.reduce((l,p)=>(r.hasOwnProperty(p)&&(l[p]=r[p]),l),{})}const Dk=ss.setTimeout,Lk=ss.clearTimeout;function Wp(r,i){i.useNativeTimers?(r.setTimeoutFn=Dk.bind(ss),r.clearTimeoutFn=Lk.bind(ss)):(r.setTimeoutFn=ss.setTimeout.bind(ss),r.clearTimeoutFn=ss.clearTimeout.bind(ss))}const Rk=1.33;function Fk(r){return typeof r=="string"?Bk(r):Math.ceil((r.byteLength||r.size)*Rk)}function Bk(r){let i=0,l=0;for(let p=0,v=r.length;p<v;p++)i=r.charCodeAt(p),i<128?l+=1:i<2048?l+=2:i<55296||i>=57344?l+=3:(p++,l+=4);return l}function Ww(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Ok(r){let i="";for(let l in r)r.hasOwnProperty(l)&&(i.length&&(i+="&"),i+=encodeURIComponent(l)+"="+encodeURIComponent(r[l]));return i}function Nk(r){let i={},l=r.split("&");for(let p=0,v=l.length;p<v;p++){let k=l[p].split("=");i[decodeURIComponent(k[0])]=decodeURIComponent(k[1])}return i}class jk extends Error{constructor(i,l,p){super(i),this.description=l,this.context=p,this.type="TransportError"}}class Iy extends ln{constructor(i){super(),this.writable=!1,Wp(this,i),this.opts=i,this.query=i.query,this.socket=i.socket,this.supportsBinary=!i.forceBase64}onError(i,l,p){return super.emitReserved("error",new jk(i,l,p)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(i){this.readyState==="open"&&this.write(i)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(i){const l=Cy(i,this.socket.binaryType);this.onPacket(l)}onPacket(i){super.emitReserved("packet",i)}onClose(i){this.readyState="closed",super.emitReserved("close",i)}pause(i){}createUri(i,l={}){return i+"://"+this._hostname()+this._port()+this.opts.path+this._query(l)}_hostname(){const i=this.opts.hostname;return i.indexOf(":")===-1?i:"["+i+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(i){const l=Ok(i);return l.length?"?"+l:""}}class Vk extends Iy{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(i){this.readyState="pausing";const l=()=>{this.readyState="paused",i()};if(this._polling||!this.writable){let p=0;this._polling&&(p++,this.once("pollComplete",function(){--p||l()})),this.writable||(p++,this.once("drain",function(){--p||l()}))}else l()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(i){const l=p=>{if(this.readyState==="opening"&&p.type==="open"&&this.onOpen(),p.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(p)};Ek(i,this.socket.binaryType).forEach(l),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const i=()=>{this.write([{type:"close"}])};this.readyState==="open"?i():this.once("open",i)}write(i){this.writable=!1,Ik(i,l=>{this.doWrite(l,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const i=this.opts.secure?"https":"http",l=this.query||{};return this.opts.timestampRequests!==!1&&(l[this.opts.timestampParam]=Ww()),!this.supportsBinary&&!l.sid&&(l.b64=1),this.createUri(i,l)}}let Xw=!1;try{Xw=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Uk=Xw;function $k(){}class qk extends Vk{constructor(i){if(super(i),typeof location<"u"){const l=location.protocol==="https:";let p=location.port;p||(p=l?"443":"80"),this.xd=typeof location<"u"&&i.hostname!==location.hostname||p!==i.port}}doWrite(i,l){const p=this.request({method:"POST",data:i});p.on("success",l),p.on("error",(v,k)=>{this.onError("xhr post error",v,k)})}doPoll(){const i=this.request();i.on("data",this.onData.bind(this)),i.on("error",(l,p)=>{this.onError("xhr poll error",l,p)}),this.pollXhr=i}}let Su=class tp extends ln{constructor(i,l,p){super(),this.createRequest=i,Wp(this,p),this._opts=p,this._method=p.method||"GET",this._uri=l,this._data=p.data!==void 0?p.data:null,this._create()}_create(){var i;const l=Hw(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");l.xdomain=!!this._opts.xd;const p=this._xhr=this.createRequest(l);try{p.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){p.setDisableHeaderCheck&&p.setDisableHeaderCheck(!0);for(let v in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(v)&&p.setRequestHeader(v,this._opts.extraHeaders[v])}}catch{}if(this._method==="POST")try{p.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{p.setRequestHeader("Accept","*/*")}catch{}(i=this._opts.cookieJar)===null||i===void 0||i.addCookies(p),"withCredentials"in p&&(p.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(p.timeout=this._opts.requestTimeout),p.onreadystatechange=()=>{var v;p.readyState===3&&((v=this._opts.cookieJar)===null||v===void 0||v.parseCookies(p.getResponseHeader("set-cookie"))),p.readyState===4&&(p.status===200||p.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof p.status=="number"?p.status:0)},0))},p.send(this._data)}catch(v){this.setTimeoutFn(()=>{this._onError(v)},0);return}typeof document<"u"&&(this._index=tp.requestsCount++,tp.requests[this._index]=this)}_onError(i){this.emitReserved("error",i,this._xhr),this._cleanup(!0)}_cleanup(i){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=$k,i)try{this._xhr.abort()}catch{}typeof document<"u"&&delete tp.requests[this._index],this._xhr=null}}_onLoad(){const i=this._xhr.responseText;i!==null&&(this.emitReserved("data",i),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Su.requestsCount=0;Su.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Tx);else if(typeof addEventListener=="function"){const r="onpagehide"in ss?"pagehide":"unload";addEventListener(r,Tx,!1)}}function Tx(){for(let r in Su.requests)Su.requests.hasOwnProperty(r)&&Su.requests[r].abort()}const Zk=function(){const r=Kw({xdomain:!1});return r&&r.responseType!==null}();class Gk extends qk{constructor(i){super(i);const l=i&&i.forceBase64;this.supportsBinary=Zk&&!l}request(i={}){return Object.assign(i,{xd:this.xd},this.opts),new Su(Kw,this.uri(),i)}}function Kw(r){const i=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!i||Uk))return new XMLHttpRequest}catch{}if(!i)try{return new ss[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Yw=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Hk extends Iy{get name(){return"websocket"}doOpen(){const i=this.uri(),l=this.opts.protocols,p=Yw?{}:Hw(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(p.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(i,l,p)}catch(v){return this.emitReserved("error",v)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=i=>this.onClose({description:"websocket connection closed",context:i}),this.ws.onmessage=i=>this.onData(i.data),this.ws.onerror=i=>this.onError("websocket error",i)}write(i){this.writable=!1;for(let l=0;l<i.length;l++){const p=i[l],v=l===i.length-1;Ty(p,this.supportsBinary,k=>{try{this.doWrite(p,k)}catch{}v&&Hp(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const i=this.opts.secure?"wss":"ws",l=this.query||{};return this.opts.timestampRequests&&(l[this.opts.timestampParam]=Ww()),this.supportsBinary||(l.b64=1),this.createUri(i,l)}}const Mm=ss.WebSocket||ss.MozWebSocket;class Wk extends Hk{createSocket(i,l,p){return Yw?new Mm(i,l,p):l?new Mm(i,l):new Mm(i)}doWrite(i,l){this.ws.send(l)}}class Xk extends Iy{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(i){return this.emitReserved("error",i)}this._transport.closed.then(()=>{this.onClose()}).catch(i=>{this.onError("webtransport error",i)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(i=>{const l=Ak(Number.MAX_SAFE_INTEGER,this.socket.binaryType),p=i.readable.pipeThrough(l).getReader(),v=Pk();v.readable.pipeTo(i.writable),this._writer=v.writable.getWriter();const k=()=>{p.read().then(({done:d,value:V})=>{d||(this.onPacket(V),k())}).catch(d=>{})};k();const S={type:"open"};this.query.sid&&(S.data=`{"sid":"${this.query.sid}"}`),this._writer.write(S).then(()=>this.onOpen())})})}write(i){this.writable=!1;for(let l=0;l<i.length;l++){const p=i[l],v=l===i.length-1;this._writer.write(p).then(()=>{v&&Hp(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var i;(i=this._transport)===null||i===void 0||i.close()}}const Kk={websocket:Wk,webtransport:Xk,polling:Gk},Yk=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Jk=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Cg(r){if(r.length>8e3)throw"URI too long";const i=r,l=r.indexOf("["),p=r.indexOf("]");l!=-1&&p!=-1&&(r=r.substring(0,l)+r.substring(l,p).replace(/:/g,";")+r.substring(p,r.length));let v=Yk.exec(r||""),k={},S=14;for(;S--;)k[Jk[S]]=v[S]||"";return l!=-1&&p!=-1&&(k.source=i,k.host=k.host.substring(1,k.host.length-1).replace(/;/g,":"),k.authority=k.authority.replace("[","").replace("]","").replace(/;/g,":"),k.ipv6uri=!0),k.pathNames=Qk(k,k.path),k.queryKey=eT(k,k.query),k}function Qk(r,i){const l=/\/{2,9}/g,p=i.replace(l,"/").split("/");return(i.slice(0,1)=="/"||i.length===0)&&p.splice(0,1),i.slice(-1)=="/"&&p.splice(p.length-1,1),p}function eT(r,i){const l={};return i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(p,v,k){v&&(l[v]=k)}),l}const Ig=typeof addEventListener=="function"&&typeof removeEventListener=="function",rp=[];Ig&&addEventListener("offline",()=>{rp.forEach(r=>r())},!1);class ba extends ln{constructor(i,l){if(super(),this.binaryType=zk,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,i&&typeof i=="object"&&(l=i,i=null),i){const p=Cg(i);l.hostname=p.host,l.secure=p.protocol==="https"||p.protocol==="wss",l.port=p.port,p.query&&(l.query=p.query)}else l.host&&(l.hostname=Cg(l.host).host);Wp(this,l),this.secure=l.secure!=null?l.secure:typeof location<"u"&&location.protocol==="https:",l.hostname&&!l.port&&(l.port=this.secure?"443":"80"),this.hostname=l.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=l.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},l.transports.forEach(p=>{const v=p.prototype.name;this.transports.push(v),this._transportsByName[v]=p}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},l),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Nk(this.opts.query)),Ig&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},rp.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(i){const l=Object.assign({},this.opts.query);l.EIO=Gw,l.transport=i,this.id&&(l.sid=this.id);const p=Object.assign({},this.opts,{query:l,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[i]);return new this._transportsByName[i](p)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const i=this.opts.rememberUpgrade&&ba.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const l=this.createTransport(i);l.open(),this.setTransport(l)}setTransport(i){this.transport&&this.transport.removeAllListeners(),this.transport=i,i.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",l=>this._onClose("transport close",l))}onOpen(){this.readyState="open",ba.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",i),this.emitReserved("heartbeat"),i.type){case"open":this.onHandshake(JSON.parse(i.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const l=new Error("server error");l.code=i.data,this._onError(l);break;case"message":this.emitReserved("data",i.data),this.emitReserved("message",i.data);break}}onHandshake(i){this.emitReserved("handshake",i),this.id=i.sid,this.transport.query.sid=i.sid,this._pingInterval=i.pingInterval,this._pingTimeout=i.pingTimeout,this._maxPayload=i.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const i=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+i,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},i),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const i=this._getWritablePackets();this.transport.send(i),this._prevBufferLen=i.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let l=1;for(let p=0;p<this.writeBuffer.length;p++){const v=this.writeBuffer[p].data;if(v&&(l+=Fk(v)),p>0&&l>this._maxPayload)return this.writeBuffer.slice(0,p);l+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const i=Date.now()>this._pingTimeoutTime;return i&&(this._pingTimeoutTime=0,Hp(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),i}write(i,l,p){return this._sendPacket("message",i,l,p),this}send(i,l,p){return this._sendPacket("message",i,l,p),this}_sendPacket(i,l,p,v){if(typeof l=="function"&&(v=l,l=void 0),typeof p=="function"&&(v=p,p=null),this.readyState==="closing"||this.readyState==="closed")return;p=p||{},p.compress=p.compress!==!1;const k={type:i,data:l,options:p};this.emitReserved("packetCreate",k),this.writeBuffer.push(k),v&&this.once("flush",v),this.flush()}close(){const i=()=>{this._onClose("forced close"),this.transport.close()},l=()=>{this.off("upgrade",l),this.off("upgradeError",l),i()},p=()=>{this.once("upgrade",l),this.once("upgradeError",l)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?p():i()}):this.upgrading?p():i()),this}_onError(i){if(ba.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",i),this._onClose("transport error",i)}_onClose(i,l){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Ig&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const p=rp.indexOf(this._offlineEventListener);p!==-1&&rp.splice(p,1)}this.readyState="closed",this.id=null,this.emitReserved("close",i,l),this.writeBuffer=[],this._prevBufferLen=0}}}ba.protocol=Gw;class tT extends ba{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let i=0;i<this._upgrades.length;i++)this._probe(this._upgrades[i])}_probe(i){let l=this.createTransport(i),p=!1;ba.priorWebsocketSuccess=!1;const v=()=>{p||(l.send([{type:"ping",data:"probe"}]),l.once("packet",Q=>{if(!p)if(Q.type==="pong"&&Q.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",l),!l)return;ba.priorWebsocketSuccess=l.name==="websocket",this.transport.pause(()=>{p||this.readyState!=="closed"&&(ue(),this.setTransport(l),l.send([{type:"upgrade"}]),this.emitReserved("upgrade",l),l=null,this.upgrading=!1,this.flush())})}else{const U=new Error("probe error");U.transport=l.name,this.emitReserved("upgradeError",U)}}))};function k(){p||(p=!0,ue(),l.close(),l=null)}const S=Q=>{const U=new Error("probe error: "+Q);U.transport=l.name,k(),this.emitReserved("upgradeError",U)};function d(){S("transport closed")}function V(){S("socket closed")}function se(Q){l&&Q.name!==l.name&&k()}const ue=()=>{l.removeListener("open",v),l.removeListener("error",S),l.removeListener("close",d),this.off("close",V),this.off("upgrading",se)};l.once("open",v),l.once("error",S),l.once("close",d),this.once("close",V),this.once("upgrading",se),this._upgrades.indexOf("webtransport")!==-1&&i!=="webtransport"?this.setTimeoutFn(()=>{p||l.open()},200):l.open()}onHandshake(i){this._upgrades=this._filterUpgrades(i.upgrades),super.onHandshake(i)}_filterUpgrades(i){const l=[];for(let p=0;p<i.length;p++)~this.transports.indexOf(i[p])&&l.push(i[p]);return l}}let rT=class extends tT{constructor(i,l={}){const p=typeof i=="object"?i:l;(!p.transports||p.transports&&typeof p.transports[0]=="string")&&(p.transports=(p.transports||["polling","websocket","webtransport"]).map(v=>Kk[v]).filter(v=>!!v)),super(i,p)}};function nT(r,i="",l){let p=r;l=l||typeof location<"u"&&location,r==null&&(r=l.protocol+"//"+l.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=l.protocol+r:r=l.host+r),/^(https?|wss?):\/\//.test(r)||(typeof l<"u"?r=l.protocol+"//"+r:r="https://"+r),p=Cg(r)),p.port||(/^(http|ws)$/.test(p.protocol)?p.port="80":/^(http|ws)s$/.test(p.protocol)&&(p.port="443")),p.path=p.path||"/";const k=p.host.indexOf(":")!==-1?"["+p.host+"]":p.host;return p.id=p.protocol+"://"+k+":"+p.port+i,p.href=p.protocol+"://"+k+(l&&l.port===p.port?"":":"+p.port),p}const iT=typeof ArrayBuffer=="function",sT=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Jw=Object.prototype.toString,oT=typeof Blob=="function"||typeof Blob<"u"&&Jw.call(Blob)==="[object BlobConstructor]",aT=typeof File=="function"||typeof File<"u"&&Jw.call(File)==="[object FileConstructor]";function Ey(r){return iT&&(r instanceof ArrayBuffer||sT(r))||oT&&r instanceof Blob||aT&&r instanceof File}function np(r,i){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let l=0,p=r.length;l<p;l++)if(np(r[l]))return!0;return!1}if(Ey(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return np(r.toJSON(),!0);for(const l in r)if(Object.prototype.hasOwnProperty.call(r,l)&&np(r[l]))return!0;return!1}function lT(r){const i=[],l=r.data,p=r;return p.data=Eg(l,i),p.attachments=i.length,{packet:p,buffers:i}}function Eg(r,i){if(!r)return r;if(Ey(r)){const l={_placeholder:!0,num:i.length};return i.push(r),l}else if(Array.isArray(r)){const l=new Array(r.length);for(let p=0;p<r.length;p++)l[p]=Eg(r[p],i);return l}else if(typeof r=="object"&&!(r instanceof Date)){const l={};for(const p in r)Object.prototype.hasOwnProperty.call(r,p)&&(l[p]=Eg(r[p],i));return l}return r}function uT(r,i){return r.data=Pg(r.data,i),delete r.attachments,r}function Pg(r,i){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<i.length)return i[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let l=0;l<r.length;l++)r[l]=Pg(r[l],i);else if(typeof r=="object")for(const l in r)Object.prototype.hasOwnProperty.call(r,l)&&(r[l]=Pg(r[l],i));return r}const Qw=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],cT=5;var Wt;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(Wt||(Wt={}));class hT{constructor(i){this.replacer=i}encode(i){return(i.type===Wt.EVENT||i.type===Wt.ACK)&&np(i)?this.encodeAsBinary({type:i.type===Wt.EVENT?Wt.BINARY_EVENT:Wt.BINARY_ACK,nsp:i.nsp,data:i.data,id:i.id}):[this.encodeAsString(i)]}encodeAsString(i){let l=""+i.type;return(i.type===Wt.BINARY_EVENT||i.type===Wt.BINARY_ACK)&&(l+=i.attachments+"-"),i.nsp&&i.nsp!=="/"&&(l+=i.nsp+","),i.id!=null&&(l+=i.id),i.data!=null&&(l+=JSON.stringify(i.data,this.replacer)),l}encodeAsBinary(i){const l=lT(i),p=this.encodeAsString(l.packet),v=l.buffers;return v.unshift(p),v}}class Py extends ln{constructor(i){super(),this.reviver=i}add(i){let l;if(typeof i=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");l=this.decodeString(i);const p=l.type===Wt.BINARY_EVENT;p||l.type===Wt.BINARY_ACK?(l.type=p?Wt.EVENT:Wt.ACK,this.reconstructor=new dT(l),l.attachments===0&&super.emitReserved("decoded",l)):super.emitReserved("decoded",l)}else if(Ey(i)||i.base64)if(this.reconstructor)l=this.reconstructor.takeBinaryData(i),l&&(this.reconstructor=null,super.emitReserved("decoded",l));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+i)}decodeString(i){let l=0;const p={type:Number(i.charAt(0))};if(Wt[p.type]===void 0)throw new Error("unknown packet type "+p.type);if(p.type===Wt.BINARY_EVENT||p.type===Wt.BINARY_ACK){const k=l+1;for(;i.charAt(++l)!=="-"&&l!=i.length;);const S=i.substring(k,l);if(S!=Number(S)||i.charAt(l)!=="-")throw new Error("Illegal attachments");p.attachments=Number(S)}if(i.charAt(l+1)==="/"){const k=l+1;for(;++l&&!(i.charAt(l)===","||l===i.length););p.nsp=i.substring(k,l)}else p.nsp="/";const v=i.charAt(l+1);if(v!==""&&Number(v)==v){const k=l+1;for(;++l;){const S=i.charAt(l);if(S==null||Number(S)!=S){--l;break}if(l===i.length)break}p.id=Number(i.substring(k,l+1))}if(i.charAt(++l)){const k=this.tryParse(i.substr(l));if(Py.isPayloadValid(p.type,k))p.data=k;else throw new Error("invalid payload")}return p}tryParse(i){try{return JSON.parse(i,this.reviver)}catch{return!1}}static isPayloadValid(i,l){switch(i){case Wt.CONNECT:return Ap(l);case Wt.DISCONNECT:return l===void 0;case Wt.CONNECT_ERROR:return typeof l=="string"||Ap(l);case Wt.EVENT:case Wt.BINARY_EVENT:return Array.isArray(l)&&(typeof l[0]=="number"||typeof l[0]=="string"&&Qw.indexOf(l[0])===-1);case Wt.ACK:case Wt.BINARY_ACK:return Array.isArray(l)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class dT{constructor(i){this.packet=i,this.buffers=[],this.reconPack=i}takeBinaryData(i){if(this.buffers.push(i),this.buffers.length===this.reconPack.attachments){const l=uT(this.reconPack,this.buffers);return this.finishedReconstruction(),l}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function pT(r){return typeof r=="string"}const fT=Number.isInteger||function(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r};function mT(r){return r===void 0||fT(r)}function Ap(r){return Object.prototype.toString.call(r)==="[object Object]"}function gT(r,i){switch(r){case Wt.CONNECT:return i===void 0||Ap(i);case Wt.DISCONNECT:return i===void 0;case Wt.EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&Qw.indexOf(i[0])===-1);case Wt.ACK:return Array.isArray(i);case Wt.CONNECT_ERROR:return typeof i=="string"||Ap(i);default:return!1}}function yT(r){return pT(r.nsp)&&mT(r.id)&&gT(r.type,r.data)}const _T=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Py,Encoder:hT,get PacketType(){return Wt},isPacketValid:yT,protocol:cT},Symbol.toStringTag,{value:"Module"}));function Es(r,i,l){return r.on(i,l),function(){r.off(i,l)}}const vT=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class e1 extends ln{constructor(i,l,p){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=i,this.nsp=l,p&&p.auth&&(this.auth=p.auth),this._opts=Object.assign({},p),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const i=this.io;this.subs=[Es(i,"open",this.onopen.bind(this)),Es(i,"packet",this.onpacket.bind(this)),Es(i,"error",this.onerror.bind(this)),Es(i,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...i){return i.unshift("message"),this.emit.apply(this,i),this}emit(i,...l){var p,v,k;if(vT.hasOwnProperty(i))throw new Error('"'+i.toString()+'" is a reserved event name');if(l.unshift(i),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(l),this;const S={type:Wt.EVENT,data:l};if(S.options={},S.options.compress=this.flags.compress!==!1,typeof l[l.length-1]=="function"){const ue=this.ids++,Q=l.pop();this._registerAckCallback(ue,Q),S.id=ue}const d=(v=(p=this.io.engine)===null||p===void 0?void 0:p.transport)===null||v===void 0?void 0:v.writable,V=this.connected&&!(!((k=this.io.engine)===null||k===void 0)&&k._hasPingExpired());return this.flags.volatile&&!d||(V?(this.notifyOutgoingListeners(S),this.packet(S)):this.sendBuffer.push(S)),this.flags={},this}_registerAckCallback(i,l){var p;const v=(p=this.flags.timeout)!==null&&p!==void 0?p:this._opts.ackTimeout;if(v===void 0){this.acks[i]=l;return}const k=this.io.setTimeoutFn(()=>{delete this.acks[i];for(let d=0;d<this.sendBuffer.length;d++)this.sendBuffer[d].id===i&&this.sendBuffer.splice(d,1);l.call(this,new Error("operation has timed out"))},v),S=(...d)=>{this.io.clearTimeoutFn(k),l.apply(this,d)};S.withError=!0,this.acks[i]=S}emitWithAck(i,...l){return new Promise((p,v)=>{const k=(S,d)=>S?v(S):p(d);k.withError=!0,l.push(k),this.emit(i,...l)})}_addToQueue(i){let l;typeof i[i.length-1]=="function"&&(l=i.pop());const p={id:this._queueSeq++,tryCount:0,pending:!1,args:i,flags:Object.assign({fromQueue:!0},this.flags)};i.push((v,...k)=>(this._queue[0],v!==null?p.tryCount>this._opts.retries&&(this._queue.shift(),l&&l(v)):(this._queue.shift(),l&&l(null,...k)),p.pending=!1,this._drainQueue())),this._queue.push(p),this._drainQueue()}_drainQueue(i=!1){if(!this.connected||this._queue.length===0)return;const l=this._queue[0];l.pending&&!i||(l.pending=!0,l.tryCount++,this.flags=l.flags,this.emit.apply(this,l.args))}packet(i){i.nsp=this.nsp,this.io._packet(i)}onopen(){typeof this.auth=="function"?this.auth(i=>{this._sendConnectPacket(i)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(i){this.packet({type:Wt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},i):i})}onerror(i){this.connected||this.emitReserved("connect_error",i)}onclose(i,l){this.connected=!1,delete this.id,this.emitReserved("disconnect",i,l),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(i=>{if(!this.sendBuffer.some(p=>String(p.id)===i)){const p=this.acks[i];delete this.acks[i],p.withError&&p.call(this,new Error("socket has been disconnected"))}})}onpacket(i){if(i.nsp===this.nsp)switch(i.type){case Wt.CONNECT:i.data&&i.data.sid?this.onconnect(i.data.sid,i.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Wt.EVENT:case Wt.BINARY_EVENT:this.onevent(i);break;case Wt.ACK:case Wt.BINARY_ACK:this.onack(i);break;case Wt.DISCONNECT:this.ondisconnect();break;case Wt.CONNECT_ERROR:this.destroy();const p=new Error(i.data.message);p.data=i.data.data,this.emitReserved("connect_error",p);break}}onevent(i){const l=i.data||[];i.id!=null&&l.push(this.ack(i.id)),this.connected?this.emitEvent(l):this.receiveBuffer.push(Object.freeze(l))}emitEvent(i){if(this._anyListeners&&this._anyListeners.length){const l=this._anyListeners.slice();for(const p of l)p.apply(this,i)}super.emit.apply(this,i),this._pid&&i.length&&typeof i[i.length-1]=="string"&&(this._lastOffset=i[i.length-1])}ack(i){const l=this;let p=!1;return function(...v){p||(p=!0,l.packet({type:Wt.ACK,id:i,data:v}))}}onack(i){const l=this.acks[i.id];typeof l=="function"&&(delete this.acks[i.id],l.withError&&i.data.unshift(null),l.apply(this,i.data))}onconnect(i,l){this.id=i,this.recovered=l&&this._pid===l,this._pid=l,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(i=>this.emitEvent(i)),this.receiveBuffer=[],this.sendBuffer.forEach(i=>{this.notifyOutgoingListeners(i),this.packet(i)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(i=>i()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Wt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(i){return this.flags.compress=i,this}get volatile(){return this.flags.volatile=!0,this}timeout(i){return this.flags.timeout=i,this}onAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(i),this}prependAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(i),this}offAny(i){if(!this._anyListeners)return this;if(i){const l=this._anyListeners;for(let p=0;p<l.length;p++)if(i===l[p])return l.splice(p,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(i),this}prependAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(i),this}offAnyOutgoing(i){if(!this._anyOutgoingListeners)return this;if(i){const l=this._anyOutgoingListeners;for(let p=0;p<l.length;p++)if(i===l[p])return l.splice(p,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(i){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const l=this._anyOutgoingListeners.slice();for(const p of l)p.apply(this,i.data)}}}function Lu(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Lu.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),l=Math.floor(i*this.jitter*r);r=Math.floor(i*10)&1?r+l:r-l}return Math.min(r,this.max)|0};Lu.prototype.reset=function(){this.attempts=0};Lu.prototype.setMin=function(r){this.ms=r};Lu.prototype.setMax=function(r){this.max=r};Lu.prototype.setJitter=function(r){this.jitter=r};class Ag extends ln{constructor(i,l){var p;super(),this.nsps={},this.subs=[],i&&typeof i=="object"&&(l=i,i=void 0),l=l||{},l.path=l.path||"/socket.io",this.opts=l,Wp(this,l),this.reconnection(l.reconnection!==!1),this.reconnectionAttempts(l.reconnectionAttempts||1/0),this.reconnectionDelay(l.reconnectionDelay||1e3),this.reconnectionDelayMax(l.reconnectionDelayMax||5e3),this.randomizationFactor((p=l.randomizationFactor)!==null&&p!==void 0?p:.5),this.backoff=new Lu({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(l.timeout==null?2e4:l.timeout),this._readyState="closed",this.uri=i;const v=l.parser||_T;this.encoder=new v.Encoder,this.decoder=new v.Decoder,this._autoConnect=l.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,i||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(i){return i===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var l;return i===void 0?this._reconnectionDelay:(this._reconnectionDelay=i,(l=this.backoff)===null||l===void 0||l.setMin(i),this)}randomizationFactor(i){var l;return i===void 0?this._randomizationFactor:(this._randomizationFactor=i,(l=this.backoff)===null||l===void 0||l.setJitter(i),this)}reconnectionDelayMax(i){var l;return i===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,(l=this.backoff)===null||l===void 0||l.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(i){if(~this._readyState.indexOf("open"))return this;this.engine=new rT(this.uri,this.opts);const l=this.engine,p=this;this._readyState="opening",this.skipReconnect=!1;const v=Es(l,"open",function(){p.onopen(),i&&i()}),k=d=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",d),i?i(d):this.maybeReconnectOnOpen()},S=Es(l,"error",k);if(this._timeout!==!1){const d=this._timeout,V=this.setTimeoutFn(()=>{v(),k(new Error("timeout")),l.close()},d);this.opts.autoUnref&&V.unref(),this.subs.push(()=>{this.clearTimeoutFn(V)})}return this.subs.push(v),this.subs.push(S),this}connect(i){return this.open(i)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const i=this.engine;this.subs.push(Es(i,"ping",this.onping.bind(this)),Es(i,"data",this.ondata.bind(this)),Es(i,"error",this.onerror.bind(this)),Es(i,"close",this.onclose.bind(this)),Es(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(i){try{this.decoder.add(i)}catch(l){this.onclose("parse error",l)}}ondecoded(i){Hp(()=>{this.emitReserved("packet",i)},this.setTimeoutFn)}onerror(i){this.emitReserved("error",i)}socket(i,l){let p=this.nsps[i];return p?this._autoConnect&&!p.active&&p.connect():(p=new e1(this,i,l),this.nsps[i]=p),p}_destroy(i){const l=Object.keys(this.nsps);for(const p of l)if(this.nsps[p].active)return;this._close()}_packet(i){const l=this.encoder.encode(i);for(let p=0;p<l.length;p++)this.engine.write(l[p],i.options)}cleanup(){this.subs.forEach(i=>i()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(i,l){var p;this.cleanup(),(p=this.engine)===null||p===void 0||p.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",i,l),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const l=this.backoff.duration();this._reconnecting=!0;const p=this.setTimeoutFn(()=>{i.skipReconnect||(this.emitReserved("reconnect_attempt",i.backoff.attempts),!i.skipReconnect&&i.open(v=>{v?(i._reconnecting=!1,i.reconnect(),this.emitReserved("reconnect_error",v)):i.onreconnect()}))},l);this.opts.autoUnref&&p.unref(),this.subs.push(()=>{this.clearTimeoutFn(p)})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",i)}}const $c={};function ip(r,i){typeof r=="object"&&(i=r,r=void 0),i=i||{};const l=nT(r,i.path||"/socket.io"),p=l.source,v=l.id,k=l.path,S=$c[v]&&k in $c[v].nsps,d=i.forceNew||i["force new connection"]||i.multiplex===!1||S;let V;return d?V=new Ag(p,i):($c[v]||($c[v]=new Ag(p,i)),V=$c[v]),l.query&&!i.query&&(i.query=l.queryKey),V.socket(l.path,i)}Object.assign(ip,{Manager:Ag,Socket:e1,io:ip,connect:ip});var t1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,i){(function(l,p){r.exports=p()})(Xb,function(){var l={},p={};function v(S,d,V){if(p[S]=V,S==="index"){var se="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",ue={};return p.shared(ue),p.index(l,ue),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([se],{type:"text/javascript"}))),l}}v("shared",["exports"],function(S){function d(n,t,s,a){return new(s||(s=Promise))(function(h,g){function y(C){try{w(a.next(C))}catch(I){g(I)}}function _(C){try{w(a.throw(C))}catch(I){g(I)}}function w(C){var I;C.done?h(C.value):(I=C.value,I instanceof s?I:new s(function(P){P(I)})).then(y,_)}w((a=a.apply(n,t||[])).next())})}function V(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var se=ue;function ue(n,t){this.x=n,this.y=t}ue.prototype={clone:function(){return new ue(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,s=n.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),s=Math.sin(n),a=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=a,this},_rotateAround:function(n,t){var s=Math.cos(n),a=Math.sin(n),h=t.y+a*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ue.convert=function(n){return n instanceof ue?n:Array.isArray(n)?new ue(n[0],n[1]):n};var Q=V(se),U=Le;function Le(n,t,s,a){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=a}Le.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,a=0;a<8;a++){var h=this.sampleCurveX(s)-n;if(Math.abs(h)<t)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=h/g}var y=0,_=1;for(s=n,a=0;a<20&&(h=this.sampleCurveX(s),!(Math.abs(h-n)<t));a++)n>h?y=s:_=s,s=.5*(_-y)+y;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Ee=V(U);let Fe,gt;function le(){return Fe==null&&(Fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Fe}function te(){if(gt==null&&(gt=!1,le())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const h=4*a;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&s[a]!==a){gt=!0;break}}}return gt||!1}function ce(n,t,s,a){const h=new Ee(n,t,s,a);return g=>h.solve(g)}const Ie=ce(.25,.1,.25,1);function Ne(n,t,s){return Math.min(s,Math.max(t,n))}function Ke(n,t,s){const a=s-t,h=((n-t)%a+a)%a+t;return h===t?s:h}function qe(n,...t){for(const s of t)for(const a in s)n[a]=s[a];return n}let Je=1;function Et(n,t,s){const a={};for(const h in n)a[h]=t.call(this,n[h],h,n);return a}function wt(n,t,s){const a={};for(const h in n)t.call(this,n[h],h,n)&&(a[h]=n[h]);return a}function St(n){return Array.isArray(n)?n.map(St):typeof n=="object"&&n?Et(n,St):n}const or={};function yt(n){or[n]||(typeof console<"u"&&console.warn(n),or[n]=!0)}function Mt(n,t,s){return(s.y-n.y)*(t.x-n.x)>(t.y-n.y)*(s.x-n.x)}function $t(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let nr=null;function er(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function lt(n,t,s,a,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(n,{timestamp:0});try{const y=g==null?void 0:g.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const _=y.startsWith("BGR"),w=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(w,function(C,I,P,z,R){const B=4*Math.max(-I,0),O=(Math.max(0,P)-P)*z*4+B,G=4*z,X=Math.max(0,I),me=Math.max(0,P);return{rect:{x:X,y:me,width:Math.min(C.width,I+z)-X,height:Math.min(C.height,P+R)-me},layout:[{offset:O,stride:G}]}}(n,t,s,a,h)),_)for(let C=0;C<w.length;C+=4){const I=w[C];w[C]=w[C+2],w[C+2]=I}return w}finally{g.close()}})}let He,Rt;const kt="AbortError";function An(){return new Error(kt)}const $r={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ct(n){return $r.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const _t="global-dispatcher";class rt extends Error{constructor(t,s,a,h){super(`AJAXError: ${s} (${t}): ${a}`),this.status=t,this.statusText=s,this.url=a,this.body=h}}const xt=()=>$t(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ir=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const a=ct(n.url);if(a)return a(n,t);if($t(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:_t},t)}if(!(/^file:/.test(s=n.url)||/^file:/.test(xt())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,h){return d(this,void 0,void 0,function*(){const g=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:xt(),signal:h.signal});a.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const y=yield fetch(g);if(!y.ok){const C=yield y.blob();throw new rt(y.status,y.statusText,a.url,C)}let _;_=a.type==="arrayBuffer"||a.type==="image"?y.arrayBuffer():a.type==="json"?y.json():y.text();const w=yield _;if(h.signal.aborted)throw An();return{data:w,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(n,t);if($t(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:_t},t)}var s;return function(a,h){return new Promise((g,y)=>{var _;const w=new XMLHttpRequest;w.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(w.responseType="arraybuffer");for(const C in a.headers)w.setRequestHeader(C,a.headers[C]);a.type==="json"&&(w.responseType="text",!((_=a.headers)===null||_===void 0)&&_.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=a.credentials==="include",w.onerror=()=>{y(new Error(w.statusText))},w.onload=()=>{if(!h.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let C=w.response;if(a.type==="json")try{C=JSON.parse(w.response)}catch(I){return void y(I)}g({data:C,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const C=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});y(new rt(w.status,w.statusText,a.url,C))}},h.signal.addEventListener("abort",()=>{w.abort(),y(An())}),w.send(a.body)})}(n,t)};function Tr(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function zr(n,t,s){s[n]&&s[n].indexOf(t)!==-1||(s[n]=s[n]||[],s[n].push(t))}function Kr(n,t,s){if(s&&s[n]){const a=s[n].indexOf(t);a!==-1&&s[n].splice(a,1)}}class Nn{constructor(t,s={}){qe(this,s),this.type=t}}class Ei extends Nn{constructor(t,s={}){super("error",qe({error:t},s))}}class Ds{on(t,s){return this._listeners=this._listeners||{},zr(t,s,this._listeners),this}off(t,s){return Kr(t,s,this._listeners),Kr(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},zr(t,s,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,s){typeof t=="string"&&(t=new Nn(t,s||{}));const a=t.type;if(this.listens(a)){t.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const _ of h)_.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const _ of g)Kr(a,_,this._oneTimeListeners),_.call(this,t);const y=this._eventedParent;y&&(qe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof Ei&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Wi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function jn(n,t){const s={};for(const a in n)a!=="ref"&&(s[a]=n[a]);return Wi.forEach(a=>{a in t&&(s[a]=t[a])}),s}function Xt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(!Xt(n[s],t[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const s in n)if(!Xt(n[s],t[s]))return!1;return!0}return n===t}function cr(n,t){n.push(t)}function Pi(n,t,s){cr(s,{command:"addSource",args:[n,t[n]]})}function pi(n,t,s){cr(t,{command:"removeSource",args:[n]}),s[n]=!0}function Vn(n,t,s,a){pi(n,s,a),Pi(n,t,s)}function Ai(n,t,s){let a;for(a in n[s])if(Object.prototype.hasOwnProperty.call(n[s],a)&&a!=="data"&&!Xt(n[s][a],t[s][a]))return!1;for(a in t[s])if(Object.prototype.hasOwnProperty.call(t[s],a)&&a!=="data"&&!Xt(n[s][a],t[s][a]))return!1;return!0}function Yr(n,t,s,a,h,g){n=n||{},t=t||{};for(const y in n)Object.prototype.hasOwnProperty.call(n,y)&&(Xt(n[y],t[y])||s.push({command:g,args:[a,y,t[y],h]}));for(const y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(n,y)&&(Xt(n[y],t[y])||s.push({command:g,args:[a,y,t[y],h]}))}function hs(n){return n.id}function ds(n,t){return n[t.id]=t,n}class De{constructor(t,s,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function ei(n,...t){for(const s of t)for(const a in s)n[a]=s[a];return n}class Dr extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class ti{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[a,h]of s)this.bindings[a]=h}concat(t){return new ti(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Hr={kind:"null"},Me={kind:"number"},Dt={kind:"string"},ft={kind:"boolean"},Jr={kind:"color"},fn={kind:"object"},bt={kind:"value"},mn={kind:"collator"},Un={kind:"formatted"},Mi={kind:"padding"},fi={kind:"resolvedImage"},W={kind:"variableAnchorOffsetCollection"};function D(n,t){return{kind:"array",itemType:n,N:t}}function L(n){if(n.kind==="array"){const t=L(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const N=[Hr,Me,Dt,ft,Jr,Un,fn,D(bt),Mi,fi,W];function q(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!q(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const s of N)if(!q(s,t))return null}}return`Expected ${L(n)} but found ${L(t)} instead.`}function re(n,t){return t.some(s=>s.kind===n.kind)}function ae(n,t){return t.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function fe(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const J=.96422,ve=.82521,Se=4/29,ye=6/29,Re=3*ye*ye,nt=ye*ye*ye,dt=Math.PI/180,Ut=180/Math.PI;function Pt(n){return(n%=360)<0&&(n+=360),n}function Nt([n,t,s,a]){let h,g;const y=Cr((.2225045*(n=jt(n))+.7168786*(t=jt(t))+.0606169*(s=jt(s)))/1);n===t&&t===s?h=g=y:(h=Cr((.4360747*n+.3850649*t+.1430804*s)/J),g=Cr((.0139322*n+.0971045*t+.7141733*s)/ve));const _=116*y-16;return[_<0?0:_,500*(h-y),200*(y-g),a]}function jt(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Cr(n){return n>nt?Math.pow(n,1/3):n/Re+Se}function hr([n,t,s,a]){let h=(n+16)/116,g=isNaN(t)?h:h+t/500,y=isNaN(s)?h:h-s/200;return h=1*tr(h),g=J*tr(g),y=ve*tr(y),[Ft(3.1338561*g-1.6168667*h-.4906146*y),Ft(-.9787684*g+1.9161415*h+.033454*y),Ft(.0719453*g-.2289914*h+1.4052427*y),a]}function Ft(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function tr(n){return n>ye?n*n*n:Re*(n-Se)}function fr(n){return parseInt(n.padEnd(2,n),16)/255}function Lr(n,t){return qr(t?n/100:n,0,1)}function qr(n,t,s){return Math.min(Math.max(t,n),s)}function Qr(n){return!n.some(Number.isNaN)}const ps={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class rr{constructor(t,s,a,h=1,g=!0){this.r=t,this.g=s,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,s,a,h]))}static parse(t){if(t instanceof rr)return t;if(typeof t!="string")return;const s=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=ps[a];if(h){const[y,_,w]=h;return[y/255,_/255,w/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let _=1;return[fr(a.slice(_,_+=y)),fr(a.slice(_,_+=y)),fr(a.slice(_,_+=y)),fr(a.slice(_,_+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[_,w,C,I,P,z,R,B,O,G,X,me]=y,ie=[I||" ",R||" ",G].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const pe=[C,z,O].join(""),xe=pe==="%%%"?100:pe===""?255:0;if(xe){const Ae=[qr(+w/xe,0,1),qr(+P/xe,0,1),qr(+B/xe,0,1),X?Lr(+X,me):1];if(Qr(Ae))return Ae}}return}}const g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,_,w,C,I,P,z,R,B]=g,O=[w||" ",I||" ",z].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const G=[+_,qr(+C,0,100),qr(+P,0,100),R?Lr(+R,B):1];if(Qr(G))return function([X,me,ie,pe]){function xe(Ae){const Xe=(Ae+X/30)%12,mt=me*Math.min(ie,1-ie);return ie-mt*Math.max(-1,Math.min(Xe-3,9-Xe,1))}return X=Pt(X),me/=100,ie/=100,[xe(0),xe(8),xe(4),pe]}(G)}}}(t);return s?new rr(...s,!1):void 0}get rgb(){const{r:t,g:s,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,s/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,a,h,g]=Nt(t),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?Pt(Math.atan2(h,a)*Ut):NaN,y,s,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nt(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,a,h]=this.rgb;return`rgba(${[t,s,a].map(g=>Math.round(255*g)).join(",")},${h})`}}rr.black=new rr(0,0,0,1),rr.white=new rr(1,1,1,1),rr.transparent=new rr(0,0,0,0),rr.red=new rr(1,0,0,1);class ko{constructor(t,s,a){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class To{constructor(t,s,a,h,g){this.text=t,this.image=s,this.scale=a,this.fontStack=h,this.textColor=g}}class gn{constructor(t){this.sections=t}static fromString(t){return new gn([new To(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof gn?t:gn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Mn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Mn)return t;if(typeof t=="number")return new Mn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Mn(t)}}toString(){return JSON.stringify(this.values)}}const Ru=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Bt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Bt)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const a=t[s],h=t[s+1];if(typeof a!="string"||!Ru.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Bt(t)}}toString(){return JSON.stringify(this.values)}}class en{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new en({name:t,available:!1}):null}}function Ls(n,t,s,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,s,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,s,a]:[n,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xi(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof rr||n instanceof ko||n instanceof gn||n instanceof Mn||n instanceof Bt||n instanceof en)return!0;if(Array.isArray(n)){for(const t of n)if(!Xi(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Xi(n[t]))return!1;return!0}return!1}function Ir(n){if(n===null)return Hr;if(typeof n=="string")return Dt;if(typeof n=="boolean")return ft;if(typeof n=="number")return Me;if(n instanceof rr)return Jr;if(n instanceof ko)return mn;if(n instanceof gn)return Un;if(n instanceof Mn)return Mi;if(n instanceof Bt)return W;if(n instanceof en)return fi;if(Array.isArray(n)){const t=n.length;let s;for(const a of n){const h=Ir(a);if(s){if(s===h)continue;s=bt;break}s=h}return D(s||bt,t)}return fn}function Xs(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof rr||n instanceof gn||n instanceof Mn||n instanceof Bt||n instanceof en?n.toString():JSON.stringify(n)}class $n{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Xi(t[1]))return s.error("invalid value");const a=t[1];let h=Ir(a);const g=s.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new $n(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Er{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Co={string:Dt,number:Me,boolean:ft,object:fn};class ri{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let a,h=1;const g=t[0];if(g==="array"){let _,w;if(t.length>2){const C=t[1];if(typeof C!="string"||!(C in Co)||C==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);_=Co[C],h++}else _=bt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}a=D(_,w)}else{if(!Co[g])throw new Error(`Types doesn't contain name = ${g}`);a=Co[g]}const y=[];for(;h<t.length;h++){const _=s.parse(t[h],h,bt);if(!_)return null;y.push(_)}return new ri(a,y)}evaluate(t){for(let s=0;s<this.args.length;s++){const a=this.args[s].evaluate(t);if(!q(this.type,Ir(a)))return a;if(s===this.args.length-1)throw new Er(`Expected value to be of type ${L(this.type)}, but found ${L(Ir(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ea={"to-boolean":ft,"to-color":Jr,"to-number":Me,"to-string":Dt};class ni{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const a=t[0];if(!Ea[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return s.error("Expected one argument.");const h=Ea[a],g=[];for(let y=1;y<t.length;y++){const _=s.parse(t[y],y,bt);if(!_)return null;g.push(_)}return new ni(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,a;for(const h of this.args){if(s=h.evaluate(t),a=null,s instanceof rr)return s;if(typeof s=="string"){const g=t.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(a=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Ls(s[0],s[1],s[2],s[3]),!a))return new rr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Er(a||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const a of this.args){s=a.evaluate(t);const h=Mn.parse(s);if(h)return h}throw new Er(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const a of this.args){s=a.evaluate(t);const h=Bt.parse(s);if(h)return h}throw new Er(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const a of this.args){if(s=a.evaluate(t),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new Er(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return gn.fromString(Xs(this.args[0].evaluate(t)));case"resolvedImage":return en.fromString(Xs(this.args[0].evaluate(t)));default:return Xs(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Fu=["Unknown","Point","LineString","Polygon"];class Io{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=rr.parse(t)),s}}class fs{constructor(t,s,a=[],h,g=new ti,y=[]){this.registry=t,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=s}parse(t,s,a,h,g={}){return s?this.concat(s,a,h)._parse(t,g):this._parse(t,g)}_parse(t,s){function a(h,g,y){return y==="assert"?new ri(g,[h]):y==="coerce"?new ni(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(t,this);if(!y)return null;if(this.expectedType){const _=this.expectedType,w=y.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(_.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(_,w))return null}else y=a(y,_,s.typeAnnotation||"coerce");else y=a(y,_,s.typeAnnotation||"coerce");else y=a(y,_,s.typeAnnotation||"coerce");else y=a(y,_,s.typeAnnotation||"assert")}if(!(y instanceof $n)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const _=new Io;try{y=new $n(y.type,y.evaluate(_))}catch(w){return this.error(w.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,a){const h=typeof t=="number"?this.path.concat(t):this.path,g=a?this.scope.concat(a):this.scope;return new fs(this.registry,this._isConstant,h,s||null,g,this.errors)}error(t,...s){const a=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new Dr(a,t))}checkSubtype(t,s){const a=q(t,s);return a&&this.error(a),a}}class Ki{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let g=1;g<t.length-1;g+=2){const y=t[g];if(typeof y!="string")return s.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const _=s.parse(t[g+1],g+1);if(!_)return null;a.push([y,_])}const h=s.parse(t[t.length-1],t.length-1,s.expectedType,a);return h?new Ki(a,h):null}outputDefined(){return this.result.outputDefined()}}class Kt{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const a=t[1];return s.scope.has(a)?new Kt(a,s.scope.get(a)):s.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ks{constructor(t,s,a){this.type=t,this.index=s,this.input=a}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,Me),h=s.parse(t[2],2,D(s.expectedType||bt));return a&&h?new Ks(h.type.itemType,a,h):null}evaluate(t){const s=this.index.evaluate(t),a=this.input.evaluate(t);if(s<0)throw new Er(`Array index out of bounds: ${s} < 0.`);if(s>=a.length)throw new Er(`Array index out of bounds: ${s} > ${a.length-1}.`);if(s!==Math.floor(s))throw new Er(`Array index must be an integer, but found ${s} instead.`);return a[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Pa{constructor(t,s){this.type=ft,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,bt),h=s.parse(t[2],2,bt);return a&&h?re(a.type,[ft,Dt,Me,Hr,bt])?new Pa(a,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(a.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!ae(s,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${L(Ir(s))} instead.`);if(!ae(a,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${L(Ir(a))} instead.`);return a.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ms{constructor(t,s,a){this.type=Me,this.needle=t,this.haystack=s,this.fromIndex=a}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,bt),h=s.parse(t[2],2,bt);if(!a||!h)return null;if(!re(a.type,[ft,Dt,Me,Hr,bt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(a.type)} instead`);if(t.length===4){const g=s.parse(t[3],3,Me);return g?new ms(a,h,g):null}return new ms(a,h)}evaluate(t){const s=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!ae(s,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${L(Ir(s))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),ae(a,["string"])){const g=a.indexOf(s,h);return g===-1?-1:[...a.slice(0,g)].length}if(ae(a,["array"]))return a.indexOf(s,h);throw new Er(`Expected second argument to be of type array or string, but found ${L(Ir(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Ys{constructor(t,s,a,h,g,y){this.inputType=t,this.type=s,this.input=a,this.cases=h,this.outputs=g,this.otherwise=y}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let a,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const g={},y=[];for(let C=2;C<t.length-1;C+=2){let I=t[C];const P=t[C+1];Array.isArray(I)||(I=[I]);const z=s.concat(C);if(I.length===0)return z.error("Expected at least one branch label.");for(const B of I){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,Ir(B)))return null}else a=Ir(B);if(g[String(B)]!==void 0)return z.error("Branch labels must be unique.");g[String(B)]=y.length}const R=s.parse(P,C,h);if(!R)return null;h=h||R.type,y.push(R)}const _=s.parse(t[1],1,bt);if(!_)return null;const w=s.parse(t[t.length-1],t.length-1,h);return w?_.type.kind!=="value"&&s.concat(1).checkSubtype(a,_.type)?null:new Ys(a,h,_,g,y,w):null}evaluate(t){const s=this.input.evaluate(t);return(Ir(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Eo{constructor(t,s,a){this.type=t,this.branches=s,this.otherwise=a}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let a;s.expectedType&&s.expectedType.kind!=="value"&&(a=s.expectedType);const h=[];for(let y=1;y<t.length-1;y+=2){const _=s.parse(t[y],y,ft);if(!_)return null;const w=s.parse(t[y+1],y+1,a);if(!w)return null;h.push([_,w]),a=a||w.type}const g=s.parse(t[t.length-1],t.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new Eo(a,h,g)}evaluate(t){for(const[s,a]of this.branches)if(s.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,a]of this.branches)t(s),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Yi{constructor(t,s,a,h){this.type=t,this.input=s,this.beginIndex=a,this.endIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,bt),h=s.parse(t[2],2,Me);if(!a||!h)return null;if(!re(a.type,[D(bt),Dt,bt]))return s.error(`Expected first argument to be of type array or string, but found ${L(a.type)} instead`);if(t.length===4){const g=s.parse(t[3],3,Me);return g?new Yi(a.type,a,h,g):null}return new Yi(a.type,a,h)}evaluate(t){const s=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),ae(s,["string"]))return[...s].slice(a,h).join("");if(ae(s,["array"]))return s.slice(a,h);throw new Er(`Expected first argument to be of type array or string, but found ${L(Ir(s))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Po(n,t){const s=n.length-1;let a,h,g=0,y=s,_=0;for(;g<=y;)if(_=Math.floor((g+y)/2),a=n[_],h=n[_+1],a<=t){if(_===s||t<h)return _;g=_+1}else{if(!(a>t))throw new Er("Input is not a number.");y=_-1}return 0}class Rs{constructor(t,s,a){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const a=s.parse(t[1],1,Me);if(!a)return null;const h=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let y=1;y<t.length;y+=2){const _=y===1?-1/0:t[y],w=t[y+1],C=y,I=y+1;if(typeof _!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=_)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const P=s.parse(w,I,g);if(!P)return null;g=g||P.type,h.push([_,P])}return new Rs(g,a,h)}evaluate(t){const s=this.labels,a=this.outputs;if(s.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return a[0].evaluate(t);const g=s.length;return h>=s[g-1]?a[g-1].evaluate(t):a[Po(s,h)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function gl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Aa=Ao;function Ao(n,t,s,a){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=a}Ao.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,a=0;a<8;a++){var h=this.sampleCurveX(s)-n;if(Math.abs(h)<t)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=h/g}var y=0,_=1;for(s=n,a=0;a<20&&(h=this.sampleCurveX(s),!(Math.abs(h-n)<t));a++)n>h?y=s:_=s,s=.5*(_-y)+y;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Ma=gl(Aa);function gs(n,t,s){return n+s*(t-n)}function ys(n,t,s){return n.map((a,h)=>gs(a,t[h],s))}const yn={number:gs,color:function(n,t,s,a="rgb"){switch(a){case"rgb":{const[h,g,y,_]=ys(n.rgb,t.rgb,s);return new rr(h,g,y,_,!1)}case"hcl":{const[h,g,y,_]=n.hcl,[w,C,I,P]=t.hcl;let z,R;if(isNaN(h)||isNaN(w))isNaN(h)?isNaN(w)?z=NaN:(z=w,y!==1&&y!==0||(R=C)):(z=h,I!==1&&I!==0||(R=g));else{let me=w-h;w>h&&me>180?me-=360:w<h&&h-w>180&&(me+=360),z=h+s*me}const[B,O,G,X]=function([me,ie,pe,xe]){return me=isNaN(me)?0:me*dt,hr([pe,Math.cos(me)*ie,Math.sin(me)*ie,xe])}([z,R??gs(g,C,s),gs(y,I,s),gs(_,P,s)]);return new rr(B,O,G,X,!1)}case"lab":{const[h,g,y,_]=hr(ys(n.lab,t.lab,s));return new rr(h,g,y,_,!1)}}},array:ys,padding:function(n,t,s){return new Mn(ys(n.values,t.values,s))},variableAnchorOffsetCollection:function(n,t,s){const a=n.values,h=t.values;if(a.length!==h.length)throw new Er(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const g=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new Er(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);g.push(a[y]);const[_,w]=a[y+1],[C,I]=h[y+1];g.push([gs(_,C,s),gs(w,I,s)])}return new Bt(g)}};class un{constructor(t,s,a,h,g){this.type=t,this.operator=s,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,_]of g)this.labels.push(y),this.outputs.push(_)}static interpolationFactor(t,s,a,h){let g=0;if(t.name==="exponential")g=Mo(s,t.base,a,h);else if(t.name==="linear")g=Mo(s,1,a,h);else if(t.name==="cubic-bezier"){const y=t.controlPoints;g=new Ma(y[0],y[1],y[2],y[3]).solve(Mo(s,1,a,h))}return g}static parse(t,s){let[a,h,g,...y]=t;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const C=h[1];if(typeof C!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(C.length!==4||C.some(I=>typeof I!="number"||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,Me),!g)return null;const _=[];let w=null;a==="interpolate-hcl"||a==="interpolate-lab"?w=Jr:s.expectedType&&s.expectedType.kind!=="value"&&(w=s.expectedType);for(let C=0;C<y.length;C+=2){const I=y[C],P=y[C+1],z=C+3,R=C+4;if(typeof I!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(_.length&&_[_.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const B=s.parse(P,R,w);if(!B)return null;w=w||B.type,_.push([I,B])}return fe(w,Me)||fe(w,Jr)||fe(w,Mi)||fe(w,W)||fe(w,D(Me))?new un(w,a,h,g,_):s.error(`Type ${L(w)} is not interpolatable.`)}evaluate(t){const s=this.labels,a=this.outputs;if(s.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return a[0].evaluate(t);const g=s.length;if(h>=s[g-1])return a[g-1].evaluate(t);const y=Po(s,h),_=un.interpolationFactor(this.interpolation,h,s[y],s[y+1]),w=a[y].evaluate(t),C=a[y+1].evaluate(t);switch(this.operator){case"interpolate":return yn[this.type.kind](w,C,_);case"interpolate-hcl":return yn.color(w,C,_,"hcl");case"interpolate-lab":return yn.color(w,C,_,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Mo(n,t,s,a){const h=a-s,g=n-s;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class Js{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let a=null;const h=s.expectedType;h&&h.kind!=="value"&&(a=h);const g=[];for(const _ of t.slice(1)){const w=s.parse(_,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,g.push(w)}if(!a)throw new Error("No output type");const y=h&&g.some(_=>q(h,_.type));return new Js(y?bt:a,g)}evaluate(t){let s,a=null,h=0;for(const g of this.args)if(h++,a=g.evaluate(t),a&&a instanceof en&&!a.available&&(s||(s=a.name),a=null,h===this.args.length&&(a=s)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function zo(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ne(n,t,s,a){return a.compare(t,s)===0}function Te(n,t,s){const a=n!=="=="&&n!=="!=";return class r1{constructor(g,y,_){this.type=ft,this.lhs=g,this.rhs=y,this.collator=_,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const _=g[0];let w=y.parse(g[1],1,bt);if(!w)return null;if(!zo(_,w.type))return y.concat(1).error(`"${_}" comparisons are not supported for type '${L(w.type)}'.`);let C=y.parse(g[2],2,bt);if(!C)return null;if(!zo(_,C.type))return y.concat(2).error(`"${_}" comparisons are not supported for type '${L(C.type)}'.`);if(w.type.kind!==C.type.kind&&w.type.kind!=="value"&&C.type.kind!=="value")return y.error(`Cannot compare types '${L(w.type)}' and '${L(C.type)}'.`);a&&(w.type.kind==="value"&&C.type.kind!=="value"?w=new ri(C.type,[w]):w.type.kind!=="value"&&C.type.kind==="value"&&(C=new ri(w.type,[C])));let I=null;if(g.length===4){if(w.type.kind!=="string"&&C.type.kind!=="string"&&w.type.kind!=="value"&&C.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(g[3],3,mn),!I)return null}return new r1(w,C,I)}evaluate(g){const y=this.lhs.evaluate(g),_=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const w=Ir(y),C=Ir(_);if(w.kind!==C.kind||w.kind!=="string"&&w.kind!=="number")throw new Er(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=Ir(y),C=Ir(_);if(w.kind!=="string"||C.kind!=="string")return t(g,y,_)}return this.collator?s(g,y,_,this.collator.evaluate(g)):t(g,y,_)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const be=Te("==",function(n,t,s){return t===s},ne),Be=Te("!=",function(n,t,s){return t!==s},function(n,t,s,a){return!ne(0,t,s,a)}),pt=Te("<",function(n,t,s){return t<s},function(n,t,s,a){return a.compare(t,s)<0}),zt=Te(">",function(n,t,s){return t>s},function(n,t,s,a){return a.compare(t,s)>0}),Lt=Te("<=",function(n,t,s){return t<=s},function(n,t,s,a){return a.compare(t,s)<=0}),_n=Te(">=",function(n,t,s){return t>=s},function(n,t,s,a){return a.compare(t,s)>=0});class mr{constructor(t,s,a){this.type=mn,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return s.error("Collator options argument must be an object.");const h=s.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ft);if(!h)return null;const g=s.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ft);if(!g)return null;let y=null;return a.locale&&(y=s.parse(a.locale,1,Dt),!y)?null:new mr(h,g,y)}evaluate(t){return new ko(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class dr{constructor(t,s,a,h,g){this.type=Dt,this.number=t,this.locale=s,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const a=s.parse(t[1],1,Me);if(!a)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=s.parse(h.locale,1,Dt),!g))return null;let y=null;if(h.currency&&(y=s.parse(h.currency,1,Dt),!y))return null;let _=null;if(h["min-fraction-digits"]&&(_=s.parse(h["min-fraction-digits"],1,Me),!_))return null;let w=null;return h["max-fraction-digits"]&&(w=s.parse(h["max-fraction-digits"],1,Me),!w)?null:new dr(a,g,y,_,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class vn{constructor(t){this.type=Un,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return s.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=t.length-1;++y){const _=t[y];if(g&&typeof _=="object"&&!Array.isArray(_)){g=!1;let w=null;if(_["font-scale"]&&(w=s.parse(_["font-scale"],1,Me),!w))return null;let C=null;if(_["text-font"]&&(C=s.parse(_["text-font"],1,D(Dt)),!C))return null;let I=null;if(_["text-color"]&&(I=s.parse(_["text-color"],1,Jr),!I))return null;const P=h[h.length-1];P.scale=w,P.font=C,P.textColor=I}else{const w=s.parse(t[y],1,bt);if(!w)return null;const C=w.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new vn(h)}evaluate(t){return new gn(this.sections.map(s=>{const a=s.content.evaluate(t);return Ir(a)===fi?new To("",a,null,null,null):new To(Xs(a),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class za{constructor(t){this.type=fi,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const a=s.parse(t[1],1,Dt);return a?new za(a):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),a=en.fromString(s);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(s)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class yl{constructor(t){this.type=Me,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=s.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${L(a.type)} instead.`):new yl(a):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new Er(`Expected value to be of type string or array, but found ${L(Ir(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const At=8192;function tn(n,t){const s=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(s*h*At),Math.round(a*h*At)]}function Qs(n,t){const s=Math.pow(2,t.z);return[(h=(n[0]/At+t.x)/s,360*h-180),(a=(n[1]/At+t.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,h}function zi(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function mi(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Zt(n,t,s){const a=n[0]-t[0],h=n[1]-t[1],g=n[0]-s[0],y=n[1]-s[1];return a*y-g*h==0&&a*g<=0&&h*y<=0}function _l(n,t,s,a){return(h=[a[0]-s[0],a[1]-s[1]])[0]*(g=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*g[0]!=0&&!(!Eh(n,t,s,a)||!Eh(s,a,n,t));var h,g}function Xp(n,t,s){for(const a of s)for(let h=0;h<a.length-1;++h)if(_l(n,t,a[h],a[h+1]))return!0;return!1}function Do(n,t,s=!1){let a=!1;for(const _ of t)for(let w=0;w<_.length-1;w++){if(Zt(n,_[w],_[w+1]))return s;(g=_[w])[1]>(h=n)[1]!=(y=_[w+1])[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(a=!a)}var h,g,y;return a}function Kp(n,t){for(const s of t)if(Do(n,s))return!0;return!1}function Ih(n,t){for(const s of n)if(!Do(s,t))return!1;for(let s=0;s<n.length-1;++s)if(Xp(n[s],n[s+1],t))return!1;return!0}function Yp(n,t){for(const s of t)if(Ih(n,s))return!0;return!1}function Eh(n,t,s,a){const h=a[0]-s[0],g=a[1]-s[1],y=(n[0]-s[0])*g-h*(n[1]-s[1]),_=(t[0]-s[0])*g-h*(t[1]-s[1]);return y>0&&_<0||y<0&&_>0}function Bu(n,t,s){const a=[];for(let h=0;h<n.length;h++){const g=[];for(let y=0;y<n[h].length;y++){const _=tn(n[h][y],s);zi(t,_),g.push(_)}a.push(g)}return a}function Ph(n,t,s){const a=[];for(let h=0;h<n.length;h++){const g=Bu(n[h],t,s);a.push(g)}return a}function Ah(n,t,s,a){if(n[0]<s[0]||n[0]>s[2]){const h=.5*a;let g=n[0]-s[0]>h?-a:s[0]-n[0]>h?a:0;g===0&&(g=n[0]-s[2]>h?-a:s[2]-n[0]>h?a:0),n[0]+=g}zi(t,n)}function Mh(n,t,s,a){const h=Math.pow(2,a.z)*At,g=[a.x*At,a.y*At],y=[];for(const _ of n)for(const w of _){const C=[w.x+g[0],w.y+g[1]];Ah(C,t,s,h),y.push(C)}return y}function zh(n,t,s,a){const h=Math.pow(2,a.z)*At,g=[a.x*At,a.y*At],y=[];for(const w of n){const C=[];for(const I of w){const P=[I.x+g[0],I.y+g[1]];zi(t,P),C.push(P)}y.push(C)}if(t[2]-t[0]<=h/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const w of y)for(const C of w)Ah(C,t,s,h)}var _;return y}class eo{constructor(t,s){this.type=ft,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Xi(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const h=[];for(const g of a.features){const{type:y,coordinates:_}=g.geometry;y==="Polygon"&&h.push(_),y==="MultiPolygon"&&h.push(..._)}if(h.length)return new eo(a,{type:"MultiPolygon",coordinates:h})}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new eo(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new eo(a,a)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(a.type==="Polygon"){const _=Bu(a.coordinates,g,y),w=Mh(s.geometry(),h,g,y);if(!mi(h,g))return!1;for(const C of w)if(!Do(C,_))return!1}if(a.type==="MultiPolygon"){const _=Ph(a.coordinates,g,y),w=Mh(s.geometry(),h,g,y);if(!mi(h,g))return!1;for(const C of w)if(!Kp(C,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(a.type==="Polygon"){const _=Bu(a.coordinates,g,y),w=zh(s.geometry(),h,g,y);if(!mi(h,g))return!1;for(const C of w)if(!Ih(C,_))return!1}if(a.type==="MultiPolygon"){const _=Ph(a.coordinates,g,y),w=zh(s.geometry(),h,g,y);if(!mi(h,g))return!1;for(const C of w)if(!Yp(C,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Dh=class{constructor(n=[],t=(s,a)=>s<a?-1:s>a?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:s}=this,a=t[n];for(;n>0;){const h=n-1>>1,g=t[h];if(s(a,g)>=0)break;t[n]=g,n=h}t[n]=a}_down(n){const{data:t,compare:s}=this,a=this.length>>1,h=t[n];for(;n<a;){let g=1+(n<<1);const y=g+1;if(y<this.length&&s(t[y],t[g])<0&&(g=y),s(t[g],h)>=0)break;t[n]=t[g],n=g}t[n]=h}};function Jp(n,t,s,a,h){Lh(n,t,s,a||n.length-1,h||Qp)}function Lh(n,t,s,a,h){for(;a>s;){if(a-s>600){var g=a-s+1,y=t-s+1,_=Math.log(g),w=.5*Math.exp(2*_/3),C=.5*Math.sqrt(_*w*(g-w)/g)*(y-g/2<0?-1:1);Lh(n,t,Math.max(s,Math.floor(t-y*w/g+C)),Math.min(a,Math.floor(t+(g-y)*w/g+C)),h)}var I=n[t],P=s,z=a;for(Da(n,s,t),h(n[a],I)>0&&Da(n,s,a);P<z;){for(Da(n,P,z),P++,z--;h(n[P],I)<0;)P++;for(;h(n[z],I)>0;)z--}h(n[s],I)===0?Da(n,s,z):Da(n,++z,a),z<=t&&(s=z+1),t<=z&&(a=z-1)}}function Da(n,t,s){var a=n[t];n[t]=n[s],n[s]=a}function Qp(n,t){return n<t?-1:n>t?1:0}function vl(n,t){if(n.length<=1)return[n];const s=[];let a,h;for(const g of n){const y=tf(g);y!==0&&(g.area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(a&&s.push(a),a=[g]):a.push(g))}if(a&&s.push(a),t>1)for(let g=0;g<s.length;g++)s[g].length<=t||(Jp(s[g],t,1,s[g].length-1,ef),s[g]=s[g].slice(0,t));return s}function ef(n,t){return t.area-n.area}function tf(n){let t=0;for(let s,a,h=0,g=n.length,y=g-1;h<g;y=h++)s=n[h],a=n[y],t+=(a.x-s.x)*(s.y+a.y);return t}const Rh=1/298.257223563,Fh=Rh*(2-Rh),Bh=Math.PI/180;class Ou{constructor(t){const s=6378.137*Bh*1e3,a=Math.cos(t*Bh),h=1/(1-Fh*(1-a*a)),g=Math.sqrt(h);this.kx=s*g*a,this.ky=s*g*h*(1-Fh)}distance(t,s){const a=this.wrap(t[0]-s[0])*this.kx,h=(t[1]-s[1])*this.ky;return Math.sqrt(a*a+h*h)}pointOnLine(t,s){let a,h,g,y,_=1/0;for(let w=0;w<t.length-1;w++){let C=t[w][0],I=t[w][1],P=this.wrap(t[w+1][0]-C)*this.kx,z=(t[w+1][1]-I)*this.ky,R=0;P===0&&z===0||(R=(this.wrap(s[0]-C)*this.kx*P+(s[1]-I)*this.ky*z)/(P*P+z*z),R>1?(C=t[w+1][0],I=t[w+1][1]):R>0&&(C+=P/this.kx*R,I+=z/this.ky*R)),P=this.wrap(s[0]-C)*this.kx,z=(s[1]-I)*this.ky;const B=P*P+z*z;B<_&&(_=B,a=C,h=I,g=w,y=R)}return{point:[a,h],index:g,t:Math.max(0,Math.min(1,y))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Oh(n,t){return t[0]-n[0]}function xl(n){return n[1]-n[0]+1}function _s(n,t){return n[1]>=n[0]&&n[1]<t}function Nu(n,t){if(n[0]>n[1])return[null,null];const s=xl(n);if(t){if(s===2)return[n,null];const h=Math.floor(s/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(s===1)return[n,null];const a=Math.floor(s/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function ju(n,t){if(!_s(t,n.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)zi(s,n[a]);return s}function Vu(n){const t=[1/0,1/0,-1/0,-1/0];for(const s of n)for(const a of s)zi(t,a);return t}function wl(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Uu(n,t,s){if(!wl(n)||!wl(t))return NaN;let a=0,h=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),s.distance([0,0],[a,h])}function to(n,t,s){const a=s.pointOnLine(t,n);return s.distance(n,a.point)}function $u(n,t,s,a,h){const g=Math.min(to(n,[s,a],h),to(t,[s,a],h)),y=Math.min(to(s,[n,t],h),to(a,[n,t],h));return Math.min(g,y)}function rf(n,t,s,a,h){if(!_s(t,n.length)||!_s(a,s.length))return 1/0;let g=1/0;for(let y=t[0];y<t[1];++y){const _=n[y],w=n[y+1];for(let C=a[0];C<a[1];++C){const I=s[C],P=s[C+1];if(_l(_,w,I,P))return 0;g=Math.min(g,$u(_,w,I,P,h))}}return g}function Rr(n,t,s,a,h){if(!_s(t,n.length)||!_s(a,s.length))return NaN;let g=1/0;for(let y=t[0];y<=t[1];++y)for(let _=a[0];_<=a[1];++_)if(g=Math.min(g,h.distance(n[y],s[_])),g===0)return g;return g}function nf(n,t,s){if(Do(n,t,!0))return 0;let a=1/0;for(const h of t){const g=h[0],y=h[h.length-1];if(g!==y&&(a=Math.min(a,to(n,[y,g],s)),a===0))return a;const _=s.pointOnLine(h,n);if(a=Math.min(a,s.distance(n,_.point)),a===0)return a}return a}function Vt(n,t,s,a){if(!_s(t,n.length))return NaN;for(let g=t[0];g<=t[1];++g)if(Do(n[g],s,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g){const y=n[g],_=n[g+1];for(const w of s)for(let C=0,I=w.length,P=I-1;C<I;P=C++){const z=w[P],R=w[C];if(_l(y,_,z,R))return 0;h=Math.min(h,$u(y,_,z,R,a))}}return h}function bl(n,t){for(const s of n)for(const a of s)if(Do(a,t,!0))return!0;return!1}function gr(n,t,s,a=1/0){const h=Vu(n),g=Vu(t);if(a!==1/0&&Uu(h,g,s)>=a)return a;if(mi(h,g)){if(bl(n,t))return 0}else if(bl(t,n))return 0;let y=1/0;for(const _ of n)for(let w=0,C=_.length,I=C-1;w<C;I=w++){const P=_[I],z=_[w];for(const R of t)for(let B=0,O=R.length,G=O-1;B<O;G=B++){const X=R[G],me=R[B];if(_l(P,z,X,me))return 0;y=Math.min(y,$u(P,z,X,me,s))}}return y}function ar(n,t,s,a,h,g){if(!g)return;const y=Uu(ju(a,g),h,s);y<t&&n.push([y,g,[0,0]])}function ro(n,t,s,a,h,g,y){if(!g||!y)return;const _=Uu(ju(a,g),ju(h,y),s);_<t&&n.push([_,g,y])}function La(n,t,s,a,h=1/0){let g=Math.min(a.distance(n[0],s[0][0]),h);if(g===0)return g;const y=new Dh([[0,[0,n.length-1],[0,0]]],Oh),_=Vu(s);for(;y.length>0;){const w=y.pop();if(w[0]>=g)continue;const C=w[1],I=t?50:100;if(xl(C)<=I){if(!_s(C,n.length))return NaN;if(t){const P=Vt(n,C,s,a);if(isNaN(P)||P===0)return P;g=Math.min(g,P)}else for(let P=C[0];P<=C[1];++P){const z=nf(n[P],s,a);if(g=Math.min(g,z),g===0)return 0}}else{const P=Nu(C,t);ar(y,g,a,n,_,P[0]),ar(y,g,a,n,_,P[1])}}return g}function Ra(n,t,s,a,h,g=1/0){let y=Math.min(g,h.distance(n[0],s[0]));if(y===0)return y;const _=new Dh([[0,[0,n.length-1],[0,s.length-1]]],Oh);for(;_.length>0;){const w=_.pop();if(w[0]>=y)continue;const C=w[1],I=w[2],P=t?50:100,z=a?50:100;if(xl(C)<=P&&xl(I)<=z){if(!_s(C,n.length)&&_s(I,s.length))return NaN;let R;if(t&&a)R=rf(n,C,s,I,h),y=Math.min(y,R);else if(t&&!a){const B=n.slice(C[0],C[1]+1);for(let O=I[0];O<=I[1];++O)if(R=to(s[O],B,h),y=Math.min(y,R),y===0)return y}else if(!t&&a){const B=s.slice(I[0],I[1]+1);for(let O=C[0];O<=C[1];++O)if(R=to(n[O],B,h),y=Math.min(y,R),y===0)return y}else R=Rr(n,C,s,I,h),y=Math.min(y,R)}else{const R=Nu(C,t),B=Nu(I,a);ro(_,y,h,n,s,R[0],B[0]),ro(_,y,h,n,s,R[0],B[1]),ro(_,y,h,n,s,R[1],B[0]),ro(_,y,h,n,s,R[1],B[1])}}return y}function qu(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class no{constructor(t,s){this.type=Me,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Xi(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new no(a,a.features.map(h=>qu(h.geometry)).flat());if(a.type==="Feature")return new no(a,qu(a.geometry));if("type"in a&&"coordinates"in a)return new no(a,qu(a))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,a){const h=s.geometry(),g=h.flat().map(w=>Qs([w.x,w.y],s.canonical));if(h.length===0)return NaN;const y=new Ou(g[0][1]);let _=1/0;for(const w of a){switch(w.type){case"Point":_=Math.min(_,Ra(g,!1,[w.coordinates],!1,y,_));break;case"LineString":_=Math.min(_,Ra(g,!1,w.coordinates,!0,y,_));break;case"Polygon":_=Math.min(_,La(g,!1,w.coordinates,y,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,a){const h=s.geometry(),g=h.flat().map(w=>Qs([w.x,w.y],s.canonical));if(h.length===0)return NaN;const y=new Ou(g[0][1]);let _=1/0;for(const w of a){switch(w.type){case"Point":_=Math.min(_,Ra(g,!0,[w.coordinates],!1,y,_));break;case"LineString":_=Math.min(_,Ra(g,!0,w.coordinates,!0,y,_));break;case"Polygon":_=Math.min(_,La(g,!0,w.coordinates,y,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(s,a){const h=s.geometry();if(h.length===0||h[0].length===0)return NaN;const g=vl(h,0).map(w=>w.map(C=>C.map(I=>Qs([I.x,I.y],s.canonical)))),y=new Ou(g[0][0][0][1]);let _=1/0;for(const w of a)for(const C of g){switch(w.type){case"Point":_=Math.min(_,La([w.coordinates],!1,C,y,_));break;case"LineString":_=Math.min(_,La(w.coordinates,!0,C,y,_));break;case"Polygon":_=Math.min(_,gr(C,w.coordinates,y,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Lo={"==":be,"!=":Be,">":zt,"<":pt,">=":_n,"<=":Lt,array:ri,at:Ks,boolean:ri,case:Eo,coalesce:Js,collator:mr,format:vn,image:za,in:Pa,"index-of":ms,interpolate:un,"interpolate-hcl":un,"interpolate-lab":un,length:yl,let:Ki,literal:$n,match:Ys,number:ri,"number-format":dr,object:ri,slice:Yi,step:Rs,string:ri,"to-boolean":ni,"to-color":ni,"to-number":ni,"to-string":ni,var:Kt,within:eo,distance:no};class gi{constructor(t,s,a,h){this.name=t,this.type=s,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const a=t[0],h=gi.definitions[a];if(!h)return s.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,_=y.filter(([C])=>!Array.isArray(C)||C.length===t.length-1);let w=null;for(const[C,I]of _){w=new fs(s.registry,Fa,s.path,null,s.scope);const P=[];let z=!1;for(let R=1;R<t.length;R++){const B=t[R],O=Array.isArray(C)?C[R-1]:C.type,G=w.parse(B,1+P.length,O);if(!G){z=!0;break}P.push(G)}if(!z)if(Array.isArray(C)&&C.length!==P.length)w.error(`Expected ${C.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const B=Array.isArray(C)?C[R]:C.type,O=P[R];w.concat(R+1).checkSubtype(B,O.type)}if(w.errors.length===0)return new gi(a,g,I,P)}}if(_.length===1)s.errors.push(...w.errors);else{const C=(_.length?_:y).map(([P])=>{return z=P,Array.isArray(z)?`(${z.map(L).join(", ")})`:`(${L(z.type)}...)`;var z}).join(" | "),I=[];for(let P=1;P<t.length;P++){const z=s.parse(t[P],1+I.length);if(!z)return null;I.push(L(z.type))}s.error(`Expected arguments of type ${C}, but found (${I.join(", ")}) instead.`)}return null}static register(t,s){gi.definitions=s;for(const a in s)t[a]=gi}}function Zu(n,[t,s,a,h]){t=t.evaluate(n),s=s.evaluate(n),a=a.evaluate(n);const g=h?h.evaluate(n):1,y=Ls(t,s,a,g);if(y)throw new Er(y);return new rr(t/255,s/255,a/255,g,!1)}function Gu(n,t){return n in t}function Hu(n,t){const s=t[n];return s===void 0?null:s}function io(n){return{type:n}}function Fa(n){if(n instanceof Kt)return Fa(n.boundExpression);if(n instanceof gi&&n.name==="error"||n instanceof mr||n instanceof eo||n instanceof no)return!1;const t=n instanceof ni||n instanceof ri;let s=!0;return n.eachChild(a=>{s=t?s&&Fa(a):s&&a instanceof $n}),!!s&&Ba(n)&&Oa(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ba(n){if(n instanceof gi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof eo||n instanceof no)return!1;let t=!0;return n.eachChild(s=>{t&&!Ba(s)&&(t=!1)}),t}function Ro(n){if(n instanceof gi&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(s=>{t&&!Ro(s)&&(t=!1)}),t}function Oa(n,t){if(n instanceof gi&&t.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(a=>{s&&!Oa(a,t)&&(s=!1)}),s}function Sl(n){return{result:"success",value:n}}function Fo(n){return{result:"error",value:n}}function Bo(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Nh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Wu(n){return!!n.expression&&n.expression.interpolated}function Jt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function kl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function sf(n){return n}function jh(n,t){const s=t.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",h=a||!(a||n.property!==void 0),g=n.type||(Wu(t)?"exponential":"interval");if(s||t.type==="padding"){const I=s?rr.parse:Mn.parse;(n=ei({},n)).stops&&(n.stops=n.stops.map(P=>[P[0],I(P[1])])),n.default=I(n.default?n.default:t.default)}if(n.colorSpace&&(y=n.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var y;let _,w,C;if(g==="exponential")_=Uh;else if(g==="interval")_=Tl;else if(g==="categorical"){_=Vh,w=Object.create(null);for(const I of n.stops)w[I[0]]=I[1];C=typeof n.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=$h}if(a){const I={},P=[];for(let B=0;B<n.stops.length;B++){const O=n.stops[B],G=O[0].zoom;I[G]===void 0&&(I[G]={zoom:G,type:n.type,property:n.property,default:n.default,stops:[]},P.push(G)),I[G].stops.push([O[0].value,O[1]])}const z=[];for(const B of P)z.push([I[B].zoom,jh(I[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:un.interpolationFactor.bind(void 0,R),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},O)=>Uh({stops:z,base:n.base},t,B).evaluate(B,O)}}if(h){const I=g==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:un.interpolationFactor.bind(void 0,I),zoomStops:n.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(n,t,P,w,C)}}return{kind:"source",evaluate(I,P){const z=P&&P.properties?P.properties[n.property]:void 0;return z===void 0?Oo(n.default,t.default):_(n,t,z,w,C)}}}function Oo(n,t,s){return n!==void 0?n:t!==void 0?t:s!==void 0?s:void 0}function Vh(n,t,s,a,h){return Oo(typeof s===h?a[s]:void 0,n.default,t.default)}function Tl(n,t,s){if(Jt(s)!=="number")return Oo(n.default,t.default);const a=n.stops.length;if(a===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[a-1][0])return n.stops[a-1][1];const h=Po(n.stops.map(g=>g[0]),s);return n.stops[h][1]}function Uh(n,t,s){const a=n.base!==void 0?n.base:1;if(Jt(s)!=="number")return Oo(n.default,t.default);const h=n.stops.length;if(h===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[h-1][0])return n.stops[h-1][1];const g=Po(n.stops.map(I=>I[0]),s),y=function(I,P,z,R){const B=R-z,O=I-z;return B===0?0:P===1?O/B:(Math.pow(P,O)-1)/(Math.pow(P,B)-1)}(s,a,n.stops[g][0],n.stops[g+1][0]),_=n.stops[g][1],w=n.stops[g+1][1],C=yn[t.type]||sf;return typeof _.evaluate=="function"?{evaluate(...I){const P=_.evaluate.apply(void 0,I),z=w.evaluate.apply(void 0,I);if(P!==void 0&&z!==void 0)return C(P,z,y,n.colorSpace)}}:C(_,w,y,n.colorSpace)}function $h(n,t,s){switch(t.type){case"color":s=rr.parse(s);break;case"formatted":s=gn.fromString(s.toString());break;case"resolvedImage":s=en.fromString(s.toString());break;case"padding":s=Mn.parse(s);break;default:Jt(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return Oo(s,n.default,t.default)}gi.register(Lo,{error:[{kind:"error"},[Dt],(n,[t])=>{throw new Er(t.evaluate(n))}],typeof:[Dt,[bt],(n,[t])=>L(Ir(t.evaluate(n)))],"to-rgba":[D(Me,4),[Jr],(n,[t])=>{const[s,a,h,g]=t.evaluate(n).rgb;return[255*s,255*a,255*h,g]}],rgb:[Jr,[Me,Me,Me],Zu],rgba:[Jr,[Me,Me,Me,Me],Zu],has:{type:ft,overloads:[[[Dt],(n,[t])=>Gu(t.evaluate(n),n.properties())],[[Dt,fn],(n,[t,s])=>Gu(t.evaluate(n),s.evaluate(n))]]},get:{type:bt,overloads:[[[Dt],(n,[t])=>Hu(t.evaluate(n),n.properties())],[[Dt,fn],(n,[t,s])=>Hu(t.evaluate(n),s.evaluate(n))]]},"feature-state":[bt,[Dt],(n,[t])=>Hu(t.evaluate(n),n.featureState||{})],properties:[fn,[],n=>n.properties()],"geometry-type":[Dt,[],n=>n.geometryType()],id:[bt,[],n=>n.id()],zoom:[Me,[],n=>n.globals.zoom],"heatmap-density":[Me,[],n=>n.globals.heatmapDensity||0],"line-progress":[Me,[],n=>n.globals.lineProgress||0],accumulated:[bt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Me,io(Me),(n,t)=>{let s=0;for(const a of t)s+=a.evaluate(n);return s}],"*":[Me,io(Me),(n,t)=>{let s=1;for(const a of t)s*=a.evaluate(n);return s}],"-":{type:Me,overloads:[[[Me,Me],(n,[t,s])=>t.evaluate(n)-s.evaluate(n)],[[Me],(n,[t])=>-t.evaluate(n)]]},"/":[Me,[Me,Me],(n,[t,s])=>t.evaluate(n)/s.evaluate(n)],"%":[Me,[Me,Me],(n,[t,s])=>t.evaluate(n)%s.evaluate(n)],ln2:[Me,[],()=>Math.LN2],pi:[Me,[],()=>Math.PI],e:[Me,[],()=>Math.E],"^":[Me,[Me,Me],(n,[t,s])=>Math.pow(t.evaluate(n),s.evaluate(n))],sqrt:[Me,[Me],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Me,[Me],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Me,[Me],(n,[t])=>Math.log(t.evaluate(n))],log2:[Me,[Me],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Me,[Me],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Me,[Me],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Me,[Me],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Me,[Me],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Me,[Me],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Me,[Me],(n,[t])=>Math.atan(t.evaluate(n))],min:[Me,io(Me),(n,t)=>Math.min(...t.map(s=>s.evaluate(n)))],max:[Me,io(Me),(n,t)=>Math.max(...t.map(s=>s.evaluate(n)))],abs:[Me,[Me],(n,[t])=>Math.abs(t.evaluate(n))],round:[Me,[Me],(n,[t])=>{const s=t.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[Me,[Me],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Me,[Me],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[ft,[Dt,bt],(n,[t,s])=>n.properties()[t.value]===s.value],"filter-id-==":[ft,[bt],(n,[t])=>n.id()===t.value],"filter-type-==":[ft,[Dt],(n,[t])=>n.geometryType()===t.value],"filter-<":[ft,[Dt,bt],(n,[t,s])=>{const a=n.properties()[t.value],h=s.value;return typeof a==typeof h&&a<h}],"filter-id-<":[ft,[bt],(n,[t])=>{const s=n.id(),a=t.value;return typeof s==typeof a&&s<a}],"filter->":[ft,[Dt,bt],(n,[t,s])=>{const a=n.properties()[t.value],h=s.value;return typeof a==typeof h&&a>h}],"filter-id->":[ft,[bt],(n,[t])=>{const s=n.id(),a=t.value;return typeof s==typeof a&&s>a}],"filter-<=":[ft,[Dt,bt],(n,[t,s])=>{const a=n.properties()[t.value],h=s.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[ft,[bt],(n,[t])=>{const s=n.id(),a=t.value;return typeof s==typeof a&&s<=a}],"filter->=":[ft,[Dt,bt],(n,[t,s])=>{const a=n.properties()[t.value],h=s.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[ft,[bt],(n,[t])=>{const s=n.id(),a=t.value;return typeof s==typeof a&&s>=a}],"filter-has":[ft,[bt],(n,[t])=>t.value in n.properties()],"filter-has-id":[ft,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ft,[D(Dt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[ft,[D(bt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[ft,[Dt,D(bt)],(n,[t,s])=>s.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[ft,[Dt,D(bt)],(n,[t,s])=>function(a,h,g,y){for(;g<=y;){const _=g+y>>1;if(h[_]===a)return!0;h[_]>a?y=_-1:g=_+1}return!1}(n.properties()[t.value],s.value,0,s.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(n,[t,s])=>t.evaluate(n)&&s.evaluate(n)],[io(ft),(n,t)=>{for(const s of t)if(!s.evaluate(n))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(n,[t,s])=>t.evaluate(n)||s.evaluate(n)],[io(ft),(n,t)=>{for(const s of t)if(s.evaluate(n))return!0;return!1}]]},"!":[ft,[ft],(n,[t])=>!t.evaluate(n)],"is-supported-script":[ft,[Dt],(n,[t])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(t.evaluate(n))}],upcase:[Dt,[Dt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[Dt,[Dt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[Dt,io(bt),(n,t)=>t.map(s=>Xs(s.evaluate(n))).join("")],"resolved-locale":[Dt,[mn],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Cl{constructor(t,s){var a;this.expression=t,this._warningHistory={},this._evaluator=new Io,this._defaultValue=s?(a=s).type==="color"&&kl(a.default)?new rr(0,0,0,0):a.type==="color"?rr.parse(a.default)||null:a.type==="padding"?Mn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Bt.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,s,a,h,g,y){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Er(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Il(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Lo}function No(n,t){const s=new fs(Lo,Fa,[],t?function(h){const g={color:Jr,string:Dt,number:Me,enum:Dt,boolean:ft,formatted:Un,padding:Mi,resolvedImage:fi,variableAnchorOffsetCollection:W};return h.type==="array"?D(g[h.value]||bt,h.length):g[h.type]}(t):void 0),a=s.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Sl(new Cl(a,t)):Fo(s.errors)}class jo{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!Ro(s.expression)}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,s,a,h,g,y)}evaluate(t,s,a,h,g,y){return this._styleExpression.evaluate(t,s,a,h,g,y)}}class Vo{constructor(t,s,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Ro(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,s,a,h,g,y)}evaluate(t,s,a,h,g,y){return this._styleExpression.evaluate(t,s,a,h,g,y)}interpolationFactor(t,s,a){return this.interpolationType?un.interpolationFactor(this.interpolationType,t,s,a):0}}function Xu(n,t){const s=No(n,t);if(s.result==="error")return s;const a=s.value.expression,h=Ba(a);if(!h&&!Bo(t))return Fo([new Dr("","data expressions not supported")]);const g=Oa(a,["zoom"]);if(!g&&!Nh(t))return Fo([new Dr("","zoom expressions not supported")]);const y=Na(a);return y||g?y instanceof Dr?Fo([y]):y instanceof un&&!Wu(t)?Fo([new Dr("",'"interpolate" expressions cannot be used with this property')]):Sl(y?new Vo(h?"camera":"composite",s.value,y.labels,y instanceof un?y.interpolation:void 0):new jo(h?"constant":"source",s.value)):Fo([new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Uo{constructor(t,s){this._parameters=t,this._specification=s,ei(this,jh(this._parameters,this._specification))}static deserialize(t){return new Uo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Na(n){let t=null;if(n instanceof Ki)t=Na(n.result);else if(n instanceof Js){for(const s of n.args)if(t=Na(s),t)break}else(n instanceof Rs||n instanceof un)&&n.input instanceof gi&&n.input.name==="zoom"&&(t=n);return t instanceof Dr||n.eachChild(s=>{const a=Na(s);a instanceof Dr?t=a:!t&&a?t=new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function El(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!El(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Pl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ku(n){if(n==null)return{filter:()=>!0,needGeometry:!1};El(n)||(n=Al(n));const t=No(n,Pl);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,a,h)=>t.value.evaluate(s,a,{},h),needGeometry:qh(n)}}function of(n,t){return n<t?-1:n>t?1:0}function qh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(qh(n[t]))return!0;return!1}function Al(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Yu(n[1],n[2],"=="):t==="!="?xn(Yu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Yu(n[1],n[2],t):t==="any"?(s=n.slice(1),["any"].concat(s.map(Al))):t==="all"?["all"].concat(n.slice(1).map(Al)):t==="none"?["all"].concat(n.slice(1).map(Al).map(xn)):t==="in"?ja(n[1],n.slice(2)):t==="!in"?xn(ja(n[1],n.slice(2))):t==="has"?Va(n[1]):t!=="!has"||xn(Va(n[1]));var s}function Yu(n,t,s){switch(n){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,n,t]}}function ja(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",n,["literal",t.sort(of)]]:["filter-in-small",n,["literal",t]]}}function Va(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function xn(n){return["!",n]}function so(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const g of n)h+=`${so(g)},`;return`${h}]`}const s=Object.keys(n).sort();let a="{";for(let h=0;h<s.length;h++)a+=`${JSON.stringify(s[h])}:${so(n[s[h]])},`;return`${a}}`}function Zh(n){let t="";for(const s of Wi)t+=`/${so(n[s])}`;return t}function Gh(n){const t=n.value;return t?[new De(n.key,t,"constants have been deprecated as of v8")]:[]}function Fr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Di(n){if(Array.isArray(n))return n.map(Di);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const s in n)t[s]=Di(n[s]);return t}return Fr(n)}function ii(n){const t=n.key,s=n.value,a=n.valueSpec||{},h=n.objectElementValidators||{},g=n.style,y=n.styleSpec,_=n.validateSpec;let w=[];const C=Jt(s);if(C!=="object")return[new De(t,s,`object expected, ${C} found`)];for(const I in s){const P=I.split(".")[0],z=a[P]||a["*"];let R;if(h[P])R=h[P];else if(a[P])R=_;else if(h["*"])R=h["*"];else{if(!a["*"]){w.push(new De(t,s[I],`unknown property "${I}"`));continue}R=_}w=w.concat(R({key:(t&&`${t}.`)+I,value:s[I],valueSpec:z,style:g,styleSpec:y,object:s,objectKey:I,validateSpec:_},s))}for(const I in a)h[I]||a[I].required&&a[I].default===void 0&&s[I]===void 0&&w.push(new De(t,s,`missing required property "${I}"`));return w}function Ua(n){const t=n.value,s=n.valueSpec,a=n.style,h=n.styleSpec,g=n.key,y=n.arrayElementValidator||n.validateSpec;if(Jt(t)!=="array")return[new De(g,t,`array expected, ${Jt(t)} found`)];if(s.length&&t.length!==s.length)return[new De(g,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new De(g,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let _={type:s.value,values:s.values};h.$version<7&&(_.function=s.function),Jt(s.value)==="object"&&(_=s.value);let w=[];for(let C=0;C<t.length;C++)w=w.concat(y({array:t,arrayIndex:C,value:t[C],valueSpec:_,validateSpec:n.validateSpec,style:a,styleSpec:h,key:`${g}[${C}]`}));return w}function Ju(n){const t=n.key,s=n.value,a=n.valueSpec;let h=Jt(s);return h==="number"&&s!=s&&(h="NaN"),h!=="number"?[new De(t,s,`number expected, ${h} found`)]:"minimum"in a&&s<a.minimum?[new De(t,s,`${s} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&s>a.maximum?[new De(t,s,`${s} is greater than the maximum value ${a.maximum}`)]:[]}function Ml(n){const t=n.valueSpec,s=Fr(n.value.type);let a,h,g,y={};const _=s!=="categorical"&&n.value.property===void 0,w=!_,C=Jt(n.value.stops)==="array"&&Jt(n.value.stops[0])==="array"&&Jt(n.value.stops[0][0])==="object",I=ii({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(R){if(s==="identity")return[new De(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const O=R.value;return B=B.concat(Ua({key:R.key,value:O,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:P})),Jt(O)==="array"&&O.length===0&&B.push(new De(R.key,O,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return s==="identity"&&_&&I.push(new De(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||I.push(new De(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!Wu(n.valueSpec)&&I.push(new De(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!Bo(n.valueSpec)?I.push(new De(n.key,n.value,"property functions not supported")):_&&!Nh(n.valueSpec)&&I.push(new De(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!C||n.value.property!==void 0||I.push(new De(n.key,n.value,'"property" property is required')),I;function P(R){let B=[];const O=R.value,G=R.key;if(Jt(O)!=="array")return[new De(G,O,`array expected, ${Jt(O)} found`)];if(O.length!==2)return[new De(G,O,`array length 2 expected, length ${O.length} found`)];if(C){if(Jt(O[0])!=="object")return[new De(G,O,`object expected, ${Jt(O[0])} found`)];if(O[0].zoom===void 0)return[new De(G,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new De(G,O,"object stop key must have value")];if(g&&g>Fr(O[0].zoom))return[new De(G,O[0].zoom,"stop zoom values must appear in ascending order")];Fr(O[0].zoom)!==g&&(g=Fr(O[0].zoom),h=void 0,y={}),B=B.concat(ii({key:`${G}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Ju,value:z}}))}else B=B.concat(z({key:`${G}[0]`,value:O[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},O));return Il(Di(O[1]))?B.concat([new De(`${G}[1]`,O[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${G}[1]`,value:O[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function z(R,B){const O=Jt(R.value),G=Fr(R.value),X=R.value!==null?R.value:B;if(a){if(O!==a)return[new De(R.key,X,`${O} stop domain type must match previous stop domain type ${a}`)]}else a=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new De(R.key,X,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&s!=="categorical"){let me=`number expected, ${O} found`;return Bo(t)&&s===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(R.key,X,me)]}return s!=="categorical"||O!=="number"||isFinite(G)&&Math.floor(G)===G?s!=="categorical"&&O==="number"&&h!==void 0&&G<h?[new De(R.key,X,"stop domain values must appear in ascending order")]:(h=G,s==="categorical"&&G in y?[new De(R.key,X,"stop domain values must be unique")]:(y[G]=!0,[])):[new De(R.key,X,`integer expected, found ${G}`)]}}function $o(n){const t=(n.expressionContext==="property"?Xu:No)(Di(n.value),n.valueSpec);if(t.result==="error")return t.value.map(a=>new De(`${n.key}${a.key}`,n.value,a.message));const s=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new De(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Ro(s))return[new De(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Ro(s))return[new De(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Oa(s,["zoom","feature-state"]))return[new De(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ba(s))return[new De(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vs(n){const t=n.key,s=n.value,a=n.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Fr(s))===-1&&h.push(new De(t,s,`expected one of [${a.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(a.values).indexOf(Fr(s))===-1&&h.push(new De(t,s,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function Qu(n){return El(Di(n.value))?$o(ei({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):zl(n)}function zl(n){const t=n.value,s=n.key;if(Jt(t)!=="array")return[new De(s,t,`array expected, ${Jt(t)} found`)];const a=n.styleSpec;let h,g=[];if(t.length<1)return[new De(s,t,"filter array must have at least 1 element")];switch(g=g.concat(vs({key:`${s}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),Fr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Fr(t[1])==="$type"&&g.push(new De(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new De(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Jt(t[1]),h!=="string"&&g.push(new De(`${s}[1]`,t[1],`string expected, ${h} found`)));for(let y=2;y<t.length;y++)h=Jt(t[y]),Fr(t[1])==="$type"?g=g.concat(vs({key:`${s}[${y}]`,value:t[y],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new De(`${s}[${y}]`,t[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(zl({key:`${s}[${y}]`,value:t[y],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=Jt(t[1]),t.length!==2?g.push(new De(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new De(`${s}[1]`,t[1],`string expected, ${h} found`))}return g}function ec(n,t){const s=n.key,a=n.validateSpec,h=n.style,g=n.styleSpec,y=n.value,_=n.objectKey,w=g[`${t}_${n.layerType}`];if(!w)return[];const C=_.match(/^(.*)-transition$/);if(t==="paint"&&C&&w[C[1]]&&w[C[1]].transition)return a({key:s,value:y,valueSpec:g.transition,style:h,styleSpec:g});const I=n.valueSpec||w[_];if(!I)return[new De(s,y,`unknown property "${_}"`)];let P;if(Jt(y)==="string"&&Bo(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new De(s,y,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const z=[];return n.layerType==="symbol"&&(_==="text-field"&&h&&!h.glyphs&&z.push(new De(s,y,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&kl(Di(y))&&Fr(y.type)==="identity"&&z.push(new De(s,y,'"text-font" does not support identity functions'))),z.concat(a({key:n.key,value:y,valueSpec:I,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:_}))}function Dl(n){return ec(n,"paint")}function tc(n){return ec(n,"layout")}function rc(n){let t=[];const s=n.value,a=n.key,h=n.style,g=n.styleSpec;s.type||s.ref||t.push(new De(a,s,'either "type" or "ref" is required'));let y=Fr(s.type);const _=Fr(s.ref);if(s.id){const w=Fr(s.id);for(let C=0;C<n.arrayIndex;C++){const I=h.layers[C];Fr(I.id)===w&&t.push(new De(a,s.id,`duplicate layer id "${s.id}", previously used at line ${I.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(C=>{C in s&&t.push(new De(a,s[C],`"${C}" is prohibited for ref layers`))}),h.layers.forEach(C=>{Fr(C.id)===_&&(w=C)}),w?w.ref?t.push(new De(a,s.ref,"ref cannot reference another ref layer")):y=Fr(w.type):t.push(new De(a,s.ref,`ref layer "${_}" not found`))}else if(y!=="background")if(s.source){const w=h.sources&&h.sources[s.source],C=w&&Fr(w.type);w?C==="vector"&&y==="raster"?t.push(new De(a,s.source,`layer "${s.id}" requires a raster source`)):C!=="raster-dem"&&y==="hillshade"?t.push(new De(a,s.source,`layer "${s.id}" requires a raster-dem source`)):C==="raster"&&y!=="raster"?t.push(new De(a,s.source,`layer "${s.id}" requires a vector source`)):C!=="vector"||s["source-layer"]?C==="raster-dem"&&y!=="hillshade"?t.push(new De(a,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!s.paint||!s.paint["line-gradient"]||C==="geojson"&&w.lineMetrics||t.push(new De(a,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new De(a,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new De(a,s.source,`source "${s.source}" not found`))}else t.push(new De(a,s,'missing required property "source"'));return t=t.concat(ii({key:a,value:s,valueSpec:g.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:s.type,valueSpec:g.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"}),filter:Qu,layout:w=>ii({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":C=>tc(ei({layerType:y},C))}}),paint:w=>ii({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":C=>Dl(ei({layerType:y},C))}})}})),t}function oo(n){const t=n.value,s=n.key,a=Jt(t);return a!=="string"?[new De(s,t,`string expected, ${a} found`)]:[]}const Ll={promoteId:function({key:n,value:t}){if(Jt(t)==="string")return oo({key:n,value:t});{const s=[];for(const a in t)s.push(...oo({key:`${n}.${a}`,value:t[a]}));return s}}};function $a(n){const t=n.value,s=n.key,a=n.styleSpec,h=n.style,g=n.validateSpec;if(!t.type)return[new De(s,t,'"type" is required')];const y=Fr(t.type);let _;switch(y){case"vector":case"raster":return _=ii({key:s,value:t,valueSpec:a[`source_${y.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:Ll,validateSpec:g}),_;case"raster-dem":return _=function(w){var C;const I=(C=w.sourceName)!==null&&C!==void 0?C:"",P=w.value,z=w.styleSpec,R=z.source_raster_dem,B=w.style;let O=[];const G=Jt(P);if(P===void 0)return O;if(G!=="object")return O.push(new De("source_raster_dem",P,`object expected, ${G} found`)),O;const X=Fr(P.encoding)==="custom",me=["redFactor","greenFactor","blueFactor","baseShift"],ie=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const pe in P)!X&&me.includes(pe)?O.push(new De(pe,P[pe],`In "${I}": "${pe}" is only valid when "encoding" is set to "custom". ${ie} encoding found`)):R[pe]?O=O.concat(w.validateSpec({key:pe,value:P[pe],valueSpec:R[pe],validateSpec:w.validateSpec,style:B,styleSpec:z})):O.push(new De(pe,P[pe],`unknown property "${pe}"`));return O}({sourceName:s,value:t,style:n.style,styleSpec:a,validateSpec:g}),_;case"geojson":if(_=ii({key:s,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:Ll}),t.cluster)for(const w in t.clusterProperties){const[C,I]=t.clusterProperties[w],P=typeof C=="string"?[C,["accumulated"],["get",w]]:C;_.push(...$o({key:`${s}.${w}.map`,value:I,expressionContext:"cluster-map"})),_.push(...$o({key:`${s}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return _;case"video":return ii({key:s,value:t,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return ii({key:s,value:t,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new De(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vs({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function nc(n){const t=n.value,s=n.styleSpec,a=s.light,h=n.style;let g=[];const y=Jt(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new De("light",t,`object expected, ${y} found`)]),g;for(const _ in t){const w=_.match(/^(.*)-transition$/);g=g.concat(w&&a[w[1]]&&a[w[1]].transition?n.validateSpec({key:_,value:t[_],valueSpec:s.transition,validateSpec:n.validateSpec,style:h,styleSpec:s}):a[_]?n.validateSpec({key:_,value:t[_],valueSpec:a[_],validateSpec:n.validateSpec,style:h,styleSpec:s}):[new De(_,t[_],`unknown property "${_}"`)])}return g}function ic(n){const t=n.value,s=n.styleSpec,a=s.sky,h=n.style,g=Jt(t);if(t===void 0)return[];if(g!=="object")return[new De("sky",t,`object expected, ${g} found`)];let y=[];for(const _ in t)y=y.concat(a[_]?n.validateSpec({key:_,value:t[_],valueSpec:a[_],style:h,styleSpec:s}):[new De(_,t[_],`unknown property "${_}"`)]);return y}function sc(n){const t=n.value,s=n.styleSpec,a=s.terrain,h=n.style;let g=[];const y=Jt(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new De("terrain",t,`object expected, ${y} found`)]),g;for(const _ in t)g=g.concat(a[_]?n.validateSpec({key:_,value:t[_],valueSpec:a[_],validateSpec:n.validateSpec,style:h,styleSpec:s}):[new De(_,t[_],`unknown property "${_}"`)]);return g}function oc(n){let t=[];const s=n.value,a=n.key;if(Array.isArray(s)){const h=[],g=[];for(const y in s)s[y].id&&h.includes(s[y].id)&&t.push(new De(a,s,`all the sprites' ids must be unique, but ${s[y].id} is duplicated`)),h.push(s[y].id),s[y].url&&g.includes(s[y].url)&&t.push(new De(a,s,`all the sprites' URLs must be unique, but ${s[y].url} is duplicated`)),g.push(s[y].url),t=t.concat(ii({key:`${a}[${y}]`,value:s[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return oo({key:a,value:s})}const Rl={"*":()=>[],array:Ua,boolean:function(n){const t=n.value,s=n.key,a=Jt(t);return a!=="boolean"?[new De(s,t,`boolean expected, ${a} found`)]:[]},number:Ju,color:function(n){const t=n.key,s=n.value,a=Jt(s);return a!=="string"?[new De(t,s,`color expected, ${a} found`)]:rr.parse(String(s))?[]:[new De(t,s,`color expected, "${s}" found`)]},constants:Gh,enum:vs,filter:Qu,function:Ml,layer:rc,object:ii,source:$a,light:nc,sky:ic,terrain:sc,projection:function(n){const t=n.value,s=n.styleSpec,a=s.projection,h=n.style,g=Jt(t);if(t===void 0)return[];if(g!=="object")return[new De("projection",t,`object expected, ${g} found`)];let y=[];for(const _ in t)y=y.concat(a[_]?n.validateSpec({key:_,value:t[_],valueSpec:a[_],style:h,styleSpec:s}):[new De(_,t[_],`unknown property "${_}"`)]);return y},string:oo,formatted:function(n){return oo(n).length===0?[]:$o(n)},resolvedImage:function(n){return oo(n).length===0?[]:$o(n)},padding:function(n){const t=n.key,s=n.value;if(Jt(s)==="array"){if(s.length<1||s.length>4)return[new De(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const a={type:"number"};let h=[];for(let g=0;g<s.length;g++)h=h.concat(n.validateSpec({key:`${t}[${g}]`,value:s[g],validateSpec:n.validateSpec,valueSpec:a}));return h}return Ju({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,s=n.value,a=Jt(s),h=n.styleSpec;if(a!=="array"||s.length<1||s.length%2!=0)return[new De(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<s.length;y+=2)g=g.concat(vs({key:`${t}[${y}]`,value:s[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(Ua({key:`${t}[${y+1}]`,value:s[y+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return g},sprite:oc};function qa(n){const t=n.value,s=n.valueSpec,a=n.styleSpec;return n.validateSpec=qa,s.expression&&kl(Fr(t))?Ml(n):s.expression&&Il(Di(t))?$o(n):s.type&&Rl[s.type]?Rl[s.type](n):ii(ei({},n,{valueSpec:s.type?a[s.type]:s}))}function Hh(n){const t=n.value,s=n.key,a=oo(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new De(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new De(s,t,'"glyphs" url must include a "{range}" token'))),a}function yi(n,t=_e){let s=[];return s=s.concat(qa({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:qa,objectElementValidators:{glyphs:Hh,"*":()=>[]}})),n.constants&&(s=s.concat(Gh({key:"constants",value:n.constants}))),ac(s)}function Ji(n){return function(t){return n({...t,validateSpec:qa})}}function ac(n){return[].concat(n).sort((t,s)=>t.line-s.line)}function Li(n){return function(...t){return ac(n.apply(this,t))}}yi.source=Li(Ji($a)),yi.sprite=Li(Ji(oc)),yi.glyphs=Li(Ji(Hh)),yi.light=Li(Ji(nc)),yi.sky=Li(Ji(ic)),yi.terrain=Li(Ji(sc)),yi.layer=Li(Ji(rc)),yi.filter=Li(Ji(Qu)),yi.paintProperty=Li(Ji(Dl)),yi.layoutProperty=Li(Ji(tc));const ao=yi,af=ao.light,lf=ao.sky,Wh=ao.paintProperty,Xh=ao.layoutProperty;function lc(n,t){let s=!1;if(t&&t.length)for(const a of t)n.fire(new Ei(new Error(a.message))),s=!0;return s}class qo{constructor(t,s,a){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(s=y[1])+2*(a=y[2]);for(let w=0;w<this.d*this.d;w++){const C=y[3+w],I=y[3+w+1];h.push(C===I?null:y.subarray(C,I))}const _=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],_),this.bboxes=y.subarray(_),this.insert=this._insertReadonly}else{this.d=s+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=a,this.scale=s/t,this.uid=0;const g=a/s*t;this.min=-g,this.max=t+g}insert(t,s,a,h,g){this._forEachCell(s,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,a,h,g,y){this.cells[g].push(y)}query(t,s,a,h,g){const y=this.min,_=this.max;if(t<=y&&s<=y&&_<=a&&_<=h&&!g)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,s,a,h,this._queryCell,w,{},g),w}}_queryCell(t,s,a,h,g,y,_,w){const C=this.cells[g];if(C!==null){const I=this.keys,P=this.bboxes;for(let z=0;z<C.length;z++){const R=C[z];if(_[R]===void 0){const B=4*R;(w?w(P[B+0],P[B+1],P[B+2],P[B+3]):t<=P[B+2]&&s<=P[B+3]&&a>=P[B+0]&&h>=P[B+1])?(_[R]=!0,y.push(I[R])):_[R]=!1}}}}_forEachCell(t,s,a,h,g,y,_,w){const C=this._convertToCellCoord(t),I=this._convertToCellCoord(s),P=this._convertToCellCoord(a),z=this._convertToCellCoord(h);for(let R=C;R<=P;R++)for(let B=I;B<=z;B++){const O=this.d*B+R;if((!w||w(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&g.call(this,t,s,a,h,O,y,_,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const h=new Int32Array(s+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=s;for(let y=0;y<t.length;y++){const _=t[y];h[3+y]=g,h.set(_,g),g+=_.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,s){const a=t.toArrayBuffer();return s&&s.push(a),{buffer:a}}static deserialize(t){return new qo(t.buffer)}}const _i={};function et(n,t,s={}){if(_i[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),_i[n]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}et("Object",Object),et("TransferableGridIndex",qo),et("Color",rr),et("Error",Error),et("AJAXError",rt),et("ResolvedImage",en),et("StylePropertyFunction",Uo),et("StyleExpression",Cl,{omit:["_evaluator"]}),et("ZoomDependentExpression",Vo),et("ZoomConstantExpression",jo),et("CompoundExpression",gi,{omit:["_evaluate"]});for(const n in Lo)Lo[n]._classRegistryKey||et(`Expression_${n}`,Lo[n]);function Fl(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function uc(n){return n.$name||n.constructor._classRegistryKey}function Kh(n){return!function(t){if(t===null||typeof t!="object")return!1;const s=uc(t);return!(!s||s==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Fl(n)||er(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Zo(n,t){if(Kh(n))return(Fl(n)||er(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const g=[];for(const y of n)g.push(Zo(y,t));return g}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const s=uc(n);if(!s)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!_i[s])throw new Error(`${s} is not registered.`);const{klass:a}=_i[s],h=a.serialize?a.serialize(n,t):{};if(a.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in n){if(!n.hasOwnProperty(g)||_i[s].omit.indexOf(g)>=0)continue;const y=n[g];h[g]=_i[s].shallow.indexOf(g)>=0?y:Zo(y,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(h.$name=s),h}function Go(n){if(Kh(n))return n;if(Array.isArray(n))return n.map(Go);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=uc(n)||"Object";if(!_i[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=_i[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(n);const a=Object.create(s.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const g=n[h];a[h]=_i[t].shallow.indexOf(h)>=0?g:Go(g)}return a}class cc{constructor(){this.first=!0}update(t,s){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const Gt={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function hc(n){for(const t of n)if(pc(t.charCodeAt(0)))return!0;return!1}function uf(n){for(const t of n)if(!Ho(t.charCodeAt(0)))return!1;return!0}function dc(n){const t=n.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(t.join("|"),"u")}const cf=dc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ho(n){return!cf.test(String.fromCodePoint(n))}const Yh=dc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function pc(n){return!(n!==746&&n!==747&&(n<4352||!(Gt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Gt["CJK Compatibility"](n)||Gt["CJK Strokes"](n)||!(!Gt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Gt["Enclosed CJK Letters and Months"](n)||Gt["Ideographic Description Characters"](n)||Gt.Kanbun(n)||Gt.Katakana(n)&&n!==12540||!(!Gt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Gt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Gt["Vertical Forms"](n)||Gt["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Yh.test(String.fromCodePoint(n)))))}function Jh(n){return!(pc(n)||function(t){return!!(Gt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Gt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Gt["Letterlike Symbols"](t)||Gt["Number Forms"](t)||Gt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Gt["Control Pictures"](t)&&t!==9251||Gt["Optical Character Recognition"](t)||Gt["Enclosed Alphanumerics"](t)||Gt["Geometric Shapes"](t)||Gt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Gt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gt["CJK Symbols and Punctuation"](t)||Gt.Katakana(t)||Gt["Private Use Area"](t)||Gt["CJK Compatibility Forms"](t)||Gt["Small Form Variants"](t)||Gt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const hf=dc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function fc(n){return hf.test(String.fromCodePoint(n))}function df(n,t){return!(!t&&fc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Gt.Khmer(n))}function pf(n){for(const t of n)if(fc(t.charCodeAt(0)))return!0;return!1}const si=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class vr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cc,this.transition={})}isSupportedScript(t){return function(s,a){for(const h of s)if(!df(h.charCodeAt(0),a))return!1;return!0}(t,si.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*s}}}class Wo{constructor(t,s){this.property=t,this.value=s,this.expression=function(a,h){if(kl(a))return new Uo(a,h);if(Il(a)){const g=Xu(a,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=rr.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=Bt.parse(a)):g=Mn.parse(a),{kind:"constant",evaluate:()=>g}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,a){return this.property.possiblyEvaluate(this,t,s,a)}}class Bl{constructor(t){this.property=t,this.value=new Wo(t,void 0)}transitioned(t,s){return new Qh(this.property,this.value,s,qe({},t.transition,this.transition),t.now)}untransitioned(){return new Qh(this.property,this.value,null,{},0)}}class Ol{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return St(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bl(this._values[t].property)),this._values[t].value=new Wo(this._values[t].property,s===null?void 0:St(s))}getTransition(t){return St(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bl(this._values[t].property)),this._values[t].transition=St(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const a=this.getValue(s);a!==void 0&&(t[s]=a);const h=this.getTransition(s);h!==void 0&&(t[`${s}-transition`]=h)}return t}transitioned(t,s){const a=new Za(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,s._values[h]);return a}untransitioned(){const t=new Za(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Qh{constructor(t,s,a,h,g){this.property=t,this.value=s,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,s,a){const h=t.now||0,g=this.value.possiblyEvaluate(t,s,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(t,s,a);{const _=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,s,a),g,function(w){if(w<=0)return 0;if(w>=1)return 1;const C=w*w,I=C*w;return 4*(w<.5?I:3*(w-C)+I-.75)}(_))}}return g}}class Za{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,a){const h=new Ha(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,s,a);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ga{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return St(this._values[t].value)}setValue(t,s){this._values[t]=new Wo(this._values[t].property,s===null?void 0:St(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const a=this.getValue(s);a!==void 0&&(t[s]=a)}return t}possiblyEvaluate(t,s,a){const h=new Ha(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,s,a);return h}}class Qi{constructor(t,s,a){this.property=t,this.value=s,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,a,h){return this.property.evaluate(this.value,this.parameters,t,s,a,h)}}class Ha{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class it{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,a){const h=yn[this.specification.type];return h?h(t,s,a):t}}class vt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,a,h){return new Qi(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},a,h)}:t.expression,s)}interpolate(t,s,a){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Qi(this,{kind:"constant",value:void 0},t.parameters);const h=yn[this.specification.type];if(h){const g=h(t.value.value,s.value.value,a);return new Qi(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,s,a,h,g,y){return t.kind==="constant"?t.value:t.evaluate(s,a,h,g,y)}}class Nl extends vt{possiblyEvaluate(t,s,a,h){if(t.value===void 0)return new Qi(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const g=t.expression.evaluate(s,null,{},a,h),y=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,_=this._calculate(y,y,y,s);return new Qi(this,{kind:"constant",value:_},s)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Qi(this,{kind:"constant",value:g},s)}return new Qi(this,t.expression,s)}evaluate(t,s,a,h,g,y){if(t.kind==="source"){const _=t.evaluate(s,a,h,g,y);return this._calculate(_,_,_,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},a,h),t.evaluate({zoom:Math.floor(s.zoom)},a,h),t.evaluate({zoom:Math.floor(s.zoom)+1},a,h),s):t.value}_calculate(t,s,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:a,to:s}}interpolate(t){return t}}class jl{constructor(t){this.specification=t}possiblyEvaluate(t,s,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(s,null,{},a,h);return this._calculate(g,g,g,s)}return this._calculate(t.expression.evaluate(new vr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new vr(Math.floor(s.zoom),s)),t.expression.evaluate(new vr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:a,to:s}}interpolate(t){return t}}class mc{constructor(t){this.specification=t}possiblyEvaluate(t,s,a,h){return!!t.expression.evaluate(s,null,{},a,h)}interpolate(){return!1}}class m{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const a=t[s];a.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new Wo(a,void 0),g=this.defaultTransitionablePropertyValues[s]=new Bl(a);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate({})}}}et("DataDrivenProperty",vt),et("DataConstantProperty",it),et("CrossFadedDataDrivenProperty",Nl),et("CrossFadedProperty",jl),et("ColorRampProperty",mc);const e="-transition";class o extends Ds{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new Ga(s.layout)),s.paint)){this._transitionablePaint=new Ol(s.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ha(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,a={}){s!=null&&this._validate(Xh,`layers.${this.id}.layout.${t}`,t,s,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,a={}){if(s!=null&&this._validate(Wh,`layers.${this.id}.paint.${t}`,t,s,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),_=h.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(t,_,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),wt(t,(s,a)=>!(s===void 0||a==="layout"&&!Object.keys(s).length||a==="paint"&&!Object.keys(s).length))}_validate(t,s,a,h,g={}){return(!g||g.validate!==!1)&&lc(this,t.call(ao,{key:s,layerType:this.type,objectKey:a,value:h,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Qi&&Bo(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class c{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class f{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function x(n,t=1){let s=0,a=0;return{members:n.map(h=>{const g=u[h.type].BYTES_PER_ELEMENT,y=s=b(s,Math.max(t,g)),_=h.components||1;return a=Math.max(a,g),s+=g*_,{name:h.name,type:h.type,components:_,offset:y}}),size:b(s,Math.max(a,t)),alignment:t}}function b(n,t){return Math.ceil(n/t)*t}class T extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.int16[h+0]=s,this.int16[h+1]=a,t}}T.prototype.bytesPerElement=4,et("StructArrayLayout2i4",T);class E extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.int16[g+0]=s,this.int16[g+1]=a,this.int16[g+2]=h,t}}E.prototype.bytesPerElement=6,et("StructArrayLayout3i6",E);class A extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,a,h)}emplace(t,s,a,h,g){const y=4*t;return this.int16[y+0]=s,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=g,t}}A.prototype.bytesPerElement=8,et("StructArrayLayout4i8",A);class M extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,_){const w=6*t;return this.int16[w+0]=s,this.int16[w+1]=a,this.int16[w+2]=h,this.int16[w+3]=g,this.int16[w+4]=y,this.int16[w+5]=_,t}}M.prototype.bytesPerElement=12,et("StructArrayLayout2i4i12",M);class F extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,_){const w=4*t,C=8*t;return this.int16[w+0]=s,this.int16[w+1]=a,this.uint8[C+4]=h,this.uint8[C+5]=g,this.uint8[C+6]=y,this.uint8[C+7]=_,t}}F.prototype.bytesPerElement=8,et("StructArrayLayout2i4ub8",F);class j extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.float32[h+0]=s,this.float32[h+1]=a,t}}j.prototype.bytesPerElement=8,et("StructArrayLayout2f8",j);class $ extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C,I){const P=this.length;return this.resize(P+1),this.emplace(P,t,s,a,h,g,y,_,w,C,I)}emplace(t,s,a,h,g,y,_,w,C,I,P){const z=10*t;return this.uint16[z+0]=s,this.uint16[z+1]=a,this.uint16[z+2]=h,this.uint16[z+3]=g,this.uint16[z+4]=y,this.uint16[z+5]=_,this.uint16[z+6]=w,this.uint16[z+7]=C,this.uint16[z+8]=I,this.uint16[z+9]=P,t}}$.prototype.bytesPerElement=20,et("StructArrayLayout10ui20",$);class H extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C,I,P,z){const R=this.length;return this.resize(R+1),this.emplace(R,t,s,a,h,g,y,_,w,C,I,P,z)}emplace(t,s,a,h,g,y,_,w,C,I,P,z,R){const B=12*t;return this.int16[B+0]=s,this.int16[B+1]=a,this.int16[B+2]=h,this.int16[B+3]=g,this.uint16[B+4]=y,this.uint16[B+5]=_,this.uint16[B+6]=w,this.uint16[B+7]=C,this.int16[B+8]=I,this.int16[B+9]=P,this.int16[B+10]=z,this.int16[B+11]=R,t}}H.prototype.bytesPerElement=24,et("StructArrayLayout4i4ui4i24",H);class K extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.float32[g+0]=s,this.float32[g+1]=a,this.float32[g+2]=h,t}}K.prototype.bytesPerElement=12,et("StructArrayLayout3f12",K);class Y extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}Y.prototype.bytesPerElement=4,et("StructArrayLayout1ul4",Y);class ee extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C){const I=this.length;return this.resize(I+1),this.emplace(I,t,s,a,h,g,y,_,w,C)}emplace(t,s,a,h,g,y,_,w,C,I){const P=10*t,z=5*t;return this.int16[P+0]=s,this.int16[P+1]=a,this.int16[P+2]=h,this.int16[P+3]=g,this.int16[P+4]=y,this.int16[P+5]=_,this.uint32[z+3]=w,this.uint16[P+8]=C,this.uint16[P+9]=I,t}}ee.prototype.bytesPerElement=20,et("StructArrayLayout6i1ul2ui20",ee);class Z extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,_){const w=6*t;return this.int16[w+0]=s,this.int16[w+1]=a,this.int16[w+2]=h,this.int16[w+3]=g,this.int16[w+4]=y,this.int16[w+5]=_,t}}Z.prototype.bytesPerElement=12,et("StructArrayLayout2i2i2i12",Z);class oe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,a,h,g)}emplace(t,s,a,h,g,y){const _=4*t,w=8*t;return this.float32[_+0]=s,this.float32[_+1]=a,this.float32[_+2]=h,this.int16[w+6]=g,this.int16[w+7]=y,t}}oe.prototype.bytesPerElement=16,et("StructArrayLayout2f1f2i16",oe);class he extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,_){const w=16*t,C=4*t,I=8*t;return this.uint8[w+0]=s,this.uint8[w+1]=a,this.float32[C+1]=h,this.float32[C+2]=g,this.int16[I+6]=y,this.int16[I+7]=_,t}}he.prototype.bytesPerElement=16,et("StructArrayLayout2ub2f2i16",he);class ge extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.uint16[g+0]=s,this.uint16[g+1]=a,this.uint16[g+2]=h,t}}ge.prototype.bytesPerElement=6,et("StructArrayLayout3ui6",ge);class ke extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C,I,P,z,R,B,O,G,X){const me=this.length;return this.resize(me+1),this.emplace(me,t,s,a,h,g,y,_,w,C,I,P,z,R,B,O,G,X)}emplace(t,s,a,h,g,y,_,w,C,I,P,z,R,B,O,G,X,me){const ie=24*t,pe=12*t,xe=48*t;return this.int16[ie+0]=s,this.int16[ie+1]=a,this.uint16[ie+2]=h,this.uint16[ie+3]=g,this.uint32[pe+2]=y,this.uint32[pe+3]=_,this.uint32[pe+4]=w,this.uint16[ie+10]=C,this.uint16[ie+11]=I,this.uint16[ie+12]=P,this.float32[pe+7]=z,this.float32[pe+8]=R,this.uint8[xe+36]=B,this.uint8[xe+37]=O,this.uint8[xe+38]=G,this.uint32[pe+10]=X,this.int16[ie+22]=me,t}}ke.prototype.bytesPerElement=48,et("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ke);class ze extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C,I,P,z,R,B,O,G,X,me,ie,pe,xe,Ae,Xe,mt,Ge,$e,at,tt){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,t,s,a,h,g,y,_,w,C,I,P,z,R,B,O,G,X,me,ie,pe,xe,Ae,Xe,mt,Ge,$e,at,tt)}emplace(t,s,a,h,g,y,_,w,C,I,P,z,R,B,O,G,X,me,ie,pe,xe,Ae,Xe,mt,Ge,$e,at,tt,Qe){const we=32*t,ut=16*t;return this.int16[we+0]=s,this.int16[we+1]=a,this.int16[we+2]=h,this.int16[we+3]=g,this.int16[we+4]=y,this.int16[we+5]=_,this.int16[we+6]=w,this.int16[we+7]=C,this.uint16[we+8]=I,this.uint16[we+9]=P,this.uint16[we+10]=z,this.uint16[we+11]=R,this.uint16[we+12]=B,this.uint16[we+13]=O,this.uint16[we+14]=G,this.uint16[we+15]=X,this.uint16[we+16]=me,this.uint16[we+17]=ie,this.uint16[we+18]=pe,this.uint16[we+19]=xe,this.uint16[we+20]=Ae,this.uint16[we+21]=Xe,this.uint16[we+22]=mt,this.uint32[ut+12]=Ge,this.float32[ut+13]=$e,this.float32[ut+14]=at,this.uint16[we+30]=tt,this.uint16[we+31]=Qe,t}}ze.prototype.bytesPerElement=64,et("StructArrayLayout8i15ui1ul2f2ui64",ze);class Ze extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}Ze.prototype.bytesPerElement=4,et("StructArrayLayout1f4",Ze);class Ye extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.uint16[6*t+0]=s,this.float32[g+1]=a,this.float32[g+2]=h,t}}Ye.prototype.bytesPerElement=12,et("StructArrayLayout1ui2f12",Ye);class Ve extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=4*t;return this.uint32[2*t+0]=s,this.uint16[g+2]=a,this.uint16[g+3]=h,t}}Ve.prototype.bytesPerElement=8,et("StructArrayLayout1ul2ui8",Ve);class je extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.uint16[h+0]=s,this.uint16[h+1]=a,t}}je.prototype.bytesPerElement=4,et("StructArrayLayout2ui4",je);class st extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}st.prototype.bytesPerElement=2,et("StructArrayLayout1ui2",st);class It extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,a,h)}emplace(t,s,a,h,g){const y=4*t;return this.float32[y+0]=s,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=g,t}}It.prototype.bytesPerElement=16,et("StructArrayLayout4f16",It);class Ue extends c{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Q(this.anchorPointX,this.anchorPointY)}}Ue.prototype.size=20;class We extends ee{get(t){return new Ue(this,t)}}et("CollisionBoxArray",We);class Tt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Tt.prototype.size=48;class xr extends ke{get(t){return new Tt(this,t)}}et("PlacedSymbolArray",xr);class Ot extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ot.prototype.size=64;class qt extends ze{get(t){return new Ot(this,t)}}et("SymbolInstanceArray",qt);class wr extends Ze{getoffsetX(t){return this.float32[1*t+0]}}et("GlyphOffsetArray",wr);class wn extends E{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}et("SymbolLineVertexArray",wn);class Ri extends c{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ri.prototype.size=12;class br extends Ye{get(t){return new Ri(this,t)}}et("TextAnchorOffsetArray",br);class qn extends c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}qn.prototype.size=8;class zn extends Ve{get(t){return new qn(this,t)}}et("FeatureIndexArray",zn);class bn extends T{}class Dn extends T{}class es extends T{}class Xo extends M{}class Vl extends F{}class Ko extends j{}class vi extends ${}class Ul extends H{}class gc extends K{}class xi extends Y{}class wi extends Z{}class Fs extends he{}class Fi extends ge{}class cn extends je{}const Sn=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:oi}=Sn;class Ht{constructor(t=[]){this.segments=t}prepareSegment(t,s,a,h){let g=this.segments[this.segments.length-1];return t>Ht.MAX_VERTEX_ARRAY_LENGTH&&yt(`Max vertices per segment is ${Ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>Ht.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:s.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,a,h){return new Ht([{vertexOffset:t,primitiveOffset:s,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function lo(n,t){return 256*(n=Ne(Math.floor(n),0,255))+Ne(Math.floor(t),0,255)}Ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,et("SegmentVector",Ht);const Yo=x([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Jo={exports:{}},ed={exports:{}};ed.exports=function(n,t){var s,a,h,g,y,_,w,C;for(a=n.length-(s=3&n.length),h=t,y=3432918353,_=461845907,C=0;C<a;)w=255&n.charCodeAt(C)|(255&n.charCodeAt(++C))<<8|(255&n.charCodeAt(++C))<<16|(255&n.charCodeAt(++C))<<24,++C,h=27492+(65535&(g=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&n.charCodeAt(C+2))<<16;case 2:w^=(255&n.charCodeAt(C+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&n.charCodeAt(C)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var ff=ed.exports,td={exports:{}};td.exports=function(n,t){for(var s,a=n.length,h=t^a,g=0;a>=4;)s=1540483477*(65535&(s=255&n.charCodeAt(g)|(255&n.charCodeAt(++g))<<8|(255&n.charCodeAt(++g))<<16|(255&n.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&n.charCodeAt(g+2))<<16;case 2:h^=(255&n.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var Bs=ff,rd=td.exports;Jo.exports=Bs,Jo.exports.murmur3=Bs,Jo.exports.murmur2=rd;var $l=V(Jo.exports);class Wa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,a,h){this.ids.push(ql(t)),this.positions.push(s,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=ql(t);let a=0,h=this.ids.length-1;for(;a<h;){const y=a+h>>1;this.ids[y]>=s?h=y:a=y+1}const g=[];for(;this.ids[a]===s;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(t,s){const a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Zl(a,h,0,a.length-1),s&&s.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){const s=new Wa;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function ql(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:$l(String(n))}function Zl(n,t,s,a){for(;s<a;){const h=n[s+a>>1];let g=s-1,y=a+1;for(;;){do g++;while(n[g]<h);do y--;while(n[y]>h);if(g>=y)break;Qo(n,g,y),Qo(t,3*g,3*y),Qo(t,3*g+1,3*y+1),Qo(t,3*g+2,3*y+2)}y-s<a-y?(Zl(n,t,s,y),s=y+1):(Zl(n,t,y+1,a),a=y)}}function Qo(n,t,s){const a=n[t];n[t]=n[s],n[s]=a}et("FeaturePositionMap",Wa);class Xa{constructor(t,s){this.gl=t.gl,this.location=s}}class nd extends Xa{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ay extends Xa{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class My extends Xa{constructor(t,s){super(t,s),this.current=rr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const n1=new Float32Array(16);function mf(n){return[lo(255*n.r,255*n.g),lo(255*n.b,255*n.a)]}class yc{constructor(t,s,a){this.value=t,this.uniformNames=s.map(h=>`u_${h}`),this.type=a}setUniform(t,s,a){t.set(a.constantOr(this.value))}getBinding(t,s,a){return this.type==="color"?new My(t,s):new nd(t,s)}}class Gl{constructor(t,s){this.uniformNames=s.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,a,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,s,a){return a.substr(0,9)==="u_pattern"?new Ay(t,s):new nd(t,s)}}class uo{constructor(t,s,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,s,a,h,g){const y=this.paintVertexArray.length,_=this.expression.evaluate(new vr(0),s,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,_)}updatePaintArray(t,s,a,h){const g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,s,g)}_setPaintValue(t,s,a){if(this.type==="color"){const h=mf(a);for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<s;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xs{constructor(t,s,a,h,g,y){this.expression=t,this.uniformNames=s.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,s,a,h,g){const y=this.expression.evaluate(new vr(this.zoom),s,{},h,[],g),_=this.expression.evaluate(new vr(this.zoom+1),s,{},h,[],g),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,y,_)}updatePaintArray(t,s,a,h){const g=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,s,g,y)}_setPaintValue(t,s,a,h){if(this.type==="color"){const g=mf(a),y=mf(h);for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,g[0],g[1],y[0],y[1])}else{for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const a=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=Ne(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,s,a){return new nd(t,s)}}class ea{constructor(t,s,a,h,g,y){this.expression=t,this.type=s,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,s,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,s.patterns&&s.patterns[this.layerId],a)}updatePaintArray(t,s,a,h,g){this._setPaintValues(t,s,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,s,a,h){if(!h||!a)return;const{min:g,mid:y,max:_}=a,w=h[g],C=h[y],I=h[_];if(w&&C&&I)for(let P=t;P<s;P++)this.zoomInPaintVertexArray.emplace(P,C.tl[0],C.tl[1],C.br[0],C.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],C.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,C.tl[0],C.tl[1],C.br[0],C.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],C.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Yo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Yo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zy{constructor(t,s,a){this.binders={},this._buffers=[];const h=[];for(const g in t.paint._values){if(!a(g))continue;const y=t.paint.get(g);if(!(y instanceof Qi&&Bo(y.property.specification)))continue;const _=i1(g,t.type),w=y.value,C=y.property.specification.type,I=y.property.useIntegerZoom,P=y.property.specification["property-type"],z=P==="cross-faded"||P==="cross-faded-data-driven";if(w.kind==="constant")this.binders[g]=z?new Gl(w.value,_):new yc(w.value,_,C),h.push(`/u_${g}`);else if(w.kind==="source"||z){const R=Dy(g,C,"source");this.binders[g]=z?new ea(w,C,I,s,R,t.id):new uo(w,_,C,R),h.push(`/a_${g}`)}else{const R=Dy(g,C,"composite");this.binders[g]=new xs(w,_,C,I,s,R),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof uo||s instanceof xs?s.maxValue:0}populatePaintArrays(t,s,a,h,g){for(const y in this.binders){const _=this.binders[y];(_ instanceof uo||_ instanceof xs||_ instanceof ea)&&_.populatePaintArray(t,s,a,h,g)}}setConstantPatternPositions(t,s){for(const a in this.binders){const h=this.binders[a];h instanceof Gl&&h.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,a,h,g){let y=!1;for(const _ in t){const w=s.getPositions(_);for(const C of w){const I=a.feature(C.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof uo||z instanceof xs||z instanceof ea)&&z.expression.isStateDependent===!0){const R=h.paint.get(P);z.expression=R.value,z.updatePaintArray(C.start,C.end,I,t[_],g),y=!0}}}}return y}defines(){const t=[];for(const s in this.binders){const a=this.binders[s];(a instanceof yc||a instanceof Gl)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof uo||a instanceof xs)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof ea)for(let h=0;h<Yo.members.length;h++)t.push(Yo.members[h].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof yc||a instanceof Gl||a instanceof xs)for(const h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const a=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof yc||g instanceof Gl||g instanceof xs){for(const y of g.uniformNames)if(s[y]){const _=g.getBinding(t,s[y],y);a.push({name:y,property:h,binding:_})}}}return a}setUniforms(t,s,a,h){for(const{name:g,property:y,binding:_}of s)this.binders[y].setUniform(_,h,a.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const a=this.binders[s];if(t&&a instanceof ea){const h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof uo||a instanceof xs)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const s in this.binders){const a=this.binders[s];(a instanceof uo||a instanceof xs||a instanceof ea)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof uo||s instanceof xs||s instanceof ea)&&s.destroy()}}}class Ka{constructor(t,s,a=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new zy(h,s,a);this.needsUpload=!1,this._featureMap=new Wa,this._bufferOffset=0}populatePaintArrays(t,s,a,h,g,y){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,s,h,g,y);s.id!==void 0&&this._featureMap.add(s.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,a,h){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,s,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function i1(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Dy(n,t,s){const a={color:{source:j,composite:It},number:{source:Ze,composite:j}},h=function(g){return{"line-pattern":{source:vi,composite:vi},"fill-pattern":{source:vi,composite:vi},"fill-extrusion-pattern":{source:vi,composite:vi}}[g]}(n);return h&&h[s]||a[t][s]}et("ConstantBinder",yc),et("CrossFadedConstantBinder",Gl),et("SourceExpressionBinder",uo),et("CrossFadedCompositeBinder",ea),et("CompositeExpressionBinder",xs),et("ProgramConfiguration",zy,{omit:["_buffers"]}),et("ProgramConfigurationSet",Ka);const Zr=8192,gf=Math.pow(2,14)-1,Ly=-gf-1;function Ya(n){const t=Zr/n.extent,s=n.loadGeometry();for(let a=0;a<s.length;a++){const h=s[a];for(let g=0;g<h.length;g++){const y=h[g],_=Math.round(y.x*t),w=Math.round(y.y*t);y.x=Ne(_,Ly,gf),y.y=Ne(w,Ly,gf),(_<y.x||_>y.x+1||w<y.y||w>y.y+1)&&yt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Ja(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Ya(n):[]}}function id(n,t,s,a,h){n.emplaceBack(2*t+(a+1)/2,2*s+(h+1)/2)}class yf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Dn,this.indexArray=new Fi,this.segments=new Ht,this.programConfigurations=new Ka(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){const h=this.layers[0],g=[];let y=null,_=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),_=!y.isConstant());for(const{feature:w,id:C,index:I,sourceLayerIndex:P}of t){const z=this.layers[0]._featureFilter.needGeometry,R=Ja(w,z);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom),R,a))continue;const B=_?y.evaluate(R,{},a):void 0,O={id:C,properties:w.properties,type:w.type,sourceLayerIndex:P,index:I,geometry:z?R.geometry:Ya(w),patterns:{},sortKey:B};g.push(O)}_&&g.sort((w,C)=>w.sortKey-C.sortKey);for(const w of g){const{geometry:C,index:I,sourceLayerIndex:P}=w,z=t[I].feature;this.addFeature(w,C,I,a),s.featureIndex.insert(z,C,I,P,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,a,h){for(const g of s)for(const y of g){const _=y.x,w=y.y;if(_<0||_>=Zr||w<0||w>=Zr)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),I=C.vertexLength;id(this.layoutVertexArray,_,w,-1,-1),id(this.layoutVertexArray,_,w,1,-1),id(this.layoutVertexArray,_,w,1,1),id(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function Ry(n,t){for(let s=0;s<n.length;s++)if(Hl(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Hl(n,t[s]))return!0;return!!_f(n,t)}function s1(n,t,s){return!!Hl(n,t)||!!vf(t,n,s)}function Fy(n,t){if(n.length===1)return Oy(t,n[0]);for(let s=0;s<t.length;s++){const a=t[s];for(let h=0;h<a.length;h++)if(Hl(n,a[h]))return!0}for(let s=0;s<n.length;s++)if(Oy(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(_f(n,t[s]))return!0;return!1}function o1(n,t,s){if(n.length>1){if(_f(n,t))return!0;for(let a=0;a<t.length;a++)if(vf(t[a],n,s))return!0}for(let a=0;a<n.length;a++)if(vf(n[a],t,s))return!0;return!1}function _f(n,t){if(n.length===0||t.length===0)return!1;for(let s=0;s<n.length-1;s++){const a=n[s],h=n[s+1];for(let g=0;g<t.length-1;g++)if(a1(a,h,t[g],t[g+1]))return!0}return!1}function a1(n,t,s,a){return Mt(n,s,a)!==Mt(t,s,a)&&Mt(n,t,s)!==Mt(n,t,a)}function vf(n,t,s){const a=s*s;if(t.length===1)return n.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(By(n,t[h-1],t[h])<a)return!0;return!1}function By(n,t,s){const a=t.distSqr(s);if(a===0)return n.distSqr(t);const h=((n.x-t.x)*(s.x-t.x)+(n.y-t.y)*(s.y-t.y))/a;return n.distSqr(h<0?t:h>1?s:s.sub(t)._mult(h)._add(t))}function Oy(n,t){let s,a,h,g=!1;for(let y=0;y<n.length;y++){s=n[y];for(let _=0,w=s.length-1;_<s.length;w=_++)a=s[_],h=s[w],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function Hl(n,t){let s=!1;for(let a=0,h=n.length-1;a<n.length;h=a++){const g=n[a],y=n[h];g.y>t.y!=y.y>t.y&&t.x<(y.x-g.x)*(t.y-g.y)/(y.y-g.y)+g.x&&(s=!s)}return s}function l1(n,t,s){const a=s[0],h=s[2];if(n.x<a.x&&t.x<a.x||n.x>h.x&&t.x>h.x||n.y<a.y&&t.y<a.y||n.y>h.y&&t.y>h.y)return!1;const g=Mt(n,t,s[0]);return g!==Mt(n,t,s[1])||g!==Mt(n,t,s[2])||g!==Mt(n,t,s[3])}function _c(n,t,s){const a=t.paint.get(n).value;return a.kind==="constant"?a.value:s.programConfigurations.get(t.id).getMaxValue(n)}function sd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function od(n,t,s,a,h){if(!t[0]&&!t[1])return n;const g=Q.convert(t)._mult(h);s==="viewport"&&g._rotate(-a);const y=[];for(let _=0;_<n.length;_++)y.push(n[_].sub(g));return y}let Ny,jy;et("CircleBucket",yf,{omit:["layers"]});var u1={get paint(){return jy=jy||new m({"circle-radius":new vt(_e.paint_circle["circle-radius"]),"circle-color":new vt(_e.paint_circle["circle-color"]),"circle-blur":new vt(_e.paint_circle["circle-blur"]),"circle-opacity":new vt(_e.paint_circle["circle-opacity"]),"circle-translate":new it(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new it(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vt(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vt(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vt(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return Ny=Ny||new m({"circle-sort-key":new vt(_e.layout_circle["circle-sort-key"])})}},Zn=1e-6,Wl=typeof Float32Array<"u"?Float32Array:Array;function xf(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Vy(n,t,s){var a=t[0],h=t[1],g=t[2],y=t[3],_=t[4],w=t[5],C=t[6],I=t[7],P=t[8],z=t[9],R=t[10],B=t[11],O=t[12],G=t[13],X=t[14],me=t[15],ie=s[0],pe=s[1],xe=s[2],Ae=s[3];return n[0]=ie*a+pe*_+xe*P+Ae*O,n[1]=ie*h+pe*w+xe*z+Ae*G,n[2]=ie*g+pe*C+xe*R+Ae*X,n[3]=ie*y+pe*I+xe*B+Ae*me,n[4]=(ie=s[4])*a+(pe=s[5])*_+(xe=s[6])*P+(Ae=s[7])*O,n[5]=ie*h+pe*w+xe*z+Ae*G,n[6]=ie*g+pe*C+xe*R+Ae*X,n[7]=ie*y+pe*I+xe*B+Ae*me,n[8]=(ie=s[8])*a+(pe=s[9])*_+(xe=s[10])*P+(Ae=s[11])*O,n[9]=ie*h+pe*w+xe*z+Ae*G,n[10]=ie*g+pe*C+xe*R+Ae*X,n[11]=ie*y+pe*I+xe*B+Ae*me,n[12]=(ie=s[12])*a+(pe=s[13])*_+(xe=s[14])*P+(Ae=s[15])*O,n[13]=ie*h+pe*w+xe*z+Ae*G,n[14]=ie*g+pe*C+xe*R+Ae*X,n[15]=ie*y+pe*I+xe*B+Ae*me,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var vc,c1=Vy;function ad(n,t,s){var a=t[0],h=t[1],g=t[2],y=t[3];return n[0]=s[0]*a+s[4]*h+s[8]*g+s[12]*y,n[1]=s[1]*a+s[5]*h+s[9]*g+s[13]*y,n[2]=s[2]*a+s[6]*h+s[10]*g+s[14]*y,n[3]=s[3]*a+s[7]*h+s[11]*g+s[15]*y,n}vc=new Wl(4),Wl!=Float32Array&&(vc[0]=0,vc[1]=0,vc[2]=0,vc[3]=0);class h1 extends o{constructor(t){super(t,u1)}createBucket(t){return new yf(t)}queryRadius(t){const s=t;return _c("circle-radius",this,s)+_c("circle-stroke-width",this,s)+sd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,a,h,g,y,_,w){const C=od(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,_),I=this.paint.get("circle-radius").evaluate(s,a)+this.paint.get("circle-stroke-width").evaluate(s,a),P=this.paint.get("circle-pitch-alignment")==="map",z=P?C:function(B,O){return B.map(G=>Uy(G,O))}(C,w),R=P?I*_:I;for(const B of h)for(const O of B){const G=P?O:Uy(O,w);let X=R;const me=ad([],[O.x,O.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=me[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=y.cameraToCenterDistance/me[3]),s1(z,G,X))return!0}return!1}}function Uy(n,t){const s=ad([],[n.x,n.y,0,1],t);return new Q(s[0]/s[3],s[1]/s[3])}class $y extends yf{}let qy;et("HeatmapBucket",$y,{omit:["layers"]});var d1={get paint(){return qy=qy||new m({"heatmap-radius":new vt(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vt(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mc(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(_e.paint_heatmap["heatmap-opacity"])})}};function wf(n,{width:t,height:s},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*s*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*s*a}`)}else h=new Uint8Array(t*s*a);return n.width=t,n.height=s,n.data=h,n}function Zy(n,{width:t,height:s},a){if(t===n.width&&s===n.height)return;const h=wf({},{width:t,height:s},a);bf(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,s)},a),n.width=t,n.height=s,n.data=h.data}function bf(n,t,s,a,h,g){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||s.x>n.width-h.width||s.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=n.data,_=t.data;if(y===_)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<h.height;w++){const C=((s.y+w)*n.width+s.x)*g,I=((a.y+w)*t.width+a.x)*g;for(let P=0;P<h.width*g;P++)_[I+P]=y[C+P]}return t}class xc{constructor(t,s){wf(this,t,1,s)}resize(t){Zy(this,t,1)}clone(){return new xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,a,h,g){bf(t,s,a,h,g,1)}}class Bi{constructor(t,s){wf(this,t,4,s)}resize(t){Zy(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Bi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,a,h,g){bf(t,s,a,h,g,4)}}function Gy(n){const t={},s=n.resolution||256,a=n.clips?n.clips.length:1,h=n.image||new Bi({width:s,height:a});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const g=(y,_,w)=>{t[n.evaluationKey]=w;const C=n.expression.evaluate(t);h.data[y+_+0]=Math.floor(255*C.r/C.a),h.data[y+_+1]=Math.floor(255*C.g/C.a),h.data[y+_+2]=Math.floor(255*C.b/C.a),h.data[y+_+3]=Math.floor(255*C.a)};if(n.clips)for(let y=0,_=0;y<a;++y,_+=4*s)for(let w=0,C=0;w<s;w++,C+=4){const I=w/(s-1),{start:P,end:z}=n.clips[y];g(_,C,P*(1-I)+z*I)}else for(let y=0,_=0;y<s;y++,_+=4)g(0,_,y/(s-1));return h}et("AlphaImage",xc),et("RGBAImage",Bi);const Sf="big-fb";class p1 extends o{createBucket(t){return new $y(t)}constructor(t){super(t,d1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Sf)&&this.heatmapFbos.delete(Sf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Hy;var f1={get paint(){return Hy=Hy||new m({"hillshade-illumination-direction":new it(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(_e.paint_hillshade["hillshade-accent-color"])})}};class m1 extends o{constructor(t){super(t,f1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const g1=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:y1}=g1;function Wy(n,t,s=2){const a=t&&t.length,h=a?t[0]*s:n.length;let g=Xy(n,0,h,s,!0);const y=[];if(!g||g.next===g.prev)return y;let _,w,C;if(a&&(g=function(I,P,z,R){const B=[];for(let O=0,G=P.length;O<G;O++){const X=Xy(I,P[O]*R,O<G-1?P[O+1]*R:I.length,R,!1);X===X.next&&(X.steiner=!0),B.push(T1(X))}B.sort(b1);for(let O=0;O<B.length;O++)z=S1(B[O],z);return z}(n,t,g,s)),n.length>80*s){_=1/0,w=1/0;let I=-1/0,P=-1/0;for(let z=s;z<h;z+=s){const R=n[z],B=n[z+1];R<_&&(_=R),B<w&&(w=B),R>I&&(I=R),B>P&&(P=B)}C=Math.max(I-_,P-w),C=C!==0?32767/C:0}return wc(g,y,s,_,w,C,0),y}function Xy(n,t,s,a,h){let g;if(h===function(y,_,w,C){let I=0;for(let P=_,z=w-C;P<w;P+=C)I+=(y[z]-y[P])*(y[P+1]+y[z+1]),z=P;return I}(n,t,s,a)>0)for(let y=t;y<s;y+=a)g=Jy(y/a|0,n[y],n[y+1],g);else for(let y=s-a;y>=t;y-=a)g=Jy(y/a|0,n[y],n[y+1],g);return g&&ld(g,g.next)&&(Sc(g),g=g.next),g}function Qa(n,t){if(!n)return n;t||(t=n);let s,a=n;do if(s=!1,a.steiner||!ld(a,a.next)&&Nr(a.prev,a,a.next)!==0)a=a.next;else{if(Sc(a),a=t=a.prev,a===a.next)break;s=!0}while(s||a!==t);return t}function wc(n,t,s,a,h,g,y){if(!n)return;!y&&g&&function(w,C,I,P){let z=w;do z.z===0&&(z.z=kf(z.x,z.y,C,I,P)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==w);z.prevZ.nextZ=null,z.prevZ=null,function(R){let B,O=1;do{let G,X=R;R=null;let me=null;for(B=0;X;){B++;let ie=X,pe=0;for(let Ae=0;Ae<O&&(pe++,ie=ie.nextZ,ie);Ae++);let xe=O;for(;pe>0||xe>0&&ie;)pe!==0&&(xe===0||!ie||X.z<=ie.z)?(G=X,X=X.nextZ,pe--):(G=ie,ie=ie.nextZ,xe--),me?me.nextZ=G:R=G,G.prevZ=me,me=G;X=ie}me.nextZ=null,O*=2}while(B>1)}(z)}(n,a,h,g);let _=n;for(;n.prev!==n.next;){const w=n.prev,C=n.next;if(g?v1(n,a,h,g):_1(n))t.push(w.i,n.i,C.i),Sc(n),n=C.next,_=C.next;else if((n=C)===_){y?y===1?wc(n=x1(Qa(n),t),t,s,a,h,g,2):y===2&&w1(n,t,s,a,h,g):wc(Qa(n),t,s,a,h,g,1);break}}}function _1(n){const t=n.prev,s=n,a=n.next;if(Nr(t,s,a)>=0)return!1;const h=t.x,g=s.x,y=a.x,_=t.y,w=s.y,C=a.y,I=h<g?h<y?h:y:g<y?g:y,P=_<w?_<C?_:C:w<C?w:C,z=h>g?h>y?h:y:g>y?g:y,R=_>w?_>C?_:C:w>C?w:C;let B=a.next;for(;B!==t;){if(B.x>=I&&B.x<=z&&B.y>=P&&B.y<=R&&Xl(h,_,g,w,y,C,B.x,B.y)&&Nr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function v1(n,t,s,a){const h=n.prev,g=n,y=n.next;if(Nr(h,g,y)>=0)return!1;const _=h.x,w=g.x,C=y.x,I=h.y,P=g.y,z=y.y,R=_<w?_<C?_:C:w<C?w:C,B=I<P?I<z?I:z:P<z?P:z,O=_>w?_>C?_:C:w>C?w:C,G=I>P?I>z?I:z:P>z?P:z,X=kf(R,B,t,s,a),me=kf(O,G,t,s,a);let ie=n.prevZ,pe=n.nextZ;for(;ie&&ie.z>=X&&pe&&pe.z<=me;){if(ie.x>=R&&ie.x<=O&&ie.y>=B&&ie.y<=G&&ie!==h&&ie!==y&&Xl(_,I,w,P,C,z,ie.x,ie.y)&&Nr(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,pe.x>=R&&pe.x<=O&&pe.y>=B&&pe.y<=G&&pe!==h&&pe!==y&&Xl(_,I,w,P,C,z,pe.x,pe.y)&&Nr(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;ie&&ie.z>=X;){if(ie.x>=R&&ie.x<=O&&ie.y>=B&&ie.y<=G&&ie!==h&&ie!==y&&Xl(_,I,w,P,C,z,ie.x,ie.y)&&Nr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;pe&&pe.z<=me;){if(pe.x>=R&&pe.x<=O&&pe.y>=B&&pe.y<=G&&pe!==h&&pe!==y&&Xl(_,I,w,P,C,z,pe.x,pe.y)&&Nr(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function x1(n,t){let s=n;do{const a=s.prev,h=s.next.next;!ld(a,h)&&Ky(a,s,s.next,h)&&bc(a,h)&&bc(h,a)&&(t.push(a.i,s.i,h.i),Sc(s),Sc(s.next),s=n=h),s=s.next}while(s!==n);return Qa(s)}function w1(n,t,s,a,h,g){let y=n;do{let _=y.next.next;for(;_!==y.prev;){if(y.i!==_.i&&C1(y,_)){let w=Yy(y,_);return y=Qa(y,y.next),w=Qa(w,w.next),wc(y,t,s,a,h,g,0),void wc(w,t,s,a,h,g,0)}_=_.next}y=y.next}while(y!==n)}function b1(n,t){return n.x-t.x}function S1(n,t){const s=function(h,g){let y=g;const _=h.x,w=h.y;let C,I=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){const O=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(O<=_&&O>I&&(I=O,C=y.x<y.next.x?y:y.next,O===_))return C}y=y.next}while(y!==g);if(!C)return null;const P=C,z=C.x,R=C.y;let B=1/0;y=C;do{if(_>=y.x&&y.x>=z&&_!==y.x&&Xl(w<R?_:I,w,z,R,w<R?I:_,w,y.x,y.y)){const O=Math.abs(w-y.y)/(_-y.x);bc(y,h)&&(O<B||O===B&&(y.x>C.x||y.x===C.x&&k1(C,y)))&&(C=y,B=O)}y=y.next}while(y!==P);return C}(n,t);if(!s)return t;const a=Yy(s,n);return Qa(a,a.next),Qa(s,s.next)}function k1(n,t){return Nr(n.prev,n,t.prev)<0&&Nr(t.next,n,n.next)<0}function kf(n,t,s,a,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function T1(n){let t=n,s=n;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==n);return s}function Xl(n,t,s,a,h,g,y,_){return(h-y)*(t-_)>=(n-y)*(g-_)&&(n-y)*(a-_)>=(s-y)*(t-_)&&(s-y)*(g-_)>=(h-y)*(a-_)}function C1(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(s,a){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==a.i&&h.next.i!==a.i&&Ky(h,h.next,s,a))return!0;h=h.next}while(h!==s);return!1}(n,t)&&(bc(n,t)&&bc(t,n)&&function(s,a){let h=s,g=!1;const y=(s.x+a.x)/2,_=(s.y+a.y)/2;do h.y>_!=h.next.y>_&&h.next.y!==h.y&&y<(h.next.x-h.x)*(_-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==s);return g}(n,t)&&(Nr(n.prev,n,t.prev)||Nr(n,t.prev,t))||ld(n,t)&&Nr(n.prev,n,n.next)>0&&Nr(t.prev,t,t.next)>0)}function Nr(n,t,s){return(t.y-n.y)*(s.x-t.x)-(t.x-n.x)*(s.y-t.y)}function ld(n,t){return n.x===t.x&&n.y===t.y}function Ky(n,t,s,a){const h=cd(Nr(n,t,s)),g=cd(Nr(n,t,a)),y=cd(Nr(s,a,n)),_=cd(Nr(s,a,t));return h!==g&&y!==_||!(h!==0||!ud(n,s,t))||!(g!==0||!ud(n,a,t))||!(y!==0||!ud(s,n,a))||!(_!==0||!ud(s,t,a))}function ud(n,t,s){return t.x<=Math.max(n.x,s.x)&&t.x>=Math.min(n.x,s.x)&&t.y<=Math.max(n.y,s.y)&&t.y>=Math.min(n.y,s.y)}function cd(n){return n>0?1:n<0?-1:0}function bc(n,t){return Nr(n.prev,n,n.next)<0?Nr(n,t,n.next)>=0&&Nr(n,n.prev,t)>=0:Nr(n,t,n.prev)<0||Nr(n,n.next,t)<0}function Yy(n,t){const s=Tf(n.i,n.x,n.y),a=Tf(t.i,t.x,t.y),h=n.next,g=t.prev;return n.next=t,t.prev=n,s.next=h,h.prev=s,a.next=s,s.prev=a,g.next=a,a.prev=g,a}function Jy(n,t,s,a){const h=Tf(n,t,s);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Sc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Tf(n,t,s){return{i:n,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Cf(n,t,s){const a=s.patternDependencies;let h=!1;for(const g of t){const y=g.paint.get(`${n}-pattern`);y.isConstant()||(h=!0);const _=y.constantOr(null);_&&(h=!0,a[_.to]=!0,a[_.from]=!0)}return h}function If(n,t,s,a,h){const g=h.patternDependencies;for(const y of t){const _=y.paint.get(`${n}-pattern`).value;if(_.kind!=="constant"){let w=_.evaluate({zoom:a-1},s,{},h.availableImages),C=_.evaluate({zoom:a},s,{},h.availableImages),I=_.evaluate({zoom:a+1},s,{},h.availableImages);w=w&&w.name?w.name:w,C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,g[w]=!0,g[C]=!0,g[I]=!0,s.patterns[y.id]={min:w,mid:C,max:I}}}return s}class Ef{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new es,this.indexArray=new Fi,this.indexArray2=new cn,this.programConfigurations=new Ka(t.layers,t.zoom),this.segments=new Ht,this.segments2=new Ht,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.hasPattern=Cf("fill",this.layers,s);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(const{feature:_,id:w,index:C,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,z=Ja(_,P);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom),z,a))continue;const R=g?h.evaluate(z,{},a,s.availableImages):void 0,B={id:w,properties:_.properties,type:_.type,sourceLayerIndex:I,index:C,geometry:P?z.geometry:Ya(_),patterns:{},sortKey:R};y.push(B)}g&&y.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of y){const{geometry:w,index:C,sourceLayerIndex:I}=_;if(this.hasPattern){const P=If("fill",this.layers,_,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(_,w,C,a,{});s.featureIndex.insert(t[C].feature,w,C,I,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}addFeatures(t,s,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,y1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,a,h,g){for(const y of vl(s,500)){let _=0;for(const R of y)_+=R.length;const w=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),C=w.vertexLength,I=[],P=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&P.push(I.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),O=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(O+R.length-1,O),I.push(R[0].x),I.push(R[0].y);for(let G=1;G<R.length;G++)this.layoutVertexArray.emplaceBack(R[G].x,R[G].y),this.indexArray2.emplaceBack(O+G-1,O+G),I.push(R[G].x),I.push(R[G].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const z=Wy(I,P);for(let R=0;R<z.length;R+=3)this.indexArray.emplaceBack(C+z[R],C+z[R+1],C+z[R+2]);w.vertexLength+=_,w.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}let Qy,e_;et("FillBucket",Ef,{omit:["layers","patternFeatures"]});var I1={get paint(){return e_=e_||new m({"fill-antialias":new it(_e.paint_fill["fill-antialias"]),"fill-opacity":new vt(_e.paint_fill["fill-opacity"]),"fill-color":new vt(_e.paint_fill["fill-color"]),"fill-outline-color":new vt(_e.paint_fill["fill-outline-color"]),"fill-translate":new it(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new it(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nl(_e.paint_fill["fill-pattern"])})},get layout(){return Qy=Qy||new m({"fill-sort-key":new vt(_e.layout_fill["fill-sort-key"])})}};class E1 extends o{constructor(t){super(t,I1)}recalculate(t,s){super.recalculate(t,s);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ef(t)}queryRadius(){return sd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,a,h,g,y,_){return Fy(od(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,_),h)}isTileClipped(){return!0}}const P1=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),A1=x([{name:"a_centroid",components:2,type:"Int16"}],4),{members:M1}=P1;var ta={},z1=se,t_=Kl;function Kl(n,t,s,a,h){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=h,n.readFields(D1,this,t)}function D1(n,t,s){n==1?t.id=s.readVarint():n==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var y=h._keys[a.readVarint()],_=h._values[a.readVarint()];h.properties[y]=_}}(s,t):n==3?t.type=s.readVarint():n==4&&(t._geometry=s.pos)}function L1(n){for(var t,s,a=0,h=0,g=n.length,y=g-1;h<g;y=h++)a+=((s=n[y]).x-(t=n[h]).x)*(t.y+s.y);return a}Kl.types=["Unknown","Point","LineString","Polygon"],Kl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,s=n.readVarint()+n.pos,a=1,h=0,g=0,y=0,_=[];n.pos<s;){if(h<=0){var w=n.readVarint();a=7&w,h=w>>3}if(h--,a===1||a===2)g+=n.readSVarint(),y+=n.readSVarint(),a===1&&(t&&_.push(t),t=[]),t.push(new z1(g,y));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&_.push(t),_},Kl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,s=1,a=0,h=0,g=0,y=1/0,_=-1/0,w=1/0,C=-1/0;n.pos<t;){if(a<=0){var I=n.readVarint();s=7&I,a=I>>3}if(a--,s===1||s===2)(h+=n.readSVarint())<y&&(y=h),h>_&&(_=h),(g+=n.readSVarint())<w&&(w=g),g>C&&(C=g);else if(s!==7)throw new Error("unknown command "+s)}return[y,w,_,C]},Kl.prototype.toGeoJSON=function(n,t,s){var a,h,g=this.extent*Math.pow(2,s),y=this.extent*n,_=this.extent*t,w=this.loadGeometry(),C=Kl.types[this.type];function I(R){for(var B=0;B<R.length;B++){var O=R[B];R[B]=[360*(O.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+_)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<w.length;a++)P[a]=w[a][0];I(w=P);break;case 2:for(a=0;a<w.length;a++)I(w[a]);break;case 3:for(w=function(R){var B=R.length;if(B<=1)return[R];for(var O,G,X=[],me=0;me<B;me++){var ie=L1(R[me]);ie!==0&&(G===void 0&&(G=ie<0),G===ie<0?(O&&X.push(O),O=[R[me]]):O.push(R[me]))}return O&&X.push(O),X}(w),a=0;a<w.length;a++)for(h=0;h<w[a].length;h++)I(w[a][h])}w.length===1?w=w[0]:C="Multi"+C;var z={type:"Feature",geometry:{type:C,coordinates:w},properties:this.properties};return"id"in this&&(z.id=this.id),z};var R1=t_,r_=n_;function n_(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(F1,this,t),this.length=this._features.length}function F1(n,t,s){n===15?t.version=s.readVarint():n===1?t.name=s.readString():n===5?t.extent=s.readVarint():n===2?t._features.push(s.pos):n===3?t._keys.push(s.readString()):n===4&&t._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(s))}n_.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new R1(this._pbf,t,this.extent,this._keys,this._values)};var B1=r_;function O1(n,t,s){if(n===3){var a=new B1(s,s.readVarint()+s.pos);a.length&&(t[a.name]=a)}}ta.VectorTile=function(n,t){this.layers=n.readFields(O1,{},t)},ta.VectorTileFeature=t_,ta.VectorTileLayer=r_;const N1=ta.VectorTileFeature.types,Pf=Math.pow(2,13);function kc(n,t,s,a,h,g,y,_){n.emplaceBack(t,s,2*Math.floor(a*Pf)+y,h*Pf*2,g*Pf*2,Math.round(_))}class Af{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Xo,this.centroidVertexArray=new bn,this.indexArray=new Fi,this.programConfigurations=new Ka(t.layers,t.zoom),this.segments=new Ht,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.features=[],this.hasPattern=Cf("fill-extrusion",this.layers,s);for(const{feature:h,id:g,index:y,sourceLayerIndex:_}of t){const w=this.layers[0]._featureFilter.needGeometry,C=Ja(h,w);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom),C,a))continue;const I={id:g,sourceLayerIndex:_,index:y,geometry:w?C.geometry:Ya(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(If("fill-extrusion",this.layers,I,this.zoom,s)):this.addFeature(I,I.geometry,y,a,{}),s.featureIndex.insert(h,I.geometry,y,_,this.index,!0)}}addFeatures(t,s,a){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,s,a)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,M1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,A1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,a,h,g){for(const y of vl(s,500)){const _={x:0,y:0,vertexCount:0};let w=0;for(const B of y)w+=B.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of y){if(B.length===0||V1(B))continue;let O=0;for(let G=0;G<B.length;G++){const X=B[G];if(G>=1){const me=B[G-1];if(!j1(X,me)){C.vertexLength+4>Ht.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=X.sub(me)._perp()._unit(),pe=me.dist(X);O+pe>32768&&(O=0),kc(this.layoutVertexArray,X.x,X.y,ie.x,ie.y,0,0,O),kc(this.layoutVertexArray,X.x,X.y,ie.x,ie.y,0,1,O),_.x+=2*X.x,_.y+=2*X.y,_.vertexCount+=2,O+=pe,kc(this.layoutVertexArray,me.x,me.y,ie.x,ie.y,0,0,O),kc(this.layoutVertexArray,me.x,me.y,ie.x,ie.y,0,1,O),_.x+=2*me.x,_.y+=2*me.y,_.vertexCount+=2;const xe=C.vertexLength;this.indexArray.emplaceBack(xe,xe+2,xe+1),this.indexArray.emplaceBack(xe+1,xe+2,xe+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+w>Ht.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),N1[t.type]!=="Polygon")continue;const I=[],P=[],z=C.vertexLength;for(const B of y)if(B.length!==0){B!==y[0]&&P.push(I.length/2);for(let O=0;O<B.length;O++){const G=B[O];kc(this.layoutVertexArray,G.x,G.y,0,0,1,1,0),_.x+=G.x,_.y+=G.y,_.vertexCount+=1,I.push(G.x),I.push(G.y)}}const R=Wy(I,P);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(z+R[B],z+R[B+2],z+R[B+1]);C.primitiveLength+=R.length/3,C.vertexLength+=w;for(let B=0;B<_.vertexCount;B++){const O=Math.floor(_.x/_.vertexCount),G=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(O,G)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}function j1(n,t){return n.x===t.x&&(n.x<0||n.x>Zr)||n.y===t.y&&(n.y<0||n.y>Zr)}function V1(n){return n.every(t=>t.x<0)||n.every(t=>t.x>Zr)||n.every(t=>t.y<0)||n.every(t=>t.y>Zr)}let i_;et("FillExtrusionBucket",Af,{omit:["layers","features"]});var U1={get paint(){return i_=i_||new m({"fill-extrusion-opacity":new it(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vt(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nl(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vt(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vt(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class $1 extends o{constructor(t){super(t,U1)}createBucket(t){return new Af(t)}queryRadius(){return sd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,a,h,g,y,_,w){const C=od(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,_),I=this.paint.get("fill-extrusion-height").evaluate(s,a),P=this.paint.get("fill-extrusion-base").evaluate(s,a),z=function(B,O,G,X){const me=[];for(const ie of B){const pe=[ie.x,ie.y,0,1];ad(pe,pe,O),me.push(new Q(pe[0]/pe[3],pe[1]/pe[3]))}return me}(C,w),R=function(B,O,G,X){const me=[],ie=[],pe=X[8]*O,xe=X[9]*O,Ae=X[10]*O,Xe=X[11]*O,mt=X[8]*G,Ge=X[9]*G,$e=X[10]*G,at=X[11]*G;for(const tt of B){const Qe=[],we=[];for(const ut of tt){const ot=ut.x,Ct=ut.y,pr=X[0]*ot+X[4]*Ct+X[12],ur=X[1]*ot+X[5]*Ct+X[13],rn=X[2]*ot+X[6]*Ct+X[14],ts=X[3]*ot+X[7]*Ct+X[15],Tn=rn+Ae,nn=ts+Xe,Gn=pr+mt,Hn=ur+Ge,Wn=rn+$e,Br=ts+at,sn=new Q((pr+pe)/nn,(ur+xe)/nn);sn.z=Tn/nn,Qe.push(sn);const Ln=new Q(Gn/Br,Hn/Br);Ln.z=Wn/Br,we.push(Ln)}me.push(Qe),ie.push(we)}return[me,ie]}(h,P,I,w);return function(B,O,G){let X=1/0;Fy(G,O)&&(X=s_(G,O[0]));for(let me=0;me<O.length;me++){const ie=O[me],pe=B[me];for(let xe=0;xe<ie.length-1;xe++){const Ae=ie[xe],Xe=[Ae,ie[xe+1],pe[xe+1],pe[xe],Ae];Ry(G,Xe)&&(X=Math.min(X,s_(G,Xe)))}}return X!==1/0&&X}(R[0],R[1],z)}}function Tc(n,t){return n.x*t.x+n.y*t.y}function s_(n,t){if(n.length===1){let s=0;const a=t[s++];let h;for(;!h||a.equals(h);)if(h=t[s++],!h)return 1/0;for(;s<t.length;s++){const g=t[s],y=n[0],_=h.sub(a),w=g.sub(a),C=y.sub(a),I=Tc(_,_),P=Tc(_,w),z=Tc(w,w),R=Tc(C,_),B=Tc(C,w),O=I*z-P*P,G=(z*R-P*B)/O,X=(I*B-P*R)/O,me=a.z*(1-G-X)+h.z*G+g.z*X;if(isFinite(me))return me}return 1/0}{let s=1/0;for(const a of t)s=Math.min(s,a.z);return s}}const q1=x([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Z1}=q1,G1=x([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:H1}=G1,W1=ta.VectorTileFeature.types,X1=Math.cos(Math.PI/180*37.5),o_=Math.pow(2,14)/.5;class Mf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Vl,this.layoutVertexArray2=new Ko,this.indexArray=new Fi,this.programConfigurations=new Ka(t.layers,t.zoom),this.segments=new Ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.hasPattern=Cf("line",this.layers,s);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(const{feature:_,id:w,index:C,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,z=Ja(_,P);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom),z,a))continue;const R=g?h.evaluate(z,{},a):void 0,B={id:w,properties:_.properties,type:_.type,sourceLayerIndex:I,index:C,geometry:P?z.geometry:Ya(_),patterns:{},sortKey:R};y.push(B)}g&&y.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of y){const{geometry:w,index:C,sourceLayerIndex:I}=_;if(this.hasPattern){const P=If("line",this.layers,_,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(_,w,C,a,{});s.featureIndex.insert(t[C].feature,w,C,I,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}addFeatures(t,s,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,H1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Z1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,a,h,g){const y=this.layers[0].layout,_=y.get("line-join").evaluate(t,{}),w=y.get("line-cap"),C=y.get("line-miter-limit"),I=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of s)this.addLine(P,t,_,w,C,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}addLine(t,s,a,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=W1[s.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let C=0;for(;C<w-1&&t[C].equals(t[C+1]);)C++;if(w<(_?3:2))return;a==="bevel"&&(g=1.05);const I=this.overscaling<=16?15*Zr/(512*this.overscaling):0,P=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let z,R,B,O,G;this.e1=this.e2=-1,_&&(z=t[w-2],G=t[C].sub(z)._unit()._perp());for(let X=C;X<w;X++){if(B=X===w-1?_?t[C+1]:void 0:t[X+1],B&&t[X].equals(B))continue;G&&(O=G),z&&(R=z),z=t[X],G=B?B.sub(z)._unit()._perp():O,O=O||G;let me=O.add(G);me.x===0&&me.y===0||me._unit();const ie=O.x*G.x+O.y*G.y,pe=me.x*G.x+me.y*G.y,xe=pe!==0?1/pe:1/0,Ae=2*Math.sqrt(2-2*pe),Xe=pe<X1&&R&&B,mt=O.x*G.y-O.y*G.x>0;if(Xe&&X>C){const at=z.dist(R);if(at>2*I){const tt=z.sub(z.sub(R)._mult(I/at)._round());this.updateDistance(R,tt),this.addCurrentVertex(tt,O,0,0,P),R=tt}}const Ge=R&&B;let $e=Ge?a:_?"butt":h;if(Ge&&$e==="round"&&(xe<y?$e="miter":xe<=2&&($e="fakeround")),$e==="miter"&&xe>g&&($e="bevel"),$e==="bevel"&&(xe>2&&($e="flipbevel"),xe<g&&($e="miter")),R&&this.updateDistance(R,z),$e==="miter")me._mult(xe),this.addCurrentVertex(z,me,0,0,P);else if($e==="flipbevel"){if(xe>100)me=G.mult(-1);else{const at=xe*O.add(G).mag()/O.sub(G).mag();me._perp()._mult(at*(mt?-1:1))}this.addCurrentVertex(z,me,0,0,P),this.addCurrentVertex(z,me.mult(-1),0,0,P)}else if($e==="bevel"||$e==="fakeround"){const at=-Math.sqrt(xe*xe-1),tt=mt?at:0,Qe=mt?0:at;if(R&&this.addCurrentVertex(z,O,tt,Qe,P),$e==="fakeround"){const we=Math.round(180*Ae/Math.PI/20);for(let ut=1;ut<we;ut++){let ot=ut/we;if(ot!==.5){const pr=ot-.5;ot+=ot*pr*(ot-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*pr*pr+(.848013+ie*(.215638*ie-1.06021)))}const Ct=G.sub(O)._mult(ot)._add(O)._unit()._mult(mt?-1:1);this.addHalfVertex(z,Ct.x,Ct.y,!1,mt,0,P)}}B&&this.addCurrentVertex(z,G,-tt,-Qe,P)}else if($e==="butt")this.addCurrentVertex(z,me,0,0,P);else if($e==="square"){const at=R?1:-1;this.addCurrentVertex(z,me,at,at,P)}else $e==="round"&&(R&&(this.addCurrentVertex(z,O,0,0,P),this.addCurrentVertex(z,O,1,1,P,!0)),B&&(this.addCurrentVertex(z,G,-1,-1,P,!0),this.addCurrentVertex(z,G,0,0,P)));if(Xe&&X<w-1){const at=z.dist(B);if(at>2*I){const tt=z.add(B.sub(z)._mult(I/at)._round());this.updateDistance(z,tt),this.addCurrentVertex(tt,G,0,0,P),z=tt}}}}addCurrentVertex(t,s,a,h,g,y=!1){const _=s.y*h-s.x,w=-s.y-s.x*h;this.addHalfVertex(t,s.x+s.y*a,s.y-s.x*a,y,!1,a,g),this.addHalfVertex(t,_,w,y,!0,-h,g),this.distance>o_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,a,h,g,y))}addHalfVertex({x:t,y:s},a,h,g,y,_,w){const C=.5*(this.lineClips?this.scaledDistance*(o_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(s<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(_===0?0:_<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),w.primitiveLength++),y?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let a_,l_;et("LineBucket",Mf,{omit:["layers","patternFeatures"]});var u_={get paint(){return l_=l_||new m({"line-opacity":new vt(_e.paint_line["line-opacity"]),"line-color":new vt(_e.paint_line["line-color"]),"line-translate":new it(_e.paint_line["line-translate"]),"line-translate-anchor":new it(_e.paint_line["line-translate-anchor"]),"line-width":new vt(_e.paint_line["line-width"]),"line-gap-width":new vt(_e.paint_line["line-gap-width"]),"line-offset":new vt(_e.paint_line["line-offset"]),"line-blur":new vt(_e.paint_line["line-blur"]),"line-dasharray":new jl(_e.paint_line["line-dasharray"]),"line-pattern":new Nl(_e.paint_line["line-pattern"]),"line-gradient":new mc(_e.paint_line["line-gradient"])})},get layout(){return a_=a_||new m({"line-cap":new it(_e.layout_line["line-cap"]),"line-join":new vt(_e.layout_line["line-join"]),"line-miter-limit":new it(_e.layout_line["line-miter-limit"]),"line-round-limit":new it(_e.layout_line["line-round-limit"]),"line-sort-key":new vt(_e.layout_line["line-sort-key"])})}};class K1 extends vt{possiblyEvaluate(t,s){return s=new vr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,a,h){return s=qe({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,a,h)}}let hd;class Y1 extends o{constructor(t){super(t,u_),this.gradientVersion=0,hd||(hd=new K1(u_.paint.properties["line-width"].specification),hd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof Rs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=hd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Mf(t)}queryRadius(t){const s=t,a=c_(_c("line-width",this,s),_c("line-gap-width",this,s)),h=_c("line-offset",this,s);return a/2+Math.abs(h)+sd(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,a,h,g,y,_){const w=od(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,_),C=_/2*c_(this.paint.get("line-width").evaluate(s,a),this.paint.get("line-gap-width").evaluate(s,a)),I=this.paint.get("line-offset").evaluate(s,a);return I&&(h=function(P,z){const R=[];for(let B=0;B<P.length;B++){const O=P[B],G=[];for(let X=0;X<O.length;X++){const me=O[X-1],ie=O[X],pe=O[X+1],xe=X===0?new Q(0,0):ie.sub(me)._unit()._perp(),Ae=X===O.length-1?new Q(0,0):pe.sub(ie)._unit()._perp(),Xe=xe._add(Ae)._unit(),mt=Xe.x*Ae.x+Xe.y*Ae.y;mt!==0&&Xe._mult(1/mt),G.push(Xe._mult(z)._add(ie))}R.push(G)}return R}(h,I*_)),function(P,z,R){for(let B=0;B<z.length;B++){const O=z[B];if(P.length>=3){for(let G=0;G<O.length;G++)if(Hl(P,O[G]))return!0}if(o1(P,O,R))return!0}return!1}(w,h,C)}isTileClipped(){return!0}}function c_(n,t){return t>0?t+2*n:n}const J1=x([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q1=x([{name:"a_projected_pos",components:3,type:"Float32"}],4);x([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eb=x([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);x([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const h_=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tb=x([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function rb(n,t,s){return n.sections.forEach(a=>{a.text=function(h,g,y){const _=g.layout.get("text-transform").evaluate(y,{});return _==="uppercase"?h=h.toLocaleUpperCase():_==="lowercase"&&(h=h.toLocaleLowerCase()),si.applyArabicShaping&&(h=si.applyArabicShaping(h)),h}(a.text,t,s)}),n}x([{name:"triangle",components:3,type:"Uint16"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),x([{type:"Float32",name:"offsetX"}]),x([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),x([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Cc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Wr=24,d_=lr,p_=function(n,t,s,a,h){var g,y,_=8*h-a-1,w=(1<<_)-1,C=w>>1,I=-7,P=h-1,z=-1,R=n[t+P];for(P+=z,g=R&(1<<-I)-1,R>>=-I,I+=_;I>0;g=256*g+n[t+P],P+=z,I-=8);for(y=g&(1<<-I)-1,g>>=-I,I+=a;I>0;y=256*y+n[t+P],P+=z,I-=8);if(g===0)g=1-C;else{if(g===w)return y?NaN:1/0*(R?-1:1);y+=Math.pow(2,a),g-=C}return(R?-1:1)*y*Math.pow(2,g-a)},f_=function(n,t,s,a,h,g){var y,_,w,C=8*g-h-1,I=(1<<C)-1,P=I>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,B=1,O=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,y=I):(y=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-y))<1&&(y--,w*=2),(t+=y+P>=1?z/w:z*Math.pow(2,1-P))*w>=2&&(y++,w/=2),y+P>=I?(_=0,y=I):y+P>=1?(_=(t*w-1)*Math.pow(2,h),y+=P):(_=t*Math.pow(2,P-1)*Math.pow(2,h),y=0));h>=8;n[s+R]=255&_,R+=B,_/=256,h-=8);for(y=y<<h|_,C+=h;C>0;n[s+R]=255&y,R+=B,y/=256,C-=8);n[s+R-B]|=128*O};function lr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}lr.Varint=0,lr.Fixed64=1,lr.Bytes=2,lr.Fixed32=5;var zf=4294967296,m_=1/zf,g_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function co(n){return n.type===lr.Bytes?n.readVarint()+n.pos:n.pos+1}function Yl(n,t,s){return s?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function y_(n,t,s){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(a);for(var h=s.pos-1;h>=n;h--)s.buf[h+a]=s.buf[h]}function nb(n,t){for(var s=0;s<n.length;s++)t.writeVarint(n[s])}function ib(n,t){for(var s=0;s<n.length;s++)t.writeSVarint(n[s])}function sb(n,t){for(var s=0;s<n.length;s++)t.writeFloat(n[s])}function ob(n,t){for(var s=0;s<n.length;s++)t.writeDouble(n[s])}function ab(n,t){for(var s=0;s<n.length;s++)t.writeBoolean(n[s])}function lb(n,t){for(var s=0;s<n.length;s++)t.writeFixed32(n[s])}function ub(n,t){for(var s=0;s<n.length;s++)t.writeSFixed32(n[s])}function cb(n,t){for(var s=0;s<n.length;s++)t.writeFixed64(n[s])}function hb(n,t){for(var s=0;s<n.length;s++)t.writeSFixed64(n[s])}function dd(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Jl(n,t,s){n[s]=t,n[s+1]=t>>>8,n[s+2]=t>>>16,n[s+3]=t>>>24}function __(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}lr.prototype={destroy:function(){this.buf=null},readFields:function(n,t,s){for(s=s||this.length;this.pos<s;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,n(h,t,this),this.pos===g&&this.skip(a)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=dd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=__(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=dd(this.buf,this.pos)+dd(this.buf,this.pos+4)*zf;return this.pos+=8,n},readSFixed64:function(){var n=dd(this.buf,this.pos)+__(this.buf,this.pos+4)*zf;return this.pos+=8,n},readFloat:function(){var n=p_(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=p_(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,s,a=this.buf;return t=127&(s=a[this.pos++]),s<128?t:(t|=(127&(s=a[this.pos++]))<<7,s<128?t:(t|=(127&(s=a[this.pos++]))<<14,s<128?t:(t|=(127&(s=a[this.pos++]))<<21,s<128?t:function(h,g,y){var _,w,C=y.buf;if(_=(112&(w=C[y.pos++]))>>4,w<128||(_|=(127&(w=C[y.pos++]))<<3,w<128)||(_|=(127&(w=C[y.pos++]))<<10,w<128)||(_|=(127&(w=C[y.pos++]))<<17,w<128)||(_|=(127&(w=C[y.pos++]))<<24,w<128)||(_|=(1&(w=C[y.pos++]))<<31,w<128))return Yl(h,_,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&g_?function(s,a,h){return g_.decode(s.subarray(a,h))}(this.buf,t,n):function(s,a,h){for(var g="",y=a;y<h;){var _,w,C,I=s[y],P=null,z=I>239?4:I>223?3:I>191?2:1;if(y+z>h)break;z===1?I<128&&(P=I):z===2?(192&(_=s[y+1]))==128&&(P=(31&I)<<6|63&_)<=127&&(P=null):z===3?(w=s[y+2],(192&(_=s[y+1]))==128&&(192&w)==128&&((P=(15&I)<<12|(63&_)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):z===4&&(w=s[y+2],C=s[y+3],(192&(_=s[y+1]))==128&&(192&w)==128&&(192&C)==128&&((P=(15&I)<<18|(63&_)<<12|(63&w)<<6|63&C)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,z=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),y+=z}return g}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==lr.Bytes)return n.push(this.readVarint(t));var s=co(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==lr.Bytes)return n.push(this.readSVarint());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==lr.Bytes)return n.push(this.readBoolean());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==lr.Bytes)return n.push(this.readFloat());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==lr.Bytes)return n.push(this.readDouble());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==lr.Bytes)return n.push(this.readFixed32());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==lr.Bytes)return n.push(this.readSFixed32());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==lr.Bytes)return n.push(this.readFixed64());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==lr.Bytes)return n.push(this.readSFixed64());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===lr.Varint)for(;this.buf[this.pos++]>127;);else if(t===lr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===lr.Fixed32)this.pos+=4;else{if(t!==lr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Jl(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Jl(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Jl(this.buf,-1&n,this.pos),Jl(this.buf,Math.floor(n*m_),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Jl(this.buf,-1&n,this.pos),Jl(this.buf,Math.floor(n*m_),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,s){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,y,_){_.buf[_.pos++]=127&g|128,g>>>=7,_.buf[_.pos++]=127&g|128,g>>>=7,_.buf[_.pos++]=127&g|128,g>>>=7,_.buf[_.pos++]=127&g|128,_.buf[_.pos]=127&(g>>>=7)}(a,0,s),function(g,y){var _=(7&g)<<4;y.buf[y.pos++]|=_|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(a,h,g){for(var y,_,w=0;w<h.length;w++){if((y=h.charCodeAt(w))>55295&&y<57344){if(!_){y>56319||w+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):_=y;continue}if(y<56320){a[g++]=239,a[g++]=191,a[g++]=189,_=y;continue}y=_-55296<<10|y-56320|65536,_=null}else _&&(a[g++]=239,a[g++]=191,a[g++]=189,_=null);y<128?a[g++]=y:(y<2048?a[g++]=y>>6|192:(y<65536?a[g++]=y>>12|224:(a[g++]=y>>18|240,a[g++]=y>>12&63|128),a[g++]=y>>6&63|128),a[g++]=63&y|128)}return g}(this.buf,n,this.pos);var s=this.pos-t;s>=128&&y_(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),f_(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),f_(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,t){this.pos++;var s=this.pos;n(t,this);var a=this.pos-s;a>=128&&y_(s,a,this),this.pos=s-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,t,s){this.writeTag(n,lr.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,nb,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,ib,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,ab,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,sb,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,ob,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,lb,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,ub,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,cb,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,hb,t)},writeBytesField:function(n,t){this.writeTag(n,lr.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,lr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,lr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,lr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,lr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,lr.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,lr.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,lr.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,lr.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,lr.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var Df=V(d_);const Lf=3;function db(n,t,s){n===1&&s.readMessage(pb,t)}function pb(n,t,s){if(n===3){const{id:a,bitmap:h,width:g,height:y,left:_,top:w,advance:C}=s.readMessage(fb,{});t.push({id:a,bitmap:new xc({width:g+2*Lf,height:y+2*Lf},h),metrics:{width:g,height:y,left:_,top:w,advance:C}})}}function fb(n,t,s){n===1?t.id=s.readVarint():n===2?t.bitmap=s.readBytes():n===3?t.width=s.readVarint():n===4?t.height=s.readVarint():n===5?t.left=s.readSVarint():n===6?t.top=s.readSVarint():n===7&&(t.advance=s.readVarint())}const v_=Lf;function x_(n){let t=0,s=0;for(const y of n)t+=y.w*y.h,s=Math.max(s,y.w);n.sort((y,_)=>_.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let h=0,g=0;for(const y of n)for(let _=a.length-1;_>=0;_--){const w=a[_];if(!(y.w>w.w||y.h>w.h)){if(y.x=w.x,y.y=w.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===w.w&&y.h===w.h){const C=a.pop();_<a.length&&(a[_]=C)}else y.h===w.h?(w.x+=y.w,w.w-=y.w):y.w===w.w?(w.y+=y.h,w.h-=y.h):(a.push({x:w.x+y.w,y:w.y,w:w.w-y.w,h:y.h}),w.y+=y.h,w.h-=y.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}const ai=1;class Rf{constructor(t,{pixelRatio:s,version:a,stretchX:h,stretchY:g,content:y,textFitWidth:_,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=h,this.stretchY=g,this.content=y,this.version=a,this.textFitWidth=_,this.textFitHeight=w}get tl(){return[this.paddedRect.x+ai,this.paddedRect.y+ai]}get br(){return[this.paddedRect.x+this.paddedRect.w-ai,this.paddedRect.y+this.paddedRect.h-ai]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ai)/this.pixelRatio,(this.paddedRect.h-2*ai)/this.pixelRatio]}}class w_{constructor(t,s){const a={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,a,g),this.addImages(s,h,g);const{w:y,h:_}=x_(g),w=new Bi({width:y||1,height:_||1});for(const C in t){const I=t[C],P=a[C].paddedRect;Bi.copy(I.data,w,{x:0,y:0},{x:P.x+ai,y:P.y+ai},I.data)}for(const C in s){const I=s[C],P=h[C].paddedRect,z=P.x+ai,R=P.y+ai,B=I.data.width,O=I.data.height;Bi.copy(I.data,w,{x:0,y:0},{x:z,y:R},I.data),Bi.copy(I.data,w,{x:0,y:O-1},{x:z,y:R-1},{width:B,height:1}),Bi.copy(I.data,w,{x:0,y:0},{x:z,y:R+O},{width:B,height:1}),Bi.copy(I.data,w,{x:B-1,y:0},{x:z-1,y:R},{width:1,height:O}),Bi.copy(I.data,w,{x:0,y:0},{x:z+B,y:R},{width:1,height:O})}this.image=w,this.iconPositions=a,this.patternPositions=h}addImages(t,s,a){for(const h in t){const g=t[h],y={x:0,y:0,w:g.data.width+2*ai,h:g.data.height+2*ai};a.push(y),s[h]=new Rf(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),s),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),s)}patchUpdatedImage(t,s,a){if(!t||!s||t.version===s.version)return;t.version=s.version;const[h,g]=t.tl;a.update(s.data,void 0,{x:h,y:g})}}var ra;et("ImagePosition",Rf),et("ImageAtlas",w_),S.ah=void 0,(ra=S.ah||(S.ah={}))[ra.none=0]="none",ra[ra.horizontal=1]="horizontal",ra[ra.vertical=2]="vertical",ra[ra.horizontalOnly=3]="horizontalOnly";const Ic=-17;class Ec{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const a=new Ec;return a.scale=t||1,a.fontStack=s,a}static forImage(t){const s=new Ec;return s.imageName=t,s}}class Ql{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const a=new Ql;for(let h=0;h<t.sections.length;h++){const g=t.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,s)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let a=0;a<t.length;a++){const h=t.charCodeAt(a+1)||null,g=t.charCodeAt(a-1)||null;s+=h&&Jh(h)&&!Cc[t[a+1]]||g&&Jh(g)&&!Cc[t[a-1]]||!Cc[t[a]]?t[a]:Cc[t[a]]}return s}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&fd[this.text.charCodeAt(a)];a++)t++;let s=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&fd[this.text.charCodeAt(a)];a--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const a=new Ql;return a.text=this.text.substring(t,s),a.sectionIndex=this.sectionIndex.slice(t,s),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Ec.forText(t.scale,t.fontStack||s));const a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void yt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Ec.forImage(s)),this.sectionIndex.push(this.sections.length-1)):yt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pd(n,t,s,a,h,g,y,_,w,C,I,P,z,R,B){const O=Ql.fromFeature(n,h);let G;P===S.ah.vertical&&O.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:me}=si;if(X&&O.sections.length===1){G=[];const xe=X(O.toString(),Ff(O,C,g,t,a,R));for(const Ae of xe){const Xe=new Ql;Xe.text=Ae,Xe.sections=O.sections;for(let mt=0;mt<Ae.length;mt++)Xe.sectionIndex.push(0);G.push(Xe)}}else if(me){G=[];const xe=me(O.text,O.sectionIndex,Ff(O,C,g,t,a,R));for(const Ae of xe){const Xe=new Ql;Xe.text=Ae[0],Xe.sectionIndex=Ae[1],Xe.sections=O.sections,G.push(Xe)}}else G=function(xe,Ae){const Xe=[],mt=xe.text;let Ge=0;for(const $e of Ae)Xe.push(xe.substring(Ge,$e)),Ge=$e;return Ge<mt.length&&Xe.push(xe.substring(Ge,mt.length)),Xe}(O,Ff(O,C,g,t,a,R));const ie=[],pe={positionedLines:ie,text:O.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(xe,Ae,Xe,mt,Ge,$e,at,tt,Qe,we,ut,ot){let Ct=0,pr=Ic,ur=0,rn=0;const ts=tt==="right"?1:tt==="left"?0:.5;let Tn=0;for(const Br of Ge){Br.trim();const sn=Br.getMaxScale(),Ln=(sn-1)*Wr,Cn={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Tn]=Cn;const Xn=Cn.positionedGlyphs;let In=0;if(!Br.length()){pr+=$e,++Tn;continue}for(let li=0;li<Br.length();li++){const Qt=Br.getSection(li),yr=Br.getSectionIndex(li),Sr=Br.getCharCode(li);let bi=0,Pr=null,nu=null,Ns=null,js=Wr;const rs=!(Qe===S.ah.horizontal||!ut&&!pc(Sr)||ut&&(fd[Sr]||(nn=Sr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(nn)))));if(Qt.imageName){const ji=mt[Qt.imageName];if(!ji)continue;Ns=Qt.imageName,xe.iconsInText=xe.iconsInText||!0,nu=ji.paddedRect;const hn=ji.displaySize;Qt.scale=Qt.scale*Wr/ot,Pr={width:hn[0],height:hn[1],left:ai,top:-v_,advance:rs?hn[1]:hn[0]},bi=Ln+(Wr-hn[1]*Qt.scale),js=Pr.advance;const ho=rs?hn[0]*Qt.scale-Wr*sn:hn[1]*Qt.scale-Wr*sn;ho>0&&ho>In&&(In=ho)}else{const ji=Xe[Qt.fontStack],hn=ji&&ji[Sr];if(hn&&hn.rect)nu=hn.rect,Pr=hn.metrics;else{const ho=Ae[Qt.fontStack],Lc=ho&&ho[Sr];if(!Lc)continue;Pr=Lc.metrics}bi=(sn-Qt.scale)*Wr}rs?(xe.verticalizable=!0,Xn.push({glyph:Sr,imageName:Ns,x:Ct,y:pr+bi,vertical:rs,scale:Qt.scale,fontStack:Qt.fontStack,sectionIndex:yr,metrics:Pr,rect:nu}),Ct+=js*Qt.scale+we):(Xn.push({glyph:Sr,imageName:Ns,x:Ct,y:pr+bi,vertical:rs,scale:Qt.scale,fontStack:Qt.fontStack,sectionIndex:yr,metrics:Pr,rect:nu}),Ct+=Pr.advance*Qt.scale+we)}Xn.length!==0&&(ur=Math.max(Ct-we,ur),_b(Xn,0,Xn.length-1,ts,In)),Ct=0;const Ni=$e*sn+In;Cn.lineOffset=Math.max(In,Ln),pr+=Ni,rn=Math.max(Ni,rn),++Tn}var nn;const Gn=pr-Ic,{horizontalAlign:Hn,verticalAlign:Wn}=Bf(at);(function(Br,sn,Ln,Cn,Xn,In,Ni,li,Qt){const yr=(sn-Ln)*Xn;let Sr=0;Sr=In!==Ni?-li*Cn-Ic:(-Cn*Qt+.5)*Ni;for(const bi of Br)for(const Pr of bi.positionedGlyphs)Pr.x+=yr,Pr.y+=Sr})(xe.positionedLines,ts,Hn,Wn,ur,rn,$e,Gn,Ge.length),xe.top+=-Wn*Gn,xe.bottom=xe.top+Gn,xe.left+=-Hn*ur,xe.right=xe.left+ur}(pe,t,s,a,G,y,_,w,P,C,z,B),!function(xe){for(const Ae of xe)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(ie)&&pe}const fd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},gb={40:!0};function b_(n,t,s,a,h,g){if(t.imageName){const y=a[t.imageName];return y?y.displaySize[0]*t.scale*Wr/g+h:0}{const y=s[t.fontStack],_=y&&y[n];return _?_.metrics.advance*t.scale+h:0}}function S_(n,t,s,a){const h=Math.pow(n-t,2);return a?n<t?h/2:2*h:h+Math.abs(s)*s}function yb(n,t,s){let a=0;return n===10&&(a-=1e4),s&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function k_(n,t,s,a,h,g){let y=null,_=S_(t,s,h,g);for(const w of a){const C=S_(t-w.x,s,h,g)+w.badness;C<=_&&(y=w,_=C)}return{index:n,x:t,priorBreak:y,badness:_}}function T_(n){return n?T_(n.priorBreak).concat(n.index):[]}function Ff(n,t,s,a,h,g){if(!n)return[];const y=[],_=function(P,z,R,B,O,G){let X=0;for(let me=0;me<P.length();me++){const ie=P.getSection(me);X+=b_(P.getCharCode(me),ie,B,O,z,G)}return X/Math.max(1,Math.ceil(X/R))}(n,t,s,a,h,g),w=n.text.indexOf("")>=0;let C=0;for(let P=0;P<n.length();P++){const z=n.getSection(P),R=n.getCharCode(P);if(fd[R]||(C+=b_(R,z,a,h,t,g)),P<n.length()-1){const B=!((I=R)<11904)&&(!!Gt["CJK Compatibility Forms"](I)||!!Gt["CJK Compatibility"](I)||!!Gt["CJK Strokes"](I)||!!Gt["CJK Symbols and Punctuation"](I)||!!Gt["Enclosed CJK Letters and Months"](I)||!!Gt["Halfwidth and Fullwidth Forms"](I)||!!Gt["Ideographic Description Characters"](I)||!!Gt["Vertical Forms"](I)||Yh.test(String.fromCodePoint(I)));(mb[R]||B||z.imageName||P!==n.length()-2&&gb[n.getCharCode(P+1)])&&y.push(k_(P+1,C,_,y,yb(R,n.getCharCode(P+1),B&&w),!1))}}var I;return T_(k_(n.length(),C,_,y,0,!0))}function Bf(n){let t=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function _b(n,t,s,a,h){if(!a&&!h)return;const g=n[s],y=(n[s].x+g.metrics.advance*g.scale)*a;for(let _=t;_<=s;_++)n[_].x-=y,n[_].y+=h}function vb(n,t,s){const{horizontalAlign:a,verticalAlign:h}=Bf(s),g=t[0]-n.displaySize[0]*a,y=t[1]-n.displaySize[1]*h;return{image:n,top:y,bottom:y+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function C_(n){var t,s;let a=n.left,h=n.top,g=n.right-a,y=n.bottom-h;const _=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(s=n.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",C=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(w==="proportional"){if(_==="stretchOnly"&&g/y<C||_==="proportional"){const I=Math.ceil(y*C);a*=I/g,g=I}}else if(_==="proportional"&&w==="stretchOnly"&&C!==0&&g/y>C){const I=Math.ceil(g/C);h*=I/y,y=I}return{x1:a,y1:h,x2:a+g,y2:h+y}}function I_(n,t,s,a,h,g){const y=n.image;let _;if(y.content){const G=y.content,X=y.pixelRatio||1;_=[G[0]/X,G[1]/X,y.displaySize[0]-G[2]/X,y.displaySize[1]-G[3]/X]}const w=t.left*g,C=t.right*g;let I,P,z,R;s==="width"||s==="both"?(R=h[0]+w-a[3],P=h[0]+C+a[1]):(R=h[0]+(w+C-y.displaySize[0])/2,P=R+y.displaySize[0]);const B=t.top*g,O=t.bottom*g;return s==="height"||s==="both"?(I=h[1]+B-a[0],z=h[1]+O+a[2]):(I=h[1]+(B+O-y.displaySize[1])/2,z=I+y.displaySize[1]),{image:y,top:I,right:P,bottom:z,left:R,collisionPadding:_}}const Pc=255,Os=128,na=Pc*Os;function E_(n,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new vr(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=s;let g=0;for(;g<a.length&&a[g]<=n;)g++;g=Math.max(0,g-1);let y=g;for(;y<a.length&&a[y]<n+1;)y++;y=Math.min(a.length-1,y);const _=a[g],w=a[y];return s.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:_,maxZoom:w,minSize:s.evaluate(new vr(_)),maxSize:s.evaluate(new vr(w)),interpolationType:h}}}function Of(n,t,s){let a="never";const h=n.get(t);return h?a=h:n.get(s)&&(a="always"),a}const xb=ta.VectorTileFeature.types,wb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function md(n,t,s,a,h,g,y,_,w,C,I,P,z){const R=_?Math.min(na,Math.round(_[0])):0,B=_?Math.min(na,Math.round(_[1])):0;n.emplaceBack(t,s,Math.round(32*a),Math.round(32*h),g,y,(R<<1)+(w?1:0),B,16*C,16*I,256*P,256*z)}function Nf(n,t,s){n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s)}function bb(n){for(const t of n.sections)if(pf(t.text))return!0;return!1}class jf{constructor(t){this.layoutVertexArray=new Ul,this.indexArray=new Fi,this.programConfigurations=t,this.segments=new Ht,this.dynamicLayoutVertexArray=new gc,this.opacityVertexArray=new xi,this.hasVisibleVertices=!1,this.placedSymbolArray=new xr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,J1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Q1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,wb,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}et("SymbolBuffers",jf);class Vf{constructor(t,s,a){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new a,this.segments=new Ht,this.collisionVertexArray=new Fs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,eb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}et("CollisionBuffers",Vf);class eu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xf([]),this.placementViewportMatrix=xf([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=E_(this.zoom,s["text-size"]),this.iconSizeData=E_(this.zoom,s["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=Of(a,"text-overlap","text-allow-overlap")!=="never"||Of(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>S.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new jf(new Ka(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new jf(new Ka(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new wr,this.lineVertexArray=new wn,this.symbolInstances=new qt,this.textAnchorOffsets=new br}calculateGlyphDependencies(t,s,a,h,g){for(let y=0;y<t.length;y++)if(s[t.charCodeAt(y)]=!0,(a||h)&&g){const _=Cc[t.charAt(y)];_&&(s[_.charCodeAt(0)]=!0)}}populate(t,s,a){const h=this.layers[0],g=h.layout,y=g.get("text-font"),_=g.get("text-field"),w=g.get("icon-image"),C=(_.value.kind!=="constant"||_.value.value instanceof gn&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),I=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!C&&!I)return;const z=s.iconDependencies,R=s.glyphDependencies,B=s.availableImages,O=new vr(this.zoom);for(const{feature:G,id:X,index:me,sourceLayerIndex:ie}of t){const pe=h._featureFilter.needGeometry,xe=Ja(G,pe);if(!h._featureFilter.filter(O,xe,a))continue;let Ae,Xe;if(pe||(xe.geometry=Ya(G)),C){const Ge=h.getValueAndResolveTokens("text-field",xe,a,B),$e=gn.factory(Ge),at=this.hasRTLText=this.hasRTLText||bb($e);(!at||si.getRTLTextPluginStatus()==="unavailable"||at&&si.isParsed())&&(Ae=rb($e,h,xe))}if(I){const Ge=h.getValueAndResolveTokens("icon-image",xe,a,B);Xe=Ge instanceof en?Ge:en.fromString(Ge)}if(!Ae&&!Xe)continue;const mt=this.sortFeaturesByKey?P.evaluate(xe,{},a):void 0;if(this.features.push({id:X,text:Ae,icon:Xe,index:me,sourceLayerIndex:ie,geometry:xe.geometry,properties:G.properties,type:xb[G.type],sortKey:mt}),Xe&&(z[Xe.name]=!0),Ae){const Ge=y.evaluate(xe,{},a).join(","),$e=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const at of Ae.sections)if(at.image)z[at.image.name]=!0;else{const tt=hc(Ae.toString()),Qe=at.fontStack||Ge,we=R[Qe]=R[Qe]||{};this.calculateGlyphDependencies(at.text,we,$e,this.allowVerticalPlacement,tt)}}}g.get("symbol-placement")==="line"&&(this.features=function(G){const X={},me={},ie=[];let pe=0;function xe(Ge){ie.push(G[Ge]),pe++}function Ae(Ge,$e,at){const tt=me[Ge];return delete me[Ge],me[$e]=tt,ie[tt].geometry[0].pop(),ie[tt].geometry[0]=ie[tt].geometry[0].concat(at[0]),tt}function Xe(Ge,$e,at){const tt=X[$e];return delete X[$e],X[Ge]=tt,ie[tt].geometry[0].shift(),ie[tt].geometry[0]=at[0].concat(ie[tt].geometry[0]),tt}function mt(Ge,$e,at){const tt=at?$e[0][$e[0].length-1]:$e[0][0];return`${Ge}:${tt.x}:${tt.y}`}for(let Ge=0;Ge<G.length;Ge++){const $e=G[Ge],at=$e.geometry,tt=$e.text?$e.text.toString():null;if(!tt){xe(Ge);continue}const Qe=mt(tt,at),we=mt(tt,at,!0);if(Qe in me&&we in X&&me[Qe]!==X[we]){const ut=Xe(Qe,we,at),ot=Ae(Qe,we,ie[ut].geometry);delete X[Qe],delete me[we],me[mt(tt,ie[ot].geometry,!0)]=ot,ie[ut].geometry=null}else Qe in me?Ae(Qe,we,at):we in X?Xe(Qe,we,at):(xe(Ge),X[Qe]=pe-1,me[we]=pe-1)}return ie.filter(Ge=>Ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,X)=>G.sortKey-X.sortKey)}update(t,s,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(s[t.segment+1]),g=t.dist(s[t.segment]);const y={};for(let _=t.segment+1;_<s.length;_++)y[_]={x:s[_].x,y:s[_].y,tileUnitDistanceFromAnchor:h},_<s.length-1&&(h+=s[_+1].dist(s[_]));for(let _=t.segment||0;_>=0;_--)y[_]={x:s[_].x,y:s[_].y,tileUnitDistanceFromAnchor:g},_>0&&(g+=s[_-1].dist(s[_]));for(let _=0;_<s.length;_++){const w=y[_];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,s,a,h,g,y,_,w,C,I,P,z){const R=t.indexArray,B=t.layoutVertexArray,O=t.segments.prepareSegment(4*s.length,B,R,this.canOverlap?y.sortKey:void 0),G=this.glyphOffsetArray.length,X=O.vertexLength,me=this.allowVerticalPlacement&&_===S.ah.vertical?Math.PI/2:0,ie=y.text&&y.text.sections;for(let pe=0;pe<s.length;pe++){const{tl:xe,tr:Ae,bl:Xe,br:mt,tex:Ge,pixelOffsetTL:$e,pixelOffsetBR:at,minFontScaleX:tt,minFontScaleY:Qe,glyphOffset:we,isSDF:ut,sectionIndex:ot}=s[pe],Ct=O.vertexLength,pr=we[1];md(B,w.x,w.y,xe.x,pr+xe.y,Ge.x,Ge.y,a,ut,$e.x,$e.y,tt,Qe),md(B,w.x,w.y,Ae.x,pr+Ae.y,Ge.x+Ge.w,Ge.y,a,ut,at.x,$e.y,tt,Qe),md(B,w.x,w.y,Xe.x,pr+Xe.y,Ge.x,Ge.y+Ge.h,a,ut,$e.x,at.y,tt,Qe),md(B,w.x,w.y,mt.x,pr+mt.y,Ge.x+Ge.w,Ge.y+Ge.h,a,ut,at.x,at.y,tt,Qe),Nf(t.dynamicLayoutVertexArray,w,me),R.emplaceBack(Ct,Ct+1,Ct+2),R.emplaceBack(Ct+1,Ct+2,Ct+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(we[0]),pe!==s.length-1&&ot===s[pe+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,y,y.index,{},z,ie&&ie[ot])}t.placedSymbolArray.emplaceBack(w.x,w.y,G,this.glyphOffsetArray.length-G,X,C,I,w.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],_,0,!1,0,P)}_addCollisionDebugVertex(t,s,a,h,g,y){return s.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,s,a,h,g,y,_){const w=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),C=w.vertexLength,I=g.layoutVertexArray,P=g.collisionVertexArray,z=_.anchorX,R=_.anchorY;this._addCollisionDebugVertex(I,P,y,z,R,new Q(t,s)),this._addCollisionDebugVertex(I,P,y,z,R,new Q(a,s)),this._addCollisionDebugVertex(I,P,y,z,R,new Q(a,h)),this._addCollisionDebugVertex(I,P,y,z,R,new Q(t,h)),w.vertexLength+=4;const B=g.indexArray;B.emplaceBack(C,C+1),B.emplaceBack(C+1,C+2),B.emplaceBack(C+2,C+3),B.emplaceBack(C+3,C),w.primitiveLength+=4}addDebugCollisionBoxes(t,s,a,h){for(let g=t;g<s;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vf(wi,h_.members,cn),this.iconCollisionBox=new Vf(wi,h_.members,cn);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,a,h,g,y,_,w,C){const I={};for(let P=s;P<a;P++){const z=t.get(P);I.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.textFeatureIndex=z.featureIndex;break}for(let P=h;P<g;P++){const z=t.get(P);I.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.verticalTextFeatureIndex=z.featureIndex;break}for(let P=y;P<_;P++){const z=t.get(P);I.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.iconFeatureIndex=z.featureIndex;break}for(let P=w;P<C;P++){const z=t.get(P);I.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},I.verticalIconFeatureIndex=z.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const a=t.placedSymbolArray.get(s),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),a=Math.cos(t),h=[],g=[],y=[];for(let _=0;_<this.symbolInstances.length;++_){y.push(_);const w=this.symbolInstances.get(_);h.push(0|Math.round(s*w.anchorX+a*w.anchorY)),g.push(w.featureIndex)}return y.sort((_,w)=>h[_]-h[w]||g[w]-g[_]),y}addToSortKeyRanges(t,s){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===s?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const a=this.symbolInstances.get(s);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let P_,A_;et("SymbolBucket",eu,{omit:["layers","collisionBoxArray","features","compareText"]}),eu.MAX_GLYPHS=65535,eu.addDynamicAttributes=Nf;var Uf={get paint(){return A_=A_||new m({"icon-opacity":new vt(_e.paint_symbol["icon-opacity"]),"icon-color":new vt(_e.paint_symbol["icon-color"]),"icon-halo-color":new vt(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new vt(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vt(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new it(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new vt(_e.paint_symbol["text-opacity"]),"text-color":new vt(_e.paint_symbol["text-color"],{runtimeType:Jr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new vt(_e.paint_symbol["text-halo-color"]),"text-halo-width":new vt(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new vt(_e.paint_symbol["text-halo-blur"]),"text-translate":new it(_e.paint_symbol["text-translate"]),"text-translate-anchor":new it(_e.paint_symbol["text-translate-anchor"])})},get layout(){return P_=P_||new m({"symbol-placement":new it(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new it(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vt(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new it(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new it(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new it(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new vt(_e.layout_symbol["icon-size"]),"icon-text-fit":new it(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new vt(_e.layout_symbol["icon-image"]),"icon-rotate":new vt(_e.layout_symbol["icon-rotate"]),"icon-padding":new vt(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new it(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new vt(_e.layout_symbol["icon-offset"]),"icon-anchor":new vt(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(_e.layout_symbol["text-rotation-alignment"]),"text-field":new vt(_e.layout_symbol["text-field"]),"text-font":new vt(_e.layout_symbol["text-font"]),"text-size":new vt(_e.layout_symbol["text-size"]),"text-max-width":new vt(_e.layout_symbol["text-max-width"]),"text-line-height":new it(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new vt(_e.layout_symbol["text-letter-spacing"]),"text-justify":new vt(_e.layout_symbol["text-justify"]),"text-radial-offset":new vt(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new vt(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new vt(_e.layout_symbol["text-anchor"]),"text-max-angle":new it(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new it(_e.layout_symbol["text-writing-mode"]),"text-rotate":new vt(_e.layout_symbol["text-rotate"]),"text-padding":new it(_e.layout_symbol["text-padding"]),"text-keep-upright":new it(_e.layout_symbol["text-keep-upright"]),"text-transform":new vt(_e.layout_symbol["text-transform"]),"text-offset":new vt(_e.layout_symbol["text-offset"]),"text-allow-overlap":new it(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new it(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new it(_e.layout_symbol["text-ignore-placement"]),"text-optional":new it(_e.layout_symbol["text-optional"])})}};class M_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Hr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}et("FormatSectionOverride",M_,{omit:["defaultValue"]});class gd extends o{constructor(t){super(t,Uf)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,a,h){const g=this.layout.get(t).evaluate(s,{},a,h),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||Il(y.value)||!g?g:function(_,w){return w.replace(/{([^{}]+)}/g,(C,I)=>_&&I in _?String(_[I]):"")}(s.properties,g)}createBucket(t){return new eu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Uf.paint.overridableProperties){if(!gd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),a=new M_(s),h=new Cl(a,s.property.specification);let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new jo("source",h):new Vo("composite",h,s.value.zoomStops),this.paint._values[t]=new Qi(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,a){return!(!this.layout||s.isDataDriven()||a.isDataDriven())&&gd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const a=t.get("text-field"),h=Uf.paint.properties[s];let g=!1;const y=_=>{for(const w of _)if(h.overrides&&h.overrides.hasOverride(w))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof gn)y(a.value.value.sections);else if(a.value.kind==="source"){const _=C=>{g||(C instanceof $n&&Ir(C.value)===Un?y(C.value.sections):C instanceof vn?y(C.sections):C.eachChild(_))},w=a.value;w._styleExpression&&_(w._styleExpression.expression)}return g}}let z_;var Sb={get paint(){return z_=z_||new m({"background-color":new it(_e.paint_background["background-color"]),"background-pattern":new jl(_e.paint_background["background-pattern"]),"background-opacity":new it(_e.paint_background["background-opacity"])})}};class kb extends o{constructor(t){super(t,Sb)}}let D_;var Tb={get paint(){return D_=D_||new m({"raster-opacity":new it(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new it(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new it(_e.paint_raster["raster-saturation"]),"raster-contrast":new it(_e.paint_raster["raster-contrast"]),"raster-resampling":new it(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new it(_e.paint_raster["raster-fade-duration"])})}};class Cb extends o{constructor(t){super(t,Tb)}}class Ib extends o{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Eb{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const $f=63710088e-1;class ia{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ia(Ke(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,a=this.lat*s,h=t.lat*s,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*s);return $f*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof ia)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ia(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ia(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const L_=2*Math.PI*$f;function R_(n){return L_*Math.cos(n*Math.PI/180)}function F_(n){return(180+n)/360}function B_(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function O_(n,t){return n/R_(t)}function qf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class Ac{constructor(t,s,a=0){this.x=+t,this.y=+s,this.z=+a}static fromLngLat(t,s=0){const a=ia.convert(t);return new Ac(F_(a.lng),B_(a.lat),O_(s,a.lat))}toLngLat(){return new ia(360*this.x-180,qf(this.y))}toAltitude(){return this.z*R_(qf(this.y))}meterInMercatorCoordinateUnits(){return 1/L_*(t=qf(this.y),1/Math.cos(t*Math.PI/180));var t}}function N_(n,t,s){var a=2*Math.PI*6378137/256/Math.pow(2,s);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Zf{constructor(t,s,a){if(!function(h,g,y){return!(h<0||h>25||y<0||y>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(t,s,a))throw new Error(`x=${s}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=a,this.key=Mc(0,t,t,s,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,a){const h=(y=this.y,_=this.z,w=N_(256*(g=this.x),256*(y=Math.pow(2,_)-y-1),_),C=N_(256*(g+1),256*(y+1),_),w[0]+","+w[1]+","+C[0]+","+C[1]);var g,y,_,w,C;const I=function(P,z,R){let B,O="";for(let G=P;G>0;G--)B=1<<G-1,O+=(z&B?1:0)+(R&B?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new Q((t.x*s-this.x)*Zr,(t.y*s-this.y)*Zr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class j_{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Mc(t,s.z,s.z,s.x,s.y)}}class Oi{constructor(t,s,a,h,g){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=s,this.canonical=new Zf(a,+h,+g),this.key=Mc(s,t,a,h,g)}clone(){return new Oi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Oi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oi(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?Mc(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):Mc(this.wrap*+s,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Oi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Oi(s,this.wrap,s,a,h),new Oi(s,this.wrap,s,a+1,h),new Oi(s,this.wrap,s,a,h+1),new Oi(s,this.wrap,s,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Oi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Oi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new j_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ac(t.x-this.wrap,t.y))}}function Mc(n,t,s,a,h){(n*=2)<0&&(n=-1*n-1);const g=1<<s;return(g*g*n+g*h+a).toString(36)+s.toString(36)+t.toString(36)}et("CanonicalTileID",Zf),et("OverscaledTileID",Oi,{omit:["posMatrix"]});class V_{constructor(t,s,a,h=1,g=1,y=1,_=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void yt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const w=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<w;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(w,C)]=this.data[this._idx(w-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,w)]=this.data[this._idx(C,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<w;C++)for(let I=0;I<w;I++){const P=this.get(C,I);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,s){const a=new Uint8Array(this.data.buffer),h=4*this._idx(t,s);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,a){return t*this.redFactor+s*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Bi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,g=s*this.dim+this.dim,y=a*this.dim,_=a*this.dim+this.dim;switch(s){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:y=_-1;break;case 1:_=y+1}const w=-s*this.dim,C=-a*this.dim;for(let I=y;I<_;I++)for(let P=h;P<g;P++)this.data[this._idx(P,I)]=t.data[this._idx(P+w,I+C)]}}et("DEMData",V_);class U_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const a=t[s];this._stringToNumber[a]=s,this._numberToString[s]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class $_{constructor(t,s,a,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=a,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class q_{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new qo(Zr,16,0),this.grid3D=new qo(Zr,16,0),this.featureIndexArray=new zn,this.promoteId=s}insert(t,s,a,h,g,y){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);const w=y?this.grid3D:this.grid;for(let C=0;C<s.length;C++){const I=s[C],P=[1/0,1/0,-1/0,-1/0];for(let z=0;z<I.length;z++){const R=I[z];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}P[0]<Zr&&P[1]<Zr&&P[2]>=0&&P[3]>=0&&w.insert(_,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ta.VectorTile(new Df(this.rawTileData)).layers,this.sourceLayerCoder=new U_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,a,h){this.loadVTLayers();const g=t.params||{},y=Zr/t.tileSize/t.scale,_=Ku(g.filter),w=t.queryGeometry,C=t.queryPadding*y,I=G_(w),P=this.grid.query(I.minX-C,I.minY-C,I.maxX+C,I.maxY+C),z=G_(t.cameraQueryGeometry),R=this.grid3D.query(z.minX-C,z.minY-C,z.maxX+C,z.maxY+C,(G,X,me,ie)=>function(pe,xe,Ae,Xe,mt){for(const $e of pe)if(xe<=$e.x&&Ae<=$e.y&&Xe>=$e.x&&mt>=$e.y)return!0;const Ge=[new Q(xe,Ae),new Q(xe,mt),new Q(Xe,mt),new Q(Xe,Ae)];if(pe.length>2){for(const $e of Ge)if(Hl(pe,$e))return!0}for(let $e=0;$e<pe.length-1;$e++)if(l1(pe[$e],pe[$e+1],Ge))return!0;return!1}(t.cameraQueryGeometry,G-C,X-C,me+C,ie+C));for(const G of R)P.push(G);P.sort(Pb);const B={};let O;for(let G=0;G<P.length;G++){const X=P[G];if(X===O)continue;O=X;const me=this.featureIndexArray.get(X);let ie=null;this.loadMatchingFeature(B,me.bucketIndex,me.sourceLayerIndex,me.featureIndex,_,g.layers,g.availableImages,s,a,h,(pe,xe,Ae)=>(ie||(ie=Ya(pe)),xe.queryIntersectsFeature(w,pe,Ae,ie,this.z,t.transform,y,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,s,a,h,g,y,_,w,C,I,P){const z=this.bucketLayerIDs[s];if(y&&!function(G,X){for(let me=0;me<G.length;me++)if(X.indexOf(G[me])>=0)return!0;return!1}(y,z))return;const R=this.sourceLayerCoder.decode(a),B=this.vtLayers[R].feature(h);if(g.needGeometry){const G=Ja(B,!0);if(!g.filter(new vr(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!g.filter(new vr(this.tileID.overscaledZ),B))return;const O=this.getId(B,R);for(let G=0;G<z.length;G++){const X=z[G];if(y&&y.indexOf(X)<0)continue;const me=w[X];if(!me)continue;let ie={};O&&I&&(ie=I.getState(me.sourceLayer||"_geojsonTileLayer",O));const pe=qe({},C[X]);pe.paint=Z_(pe.paint,me.paint,B,ie,_),pe.layout=Z_(pe.layout,me.layout,B,ie,_);const xe=!P||P(B,me,ie);if(!xe)continue;const Ae=new $_(B,this.z,this.x,this.y,O);Ae.layer=pe;let Xe=t[X];Xe===void 0&&(Xe=t[X]=[]),Xe.push({featureIndex:h,feature:Ae,intersectionZ:xe})}}lookupSymbolFeatures(t,s,a,h,g,y,_,w){const C={};this.loadVTLayers();const I=Ku(g);for(const P of t)this.loadMatchingFeature(C,a,h,P,I,y,_,w,s);return C}hasLayer(t){for(const s of this.bucketLayerIDs)for(const a of s)if(t===a)return!0;return!1}getId(t,s){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof a=="boolean"&&(a=Number(a))),a}}function Z_(n,t,s,a,h){return Et(n,(g,y)=>{const _=t instanceof Ha?t.get(y):null;return _&&_.evaluate?_.evaluate(s,a,h):_})}function G_(n){let t=1/0,s=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),s=Math.min(s,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:t,minY:s,maxX:a,maxY:h}}function Pb(n,t){return t-n}function H_(n,t,s,a,h){const g=[];for(let y=0;y<n.length;y++){const _=n[y];let w;for(let C=0;C<_.length-1;C++){let I=_[C],P=_[C+1];I.x<t&&P.x<t||(I.x<t?I=new Q(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<t&&(P=new Q(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<s&&P.y<s||(I.y<s?I=new Q(I.x+(s-I.y)/(P.y-I.y)*(P.x-I.x),s)._round():P.y<s&&(P=new Q(I.x+(s-I.y)/(P.y-I.y)*(P.x-I.x),s)._round()),I.x>=a&&P.x>=a||(I.x>=a?I=new Q(a,I.y+(a-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=a&&(P=new Q(a,I.y+(a-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=h&&P.y>=h||(I.y>=h?I=new Q(I.x+(h-I.y)/(P.y-I.y)*(P.x-I.x),h)._round():P.y>=h&&(P=new Q(I.x+(h-I.y)/(P.y-I.y)*(P.x-I.x),h)._round()),w&&I.equals(w[w.length-1])||(w=[I],g.push(w)),w.push(P)))))}}return g}et("FeatureIndex",q_,{omit:["rawTileData","sourceLayerCoder"]});class sa extends Q{constructor(t,s,a,h){super(t,s),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new sa(this.x,this.y,this.angle,this.segment)}}function W_(n,t,s,a,h){if(t.segment===void 0||s===0)return!0;let g=t,y=t.segment+1,_=0;for(;_>-s/2;){if(y--,y<0)return!1;_-=n[y].dist(g),g=n[y]}_+=n[y].dist(n[y+1]),y++;const w=[];let C=0;for(;_<s/2;){const I=n[y],P=n[y+1];if(!P)return!1;let z=n[y-1].angleTo(I)-I.angleTo(P);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:_,angleDelta:z}),C+=z;_-w[0].distance>a;)C-=w.shift().angleDelta;if(C>h)return!1;y++,_+=I.dist(P)}return!0}function X_(n){let t=0;for(let s=0;s<n.length-1;s++)t+=n[s].dist(n[s+1]);return t}function K_(n,t,s){return n?.6*t*s:0}function Y_(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function Ab(n,t,s,a,h,g){const y=K_(s,h,g),_=Y_(s,a)*g;let w=0;const C=X_(n)/2;for(let I=0;I<n.length-1;I++){const P=n[I],z=n[I+1],R=P.dist(z);if(w+R>C){const B=(C-w)/R,O=yn.number(P.x,z.x,B),G=yn.number(P.y,z.y,B),X=new sa(O,G,z.angleTo(P),I);return X._round(),!y||W_(n,X,_,y,t)?X:void 0}w+=R}}function Mb(n,t,s,a,h,g,y,_,w){const C=K_(a,g,y),I=Y_(a,h),P=I*y,z=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return t-P<t/4&&(t=P+t/4),J_(n,z?t/2*_%t:(I/2+2*g)*y*_%t,t,C,s,P,z,!1,w)}function J_(n,t,s,a,h,g,y,_,w){const C=g/2,I=X_(n);let P=0,z=t-s,R=[];for(let B=0;B<n.length-1;B++){const O=n[B],G=n[B+1],X=O.dist(G),me=G.angleTo(O);for(;z+s<P+X;){z+=s;const ie=(z-P)/X,pe=yn.number(O.x,G.x,ie),xe=yn.number(O.y,G.y,ie);if(pe>=0&&pe<w&&xe>=0&&xe<w&&z-C>=0&&z+C<=I){const Ae=new sa(pe,xe,me,B);Ae._round(),a&&!W_(n,Ae,g,a,h)||R.push(Ae)}}P+=X}return _||R.length||y||(R=J_(n,P/2,s,a,h,g,y,!0,w)),R}et("Anchor",sa);const tu=ai;function Q_(n,t,s,a){const h=[],g=n.image,y=g.pixelRatio,_=g.paddedRect.w-2*tu,w=g.paddedRect.h-2*tu;let C={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const I=g.stretchX||[[0,_]],P=g.stretchY||[[0,w]],z=(we,ut)=>we+ut[1]-ut[0],R=I.reduce(z,0),B=P.reduce(z,0),O=_-R,G=w-B;let X=0,me=R,ie=0,pe=B,xe=0,Ae=O,Xe=0,mt=G;if(g.content&&a){const we=g.content,ut=we[2]-we[0],ot=we[3]-we[1];(g.textFitWidth||g.textFitHeight)&&(C=C_(n)),X=yd(I,0,we[0]),ie=yd(P,0,we[1]),me=yd(I,we[0],we[2]),pe=yd(P,we[1],we[3]),xe=we[0]-X,Xe=we[1]-ie,Ae=ut-me,mt=ot-pe}const Ge=C.x1,$e=C.y1,at=C.x2-Ge,tt=C.y2-$e,Qe=(we,ut,ot,Ct)=>{const pr=_d(we.stretch-X,me,at,Ge),ur=vd(we.fixed-xe,Ae,we.stretch,R),rn=_d(ut.stretch-ie,pe,tt,$e),ts=vd(ut.fixed-Xe,mt,ut.stretch,B),Tn=_d(ot.stretch-X,me,at,Ge),nn=vd(ot.fixed-xe,Ae,ot.stretch,R),Gn=_d(Ct.stretch-ie,pe,tt,$e),Hn=vd(Ct.fixed-Xe,mt,Ct.stretch,B),Wn=new Q(pr,rn),Br=new Q(Tn,rn),sn=new Q(Tn,Gn),Ln=new Q(pr,Gn),Cn=new Q(ur/y,ts/y),Xn=new Q(nn/y,Hn/y),In=t*Math.PI/180;if(In){const Qt=Math.sin(In),yr=Math.cos(In),Sr=[yr,-Qt,Qt,yr];Wn._matMult(Sr),Br._matMult(Sr),Ln._matMult(Sr),sn._matMult(Sr)}const Ni=we.stretch+we.fixed,li=ut.stretch+ut.fixed;return{tl:Wn,tr:Br,bl:Ln,br:sn,tex:{x:g.paddedRect.x+tu+Ni,y:g.paddedRect.y+tu+li,w:ot.stretch+ot.fixed-Ni,h:Ct.stretch+Ct.fixed-li},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cn,pixelOffsetBR:Xn,minFontScaleX:Ae/y/at,minFontScaleY:mt/y/tt,isSDF:s}};if(a&&(g.stretchX||g.stretchY)){const we=ev(I,O,R),ut=ev(P,G,B);for(let ot=0;ot<we.length-1;ot++){const Ct=we[ot],pr=we[ot+1];for(let ur=0;ur<ut.length-1;ur++)h.push(Qe(Ct,ut[ur],pr,ut[ur+1]))}}else h.push(Qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:w+1}));return h}function yd(n,t,s){let a=0;for(const h of n)a+=Math.max(t,Math.min(s,h[1]))-Math.max(t,Math.min(s,h[0]));return a}function ev(n,t,s){const a=[{fixed:-tu,stretch:0}];for(const[h,g]of n){const y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return a.push({fixed:t+tu,stretch:s}),a}function _d(n,t,s,a){return n/t*s+a}function vd(n,t,s,a){return n-t*s/a}class xd{constructor(t,s,a,h,g,y,_,w,C,I){var P;if(this.boxStartIndex=t.length,C){let z=y.top,R=y.bottom;const B=y.collisionPadding;B&&(z-=B[1],R+=B[3]);let O=R-z;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const z=!((P=y.image)===null||P===void 0)&&P.content&&(y.image.textFitWidth||y.image.textFitHeight)?C_(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};z.y1=z.y1*_-w[0],z.y2=z.y2*_+w[2],z.x1=z.x1*_-w[3],z.x2=z.x2*_+w[1];const R=y.collisionPadding;if(R&&(z.x1-=R[0]*_,z.y1-=R[1]*_,z.x2+=R[2]*_,z.y2+=R[3]*_),I){const B=new Q(z.x1,z.y1),O=new Q(z.x2,z.y1),G=new Q(z.x1,z.y2),X=new Q(z.x2,z.y2),me=I*Math.PI/180;B._rotate(me),O._rotate(me),G._rotate(me),X._rotate(me),z.x1=Math.min(B.x,O.x,G.x,X.x),z.x2=Math.max(B.x,O.x,G.x,X.x),z.y1=Math.min(B.y,O.y,G.y,X.y),z.y2=Math.max(B.y,O.y,G.y,X.y)}t.emplaceBack(s.x,s.y,z.x1,z.y1,z.x2,z.y2,a,h,g)}this.boxEndIndex=t.length}}class zb{constructor(t=[],s=(a,h)=>a<h?-1:a>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:a}=this,h=s[t];for(;t>0;){const g=t-1>>1,y=s[g];if(a(h,y)>=0)break;s[t]=y,t=g}s[t]=h}_down(t){const{data:s,compare:a}=this,h=this.length>>1,g=s[t];for(;t<h;){let y=1+(t<<1);const _=y+1;if(_<this.length&&a(s[_],s[y])<0&&(y=_),a(s[y],g)>=0)break;s[t]=s[y],t=y}s[t]=g}}function Db(n,t=1,s=!1){let a=1/0,h=1/0,g=-1/0,y=-1/0;const _=n[0];for(let R=0;R<_.length;R++){const B=_[R];(!R||B.x<a)&&(a=B.x),(!R||B.y<h)&&(h=B.y),(!R||B.x>g)&&(g=B.x),(!R||B.y>y)&&(y=B.y)}const w=Math.min(g-a,y-h);let C=w/2;const I=new zb([],Lb);if(w===0)return new Q(a,h);for(let R=a;R<g;R+=w)for(let B=h;B<y;B+=w)I.push(new ru(R+C,B+C,C,n));let P=function(R){let B=0,O=0,G=0;const X=R[0];for(let me=0,ie=X.length,pe=ie-1;me<ie;pe=me++){const xe=X[me],Ae=X[pe],Xe=xe.x*Ae.y-Ae.x*xe.y;O+=(xe.x+Ae.x)*Xe,G+=(xe.y+Ae.y)*Xe,B+=3*Xe}return new ru(O/B,G/B,0,R)}(n),z=I.length;for(;I.length;){const R=I.pop();(R.d>P.d||!P.d)&&(P=R,s&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,z)),R.max-P.d<=t||(C=R.h/2,I.push(new ru(R.p.x-C,R.p.y-C,C,n)),I.push(new ru(R.p.x+C,R.p.y-C,C,n)),I.push(new ru(R.p.x-C,R.p.y+C,C,n)),I.push(new ru(R.p.x+C,R.p.y+C,C,n)),z+=4)}return s&&(console.log(`num probes: ${z}`),console.log(`best distance: ${P.d}`)),P.p}function Lb(n,t){return t.max-n.max}function ru(n,t,s,a){this.p=new Q(n,t),this.h=s,this.d=function(h,g){let y=!1,_=1/0;for(let w=0;w<g.length;w++){const C=g[w];for(let I=0,P=C.length,z=P-1;I<P;z=I++){const R=C[I],B=C[z];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(y=!y),_=Math.min(_,By(h,R,B))}}return(y?1:-1)*Math.sqrt(_)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var kn;S.aq=void 0,(kn=S.aq||(S.aq={}))[kn.center=1]="center",kn[kn.left=2]="left",kn[kn.right=3]="right",kn[kn.top=4]="top",kn[kn.bottom=5]="bottom",kn[kn["top-left"]=6]="top-left",kn[kn["top-right"]=7]="top-right",kn[kn["bottom-left"]=8]="bottom-left",kn[kn["bottom-right"]=9]="bottom-right";const oa=7,Gf=Number.POSITIVE_INFINITY;function tv(n,t){return t[1]!==Gf?function(s,a,h){let g=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),s){case"top-right":case"top-left":case"top":y=h-oa;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+oa}switch(s){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,y]}(n,t[0],t[1]):function(s,a){let h=0,g=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(s){case"top-right":case"top-left":g=y-oa;break;case"bottom-right":case"bottom-left":g=-y+oa;break;case"bottom":g=-a+oa;break;case"top":g=a-oa}switch(s){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(n,t[0])}function rv(n,t,s){var a;const h=n.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},s);if(g){const _=g.values,w=[];for(let C=0;C<_.length;C+=2){const I=w[C]=_[C],P=_[C+1].map(z=>z*Wr);I.startsWith("top")?P[1]-=oa:I.startsWith("bottom")&&(P[1]+=oa),w[C+1]=P}return new Bt(w)}const y=h.get("text-variable-anchor");if(y){let _;_=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},s)*Wr,Gf]:h.get("text-offset").evaluate(t,{},s).map(C=>C*Wr);const w=[];for(const C of y)w.push(C,tv(C,_));return new Bt(w)}return null}function Hf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Rb(n,t,s,a,h,g,y,_,w,C,I){let P=g.textMaxSize.evaluate(t,{});P===void 0&&(P=y);const z=n.layers[0].layout,R=z.get("icon-offset").evaluate(t,{},I),B=iv(s.horizontal),O=y/24,G=n.tilePixelRatio*O,X=n.tilePixelRatio*P/24,me=n.tilePixelRatio*_,ie=n.tilePixelRatio*z.get("symbol-spacing"),pe=z.get("text-padding")*n.tilePixelRatio,xe=function(we,ut,ot,Ct=1){const pr=we.get("icon-padding").evaluate(ut,{},ot),ur=pr&&pr.values;return[ur[0]*Ct,ur[1]*Ct,ur[2]*Ct,ur[3]*Ct]}(z,t,I,n.tilePixelRatio),Ae=z.get("text-max-angle")/180*Math.PI,Xe=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",mt=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ge=z.get("symbol-placement"),$e=ie/2,at=z.get("icon-text-fit");let tt;a&&at!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(tt=I_(a,s.vertical,at,z.get("icon-text-fit-padding"),R,O)),B&&(a=I_(a,B,at,z.get("icon-text-fit-padding"),R,O)));const Qe=(we,ut)=>{ut.x<0||ut.x>=Zr||ut.y<0||ut.y>=Zr||function(ot,Ct,pr,ur,rn,ts,Tn,nn,Gn,Hn,Wn,Br,sn,Ln,Cn,Xn,In,Ni,li,Qt,yr,Sr,bi,Pr,nu){const Ns=ot.addToLineVertexArray(Ct,pr);let js,rs,ji,hn,ho=0,Lc=0,lv=0,uv=0,tm=-1,rm=-1;const po={};let cv=$l("");if(ot.allowVerticalPlacement&&ur.vertical){const Rn=nn.layout.get("text-rotate").evaluate(yr,{},Pr)+90;ji=new xd(Gn,Ct,Hn,Wn,Br,ur.vertical,sn,Ln,Cn,Rn),Tn&&(hn=new xd(Gn,Ct,Hn,Wn,Br,Tn,In,Ni,Cn,Rn))}if(rn){const Rn=nn.layout.get("icon-rotate").evaluate(yr,{}),Vi=nn.layout.get("icon-text-fit")!=="none",el=Q_(rn,Rn,bi,Vi),bs=Tn?Q_(Tn,Rn,bi,Vi):void 0;rs=new xd(Gn,Ct,Hn,Wn,Br,rn,In,Ni,!1,Rn),ho=4*el.length;const tl=ot.iconSizeData;let Vs=null;tl.kind==="source"?(Vs=[Os*nn.layout.get("icon-size").evaluate(yr,{})],Vs[0]>na&&yt(`${ot.layerIds[0]}: Value for "icon-size" is >= ${Pc}. Reduce your "icon-size".`)):tl.kind==="composite"&&(Vs=[Os*Sr.compositeIconSizes[0].evaluate(yr,{},Pr),Os*Sr.compositeIconSizes[1].evaluate(yr,{},Pr)],(Vs[0]>na||Vs[1]>na)&&yt(`${ot.layerIds[0]}: Value for "icon-size" is >= ${Pc}. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,el,Vs,Qt,li,yr,S.ah.none,Ct,Ns.lineStartIndex,Ns.lineLength,-1,Pr),tm=ot.icon.placedSymbolArray.length-1,bs&&(Lc=4*bs.length,ot.addSymbols(ot.icon,bs,Vs,Qt,li,yr,S.ah.vertical,Ct,Ns.lineStartIndex,Ns.lineLength,-1,Pr),rm=ot.icon.placedSymbolArray.length-1)}const hv=Object.keys(ur.horizontal);for(const Rn of hv){const Vi=ur.horizontal[Rn];if(!js){cv=$l(Vi.text);const bs=nn.layout.get("text-rotate").evaluate(yr,{},Pr);js=new xd(Gn,Ct,Hn,Wn,Br,Vi,sn,Ln,Cn,bs)}const el=Vi.positionedLines.length===1;if(lv+=nv(ot,Ct,Vi,ts,nn,Cn,yr,Xn,Ns,ur.vertical?S.ah.horizontal:S.ah.horizontalOnly,el?hv:[Rn],po,tm,Sr,Pr),el)break}ur.vertical&&(uv+=nv(ot,Ct,ur.vertical,ts,nn,Cn,yr,Xn,Ns,S.ah.vertical,["vertical"],po,rm,Sr,Pr));const Ob=js?js.boxStartIndex:ot.collisionBoxArray.length,Nb=js?js.boxEndIndex:ot.collisionBoxArray.length,jb=ji?ji.boxStartIndex:ot.collisionBoxArray.length,Vb=ji?ji.boxEndIndex:ot.collisionBoxArray.length,Ub=rs?rs.boxStartIndex:ot.collisionBoxArray.length,$b=rs?rs.boxEndIndex:ot.collisionBoxArray.length,qb=hn?hn.boxStartIndex:ot.collisionBoxArray.length,Zb=hn?hn.boxEndIndex:ot.collisionBoxArray.length;let ws=-1;const bd=(Rn,Vi)=>Rn&&Rn.circleDiameter?Math.max(Rn.circleDiameter,Vi):Vi;ws=bd(js,ws),ws=bd(ji,ws),ws=bd(rs,ws),ws=bd(hn,ws);const dv=ws>-1?1:0;dv&&(ws*=nu/Wr),ot.glyphOffsetArray.length>=eu.MAX_GLYPHS&&yt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yr.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,yr.sortKey);const Gb=rv(nn,yr,Pr),[Hb,Wb]=function(Rn,Vi){const el=Rn.length,bs=Vi==null?void 0:Vi.values;if((bs==null?void 0:bs.length)>0)for(let tl=0;tl<bs.length;tl+=2){const Vs=bs[tl+1];Rn.emplaceBack(S.aq[bs[tl]],Vs[0],Vs[1])}return[el,Rn.length]}(ot.textAnchorOffsets,Gb);ot.symbolInstances.emplaceBack(Ct.x,Ct.y,po.right>=0?po.right:-1,po.center>=0?po.center:-1,po.left>=0?po.left:-1,po.vertical||-1,tm,rm,cv,Ob,Nb,jb,Vb,Ub,$b,qb,Zb,Hn,lv,uv,ho,Lc,dv,0,sn,ws,Hb,Wb)}(n,ut,we,s,a,h,tt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,G,[pe,pe,pe,pe],Xe,w,me,xe,mt,R,t,g,C,I,y)};if(Ge==="line")for(const we of H_(t.geometry,0,0,Zr,Zr)){const ut=Mb(we,ie,Ae,s.vertical||B,a,24,X,n.overscaling,Zr);for(const ot of ut)B&&Fb(n,B.text,$e,ot)||Qe(we,ot)}else if(Ge==="line-center"){for(const we of t.geometry)if(we.length>1){const ut=Ab(we,Ae,s.vertical||B,a,24,X);ut&&Qe(we,ut)}}else if(t.type==="Polygon")for(const we of vl(t.geometry,0)){const ut=Db(we,16);Qe(we[0],new sa(ut.x,ut.y,0))}else if(t.type==="LineString")for(const we of t.geometry)Qe(we,new sa(we[0].x,we[0].y,0));else if(t.type==="Point")for(const we of t.geometry)for(const ut of we)Qe([ut],new sa(ut.x,ut.y,0))}function nv(n,t,s,a,h,g,y,_,w,C,I,P,z,R,B){const O=function(me,ie,pe,xe,Ae,Xe,mt,Ge){const $e=xe.layout.get("text-rotate").evaluate(Xe,{})*Math.PI/180,at=[];for(const tt of ie.positionedLines)for(const Qe of tt.positionedGlyphs){if(!Qe.rect)continue;const we=Qe.rect||{};let ut=v_+1,ot=!0,Ct=1,pr=0;const ur=(Ae||Ge)&&Qe.vertical,rn=Qe.metrics.advance*Qe.scale/2;if(Ge&&ie.verticalizable&&(pr=tt.lineOffset/2-(Qe.imageName?-(Wr-Qe.metrics.width*Qe.scale)/2:(Qe.scale-1)*Wr)),Qe.imageName){const Qt=mt[Qe.imageName];ot=Qt.sdf,Ct=Qt.pixelRatio,ut=ai/Ct}const ts=Ae?[Qe.x+rn,Qe.y]:[0,0];let Tn=Ae?[0,0]:[Qe.x+rn+pe[0],Qe.y+pe[1]-pr],nn=[0,0];ur&&(nn=Tn,Tn=[0,0]);const Gn=Qe.metrics.isDoubleResolution?2:1,Hn=(Qe.metrics.left-ut)*Qe.scale-rn+Tn[0],Wn=(-Qe.metrics.top-ut)*Qe.scale+Tn[1],Br=Hn+we.w/Gn*Qe.scale/Ct,sn=Wn+we.h/Gn*Qe.scale/Ct,Ln=new Q(Hn,Wn),Cn=new Q(Br,Wn),Xn=new Q(Hn,sn),In=new Q(Br,sn);if(ur){const Qt=new Q(-rn,rn-Ic),yr=-Math.PI/2,Sr=Wr/2-rn,bi=new Q(5-Ic-Sr,-(Qe.imageName?Sr:0)),Pr=new Q(...nn);Ln._rotateAround(yr,Qt)._add(bi)._add(Pr),Cn._rotateAround(yr,Qt)._add(bi)._add(Pr),Xn._rotateAround(yr,Qt)._add(bi)._add(Pr),In._rotateAround(yr,Qt)._add(bi)._add(Pr)}if($e){const Qt=Math.sin($e),yr=Math.cos($e),Sr=[yr,-Qt,Qt,yr];Ln._matMult(Sr),Cn._matMult(Sr),Xn._matMult(Sr),In._matMult(Sr)}const Ni=new Q(0,0),li=new Q(0,0);at.push({tl:Ln,tr:Cn,bl:Xn,br:In,tex:we,writingMode:ie.writingMode,glyphOffset:ts,sectionIndex:Qe.sectionIndex,isSDF:ot,pixelOffsetTL:Ni,pixelOffsetBR:li,minFontScaleX:0,minFontScaleY:0})}return at}(0,s,_,h,g,y,a,n.allowVerticalPlacement),G=n.textSizeData;let X=null;G.kind==="source"?(X=[Os*h.layout.get("text-size").evaluate(y,{})],X[0]>na&&yt(`${n.layerIds[0]}: Value for "text-size" is >= ${Pc}. Reduce your "text-size".`)):G.kind==="composite"&&(X=[Os*R.compositeTextSizes[0].evaluate(y,{},B),Os*R.compositeTextSizes[1].evaluate(y,{},B)],(X[0]>na||X[1]>na)&&yt(`${n.layerIds[0]}: Value for "text-size" is >= ${Pc}. Reduce your "text-size".`)),n.addSymbols(n.text,O,X,_,g,y,C,t,w.lineStartIndex,w.lineLength,z,B);for(const me of I)P[me]=n.text.placedSymbolArray.length-1;return 4*O.length}function iv(n){for(const t in n)return n[t];return null}function Fb(n,t,s,a){const h=n.compareText;if(t in h){const g=h[t];for(let y=g.length-1;y>=0;y--)if(a.dist(g[y])<s)return!0}else h[t]=[];return h[t].push(a),!1}const sv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,a]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=sv[15&a];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new Wf(_,y,g,t)}constructor(t,s=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=sv.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-_%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+_+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=s,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Xf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:_}=this,w=[0,g.length-1,0],C=[];for(;w.length;){const I=w.pop()||0,P=w.pop()||0,z=w.pop()||0;if(P-z<=_){for(let G=z;G<=P;G++){const X=y[2*G],me=y[2*G+1];X>=t&&X<=a&&me>=s&&me<=h&&C.push(g[G])}continue}const R=z+P>>1,B=y[2*R],O=y[2*R+1];B>=t&&B<=a&&O>=s&&O<=h&&C.push(g[R]),(I===0?t<=B:s<=O)&&(w.push(z),w.push(R-1),w.push(1-I)),(I===0?a>=B:h>=O)&&(w.push(R+1),w.push(P),w.push(1-I))}return C}within(t,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,_=[0,h.length-1,0],w=[],C=a*a;for(;_.length;){const I=_.pop()||0,P=_.pop()||0,z=_.pop()||0;if(P-z<=y){for(let G=z;G<=P;G++)av(g[2*G],g[2*G+1],t,s)<=C&&w.push(h[G]);continue}const R=z+P>>1,B=g[2*R],O=g[2*R+1];av(B,O,t,s)<=C&&w.push(h[R]),(I===0?t-a<=B:s-a<=O)&&(_.push(z),_.push(R-1),_.push(1-I)),(I===0?t+a>=B:s+a>=O)&&(_.push(R+1),_.push(P),_.push(1-I))}return w}}function Xf(n,t,s,a,h,g){if(h-a<=s)return;const y=a+h>>1;ov(n,t,y,a,h,g),Xf(n,t,s,a,y-1,1-g),Xf(n,t,s,y+1,h,1-g)}function ov(n,t,s,a,h,g){for(;h>a;){if(h-a>600){const C=h-a+1,I=s-a+1,P=Math.log(C),z=.5*Math.exp(2*P/3),R=.5*Math.sqrt(P*z*(C-z)/C)*(I-C/2<0?-1:1);ov(n,t,s,Math.max(a,Math.floor(s-I*z/C+R)),Math.min(h,Math.floor(s+(C-I)*z/C+R)),g)}const y=t[2*s+g];let _=a,w=h;for(zc(n,t,a,s),t[2*h+g]>y&&zc(n,t,a,h);_<w;){for(zc(n,t,_,w),_++,w--;t[2*_+g]<y;)_++;for(;t[2*w+g]>y;)w--}t[2*a+g]===y?zc(n,t,a,w):(w++,zc(n,t,w,h)),w<=s&&(a=w+1),s<=w&&(h=w-1)}}function zc(n,t,s,a){Kf(n,s,a),Kf(t,2*s,2*a),Kf(t,2*s+1,2*a+1)}function Kf(n,t,s){const a=n[t];n[t]=n[s],n[s]=a}function av(n,t,s,a){const h=n-s,g=t-a;return h*h+g*g}var Yf;S.bg=void 0,(Yf=S.bg||(S.bg={})).create="create",Yf.load="load",Yf.fullLoad="fullLoad";let wd=null,Dc=[];const Jf=1e3/60,Qf="loadTime",em="fullLoadTime",Bb={mark(n){performance.mark(n)},frame(n){const t=n;wd!=null&&Dc.push(t-wd),wd=t},clearMetrics(){wd=null,Dc=[],performance.clearMeasures(Qf),performance.clearMeasures(em);for(const n in S.bg)performance.clearMarks(S.bg[n])},getPerformanceMetrics(){performance.measure(Qf,S.bg.create,S.bg.load),performance.measure(em,S.bg.create,S.bg.fullLoad);const n=performance.getEntriesByName(Qf)[0].duration,t=performance.getEntriesByName(em)[0].duration,s=Dc.length,a=1/(Dc.reduce((g,y)=>g+y,0)/s/1e3),h=Dc.filter(g=>g>Jf).reduce((g,y)=>g+(y-Jf)/Jf,0);return{loadTime:n,fullLoadTime:t,fps:a,percentDroppedFrames:h/(s+h)*100,totalFrames:s}}};S.$=class extends A{},S.A=Wl,S.B=lf,S.C=function(n){if(nr==null){const t=n.navigator?n.navigator.userAgent:null;nr=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return nr},S.D=it,S.E=Ds,S.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Eb(()=>this.process()),this.subscription=function(s,a,h,g){return s.addEventListener(a,h,!1),{unsubscribe:()=>{s.removeEventListener(a,h,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=$t(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((s,a)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:s,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const _={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const g=[],y=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Zo(n.data,g)});this.target.postMessage(y,{transfer:g})})}receive(n){const t=n.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const a=this.abortControllers[s];return delete this.abortControllers[s],void(a&&a.abort())}if($t(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(Go(t.error)):h.resolve(Go(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Go(t.data),a=new AbortController;this.abortControllers[n]=a;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,s,a);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}})}completeTask(n,t,s){const a=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Zo(t):null,data:Zo(s,a)};this.target.postMessage(h,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=_t,S.H=function(){var n=new Wl(16);return Wl!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},S.I=Rf,S.J=function(n,t,s){var a,h,g,y,_,w,C,I,P,z,R,B,O=s[0],G=s[1],X=s[2];return t===n?(n[12]=t[0]*O+t[4]*G+t[8]*X+t[12],n[13]=t[1]*O+t[5]*G+t[9]*X+t[13],n[14]=t[2]*O+t[6]*G+t[10]*X+t[14],n[15]=t[3]*O+t[7]*G+t[11]*X+t[15]):(h=t[1],g=t[2],y=t[3],_=t[4],w=t[5],C=t[6],I=t[7],P=t[8],z=t[9],R=t[10],B=t[11],n[0]=a=t[0],n[1]=h,n[2]=g,n[3]=y,n[4]=_,n[5]=w,n[6]=C,n[7]=I,n[8]=P,n[9]=z,n[10]=R,n[11]=B,n[12]=a*O+_*G+P*X+t[12],n[13]=h*O+w*G+z*X+t[13],n[14]=g*O+C*G+R*X+t[14],n[15]=y*O+I*G+B*X+t[15]),n},S.K=function(n,t,s){var a=s[0],h=s[1],g=s[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*g,n[9]=t[9]*g,n[10]=t[10]*g,n[11]=t[11]*g,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},S.L=Vy,S.M=function(n,t){const s={};for(let a=0;a<t.length;a++){const h=t[a];h in n&&(s[h]=n[h])}return s},S.N=ia,S.O=F_,S.P=Q,S.Q=B_,S.R=Bi,S.S=Oi,S.T=Ol,S.U=le,S.V=te,S.W=lt,S.X=Zr,S.Y=x,S.Z=Ac,S._=d,S.a=$r,S.a$=function(n,t){var s=n[0],a=n[1],h=n[2],g=n[3],y=n[4],_=n[5],w=n[6],C=n[7],I=n[8],P=n[9],z=n[10],R=n[11],B=n[12],O=n[13],G=n[14],X=n[15],me=t[0],ie=t[1],pe=t[2],xe=t[3],Ae=t[4],Xe=t[5],mt=t[6],Ge=t[7],$e=t[8],at=t[9],tt=t[10],Qe=t[11],we=t[12],ut=t[13],ot=t[14],Ct=t[15];return Math.abs(s-me)<=Zn*Math.max(1,Math.abs(s),Math.abs(me))&&Math.abs(a-ie)<=Zn*Math.max(1,Math.abs(a),Math.abs(ie))&&Math.abs(h-pe)<=Zn*Math.max(1,Math.abs(h),Math.abs(pe))&&Math.abs(g-xe)<=Zn*Math.max(1,Math.abs(g),Math.abs(xe))&&Math.abs(y-Ae)<=Zn*Math.max(1,Math.abs(y),Math.abs(Ae))&&Math.abs(_-Xe)<=Zn*Math.max(1,Math.abs(_),Math.abs(Xe))&&Math.abs(w-mt)<=Zn*Math.max(1,Math.abs(w),Math.abs(mt))&&Math.abs(C-Ge)<=Zn*Math.max(1,Math.abs(C),Math.abs(Ge))&&Math.abs(I-$e)<=Zn*Math.max(1,Math.abs(I),Math.abs($e))&&Math.abs(P-at)<=Zn*Math.max(1,Math.abs(P),Math.abs(at))&&Math.abs(z-tt)<=Zn*Math.max(1,Math.abs(z),Math.abs(tt))&&Math.abs(R-Qe)<=Zn*Math.max(1,Math.abs(R),Math.abs(Qe))&&Math.abs(B-we)<=Zn*Math.max(1,Math.abs(B),Math.abs(we))&&Math.abs(O-ut)<=Zn*Math.max(1,Math.abs(O),Math.abs(ut))&&Math.abs(G-ot)<=Zn*Math.max(1,Math.abs(G),Math.abs(ot))&&Math.abs(X-Ct)<=Zn*Math.max(1,Math.abs(X),Math.abs(Ct))},S.a0=Ht,S.a1=Zf,S.a2=De,S.a3=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const a of n){const h=window.document.createElement("source");Tr(a)||(t.crossOrigin="Anonymous"),h.src=a,t.appendChild(h)}})},S.a4=function(){return Je++},S.a5=We,S.a6=eu,S.a7=Ku,S.a8=Ja,S.a9=$_,S.aA=function(n){if(n.type==="custom")return new Ib(n);switch(n.type){case"background":return new kb(n);case"circle":return new h1(n);case"fill":return new E1(n);case"fill-extrusion":return new $1(n);case"heatmap":return new p1(n);case"hillshade":return new m1(n);case"line":return new Y1(n);case"raster":return new Cb(n);case"symbol":return new gd(n)}},S.aB=St,S.aC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Xt(n.version,t.version))return[{command:"setStyle",args:[t]}];Xt(n.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Xt(n.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Xt(n.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Xt(n.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Xt(n.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Xt(n.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Xt(n.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Xt(n.light,t.light)||s.push({command:"setLight",args:[t.light]}),Xt(n.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Xt(n.sky,t.sky)||s.push({command:"setSky",args:[t.sky]}),Xt(n.projection,t.projection)||s.push({command:"setProjection",args:[t.projection]});const a={},h=[];(function(y,_,w,C){let I;for(I in _=_||{},y=y||{})Object.prototype.hasOwnProperty.call(y,I)&&(Object.prototype.hasOwnProperty.call(_,I)||pi(I,w,C));for(I in _)Object.prototype.hasOwnProperty.call(_,I)&&(Object.prototype.hasOwnProperty.call(y,I)?Xt(y[I],_[I])||(y[I].type==="geojson"&&_[I].type==="geojson"&&Ai(y,_,I)?cr(w,{command:"setGeoJSONSourceData",args:[I,_[I].data]}):Vn(I,_,w,C)):Pi(I,_,w))})(n.sources,t.sources,h,a);const g=[];n.layers&&n.layers.forEach(y=>{"source"in y&&a[y.source]?s.push({command:"removeLayer",args:[y.id]}):g.push(y)}),s=s.concat(h),function(y,_,w){_=_||[];const C=(y=y||[]).map(hs),I=_.map(hs),P=y.reduce(ds,{}),z=_.reduce(ds,{}),R=C.slice(),B=Object.create(null);let O,G,X,me,ie;for(let pe=0,xe=0;pe<C.length;pe++)O=C[pe],Object.prototype.hasOwnProperty.call(z,O)?xe++:(cr(w,{command:"removeLayer",args:[O]}),R.splice(R.indexOf(O,xe),1));for(let pe=0,xe=0;pe<I.length;pe++)O=I[I.length-1-pe],R[R.length-1-pe]!==O&&(Object.prototype.hasOwnProperty.call(P,O)?(cr(w,{command:"removeLayer",args:[O]}),R.splice(R.lastIndexOf(O,R.length-xe),1)):xe++,me=R[R.length-pe],cr(w,{command:"addLayer",args:[z[O],me]}),R.splice(R.length-pe,0,O),B[O]=!0);for(let pe=0;pe<I.length;pe++)if(O=I[pe],G=P[O],X=z[O],!B[O]&&!Xt(G,X))if(Xt(G.source,X.source)&&Xt(G["source-layer"],X["source-layer"])&&Xt(G.type,X.type)){for(ie in Yr(G.layout,X.layout,w,O,null,"setLayoutProperty"),Yr(G.paint,X.paint,w,O,null,"setPaintProperty"),Xt(G.filter,X.filter)||cr(w,{command:"setFilter",args:[O,X.filter]}),Xt(G.minzoom,X.minzoom)&&Xt(G.maxzoom,X.maxzoom)||cr(w,{command:"setLayerZoomRange",args:[O,X.minzoom,X.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?Yr(G[ie],X[ie],w,O,ie.slice(6),"setPaintProperty"):Xt(G[ie],X[ie])||cr(w,{command:"setLayerProperty",args:[O,ie,X[ie]]}));for(ie in X)Object.prototype.hasOwnProperty.call(X,ie)&&!Object.prototype.hasOwnProperty.call(G,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?Yr(G[ie],X[ie],w,O,ie.slice(6),"setPaintProperty"):Xt(G[ie],X[ie])||cr(w,{command:"setLayerProperty",args:[O,ie,X[ie]]}))}else cr(w,{command:"removeLayer",args:[O]}),me=R[R.lastIndexOf(O)+1],cr(w,{command:"addLayer",args:[X,me]})}(g,t.layers,s)}catch(a){console.warn("Unable to compute style diff:",a),s=[{command:"setStyle",args:[t]}]}return s},S.aD=function(n){const t=[],s=n.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},S.aE=function n(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let a=0;a<t.length;a++)if(!n(t[a],s[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const a in t)if(!n(t[a],s[a]))return!1;return!0}return t===s},S.aF=Et,S.aG=wt,S.aH=class extends Xa{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},S.aI=nd,S.aJ=class extends Xa{constructor(n,t){super(n,t),this.current=n1}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},S.aK=Ay,S.aL=My,S.aM=rr,S.aN=class extends Xa{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},S.aO=class extends Xa{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},S.aP=function(n,t,s,a,h,g,y){var _=1/(t-s),w=1/(a-h),C=1/(g-y);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*C,n[11]=0,n[12]=(t+s)*_,n[13]=(h+a)*w,n[14]=(y+g)*C,n[15]=1,n},S.aQ=c1,S.aR=class extends oe{},S.aS=tb,S.aT=class extends ge{},S.aU=Sf,S.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},S.aW=Gy,S.aX=bn,S.aY=Fi,S.aZ=class extends st{},S.a_=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},S.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,a,h,g)=>{const y=h||g;return t[a]=!y||y.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},S.ab=function(n,t){const s=[];for(const a in n)a in t||s.push(a);return s},S.ac=Ne,S.ad=function(n,t,s){var a=Math.sin(s),h=Math.cos(s),g=t[0],y=t[1],_=t[2],w=t[3],C=t[4],I=t[5],P=t[6],z=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=g*h+C*a,n[1]=y*h+I*a,n[2]=_*h+P*a,n[3]=w*h+z*a,n[4]=C*h-g*a,n[5]=I*h-y*a,n[6]=P*h-_*a,n[7]=z*h-w*a,n},S.ae=function(n){var t=new Wl(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},S.af=ad,S.ag=function(n,t){let s=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:y}=n,_=h?Ne(un.interpolationFactor(h,t,g,y),0,1):0;n.kind==="camera"?a=yn.number(n.minSize,n.maxSize,_):s=_}return{uSizeT:s,uSize:a}},S.ai=function(n,{uSize:t,uSizeT:s},{lowerSize:a,upperSize:h}){return n.kind==="source"?a/Os:n.kind==="composite"?yn.number(a/Os,h/Os,s):t},S.aj=Nf,S.ak=function(n,t,s,a){const h=t.y-n.y,g=t.x-n.x,y=a.y-s.y,_=a.x-s.x,w=y*g-_*h;if(w===0)return null;const C=(_*(n.y-s.y)-y*(n.x-s.x))/w;return new Q(n.x+C*g,n.y+C*h)},S.al=H_,S.am=Ry,S.an=xf,S.ao=function(n){let t=1/0,s=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),s=Math.min(s,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return[t,s,a,h]},S.ap=Wr,S.ar=Of,S.as=function(n,t){var s=t[0],a=t[1],h=t[2],g=t[3],y=t[4],_=t[5],w=t[6],C=t[7],I=t[8],P=t[9],z=t[10],R=t[11],B=t[12],O=t[13],G=t[14],X=t[15],me=s*_-a*y,ie=s*w-h*y,pe=s*C-g*y,xe=a*w-h*_,Ae=a*C-g*_,Xe=h*C-g*w,mt=I*O-P*B,Ge=I*G-z*B,$e=I*X-R*B,at=P*G-z*O,tt=P*X-R*O,Qe=z*X-R*G,we=me*Qe-ie*tt+pe*at+xe*$e-Ae*Ge+Xe*mt;return we?(n[0]=(_*Qe-w*tt+C*at)*(we=1/we),n[1]=(h*tt-a*Qe-g*at)*we,n[2]=(O*Xe-G*Ae+X*xe)*we,n[3]=(z*Ae-P*Xe-R*xe)*we,n[4]=(w*$e-y*Qe-C*Ge)*we,n[5]=(s*Qe-h*$e+g*Ge)*we,n[6]=(G*pe-B*Xe-X*ie)*we,n[7]=(I*Xe-z*pe+R*ie)*we,n[8]=(y*tt-_*$e+C*mt)*we,n[9]=(a*$e-s*tt-g*mt)*we,n[10]=(B*Ae-O*pe+X*me)*we,n[11]=(P*pe-I*Ae-R*me)*we,n[12]=(_*Ge-y*at-w*mt)*we,n[13]=(s*at-a*Ge+h*mt)*we,n[14]=(O*ie-B*xe-G*me)*we,n[15]=(I*xe-P*ie+z*me)*we,n):null},S.at=Hf,S.au=Bf,S.av=Wf,S.aw=function(){const n={},t=_e.$version;for(const s in _e.$root){const a=_e.$root[s];if(a.required){let h=null;h=s==="version"?t:a.type==="array"?[]:{},h!=null&&(n[s]=h)}}return n},S.ax=cc,S.ay=xt,S.az=function(n){n=n.slice();const t=Object.create(null);for(let s=0;s<n.length;s++)t[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=jn(n[s],t[n[s].ref]));return n},S.b=er,S.b0=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},S.b1=function(n,t,s){return n[0]=t[0]*s[0],n[1]=t[1]*s[1],n[2]=t[2]*s[2],n[3]=t[3]*s[3],n},S.b2=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},S.b3=Ke,S.b4=j_,S.b5=O_,S.b6=function(n,t,s,a,h){var g,y=1/Math.tan(t/2);return n[0]=y/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+a)*(g=1/(a-h)),n[14]=2*h*a*g):(n[10]=-1,n[14]=-2*a),n},S.b7=function(n,t,s){var a=Math.sin(s),h=Math.cos(s),g=t[4],y=t[5],_=t[6],w=t[7],C=t[8],I=t[9],P=t[10],z=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=g*h+C*a,n[5]=y*h+I*a,n[6]=_*h+P*a,n[7]=w*h+z*a,n[8]=C*h-g*a,n[9]=I*h-y*a,n[10]=P*h-_*a,n[11]=z*h-w*a,n},S.b8=ce,S.b9=Ie,S.bA=d_,S.bB=function(n){return n.message===kt},S.bC=No,S.bD=si,S.ba=function(n){return n*Math.PI/180},S.bb=function(n,t){const{x:s,y:a}=Ac.fromLngLat(t);return!(n<0||n>25||a<0||a>=1||s<0||s>=1)},S.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},S.bd=class extends E{},S.be=$f,S.bf=Bb,S.bh=rt,S.bi=function(n,t){$r.REGISTERED_PROTOCOLS[n]=t},S.bj=function(n){delete $r.REGISTERED_PROTOCOLS[n]},S.bk=function(n,t){const s={};for(let h=0;h<n.length;h++){const g=t&&t[n[h].id]||Zh(n[h]);t&&(t[n[h].id]=g);let y=s[g];y||(y=s[g]=[]),y.push(n[h])}const a=[];for(const h in s)a.push(s[h]);return a},S.bl=et,S.bm=U_,S.bn=q_,S.bo=w_,S.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Zr/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],s=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new vr(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new vr(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new vr(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=n.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new vr(C),n.canonical),a["text-size"].possiblyEvaluate(new vr(I),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=n.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new vr(C),n.canonical),a["icon-size"].possiblyEvaluate(new vr(I),n.canonical)]}const g=s.get("text-line-height")*Wr,y=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",_=s.get("text-keep-upright"),w=s.get("text-size");for(const C of n.bucket.features){const I=s.get("text-font").evaluate(C,{},n.canonical).join(","),P=w.evaluate(C,{},n.canonical),z=h.layoutTextSize.evaluate(C,{},n.canonical),R=h.layoutIconSize.evaluate(C,{},n.canonical),B={horizontal:{},vertical:void 0},O=C.text;let G,X=[0,0];if(O){const pe=O.toString(),xe=s.get("text-letter-spacing").evaluate(C,{},n.canonical)*Wr,Ae=uf(pe)?xe:0,Xe=s.get("text-anchor").evaluate(C,{},n.canonical),mt=rv(t,C,n.canonical);if(!mt){const tt=s.get("text-radial-offset").evaluate(C,{},n.canonical);X=tt?tv(Xe,[tt*Wr,Gf]):s.get("text-offset").evaluate(C,{},n.canonical).map(Qe=>Qe*Wr)}let Ge=y?"center":s.get("text-justify").evaluate(C,{},n.canonical);const $e=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(C,{},n.canonical)*Wr:1/0,at=()=>{n.bucket.allowVerticalPlacement&&hc(pe)&&(B.vertical=pd(O,n.glyphMap,n.glyphPositions,n.imagePositions,I,$e,g,Xe,"left",Ae,X,S.ah.vertical,!0,z,P))};if(!y&&mt){const tt=new Set;if(Ge==="auto")for(let we=0;we<mt.values.length;we+=2)tt.add(Hf(mt.values[we]));else tt.add(Ge);let Qe=!1;for(const we of tt)if(!B.horizontal[we])if(Qe)B.horizontal[we]=B.horizontal[0];else{const ut=pd(O,n.glyphMap,n.glyphPositions,n.imagePositions,I,$e,g,"center",we,Ae,X,S.ah.horizontal,!1,z,P);ut&&(B.horizontal[we]=ut,Qe=ut.positionedLines.length===1)}at()}else{Ge==="auto"&&(Ge=Hf(Xe));const tt=pd(O,n.glyphMap,n.glyphPositions,n.imagePositions,I,$e,g,Xe,Ge,Ae,X,S.ah.horizontal,!1,z,P);tt&&(B.horizontal[Ge]=tt),at(),hc(pe)&&y&&_&&(B.vertical=pd(O,n.glyphMap,n.glyphPositions,n.imagePositions,I,$e,g,Xe,Ge,Ae,X,S.ah.vertical,!1,z,P))}}let me=!1;if(C.icon&&C.icon.name){const pe=n.imageMap[C.icon.name];pe&&(G=vb(n.imagePositions[C.icon.name],s.get("icon-offset").evaluate(C,{},n.canonical),s.get("icon-anchor").evaluate(C,{},n.canonical)),me=!!pe.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=me:n.bucket.sdfIcons!==me&&yt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pe.pixelRatio!==n.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const ie=iv(B.horizontal)||B.vertical;n.bucket.iconsInText=!!ie&&ie.iconsInText,(ie||G)&&Rb(n.bucket,C,B,G,n.imageMap,h,z,R,X,me,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},S.bq=Mf,S.br=Ef,S.bs=Af,S.bt=ta,S.bu=Df,S.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},S.bw=function(n,t,s,a,h){return d(this,void 0,void 0,function*(){if(te())try{return yield lt(n,t,s,a,h)}catch{}return function(g,y,_,w,C){const I=g.width,P=g.height;He&&Rt||(He=new OffscreenCanvas(I,P),Rt=He.getContext("2d",{willReadFrequently:!0})),He.width=I,He.height=P,Rt.drawImage(g,0,0,I,P);const z=Rt.getImageData(y,_,w,C);return Rt.clearRect(0,0,I,P),z.data}(n,t,s,a,h)})},S.bx=V_,S.by=V,S.bz=se,S.c=An,S.d=n=>d(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=qe,S.f=n=>new Promise((t,s)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=Pe})},a.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});a.src=n.byteLength?URL.createObjectURL(h):Pe}),S.g=ct,S.h=(n,t)=>ir(qe(n,{type:"json"}),t),S.i=$t,S.j=Ei,S.k=Nn,S.l=(n,t)=>ir(qe(n,{type:"arrayBuffer"}),t),S.m=ir,S.n=function(n){return new Df(n).readFields(db,[])},S.o=xc,S.p=x_,S.q=m,S.r=af,S.s=Tr,S.t=lc,S.u=ao,S.v=_e,S.w=yt,S.x=function([n,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(s),y:n*Math.sin(t)*Math.sin(s),z:n*Math.cos(s)}},S.y=yn,S.z=vr}),v("worker",["./shared"],function(S){class d{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,L){for(const q of D){this._layerConfigs[q.id]=q;const re=this._layers[q.id]=S.aA(q);re._featureFilter=S.a7(re.filter),this.keyCache[q.id]&&delete this.keyCache[q.id]}for(const q of L)delete this.keyCache[q],delete this._layerConfigs[q],delete this._layers[q];this.familiesBySource={};const N=S.bk(Object.values(this._layerConfigs),this.keyCache);for(const q of N){const re=q.map(ye=>this._layers[ye.id]),ae=re[0];if(ae.visibility==="none")continue;const fe=ae.source||"";let J=this.familiesBySource[fe];J||(J=this.familiesBySource[fe]={});const ve=ae.sourceLayer||"_geojsonTileLayer";let Se=J[ve];Se||(Se=J[ve]=[]),Se.push(re)}}}class V{constructor(D){const L={},N=[];for(const fe in D){const J=D[fe],ve=L[fe]={};for(const Se in J){const ye=J[+Se];if(!ye||ye.bitmap.width===0||ye.bitmap.height===0)continue;const Re={x:0,y:0,w:ye.bitmap.width+2,h:ye.bitmap.height+2};N.push(Re),ve[Se]={rect:Re,metrics:ye.metrics}}}const{w:q,h:re}=S.p(N),ae=new S.o({width:q||1,height:re||1});for(const fe in D){const J=D[fe];for(const ve in J){const Se=J[+ve];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const ye=L[fe][ve].rect;S.o.copy(Se.bitmap,ae,{x:0,y:0},{x:ye.x+1,y:ye.y+1},Se.bitmap)}}this.image=ae,this.positions=L}}S.bl("GlyphAtlas",V);class se{constructor(D){this.tileID=new S.S(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[]}parse(D,L,N,q){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=D,this.collisionBoxArray=new S.a5;const re=new S.bm(Object.keys(D.layers).sort()),ae=new S.bn(this.tileID,this.promoteId);ae.bucketLayerIDs=[];const fe={},J={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},ve=L.familiesBySource[this.source];for(const Ft in ve){const tr=D.layers[Ft];if(!tr)continue;tr.version===1&&S.w(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fr=re.encode(Ft),Lr=[];for(let qr=0;qr<tr.length;qr++){const Qr=tr.feature(qr),ps=ae.getId(Qr,Ft);Lr.push({feature:Qr,id:ps,index:qr,sourceLayerIndex:fr})}for(const qr of ve[Ft]){const Qr=qr[0];Qr.source!==this.source&&S.w(`layer.source = ${Qr.source} does not equal this.source = ${this.source}`),Qr.minzoom&&this.zoom<Math.floor(Qr.minzoom)||Qr.maxzoom&&this.zoom>=Qr.maxzoom||Qr.visibility!=="none"&&(ue(qr,this.zoom,N),(fe[Qr.id]=Qr.createBucket({index:ae.bucketLayerIDs.length,layers:qr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fr,sourceID:this.source})).populate(Lr,J,this.tileID.canonical),ae.bucketLayerIDs.push(qr.map(ps=>ps.id)))}}const Se=S.aF(J.glyphDependencies,Ft=>Object.keys(Ft).map(Number));this.inFlightDependencies.forEach(Ft=>Ft==null?void 0:Ft.abort()),this.inFlightDependencies=[];let ye=Promise.resolve({});if(Object.keys(Se).length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),ye=q.sendAsync({type:"GG",data:{stacks:Se,source:this.source,tileID:this.tileID,type:"glyphs"}},Ft)}const Re=Object.keys(J.iconDependencies);let nt=Promise.resolve({});if(Re.length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),nt=q.sendAsync({type:"GI",data:{icons:Re,source:this.source,tileID:this.tileID,type:"icons"}},Ft)}const dt=Object.keys(J.patternDependencies);let Ut=Promise.resolve({});if(dt.length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),Ut=q.sendAsync({type:"GI",data:{icons:dt,source:this.source,tileID:this.tileID,type:"patterns"}},Ft)}const[Pt,Nt,jt]=yield Promise.all([ye,nt,Ut]),Cr=new V(Pt),hr=new S.bo(Nt,jt);for(const Ft in fe){const tr=fe[Ft];tr instanceof S.a6?(ue(tr.layers,this.zoom,N),S.bp({bucket:tr,glyphMap:Pt,glyphPositions:Cr.positions,imageMap:Nt,imagePositions:hr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):tr.hasPattern&&(tr instanceof S.bq||tr instanceof S.br||tr instanceof S.bs)&&(ue(tr.layers,this.zoom,N),tr.addFeatures(J,this.tileID.canonical,hr.patternPositions))}return this.status="done",{buckets:Object.values(fe).filter(Ft=>!Ft.isEmpty()),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cr.image,imageAtlas:hr,glyphMap:this.returnDependencies?Pt:null,iconMap:this.returnDependencies?Nt:null,glyphPositions:this.returnDependencies?Cr.positions:null}})}}function ue(W,D,L){const N=new S.z(D);for(const q of W)q.recalculate(N,L)}class Q{constructor(D,L,N){this.actor=D,this.layerIndex=L,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(D,L){return S._(this,void 0,void 0,function*(){const N=yield S.l(D.request,L);try{return{vectorTile:new S.bt.VectorTile(new S.bu(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(q){const re=new Uint8Array(N.data);let ae=`Unable to parse the tile at ${D.request.url}, `;throw ae+=re[0]===31&&re[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${q.message}`,new Error(ae)}})}loadTile(D){return S._(this,void 0,void 0,function*(){const L=D.uid,N=!!(D&&D.request&&D.request.collectResourceTiming)&&new S.bv(D.request),q=new se(D);this.loading[L]=q;const re=new AbortController;q.abort=re;try{const ae=yield this.loadVectorTile(D,re);if(delete this.loading[L],!ae)return null;const fe=ae.rawData,J={};ae.expires&&(J.expires=ae.expires),ae.cacheControl&&(J.cacheControl=ae.cacheControl);const ve={};if(N){const ye=N.finish();ye&&(ve.resourceTiming=JSON.parse(JSON.stringify(ye)))}q.vectorTile=ae.vectorTile;const Se=q.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[L]=q,this.fetching[L]={rawTileData:fe,cacheControl:J,resourceTiming:ve};try{const ye=yield Se;return S.e({rawTileData:fe.slice(0)},ye,J,ve)}finally{delete this.fetching[L]}}catch(ae){throw delete this.loading[L],q.status="done",this.loaded[L]=q,ae}})}reloadTile(D){return S._(this,void 0,void 0,function*(){const L=D.uid;if(!this.loaded||!this.loaded[L])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const N=this.loaded[L];if(N.showCollisionBoxes=D.showCollisionBoxes,N.status==="parsing"){const q=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor);let re;if(this.fetching[L]){const{rawTileData:ae,cacheControl:fe,resourceTiming:J}=this.fetching[L];delete this.fetching[L],re=S.e({rawTileData:ae.slice(0)},q,fe,J)}else re=q;return re}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(D){return S._(this,void 0,void 0,function*(){const L=this.loading,N=D.uid;L&&L[N]&&L[N].abort&&(L[N].abort.abort(),delete L[N])})}removeTile(D){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[D.uid]&&delete this.loaded[D.uid]})}}class U{constructor(){this.loaded={}}loadTile(D){return S._(this,void 0,void 0,function*(){const{uid:L,encoding:N,rawImageData:q,redFactor:re,greenFactor:ae,blueFactor:fe,baseShift:J}=D,ve=q.width+2,Se=q.height+2,ye=S.b(q)?new S.R({width:ve,height:Se},yield S.bw(q,-1,-1,ve,Se)):q,Re=new S.bx(L,ye,N,re,ae,fe,J);return this.loaded=this.loaded||{},this.loaded[L]=Re,Re})}removeTile(D){const L=this.loaded,N=D.uid;L&&L[N]&&delete L[N]}}function Le(W,D){if(W.length!==0){Ee(W[0],D);for(var L=1;L<W.length;L++)Ee(W[L],!D)}}function Ee(W,D){for(var L=0,N=0,q=0,re=W.length,ae=re-1;q<re;ae=q++){var fe=(W[q][0]-W[ae][0])*(W[ae][1]+W[q][1]),J=L+fe;N+=Math.abs(L)>=Math.abs(fe)?L-J+fe:fe-J+L,L=J}L+N>=0!=!!D&&W.reverse()}var Fe=S.by(function W(D,L){var N,q=D&&D.type;if(q==="FeatureCollection")for(N=0;N<D.features.length;N++)W(D.features[N],L);else if(q==="GeometryCollection")for(N=0;N<D.geometries.length;N++)W(D.geometries[N],L);else if(q==="Feature")W(D.geometry,L);else if(q==="Polygon")Le(D.coordinates,L);else if(q==="MultiPolygon")for(N=0;N<D.coordinates.length;N++)Le(D.coordinates[N],L);return D});const gt=S.bt.VectorTileFeature.prototype.toGeoJSON;var le={exports:{}},te=S.bz,ce=S.bt.VectorTileFeature,Ie=Ne;function Ne(W,D){this.options=D||{},this.features=W,this.length=W.length}function Ke(W,D){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=D||4096}Ne.prototype.feature=function(W){return new Ke(this.features[W],this.options.extent)},Ke.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var D=0;D<W.length;D++){for(var L=W[D],N=[],q=0;q<L.length;q++)N.push(new te(L[q][0],L[q][1]));this.geometry.push(N)}return this.geometry},Ke.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,D=1/0,L=-1/0,N=1/0,q=-1/0,re=0;re<W.length;re++)for(var ae=W[re],fe=0;fe<ae.length;fe++){var J=ae[fe];D=Math.min(D,J.x),L=Math.max(L,J.x),N=Math.min(N,J.y),q=Math.max(q,J.y)}return[D,N,L,q]},Ke.prototype.toGeoJSON=ce.prototype.toGeoJSON;var qe=S.bA,Je=Ie;function Et(W){var D=new qe;return function(L,N){for(var q in L.layers)N.writeMessage(3,wt,L.layers[q])}(W,D),D.finish()}function wt(W,D){var L;D.writeVarintField(15,W.version||1),D.writeStringField(1,W.name||""),D.writeVarintField(5,W.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<W.length;L++)N.feature=W.feature(L),D.writeMessage(2,St,N);var q=N.keys;for(L=0;L<q.length;L++)D.writeStringField(3,q[L]);var re=N.values;for(L=0;L<re.length;L++)D.writeMessage(4,nr,re[L])}function St(W,D){var L=W.feature;L.id!==void 0&&D.writeVarintField(1,L.id),D.writeMessage(2,or,W),D.writeVarintField(3,L.type),D.writeMessage(4,$t,L)}function or(W,D){var L=W.feature,N=W.keys,q=W.values,re=W.keycache,ae=W.valuecache;for(var fe in L.properties){var J=L.properties[fe],ve=re[fe];if(J!==null){ve===void 0&&(N.push(fe),re[fe]=ve=N.length-1),D.writeVarint(ve);var Se=typeof J;Se!=="string"&&Se!=="boolean"&&Se!=="number"&&(J=JSON.stringify(J));var ye=Se+":"+J,Re=ae[ye];Re===void 0&&(q.push(J),ae[ye]=Re=q.length-1),D.writeVarint(Re)}}}function yt(W,D){return(D<<3)+(7&W)}function Mt(W){return W<<1^W>>31}function $t(W,D){for(var L=W.loadGeometry(),N=W.type,q=0,re=0,ae=L.length,fe=0;fe<ae;fe++){var J=L[fe],ve=1;N===1&&(ve=J.length),D.writeVarint(yt(1,ve));for(var Se=N===3?J.length-1:J.length,ye=0;ye<Se;ye++){ye===1&&N!==1&&D.writeVarint(yt(2,Se-1));var Re=J[ye].x-q,nt=J[ye].y-re;D.writeVarint(Mt(Re)),D.writeVarint(Mt(nt)),q+=Re,re+=nt}N===3&&D.writeVarint(yt(7,1))}}function nr(W,D){var L=typeof W;L==="string"?D.writeStringField(1,W):L==="boolean"?D.writeBooleanField(7,W):L==="number"&&(W%1!=0?D.writeDoubleField(3,W):W<0?D.writeSVarintField(6,W):D.writeVarintField(5,W))}le.exports=Et,le.exports.fromVectorTileJs=Et,le.exports.fromGeojsonVt=function(W,D){D=D||{};var L={};for(var N in W)L[N]=new Je(W[N].features,D),L[N].name=N,L[N].version=D.version,L[N].extent=D.extent;return Et({layers:L})},le.exports.GeoJSONWrapper=Je;var er=S.by(le.exports);const Pe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},lt=Math.fround||(He=new Float32Array(1),W=>(He[0]=+W,He[0]));var He;const Rt=3,kt=5,An=6;class $r{constructor(D){this.options=Object.assign(Object.create(Pe),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:L,minZoom:N,maxZoom:q}=this.options;L&&console.time("total time");const re=`prepare ${D.length} points`;L&&console.time(re),this.points=D;const ae=[];for(let J=0;J<D.length;J++){const ve=D[J];if(!ve.geometry)continue;const[Se,ye]=ve.geometry.coordinates,Re=lt(rt(Se)),nt=lt(xt(ye));ae.push(Re,nt,1/0,J,-1,1),this.options.reduce&&ae.push(0)}let fe=this.trees[q+1]=this._createTree(ae);L&&console.timeEnd(re);for(let J=q;J>=N;J--){const ve=+Date.now();fe=this.trees[J]=this._createTree(this._cluster(fe,J)),L&&console.log("z%d: %d clusters in %dms",J,fe.numItems,+Date.now()-ve)}return L&&console.timeEnd("total time"),this}getClusters(D,L){let N=((D[0]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,D[1]));let re=D[2]===180?180:((D[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)N=-180,re=180;else if(N>re){const ye=this.getClusters([N,q,180,ae],L),Re=this.getClusters([-180,q,re,ae],L);return ye.concat(Re)}const fe=this.trees[this._limitZoom(L)],J=fe.range(rt(N),xt(ae),rt(re),xt(q)),ve=fe.data,Se=[];for(const ye of J){const Re=this.stride*ye;Se.push(ve[Re+kt]>1?ct(ve,Re,this.clusterProps):this.points[ve[Re+Rt]])}return Se}getChildren(D){const L=this._getOriginId(D),N=this._getOriginZoom(D),q="No cluster with the specified id.",re=this.trees[N];if(!re)throw new Error(q);const ae=re.data;if(L*this.stride>=ae.length)throw new Error(q);const fe=this.options.radius/(this.options.extent*Math.pow(2,N-1)),J=re.within(ae[L*this.stride],ae[L*this.stride+1],fe),ve=[];for(const Se of J){const ye=Se*this.stride;ae[ye+4]===D&&ve.push(ae[ye+kt]>1?ct(ae,ye,this.clusterProps):this.points[ae[ye+Rt]])}if(ve.length===0)throw new Error(q);return ve}getLeaves(D,L,N){const q=[];return this._appendLeaves(q,D,L=L||10,N=N||0,0),q}getTile(D,L,N){const q=this.trees[this._limitZoom(D)],re=Math.pow(2,D),{extent:ae,radius:fe}=this.options,J=fe/ae,ve=(N-J)/re,Se=(N+1+J)/re,ye={features:[]};return this._addTileFeatures(q.range((L-J)/re,ve,(L+1+J)/re,Se),q.data,L,N,re,ye),L===0&&this._addTileFeatures(q.range(1-J/re,ve,1,Se),q.data,re,N,re,ye),L===re-1&&this._addTileFeatures(q.range(0,ve,J/re,Se),q.data,-1,N,re,ye),ye.features.length?ye:null}getClusterExpansionZoom(D){let L=this._getOriginZoom(D)-1;for(;L<=this.options.maxZoom;){const N=this.getChildren(D);if(L++,N.length!==1)break;D=N[0].properties.cluster_id}return L}_appendLeaves(D,L,N,q,re){const ae=this.getChildren(L);for(const fe of ae){const J=fe.properties;if(J&&J.cluster?re+J.point_count<=q?re+=J.point_count:re=this._appendLeaves(D,J.cluster_id,N,q,re):re<q?re++:D.push(fe),D.length===N)break}return re}_createTree(D){const L=new S.av(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<D.length;N+=this.stride)L.add(D[N],D[N+1]);return L.finish(),L.data=D,L}_addTileFeatures(D,L,N,q,re,ae){for(const fe of D){const J=fe*this.stride,ve=L[J+kt]>1;let Se,ye,Re;if(ve)Se=_t(L,J,this.clusterProps),ye=L[J],Re=L[J+1];else{const Ut=this.points[L[J+Rt]];Se=Ut.properties;const[Pt,Nt]=Ut.geometry.coordinates;ye=rt(Pt),Re=xt(Nt)}const nt={type:1,geometry:[[Math.round(this.options.extent*(ye*re-N)),Math.round(this.options.extent*(Re*re-q))]],tags:Se};let dt;dt=ve||this.options.generateId?L[J+Rt]:this.points[L[J+Rt]].id,dt!==void 0&&(nt.id=dt),ae.features.push(nt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,L){const{radius:N,extent:q,reduce:re,minPoints:ae}=this.options,fe=N/(q*Math.pow(2,L)),J=D.data,ve=[],Se=this.stride;for(let ye=0;ye<J.length;ye+=Se){if(J[ye+2]<=L)continue;J[ye+2]=L;const Re=J[ye],nt=J[ye+1],dt=D.within(J[ye],J[ye+1],fe),Ut=J[ye+kt];let Pt=Ut;for(const Nt of dt){const jt=Nt*Se;J[jt+2]>L&&(Pt+=J[jt+kt])}if(Pt>Ut&&Pt>=ae){let Nt,jt=Re*Ut,Cr=nt*Ut,hr=-1;const Ft=((ye/Se|0)<<5)+(L+1)+this.points.length;for(const tr of dt){const fr=tr*Se;if(J[fr+2]<=L)continue;J[fr+2]=L;const Lr=J[fr+kt];jt+=J[fr]*Lr,Cr+=J[fr+1]*Lr,J[fr+4]=Ft,re&&(Nt||(Nt=this._map(J,ye,!0),hr=this.clusterProps.length,this.clusterProps.push(Nt)),re(Nt,this._map(J,fr)))}J[ye+4]=Ft,ve.push(jt/Pt,Cr/Pt,1/0,Ft,-1,Pt),re&&ve.push(hr)}else{for(let Nt=0;Nt<Se;Nt++)ve.push(J[ye+Nt]);if(Pt>1)for(const Nt of dt){const jt=Nt*Se;if(!(J[jt+2]<=L)){J[jt+2]=L;for(let Cr=0;Cr<Se;Cr++)ve.push(J[jt+Cr])}}}}return ve}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,L,N){if(D[L+kt]>1){const ae=this.clusterProps[D[L+An]];return N?Object.assign({},ae):ae}const q=this.points[D[L+Rt]].properties,re=this.options.map(q);return N&&re===q?Object.assign({},re):re}}function ct(W,D,L){return{type:"Feature",id:W[D+Rt],properties:_t(W,D,L),geometry:{type:"Point",coordinates:[(N=W[D],360*(N-.5)),ir(W[D+1])]}};var N}function _t(W,D,L){const N=W[D+kt],q=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,re=W[D+An],ae=re===-1?{}:Object.assign({},L[re]);return Object.assign(ae,{cluster:!0,cluster_id:W[D+Rt],point_count:N,point_count_abbreviated:q})}function rt(W){return W/360+.5}function xt(W){const D=Math.sin(W*Math.PI/180),L=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return L<0?0:L>1?1:L}function ir(W){const D=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Tr(W,D,L,N){let q=N;const re=D+(L-D>>1);let ae,fe=L-D;const J=W[D],ve=W[D+1],Se=W[L],ye=W[L+1];for(let Re=D+3;Re<L;Re+=3){const nt=zr(W[Re],W[Re+1],J,ve,Se,ye);if(nt>q)ae=Re,q=nt;else if(nt===q){const dt=Math.abs(Re-re);dt<fe&&(ae=Re,fe=dt)}}q>N&&(ae-D>3&&Tr(W,D,ae,N),W[ae+2]=q,L-ae>3&&Tr(W,ae,L,N))}function zr(W,D,L,N,q,re){let ae=q-L,fe=re-N;if(ae!==0||fe!==0){const J=((W-L)*ae+(D-N)*fe)/(ae*ae+fe*fe);J>1?(L=q,N=re):J>0&&(L+=ae*J,N+=fe*J)}return ae=W-L,fe=D-N,ae*ae+fe*fe}function Kr(W,D,L,N){const q={id:W??null,type:D,geometry:L,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(D==="Point"||D==="MultiPoint"||D==="LineString")Nn(q,L);else if(D==="Polygon")Nn(q,L[0]);else if(D==="MultiLineString")for(const re of L)Nn(q,re);else if(D==="MultiPolygon")for(const re of L)Nn(q,re[0]);return q}function Nn(W,D){for(let L=0;L<D.length;L+=3)W.minX=Math.min(W.minX,D[L]),W.minY=Math.min(W.minY,D[L+1]),W.maxX=Math.max(W.maxX,D[L]),W.maxY=Math.max(W.maxY,D[L+1])}function Ei(W,D,L,N){if(!D.geometry)return;const q=D.geometry.coordinates;if(q&&q.length===0)return;const re=D.geometry.type,ae=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2);let fe=[],J=D.id;if(L.promoteId?J=D.properties[L.promoteId]:L.generateId&&(J=N||0),re==="Point")Ds(q,fe);else if(re==="MultiPoint")for(const ve of q)Ds(ve,fe);else if(re==="LineString")_e(q,fe,ae,!1);else if(re==="MultiLineString"){if(L.lineMetrics){for(const ve of q)fe=[],_e(ve,fe,ae,!1),W.push(Kr(J,"LineString",fe,D.properties));return}Wi(q,fe,ae,!1)}else if(re==="Polygon")Wi(q,fe,ae,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(const ve of D.geometry.geometries)Ei(W,{id:J,geometry:ve,properties:D.properties},L,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ve of q){const Se=[];Wi(ve,Se,ae,!0),fe.push(Se)}}W.push(Kr(J,re,fe,D.properties))}function Ds(W,D){D.push(jn(W[0]),Xt(W[1]),0)}function _e(W,D,L,N){let q,re,ae=0;for(let J=0;J<W.length;J++){const ve=jn(W[J][0]),Se=Xt(W[J][1]);D.push(ve,Se,0),J>0&&(ae+=N?(q*Se-ve*re)/2:Math.sqrt(Math.pow(ve-q,2)+Math.pow(Se-re,2))),q=ve,re=Se}const fe=D.length-3;D[2]=1,Tr(D,0,fe,L),D[fe+2]=1,D.size=Math.abs(ae),D.start=0,D.end=D.size}function Wi(W,D,L,N){for(let q=0;q<W.length;q++){const re=[];_e(W[q],re,L,N),D.push(re)}}function jn(W){return W/360+.5}function Xt(W){const D=Math.sin(W*Math.PI/180),L=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return L<0?0:L>1?1:L}function cr(W,D,L,N,q,re,ae,fe){if(N/=D,re>=(L/=D)&&ae<N)return W;if(ae<L||re>=N)return null;const J=[];for(const ve of W){const Se=ve.geometry;let ye=ve.type;const Re=q===0?ve.minX:ve.minY,nt=q===0?ve.maxX:ve.maxY;if(Re>=L&&nt<N){J.push(ve);continue}if(nt<L||Re>=N)continue;let dt=[];if(ye==="Point"||ye==="MultiPoint")Pi(Se,dt,L,N,q);else if(ye==="LineString")pi(Se,dt,L,N,q,!1,fe.lineMetrics);else if(ye==="MultiLineString")Ai(Se,dt,L,N,q,!1);else if(ye==="Polygon")Ai(Se,dt,L,N,q,!0);else if(ye==="MultiPolygon")for(const Ut of Se){const Pt=[];Ai(Ut,Pt,L,N,q,!0),Pt.length&&dt.push(Pt)}if(dt.length){if(fe.lineMetrics&&ye==="LineString"){for(const Ut of dt)J.push(Kr(ve.id,ye,Ut,ve.tags));continue}ye!=="LineString"&&ye!=="MultiLineString"||(dt.length===1?(ye="LineString",dt=dt[0]):ye="MultiLineString"),ye!=="Point"&&ye!=="MultiPoint"||(ye=dt.length===3?"Point":"MultiPoint"),J.push(Kr(ve.id,ye,dt,ve.tags))}}return J.length?J:null}function Pi(W,D,L,N,q){for(let re=0;re<W.length;re+=3){const ae=W[re+q];ae>=L&&ae<=N&&Yr(D,W[re],W[re+1],W[re+2])}}function pi(W,D,L,N,q,re,ae){let fe=Vn(W);const J=q===0?hs:ds;let ve,Se,ye=W.start;for(let Pt=0;Pt<W.length-3;Pt+=3){const Nt=W[Pt],jt=W[Pt+1],Cr=W[Pt+2],hr=W[Pt+3],Ft=W[Pt+4],tr=q===0?Nt:jt,fr=q===0?hr:Ft;let Lr=!1;ae&&(ve=Math.sqrt(Math.pow(Nt-hr,2)+Math.pow(jt-Ft,2))),tr<L?fr>L&&(Se=J(fe,Nt,jt,hr,Ft,L),ae&&(fe.start=ye+ve*Se)):tr>N?fr<N&&(Se=J(fe,Nt,jt,hr,Ft,N),ae&&(fe.start=ye+ve*Se)):Yr(fe,Nt,jt,Cr),fr<L&&tr>=L&&(Se=J(fe,Nt,jt,hr,Ft,L),Lr=!0),fr>N&&tr<=N&&(Se=J(fe,Nt,jt,hr,Ft,N),Lr=!0),!re&&Lr&&(ae&&(fe.end=ye+ve*Se),D.push(fe),fe=Vn(W)),ae&&(ye+=ve)}let Re=W.length-3;const nt=W[Re],dt=W[Re+1],Ut=q===0?nt:dt;Ut>=L&&Ut<=N&&Yr(fe,nt,dt,W[Re+2]),Re=fe.length-3,re&&Re>=3&&(fe[Re]!==fe[0]||fe[Re+1]!==fe[1])&&Yr(fe,fe[0],fe[1],fe[2]),fe.length&&D.push(fe)}function Vn(W){const D=[];return D.size=W.size,D.start=W.start,D.end=W.end,D}function Ai(W,D,L,N,q,re){for(const ae of W)pi(ae,D,L,N,q,re,!1)}function Yr(W,D,L,N){W.push(D,L,N)}function hs(W,D,L,N,q,re){const ae=(re-D)/(N-D);return Yr(W,re,L+(q-L)*ae,1),ae}function ds(W,D,L,N,q,re){const ae=(re-L)/(q-L);return Yr(W,D+(N-D)*ae,re,1),ae}function De(W,D){const L=[];for(let N=0;N<W.length;N++){const q=W[N],re=q.type;let ae;if(re==="Point"||re==="MultiPoint"||re==="LineString")ae=ei(q.geometry,D);else if(re==="MultiLineString"||re==="Polygon"){ae=[];for(const fe of q.geometry)ae.push(ei(fe,D))}else if(re==="MultiPolygon"){ae=[];for(const fe of q.geometry){const J=[];for(const ve of fe)J.push(ei(ve,D));ae.push(J)}}L.push(Kr(q.id,re,ae,q.tags))}return L}function ei(W,D){const L=[];L.size=W.size,W.start!==void 0&&(L.start=W.start,L.end=W.end);for(let N=0;N<W.length;N+=3)L.push(W[N]+D,W[N+1],W[N+2]);return L}function Dr(W,D){if(W.transformed)return W;const L=1<<W.z,N=W.x,q=W.y;for(const re of W.features){const ae=re.geometry,fe=re.type;if(re.geometry=[],fe===1)for(let J=0;J<ae.length;J+=2)re.geometry.push(ti(ae[J],ae[J+1],D,L,N,q));else for(let J=0;J<ae.length;J++){const ve=[];for(let Se=0;Se<ae[J].length;Se+=2)ve.push(ti(ae[J][Se],ae[J][Se+1],D,L,N,q));re.geometry.push(ve)}}return W.transformed=!0,W}function ti(W,D,L,N,q,re){return[Math.round(L*(W*N-q)),Math.round(L*(D*N-re))]}function Hr(W,D,L,N,q){const re=D===q.maxZoom?0:q.tolerance/((1<<D)*q.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:W.length,source:null,x:L,y:N,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const fe of W)Me(ae,fe,re,q);return ae}function Me(W,D,L,N){const q=D.geometry,re=D.type,ae=[];if(W.minX=Math.min(W.minX,D.minX),W.minY=Math.min(W.minY,D.minY),W.maxX=Math.max(W.maxX,D.maxX),W.maxY=Math.max(W.maxY,D.maxY),re==="Point"||re==="MultiPoint")for(let fe=0;fe<q.length;fe+=3)ae.push(q[fe],q[fe+1]),W.numPoints++,W.numSimplified++;else if(re==="LineString")Dt(ae,q,W,L,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(let fe=0;fe<q.length;fe++)Dt(ae,q[fe],W,L,re==="Polygon",fe===0);else if(re==="MultiPolygon")for(let fe=0;fe<q.length;fe++){const J=q[fe];for(let ve=0;ve<J.length;ve++)Dt(ae,J[ve],W,L,!0,ve===0)}if(ae.length){let fe=D.tags||null;if(re==="LineString"&&N.lineMetrics){fe={};for(const ve in D.tags)fe[ve]=D.tags[ve];fe.mapbox_clip_start=q.start/q.size,fe.mapbox_clip_end=q.end/q.size}const J={geometry:ae,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:fe};D.id!==null&&(J.id=D.id),W.features.push(J)}}function Dt(W,D,L,N,q,re){const ae=N*N;if(N>0&&D.size<(q?ae:N))return void(L.numPoints+=D.length/3);const fe=[];for(let J=0;J<D.length;J+=3)(N===0||D[J+2]>ae)&&(L.numSimplified++,fe.push(D[J],D[J+1])),L.numPoints++;q&&function(J,ve){let Se=0;for(let ye=0,Re=J.length,nt=Re-2;ye<Re;nt=ye,ye+=2)Se+=(J[ye]-J[nt])*(J[ye+1]+J[nt+1]);if(Se>0===ve)for(let ye=0,Re=J.length;ye<Re/2;ye+=2){const nt=J[ye],dt=J[ye+1];J[ye]=J[Re-2-ye],J[ye+1]=J[Re-1-ye],J[Re-2-ye]=nt,J[Re-1-ye]=dt}}(fe,re),W.push(fe)}const ft={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Jr{constructor(D,L){const N=(L=this.options=function(re,ae){for(const fe in ae)re[fe]=ae[fe];return re}(Object.create(ft),L)).debug;if(N&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");let q=function(re,ae){const fe=[];if(re.type==="FeatureCollection")for(let J=0;J<re.features.length;J++)Ei(fe,re.features[J],ae,J);else Ei(fe,re.type==="Feature"?re:{geometry:re},ae);return fe}(D,L);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(re,ae){const fe=ae.buffer/ae.extent;let J=re;const ve=cr(re,1,-1-fe,fe,0,-1,2,ae),Se=cr(re,1,1-fe,2+fe,0,-1,2,ae);return(ve||Se)&&(J=cr(re,1,-fe,1+fe,0,-1,2,ae)||[],ve&&(J=De(ve,1).concat(J)),Se&&(J=J.concat(De(Se,-1)))),J}(q,L),q.length&&this.splitTile(q,0,0,0),N&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(D,L,N,q,re,ae,fe){const J=[D,L,N,q],ve=this.options,Se=ve.debug;for(;J.length;){q=J.pop(),N=J.pop(),L=J.pop(),D=J.pop();const ye=1<<L,Re=fn(L,N,q);let nt=this.tiles[Re];if(!nt&&(Se>1&&console.time("creation"),nt=this.tiles[Re]=Hr(D,L,N,q,ve),this.tileCoords.push({z:L,x:N,y:q}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,N,q,nt.numFeatures,nt.numPoints,nt.numSimplified),console.timeEnd("creation"));const Lr=`z${L}`;this.stats[Lr]=(this.stats[Lr]||0)+1,this.total++}if(nt.source=D,re==null){if(L===ve.indexMaxZoom||nt.numPoints<=ve.indexMaxPoints)continue}else{if(L===ve.maxZoom||L===re)continue;if(re!=null){const Lr=re-L;if(N!==ae>>Lr||q!==fe>>Lr)continue}}if(nt.source=null,D.length===0)continue;Se>1&&console.time("clipping");const dt=.5*ve.buffer/ve.extent,Ut=.5-dt,Pt=.5+dt,Nt=1+dt;let jt=null,Cr=null,hr=null,Ft=null,tr=cr(D,ye,N-dt,N+Pt,0,nt.minX,nt.maxX,ve),fr=cr(D,ye,N+Ut,N+Nt,0,nt.minX,nt.maxX,ve);D=null,tr&&(jt=cr(tr,ye,q-dt,q+Pt,1,nt.minY,nt.maxY,ve),Cr=cr(tr,ye,q+Ut,q+Nt,1,nt.minY,nt.maxY,ve),tr=null),fr&&(hr=cr(fr,ye,q-dt,q+Pt,1,nt.minY,nt.maxY,ve),Ft=cr(fr,ye,q+Ut,q+Nt,1,nt.minY,nt.maxY,ve),fr=null),Se>1&&console.timeEnd("clipping"),J.push(jt||[],L+1,2*N,2*q),J.push(Cr||[],L+1,2*N,2*q+1),J.push(hr||[],L+1,2*N+1,2*q),J.push(Ft||[],L+1,2*N+1,2*q+1)}}getTile(D,L,N){D=+D,L=+L,N=+N;const q=this.options,{extent:re,debug:ae}=q;if(D<0||D>24)return null;const fe=1<<D,J=fn(D,L=L+fe&fe-1,N);if(this.tiles[J])return Dr(this.tiles[J],re);ae>1&&console.log("drilling down to z%d-%d-%d",D,L,N);let ve,Se=D,ye=L,Re=N;for(;!ve&&Se>0;)Se--,ye>>=1,Re>>=1,ve=this.tiles[fn(Se,ye,Re)];return ve&&ve.source?(ae>1&&(console.log("found parent tile z%d-%d-%d",Se,ye,Re),console.time("drilling down")),this.splitTile(ve.source,Se,ye,Re,D,L,N),ae>1&&console.timeEnd("drilling down"),this.tiles[J]?Dr(this.tiles[J],re):null):null}}function fn(W,D,L){return 32*((1<<W)*L+D)+W}function bt(W,D){return D?W.properties[D]:W.id}function mn(W,D){if(W==null)return!0;if(W.type==="Feature")return bt(W,D)!=null;if(W.type==="FeatureCollection"){const L=new Set;for(const N of W.features){const q=bt(N,D);if(q==null||L.has(q))return!1;L.add(q)}return!0}return!1}function Un(W,D){const L=new Map;if(W!=null)if(W.type==="Feature")L.set(bt(W,D),W);else for(const N of W.features)L.set(bt(N,D),N);return L}class Mi extends Q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(D,L){return S._(this,void 0,void 0,function*(){const N=D.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const q=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!q)return null;const re=new class{constructor(fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=fe.length,this._features=fe}feature(fe){return new class{constructor(J){this._feature=J,this.extent=S.X,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ve of this._feature.geometry)J.push([new S.P(ve[0],ve[1])]);return J}{const J=[];for(const ve of this._feature.geometry){const Se=[];for(const ye of ve)Se.push(new S.P(ye[0],ye[1]));J.push(Se)}return J}}toGeoJSON(J,ve,Se){return gt.call(this,J,ve,Se)}}(this._features[fe])}}(q.features);let ae=er(re);return ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),{vectorTile:re,rawData:ae.buffer}})}loadData(D){return S._(this,void 0,void 0,function*(){var L;(L=this._pendingRequest)===null||L===void 0||L.abort();const N=!!(D&&D.request&&D.request.collectResourceTiming)&&new S.bv(D.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(D,this._pendingRequest),this._geoJSONIndex=D.cluster?new $r(function({superclusterOptions:ae,clusterProperties:fe}){if(!fe||!ae)return ae;const J={},ve={},Se={accumulated:null,zoom:0},ye={properties:null},Re=Object.keys(fe);for(const nt of Re){const[dt,Ut]=fe[nt],Pt=S.bC(Ut),Nt=S.bC(typeof dt=="string"?[dt,["accumulated"],["get",nt]]:dt);J[nt]=Pt.value,ve[nt]=Nt.value}return ae.map=nt=>{ye.properties=nt;const dt={};for(const Ut of Re)dt[Ut]=J[Ut].evaluate(Se,ye);return dt},ae.reduce=(nt,dt)=>{ye.properties=dt;for(const Ut of Re)Se.accumulated=nt[Ut],nt[Ut]=ve[Ut].evaluate(Se,ye)},ae}(D)).load((yield this._pendingData).features):(q=yield this._pendingData,new Jr(q,D.geojsonVtOptions)),this.loaded={};const re={};if(N){const ae=N.finish();ae&&(re.resourceTiming={},re.resourceTiming[D.source]=JSON.parse(JSON.stringify(ae)))}return re}catch(re){if(delete this._pendingRequest,S.bB(re))return{abandoned:!0};throw re}var q})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(D){const L=this.loaded;return L&&L[D.uid]?super.reloadTile(D):this.loadTile(D)}loadAndProcessGeoJSON(D,L){return S._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(D,L);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(Fe(N,!0),D.filter){const q=S.bC(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(q.result==="error")throw new Error(q.value.map(ae=>`${ae.key}: ${ae.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(ae=>q.value.evaluate({zoom:0},ae))}}return N})}loadGeoJSON(D,L){return S._(this,void 0,void 0,function*(){const{promoteId:N}=D;if(D.request){const q=yield S.h(D.request,L);return this._dataUpdateable=mn(q.data,N)?Un(q.data,N):void 0,q.data}if(typeof D.data=="string")try{const q=JSON.parse(D.data);return this._dataUpdateable=mn(q,N)?Un(q,N):void 0,q}catch{throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`)}if(!D.dataDiff)throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${D.source}`);return function(q,re,ae){var fe,J,ve,Se;if(re.removeAll&&q.clear(),re.remove)for(const ye of re.remove)q.delete(ye);if(re.add)for(const ye of re.add){const Re=bt(ye,ae);Re!=null&&q.set(Re,ye)}if(re.update)for(const ye of re.update){let Re=q.get(ye.id);if(Re==null)continue;const nt=!ye.removeAllProperties&&(((fe=ye.removeProperties)===null||fe===void 0?void 0:fe.length)>0||((J=ye.addOrUpdateProperties)===null||J===void 0?void 0:J.length)>0);if((ye.newGeometry||ye.removeAllProperties||nt)&&(Re=Object.assign({},Re),q.set(ye.id,Re),nt&&(Re.properties=Object.assign({},Re.properties))),ye.newGeometry&&(Re.geometry=ye.newGeometry),ye.removeAllProperties)Re.properties={};else if(((ve=ye.removeProperties)===null||ve===void 0?void 0:ve.length)>0)for(const dt of ye.removeProperties)Object.prototype.hasOwnProperty.call(Re.properties,dt)&&delete Re.properties[dt];if(((Se=ye.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0)for(const{key:dt,value:Ut}of ye.addOrUpdateProperties)Re.properties[dt]=Ut}}(this._dataUpdateable,D.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(D){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(D){return this._geoJSONIndex.getClusterExpansionZoom(D.clusterId)}getClusterChildren(D){return this._geoJSONIndex.getChildren(D.clusterId)}getClusterLeaves(D){return this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset)}}class fi{constructor(D){this.self=D,this.actor=new S.F(D),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(L,N)=>{if(this.externalWorkerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.externalWorkerSourceTypes[L]=N},this.self.addProtocol=S.bi,this.self.removeProtocol=S.bj,this.self.registerRTLTextPlugin=L=>{if(S.bD.isParsed())throw new Error("RTL text plugin already registered.");S.bD.setMethods(L)},this.actor.registerMessageHandler("LDT",(L,N)=>this._getDEMWorkerSource(L,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(L,N)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(L,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(L,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(L,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(L,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(L,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(L,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(L,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(L,N)=>this._getWorkerSource(L,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(L,N)=>this._getWorkerSource(L,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(L,N)=>this._getWorkerSource(L,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(L,N)=>this._getWorkerSource(L,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(L,N)=>this._getWorkerSource(L,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(L,N)=>this._getWorkerSource(L,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(L,N)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[L]||!this.workerSources[L][N.type]||!this.workerSources[L][N.type][N.source])return;const q=this.workerSources[L][N.type][N.source];delete this.workerSources[L][N.type][N.source],q.removeSource!==void 0&&q.removeSource(N)})),this.actor.registerMessageHandler("RM",L=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L]})),this.actor.registerMessageHandler("SR",(L,N)=>S._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(L,N)=>this._syncRTLPluginState(L,N)),this.actor.registerMessageHandler("IS",(L,N)=>S._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(L,N)=>this._setImages(L,N)),this.actor.registerMessageHandler("UL",(L,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(L).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(L,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(L).replace(N)}))}_setImages(D,L){return S._(this,void 0,void 0,function*(){this.availableImages[D]=L;for(const N in this.workerSources[D]){const q=this.workerSources[D][N];for(const re in q)q[re].availableImages=L}})}_syncRTLPluginState(D,L){return S._(this,void 0,void 0,function*(){if(S.bD.isParsed())return S.bD.getState();if(L.pluginStatus!=="loading")return S.bD.setState(L),L;const N=L.pluginURL;if(this.self.importScripts(N),S.bD.isParsed()){const q={pluginStatus:"loaded",pluginURL:N};return S.bD.setState(q),q}throw S.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${N}`)})}_getAvailableImages(D){let L=this.availableImages[D];return L||(L=[]),L}_getLayerIndex(D){let L=this.layerIndexes[D];return L||(L=this.layerIndexes[D]=new d),L}_getWorkerSource(D,L,N){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][L]||(this.workerSources[D][L]={}),!this.workerSources[D][L][N]){const q={sendAsync:(re,ae)=>(re.targetMapId=D,this.actor.sendAsync(re,ae))};switch(L){case"vector":this.workerSources[D][L][N]=new Q(q,this._getLayerIndex(D),this._getAvailableImages(D));break;case"geojson":this.workerSources[D][L][N]=new Mi(q,this._getLayerIndex(D),this._getAvailableImages(D));break;default:this.workerSources[D][L][N]=new this.externalWorkerSourceTypes[L](q,this._getLayerIndex(D),this._getAvailableImages(D))}}return this.workerSources[D][L][N]}_getDEMWorkerSource(D,L){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][L]||(this.demWorkerSources[D][L]=new U),this.demWorkerSources[D][L]}}return S.i(self)&&(self.worker=new fi(self)),fi}),v("index",["exports","./shared"],function(S,d){var V="4.7.1";let se,ue;const Q={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((e,o)=>{const u=requestAnimationFrame(e);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),o(d.c())})}),getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,o.drawImage(m,0,0,m.width,m.height),o},resolveURL:m=>(se||(se=document.createElement("a")),se.href=m,se.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ue==null&&(ue=matchMedia("(prefers-reduced-motion: reduce)")),ue.matches)}};class U{static testProp(e){if(!U.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in U.docStyle)return e[o];return e[0]}static create(e,o,u){const c=window.document.createElement(e);return o!==void 0&&(c.className=o),u&&u.appendChild(c),c}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(e,o){e.style[U.transformProp]=o}static addEventListener(e,o,u,c={}){e.addEventListener(o,u,"passive"in c?c:c.capture)}static removeEventListener(e,o,u,c={}){e.removeEventListener(o,u,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",U.suppressClickInternal,!0)},0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,u){const c=o.boundingClientRect;return new d.P((u.clientX-c.left)/o.x-e.clientLeft,(u.clientY-c.top)/o.y-e.clientTop)}static mousePos(e,o){const u=U.getScale(e);return U.getPoint(e,u,o)}static touchPos(e,o){const u=[],c=U.getScale(e);for(let f=0;f<o.length;f++)u.push(U.getPoint(e,c,o[f]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);const Le={supported:!1,testSupport:function(m){!gt&&Fe&&(le?te(m):Ee=m)}};let Ee,Fe,gt=!1,le=!1;function te(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Fe),m.isContextLost())return;Le.supported=!0}catch{}m.deleteTexture(e),gt=!0}var ce;typeof document<"u"&&(Fe=document.createElement("img"),Fe.onload=()=>{Ee&&te(Ee),Ee=null,le=!0},Fe.onerror=()=>{gt=!0,Ee=null},Fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,o,u,c;m.resetRequestQueue=()=>{e=[],o=0,u=0,c={}},m.addThrottleControl=T=>{const E=u++;return c[E]=T,E},m.removeThrottleControl=T=>{delete c[T],x()},m.getImage=(T,E,A=!0)=>new Promise((M,F)=>{Le.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:E,requestParameters:T,supportImageRefresh:A,state:"queued",onError:j=>{F(j)},onSuccess:j=>{M(j)}}),x()});const f=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:E,supportImageRefresh:A,onError:M,onSuccess:F,abortController:j}=T,$=A===!1&&!d.i(self)&&!d.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((Y,ee)=>Y&&ee==="accept",!0));o++;const H=$?b(E,j):d.m(E,j);try{const Y=yield H;delete T.abortController,T.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?F(Y):Y.data&&F({data:yield(K=Y.data,typeof createImageBitmap=="function"?d.d(K):d.f(K)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete T.abortController,M(Y)}finally{o--,x()}var K}),x=()=>{const T=(()=>{for(const E of Object.keys(c))if(c[E]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=o;E<T&&e.length>0;E++){const A=e.shift();A.abortController.signal.aborted?E--:f(A)}},b=(T,E)=>new Promise((A,M)=>{const F=new Image,j=T.url,$=T.credentials;$&&$==="include"?F.crossOrigin="use-credentials":($&&$==="same-origin"||!d.s(j))&&(F.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{F.src="",M(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,A({data:F})},F.onerror=()=>{F.onerror=F.onload=null,E.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=j})}(ce||(ce={})),ce.resetRequestQueue();class Ie{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ne(m){var e=new d.A(3);return e[0]=m[0],e[1]=m[1],e[2]=m[2],e}var Ke,qe=function(m,e,o){return m[0]=e[0]-o[0],m[1]=e[1]-o[1],m[2]=e[2]-o[2],m};Ke=new d.A(3),d.A!=Float32Array&&(Ke[0]=0,Ke[1]=0,Ke[2]=0);var Je=function(m){var e=m[0],o=m[1];return e*e+o*o};function Et(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const o=[];for(const{id:u,url:c}of m){const f=`${u}${c}`;o.indexOf(f)===-1&&(o.push(f),e.push({id:u,url:c}))}}return e}function wt(m,e,o){const u=m.split("?");return u[0]+=`${e}${o}`,u.join("?")}(function(){var m=new d.A(2);d.A!=Float32Array&&(m[0]=0,m[1]=0)})();class St{constructor(e,o,u,c){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(o,c)}update(e,o,u){const{width:c,height:f}=e,x=!(this.size&&this.size[0]===c&&this.size[1]===f||u),{context:b}=this,{gl:T}=b;if(this.useMipmap=!!(o&&o.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[c,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,c,f,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:E,y:A}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,E,A,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,E,A,c,f,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,o,u){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),u!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,u||e),this.filter=e),o!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function or(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class yt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let u=!0;const c=o.data||o.spriteData;return this._validateStretch(o.stretchX,c&&c.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,c&&c.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,o){if(!e)return!0;let u=0;for(const c of e){if(c[0]<u||c[1]<c[0]||o<c[1])return!1;u=c[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const u=o.spriteData,c=u&&u.width||o.data.width,f=u&&u.height||o.data.height;return!(e[0]<0||c<e[0]||e[1]<0||f<e[1]||e[2]<0||c<e[2]||e[3]<0||f<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,u=!0){const c=this.getImage(e);if(u&&(c.data.width!==o.data.width||c.data.height!==o.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=c.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((o,u)=>{let c=!0;if(!this.isLoaded())for(const f of e)this.images[f]||(c=!1);this.isLoaded()||c?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})})}_getImagesForIds(e){const o={};for(const u of e){let c=this.getImage(u);c||(this.fire(new d.k("styleimagemissing",{id:u})),c=this.getImage(u)),c?o[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],u=this.getImage(e);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const c={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new d.I(c,u);this.patterns[e]={bin:c,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new St(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:o,h:u}=d.p(e),c=this.atlasImage;c.resize({width:o||1,height:u||1});for(const f in this.patterns){const{bin:x}=this.patterns[f],b=x.x+1,T=x.y+1,E=this.getImage(f).data,A=E.width,M=E.height;d.R.copy(E,c,{x:0,y:0},{x:b,y:T},{width:A,height:M}),d.R.copy(E,c,{x:0,y:M-1},{x:b,y:T-1},{width:A,height:1}),d.R.copy(E,c,{x:0,y:0},{x:b,y:T+M},{width:A,height:1}),d.R.copy(E,c,{x:A-1,y:0},{x:b-1,y:T},{width:1,height:M}),d.R.copy(E,c,{x:0,y:0},{x:b+A,y:T},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||d.w(`Image with ID: "${o}" was not found`),or(u)&&this.updateImage(o,u)}}}const Mt=1e20;function $t(m,e,o,u,c,f,x,b,T){for(let E=e;E<e+u;E++)nr(m,o*f+E,f,c,x,b,T);for(let E=o;E<o+c;E++)nr(m,E*f+e,1,u,x,b,T)}function nr(m,e,o,u,c,f,x){f[0]=0,x[0]=-Mt,x[1]=Mt,c[0]=m[e];for(let b=1,T=0,E=0;b<u;b++){c[b]=m[e+b*o];const A=b*b;do{const M=f[T];E=(c[b]-c[M]+A-M*M)/(b-M)/2}while(E<=x[T]&&--T>-1);T++,f[T]=b,x[T]=E,x[T+1]=Mt}for(let b=0,T=0;b<u;b++){for(;x[T+1]<b;)T++;const E=f[T],A=b-E;m[e+b*o]=c[E]+A*A}}class er{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const o=[];for(const f in e)for(const x of e[f])o.push(this._getAndCacheGlyphsPromise(f,x));const u=yield Promise.all(o),c={};for(const{stack:f,id:x,glyph:b}of u)c[f]||(c[f]={}),c[f][x]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return c})}_getAndCacheGlyphsPromise(e,o){return d._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=u.glyphs[o];if(c!==void 0)return{stack:e,id:o,glyph:c};if(c=this._tinySDF(u,e,o),c)return u.glyphs[o]=c,{stack:e,id:o,glyph:c};const f=Math.floor(o/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[f])return{stack:e,id:o,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[f]){const b=er.loadGlyphRange(e,f,this.url,this.requestManager);u.requests[f]=b}const x=yield u.requests[f];for(const b in x)this._doesCharSupportLocalGlyph(+b)||(u.glyphs[+b]=x[+b]);return u.ranges[f]=!0,{stack:e,id:o,glyph:x[o]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,o,u){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(u))return;let f=e.tinySDF;if(!f){let b="400";/bold/i.test(o)?b="900":/medium/i.test(o)?b="500":/light/i.test(o)&&(b="200"),f=e.tinySDF=new er.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:b})}const x=f.draw(String.fromCharCode(u));return{id:u,bitmap:new d.o({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}er.loadGlyphRange=function(m,e,o,u){return d._(this,void 0,void 0,function*(){const c=256*e,f=c+255,x=u.transformRequest(o.replace("{fontstack}",m).replace("{range}",`${c}-${f}`),"Glyphs"),b=yield d.l(x,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${f}`);const T={};for(const E of d.n(b.data))T[E.id]=E;return T})},er.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=o;const b=this.size=m+4*e,T=this._createCanvas(b),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${x} ${f} ${m}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(m),x=Math.ceil(o),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),T=Math.min(this.size-this.buffer,x+Math.ceil(u)),E=b+2*this.buffer,A=T+2*this.buffer,M=Math.max(E*A,0),F=new Uint8ClampedArray(M),j={data:F,width:E,height:A,glyphWidth:b,glyphHeight:T,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(b===0||T===0)return j;const{ctx:$,buffer:H,gridInner:K,gridOuter:Y}=this;$.clearRect(H,H,b,T),$.fillText(m,H,H+x);const ee=$.getImageData(H,H,b,T);Y.fill(Mt,0,M),K.fill(0,0,M);for(let Z=0;Z<T;Z++)for(let oe=0;oe<b;oe++){const he=ee.data[4*(Z*b+oe)+3]/255;if(he===0)continue;const ge=(Z+H)*E+oe+H;if(he===1)Y[ge]=0,K[ge]=Mt;else{const ke=.5-he;Y[ge]=ke>0?ke*ke:0,K[ge]=ke<0?ke*ke:0}}$t(Y,0,0,E,A,E,this.f,this.v,this.z),$t(K,H,H,b,T,E,this.f,this.v,this.z);for(let Z=0;Z<M;Z++){const oe=Math.sqrt(Y[Z])-Math.sqrt(K[Z]);F[Z]=Math.round(255-255*(oe/this.radius+this.cutoff))}return j}};class Pe{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,o){return d.x(e.expression.evaluate(o))}interpolate(e,o,u){return{x:d.y.number(e.x,o.x,u),y:d.y.number(e.y,o.y,u),z:d.y.number(e.z,o.z,u)}}}let lt;class He extends d.E{constructor(e){super(),lt=lt||new d.q({anchor:new d.D(d.v.light.anchor),position:new Pe,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(lt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(d.r,e,o))for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u){return(!u||u.validate!==!1)&&d.t(this,e.call(d.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const Rt=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class kt extends d.E{constructor(e){super(),this._transitionable=new d.T(Rt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,o={}){if(!this._validate(d.B,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u={}){return(u==null?void 0:u.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class An{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const u=e.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,o)),this.dashEntry[u]}getDashRanges(e,o,u){const c=[];let f=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,b=!0;c.push({left:f,right:x,isDash:b,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){b=!b;const A=e[E];f=T*u,T+=A,x=T*u,c.push({left:f,right:x,isDash:b,zeroLength:A===0})}return c}addRoundDash(e,o,u){const c=o/2;for(let f=-u;f<=u;f++){const x=this.width*(this.nextRow+u+f);let b=0,T=e[b];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++b]);const A=Math.abs(E-T.left),M=Math.abs(E-T.right),F=Math.min(A,M);let j;const $=f/u*(c+1);if(T.isDash){const H=c-Math.abs($);j=Math.sqrt(F*F+H*H)}else j=c-Math.sqrt(F*F+$*$);this.data[x+E]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const T=e[b],E=e[b+1];T.zeroLength?e.splice(b,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(b,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const c=this.width*this.nextRow;let f=0,x=e[f];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++f]);const T=Math.abs(b-x.left),E=Math.abs(b-x.right),A=Math.min(T,E);this.data[c+b]=Math.max(0,Math.min(255,(x.isDash?A:-A)+128))}}addDash(e,o){const u=o?7:0,c=2*u+1;if(this.nextRow+c>this.height)return d.w("LineAtlas out of space"),null;let f=0;for(let b=0;b<e.length;b++)f+=e[b];if(f!==0){const b=this.width/f,T=this.getDashRanges(e,this.width,b);o?this.addRoundDash(T,b,u):this.addRegularDash(T)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:f};return this.nextRow+=c,this.dirty=!0,x}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const $r="maplibre_preloaded_worker_pool";class ct{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ct.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$r]}numActive(){return Object.keys(this.active).length}}const _t=Math.floor(Q.hardwareConcurrency/2);let rt,xt;function ir(){return rt||(rt=new ct),rt}ct.workerCount=d.C(globalThis)?Math.max(Math.min(_t,3),1):1;class Tr{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let c=0;c<u.length;c++){const f=new d.F(u[c],o);f.name=`Worker ${c}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const u=[];for(const c of this.actors)u.push(c.sendAsync({type:e,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const u of this.actors)u.registerMessageHandler(e,o)}}function zr(){return xt||(xt=new Tr(ir(),d.G),xt.registerMessageHandler("GR",(m,e,o)=>d.m(e,o))),xt}function Kr(m,e){const o=d.H();return d.J(o,o,[1,1,0]),d.K(o,o,[.5*m.width,.5*m.height,1]),d.L(o,o,m.calculatePosMatrix(e.toUnwrapped()))}function Nn(m,e,o,u,c,f){const x=function(M,F,j){if(M)for(const $ of M){const H=F[$];if(H&&H.source===j&&H.type==="fill-extrusion")return!0}else for(const $ in F){const H=F[$];if(H.source===j&&H.type==="fill-extrusion")return!0}return!1}(c&&c.layers,e,m.id),b=f.maxPitchScaleFactor(),T=m.tilesIn(u,b,x);T.sort(Ei);const E=[];for(const M of T)E.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,o,m._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,c,f,b,Kr(m.transform,M.tileID))});const A=function(M){const F={},j={};for(const $ of M){const H=$.queryResults,K=$.wrappedTileID,Y=j[K]=j[K]||{};for(const ee in H){const Z=H[ee],oe=Y[ee]=Y[ee]||{},he=F[ee]=F[ee]||[];for(const ge of Z)oe[ge.featureIndex]||(oe[ge.featureIndex]=!0,he.push(ge))}}return F}(E);for(const M in A)A[M].forEach(F=>{const j=F.feature,$=m.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=$});return A}function Ei(m,e){const o=m.tileID,u=e.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function Ds(m,e,o){return d._(this,void 0,void 0,function*(){let u=m;if(m.url?u=(yield d.h(e.transformRequest(m.url,"Source"),o)).data:yield Q.frameAsync(o),!u)return null;const c=d.M(d.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(c.vectorLayerIds=u.vector_layers.map(f=>f.id)),c})}class _e{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const o=this._sw,u=this._ne;let c,f;if(e instanceof d.N)c=e,f=e;else{if(!(e instanceof _e))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(_e.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return o||u?(o.lng=Math.min(c.lng,o.lng),o.lat=Math.min(c.lat,o.lat),u.lng=Math.max(f.lng,u.lng),u.lat=Math.max(f.lat,u.lat)):(this._sw=new d.N(c.lng,c.lat),this._ne=new d.N(f.lng,f.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:u}=d.N.convert(e);let c=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&c}static convert(e){return e instanceof _e?e:e&&new _e(e)}static fromLngLat(e,o=0){const u=360*o/40075017,c=u/Math.cos(Math.PI/180*e.lat);return new _e(new d.N(e.lng-c,e.lat-u),new d.N(e.lng+c,e.lat+u))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),o=new d.N(this._ne.lng,this._ne.lat);return new _e(e,e.lng>o.lng?new d.N(o.lng+360,o.lat):o)}}class Wi{constructor(e,o,u){this.bounds=_e.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),u=Math.floor(d.O(this.bounds.getWest())*o),c=Math.floor(d.Q(this.bounds.getNorth())*o),f=Math.ceil(d.O(this.bounds.getEast())*o),x=Math.ceil(d.Q(this.bounds.getSouth())*o);return e.x>=u&&e.x<f&&e.y>=c&&e.y<x}}class jn extends d.E{constructor(e,o,u,c){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(o,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ds(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new Wi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((f,x)=>{e.reloadPromise={resolve:f,reject:x}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const f=yield e.actor.sendAsync({type:c,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,f)}catch(f){if(delete e.abortController,e.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Xt extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},o),d.e(this,d.M(o,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ds(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new Wi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield ce.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const c=this.map.painter.context,f=c.gl,x=u.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new St(c,x,f.RGBA,{useMipmap:!0}),e.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class cr extends Xt{constructor(e,o,u,c){super(e,o,u,c),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield ce.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const f=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const x=d.b(f)&&d.U()?f:yield this.readImageNow(f),b={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const o=e.width+2,u=e.height+2;try{return new d.R({width:o,height:u},yield d.W(e,-1,-1,o,u))}catch{}}return Q.getImageData(e,1)})}_getNeighboringTiles(e){const o=e.canonical,u=Math.pow(2,o.z),c=(o.x-1+u)%u,f=o.x===0?e.wrap-1:e.wrap,x=(o.x+1+u)%u,b=o.x+1===u?e.wrap+1:e.wrap,T={};return T[new d.S(e.overscaledZ,f,o.z,c,o.y).key]={backfilled:!1},T[new d.S(e.overscaledZ,b,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(T[new d.S(e.overscaledZ,f,o.z,c,o.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,b,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<u&&(T[new d.S(e.overscaledZ,f,o.z,c,o.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,b,o.z,x,o.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Pi extends d.E{constructor(e,o,u,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(c),this._data=o.data,this._options=d.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const f=d.X/this.tileSize;o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*f,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*f,extent:d.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.X,radius:(o.clusterRadius||50)*f,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:u}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const o=d.e({type:this.type},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(Q.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let c=null;u.resourceTiming&&u.resourceTiming[this.id]&&(c=u.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&d.e(f,{resourceTiming:c}),this.fire(new d.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:o,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,o==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var pi=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vn extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=o}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ce.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new d.j(o))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(d.Z.fromLngLat);this.tileID=function(c){let f=1/0,x=1/0,b=-1/0,T=-1/0;for(const F of c)f=Math.min(f,F.x),x=Math.min(x,F.y),b=Math.max(b,F.x),T=Math.max(T,F.y);const E=Math.max(b-f,T-x),A=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),M=Math.pow(2,A);return new d.a1(A,Math.floor((f+b)/2*M),Math.floor((x+T)/2*M))}(o),this.minzoom=this.maxzoom=this.tileID.z;const u=o.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,d.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,d.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,pi.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new St(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ai extends Vn{constructor(e,o,u,c){super(e,o,u,c),this.roundZoom=!0,this.type="video",this.options=o}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield d.a3(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new d.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,pi.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new St(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Yr extends Vn{constructor(e,o,u,c){super(e,o,u,c),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(x=>typeof x!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,pi.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new St(o,this.canvas,u.RGBA,{premultiply:!0});let c=!1;for(const f in this.tiles){const x=this.tiles[f];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,c=!0)}c&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const hs={},ds=m=>{switch(m){case"geojson":return Pi;case"image":return Vn;case"raster":return Xt;case"raster-dem":return cr;case"vector":return jn;case"video":return Ai;case"canvas":return Yr}return hs[m]},De="RTLPluginLoaded";class ei extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=zr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Q.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(De))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Dr=null;function ti(){return Dr||(Dr=new ei),Dr}class Hr{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,f){const x={};if(!f)return x;for(const b of c){const T=b.layerIds.map(E=>f.getLayer(E)).filter(Boolean);if(T.length!==0){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(E=>T.filter(A=>A.id===E)[0]));for(const E of T)x[E.id]=b}}return x}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof d.a6){if(this.hasSymbolBuckets=!0,!u)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof d.a6&&f.hasRTLText){this.hasRTLText=!0,ti().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(c).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const c=this.buckets[u];c.uploadPending()&&c.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new St(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new St(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,u,c,f,x,b,T,E,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:f,scale:x,tileSize:this.tileSize,pixelPosMatrix:A,transform:T,params:b,queryPadding:this.queryPadding*E},e,o,u):{}}querySourceFeatures(e,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const c=u.loadVTLayers(),f=o&&o.sourceLayer?o.sourceLayer:"",x=c._geojsonTileLayer||c[f];if(!x)return;const b=d.a7(o&&o.filter),{z:T,x:E,y:A}=this.tileID.canonical,M={z:T,x:E,y:A};for(let F=0;F<x.length;F++){const j=x.feature(F);if(b.needGeometry){const K=d.a8(j,!0);if(!b.filter(new d.z(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!b.filter(new d.z(this.tileID.overscaledZ),j))continue;const $=u.getId(j,f),H=new d.a9(j,T,E,A,$);H.tile=M,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const u=d.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let c=!1;if(this.expirationTime>u)c=!1;else if(o)if(this.expirationTime<o)c=!0;else{const f=this.expirationTime-o;f?this.expirationTime=u+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!o.style.hasLayer(c))continue;const f=this.buckets[c],x=f.layers[0].sourceLayer||"_geojsonTileLayer",b=u[x],T=e[x];if(!b||!T||Object.keys(T).length===0)continue;f.update(T,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=o&&o.style&&o.style.getLayer(c);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Q.now()+e}setDependencies(e,o){const u={};for(const c of o)u[c]=!0;this.dependencies[e]=u}hasDependency(e,o){for(const u of e){const c=this.dependencies[u];if(c){for(const f of o)if(c[f])return!0}}return!1}}class Me{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,u){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:o,timeout:void 0};if(u!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},u)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const u=e.wrapped().key,c=o===void 0?0:this.data[u].indexOf(o),f=this.data[u][c];return this.data[u].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(f.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const u in this.data)for(const c of this.data[u])e(c.value)||o.push(c);for(const u of o)this.remove(u.value.tileID,u)}}class Dt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,u){const c=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},d.e(this.stateChanges[e][c],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==c&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const f in this.state[e][c])u[f]||(this.deletedStates[e][c][f]=null)}else for(const f in u)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][f]===null&&delete this.deletedStates[e][c][f]}removeFeatureState(e,o,u){if(this.deletedStates[e]===null)return;const c=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&o!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][u]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(u in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][u]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,o){const u=String(o),c=d.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][o];if(f===null)return{};for(const x in f)delete c[x]}return c}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const u={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const x in this.stateChanges[c])this.state[c][x]||(this.state[c][x]={}),d.e(this.state[c][x],this.stateChanges[c][x]),f[x]=this.state[c][x];u[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const x in this.state[c])f[x]={},this.state[c][x]={};else for(const x in this.deletedStates[c]){if(this.deletedStates[c][x]===null)this.state[c][x]={};else for(const b of Object.keys(this.deletedStates[c][x]))delete this.state[c][x][b];f[x]=this.state[c][x]}u[c]=u[c]||{},d.e(u[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const c in e)e[c].setFeatureState(u,o)}}class ft extends d.E{constructor(e,o,u){super(),this.id=e,this.dispatcher=u,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,f,x,b)=>{const T=new(ds(f.type))(c,f,x,b);if(T.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${T.id}`);return T})(e,o,u,this),this._tiles={},this._cache=new Me(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Dt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,u)}catch(c){e.state="errored",c.status!==404?this._source.fire(new d.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Jr).map(e=>e.key)}getRenderableIds(e){const o=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&o.push(this._tiles[u]);return e?o.sort((u,c)=>{const f=u.tileID,x=c.tileID,b=new d.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),T=new d.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-x.overscaledZ||T.y-b.y||T.x-b.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(Jr).map(u=>u.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){return d._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,e,o))})}_tileLoaded(e,o,u){e.timeAdded=Q.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const o=this.getRenderableIds();for(let c=0;c<o.length;c++){const f=o[c];if(e.neighboringTiles&&e.neighboringTiles[f]){const x=this.getTileByID(f);u(e,x),u(x,e)}}function u(c,f){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let x=f.tileID.canonical.x-c.tileID.canonical.x;const b=f.tileID.canonical.y-c.tileID.canonical.y,T=Math.pow(2,c.tileID.canonical.z),E=f.tileID.key;x===0&&b===0||Math.abs(b)>1||(Math.abs(x)>1&&(Math.abs(x+T)===1?x+=T:Math.abs(x-T)===1&&(x-=T)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,x,b),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,u,c){for(const f in this._tiles){let x=this._tiles[f];if(c[f]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>u)continue;let b=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){const E=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[E.key],x&&x.hasData()&&(b=E)}let T=b;for(;T.overscaledZ>o;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){c[b.key]=b;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=e.overscaledZ-1;u>=o;u--){const c=e.scaledTo(u),f=this._getLoadedTile(c);if(f)return f}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(f)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){const u={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+o),u[f.tileID.key]=f}this._tiles=u;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,o,u,c,f,x){const b={},T={},E=Object.keys(e),A=Q.now();for(const M of E){const F=e[M],j=this._tiles[M];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=A)continue;const $=this.findLoadedParent(F,o),H=this.findLoadedSibling(F),K=$||H||null;K&&(this._addTile(K.tileID),b[K.tileID.key]=K.tileID),T[M]=F}this._retainLoadedChildren(T,c,u,e);for(const M in b)e[M]||(this._coveredTiles[M]=!0,e[M]=b[M]);if(x){const M={},F={};for(const j of f)this._tiles[j.key].hasData()?M[j.key]=j:F[j.key]=j;for(const j in F){const $=F[j].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(M[$[0].key]=e[$[0].key]=$[0],M[$[1].key]=e[$[1].key]=$[1],M[$[2].key]=e[$[2].key]=$[2],M[$[3].key]=e[$[3].key]=$[3],delete F[j])}for(const j in F){const $=F[j],H=this.findLoadedParent($,this._source.minzoom),K=this.findLoadedSibling($),Y=H||K||null;if(Y){M[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(const ee in M)M[ee].isChildOf(Y.tileID)&&delete M[ee]}}for(const j in this._tiles)M[j]||(this._coveredTiles[j]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.S(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(u=u.filter(A=>this._source.hasTile(A)))):u=[];const c=e.coveringZoomLevel(this._source),f=Math.max(c-ft.maxOverzooming,this._source.minzoom),x=Math.max(c+ft.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const M of u)if(M.canonical.z>this._source.minzoom){const F=M.scaledTo(M.canonical.z-1);A[F.key]=F;const j=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));A[j.key]=j}u=u.concat(Object.values(A))}const b=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(u,c);fn(this._source.type)&&this._updateCoveredAndRetainedTiles(T,f,x,c,u,o);for(const A in T)this._tiles[A].clearFadeHold();const E=d.ab(this._tiles,T);for(const A of E){const M=this._tiles[A];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var u;const c={},f={},x=Math.max(o-ft.maxOverzooming,this._source.minzoom),b=Math.max(o+ft.maxUnderzooming,this._source.minzoom),T={};for(const E of e){const A=this._addTile(E);c[E.key]=E,A.hasData()||o<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,o,b,c);for(const E of e){let A=this._tiles[E.key];if(A.hasData())continue;if(o+1>this._source.maxzoom){const F=E.children(this._source.maxzoom)[0],j=this.getTile(F);if(j&&j.hasData()){c[F.key]=F;continue}}else{const F=E.children(this._source.maxzoom);if(c[F[0].key]&&c[F[1].key]&&c[F[2].key]&&c[F[3].key])continue}let M=A.wasRequested();for(let F=E.overscaledZ-1;F>=x;--F){const j=E.scaledTo(F);if(f[j.key])break;if(f[j.key]=!0,A=this.getTile(j),!A&&M&&(A=this._addTile(j)),A){const $=A.hasData();if(($||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||M)&&(c[j.key]=j),M=A.wasRequested(),$)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let u,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){u=this._loadedParentTiles[c.key];break}o.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(u=this._getLoadedTile(f),u)break;c=f}for(const f of o)this._loadedParentTiles[f]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const o=this._tiles[e].tileID,u=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=u}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const u=o;return o||(o=new Hr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,u||this._source.fire(new d.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=o.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){const o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,u){const c=[],f=this.transform;if(!f)return c;const x=u?f.getCameraQueryGeometry(e):e,b=e.map($=>f.pointCoordinate($,this.terrain)),T=x.map($=>f.pointCoordinate($,this.terrain)),E=this.getIds();let A=1/0,M=1/0,F=-1/0,j=-1/0;for(const $ of T)A=Math.min(A,$.x),M=Math.min(M,$.y),F=Math.max(F,$.x),j=Math.max(j,$.y);for(let $=0;$<E.length;$++){const H=this._tiles[E[$]];if(H.holdingForFade())continue;const K=H.tileID,Y=Math.pow(2,f.zoom-H.tileID.overscaledZ),ee=o*H.queryPadding*d.X/H.tileSize/Y,Z=[K.getTilePoint(new d.Z(A,M)),K.getTilePoint(new d.Z(F,j))];if(Z[0].x-ee<d.X&&Z[0].y-ee<d.X&&Z[1].x+ee>=0&&Z[1].y+ee>=0){const oe=b.map(ge=>K.getTilePoint(ge)),he=T.map(ge=>K.getTilePoint(ge));c.push({tile:H,tileID:K,queryGeometry:oe,cameraQueryGeometry:he,scale:Y})}}return c}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of o)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(fn(this._source.type)){const e=Q.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,u){this._state.updateState(e=e||"_geojsonTileLayer",o,u)}removeFeatureState(e,o,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,u)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,u){const c=this._tiles[e];c&&c.setDependencies(o,u)}reloadTilesForDependencies(e,o){for(const u in this._tiles)this._tiles[u].hasDependency(e,o)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,o))}}function Jr(m,e){const o=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-o||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function fn(m){return m==="raster"||m==="image"||m==="video"}ft.maxOverzooming=10,ft.maxUnderzooming=3;class bt{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let o=1,u=this._distances[o];const c=e*this.paddedLength+this.padding;for(;u<c&&o<this._distances.length;)u=this._distances[++o];const f=o-1,x=this._distances[f],b=u-x,T=b>0?(c-x)/b:0;return this.points[f].mult(1-T).add(this.points[o].mult(T))}}function mn(m,e){let o=!0;return m==="always"||m!=="never"&&e!=="never"||(o=!1),o}class Un{constructor(e,o,u){const c=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(o/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)c.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,u,c,f){this._forEachCell(o,u,c,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(f)}insertCircle(e,o,u,c){this._forEachCell(o-c,u-c,o+c,u+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(u),this.circles.push(c)}_insertBoxCell(e,o,u,c,f,x){this.boxCells[f].push(x)}_insertCircleCell(e,o,u,c,f,x){this.circleCells[f].push(x)}_query(e,o,u,c,f,x,b){if(u<0||e>this.width||c<0||o>this.height)return[];const T=[];if(e<=0&&o<=0&&this.width<=u&&this.height<=c){if(f)return[{key:null,x1:e,y1:o,x2:u,y2:c}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const A=this.circles[3*E],M=this.circles[3*E+1],F=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:A-F,y1:M-F,x2:A+F,y2:M+F})}}else this._forEachCell(e,o,u,c,this._queryCell,T,{hitTest:f,overlapMode:x,seenUids:{box:{},circle:{}}},b);return T}query(e,o,u,c){return this._query(e,o,u,c,!1,null)}hitTest(e,o,u,c,f,x){return this._query(e,o,u,c,!0,f,x).length>0}hitTestCircle(e,o,u,c,f){const x=e-u,b=e+u,T=o-u,E=o+u;if(b<0||x>this.width||E<0||T>this.height)return!1;const A=[];return this._forEachCell(x,T,b,E,this._queryCellCircle,A,{hitTest:!0,overlapMode:c,circle:{x:e,y:o,radius:u},seenUids:{box:{},circle:{}}},f),A.length>0}_queryCell(e,o,u,c,f,x,b,T){const{seenUids:E,hitTest:A,overlapMode:M}=b,F=this.boxCells[f];if(F!==null){const $=this.bboxes;for(const H of F)if(!E.box[H]){E.box[H]=!0;const K=4*H,Y=this.boxKeys[H];if(e<=$[K+2]&&o<=$[K+3]&&u>=$[K+0]&&c>=$[K+1]&&(!T||T(Y))&&(!A||!mn(M,Y.overlapMode))&&(x.push({key:Y,x1:$[K],y1:$[K+1],x2:$[K+2],y2:$[K+3]}),A))return!0}}const j=this.circleCells[f];if(j!==null){const $=this.circles;for(const H of j)if(!E.circle[H]){E.circle[H]=!0;const K=3*H,Y=this.circleKeys[H];if(this._circleAndRectCollide($[K],$[K+1],$[K+2],e,o,u,c)&&(!T||T(Y))&&(!A||!mn(M,Y.overlapMode))){const ee=$[K],Z=$[K+1],oe=$[K+2];if(x.push({key:Y,x1:ee-oe,y1:Z-oe,x2:ee+oe,y2:Z+oe}),A)return!0}}}return!1}_queryCellCircle(e,o,u,c,f,x,b,T){const{circle:E,seenUids:A,overlapMode:M}=b,F=this.boxCells[f];if(F!==null){const $=this.bboxes;for(const H of F)if(!A.box[H]){A.box[H]=!0;const K=4*H,Y=this.boxKeys[H];if(this._circleAndRectCollide(E.x,E.y,E.radius,$[K+0],$[K+1],$[K+2],$[K+3])&&(!T||T(Y))&&!mn(M,Y.overlapMode))return x.push(!0),!0}}const j=this.circleCells[f];if(j!==null){const $=this.circles;for(const H of j)if(!A.circle[H]){A.circle[H]=!0;const K=3*H,Y=this.circleKeys[H];if(this._circlesCollide($[K],$[K+1],$[K+2],E.x,E.y,E.radius)&&(!T||T(Y))&&!mn(M,Y.overlapMode))return x.push(!0),!0}}}_forEachCell(e,o,u,c,f,x,b,T){const E=this._convertToXCellCoord(e),A=this._convertToYCellCoord(o),M=this._convertToXCellCoord(u),F=this._convertToYCellCoord(c);for(let j=E;j<=M;j++)for(let $=A;$<=F;$++)if(f.call(this,e,o,u,c,this.xCellCount*$+j,x,b,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,u,c,f,x){const b=c-e,T=f-o,E=u+x;return E*E>b*b+T*T}_circleAndRectCollide(e,o,u,c,f,x,b){const T=(x-c)/2,E=Math.abs(e-(c+T));if(E>T+u)return!1;const A=(b-f)/2,M=Math.abs(o-(f+A));if(M>A+u)return!1;if(E<=T||M<=A)return!0;const F=E-T,j=M-A;return F*F+j*j<=u*u}}function Mi(m,e,o,u,c){const f=d.H();return e?(d.K(f,f,[1/c,1/c,1]),o||d.ad(f,f,u.angle)):d.L(f,u.labelPlaneMatrix,m),f}function fi(m,e,o,u,c){if(e){const f=d.ae(m);return d.K(f,f,[c,c,1]),o||d.ad(f,f,-u.angle),f}return u.glCoordMatrix}function W(m,e,o,u){let c;u?(c=[m,e,u(m,e),1],d.af(c,c,o)):(c=[m,e,0,1],Ut(c,c,o));const f=c[3];return{point:new d.P(c[0]/f,c[1]/f),signedDistanceFromCamera:f,isOccluded:!1}}function D(m,e){return .5+m/e*.5}function L(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function N(m,e,o,u,c,f,x,b,T,E,A,M,F,j,$){const H=u?m.textSizeData:m.iconSizeData,K=d.ag(H,o.transform.zoom),Y=[256/o.width*2+1,256/o.height*2+1],ee=u?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ee.clear();const Z=m.lineVertexArray,oe=u?m.text.placedSymbolArray:m.icon.placedSymbolArray,he=o.transform.width/o.transform.height;let ge=!1;for(let ke=0;ke<oe.length;ke++){const ze=oe.get(ke);if(ze.hidden||ze.writingMode===d.ah.vertical&&!ge){dt(ze.numGlyphs,ee);continue}ge=!1;const Ze=W(ze.anchorX,ze.anchorY,e,$);if(!L(Ze.point,Y)){dt(ze.numGlyphs,ee);continue}const Ye=D(o.transform.cameraToCenterDistance,Ze.signedDistanceFromCamera),Ve=d.ai(H,K,ze),je=x?Ve/Ye:Ve*Ye,st={getElevation:$,labelPlaneMatrix:c,lineVertexArray:Z,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:E,tileAnchorPoint:new d.P(ze.anchorX,ze.anchorY),unwrappedTileID:A,width:M,height:F,translation:j},It=ae(st,ze,je,!1,b,e,f,m.glyphOffsetArray,ee,he,T);ge=It.useVertical,(It.notEnoughRoom||ge||It.needsFlipping&&ae(st,ze,je,!0,b,e,f,m.glyphOffsetArray,ee,he,T).notEnoughRoom)&&dt(ze.numGlyphs,ee)}u?m.text.dynamicLayoutVertexBuffer.updateData(ee):m.icon.dynamicLayoutVertexBuffer.updateData(ee)}function q(m,e,o,u,c,f,x,b){const T=f.glyphStartIndex+f.numGlyphs,E=f.lineStartIndex,A=f.lineStartIndex+f.lineLength,M=e.getoffsetX(f.glyphStartIndex),F=e.getoffsetX(T-1),j=Re(m*M,o,u,c,f.segment,E,A,b,x);if(!j)return null;const $=Re(m*F,o,u,c,f.segment,E,A,b,x);return $?b.projectionCache.anyProjectionOccluded?null:{first:j,last:$}:null}function re(m,e,o,u){return m===d.ah.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*u?{useVertical:!0}:(m===d.ah.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function ae(m,e,o,u,c,f,x,b,T,E,A){const M=o/24,F=e.lineOffsetX*M,j=e.lineOffsetY*M;let $;if(e.numGlyphs>1){const H=e.glyphStartIndex+e.numGlyphs,K=e.lineStartIndex,Y=e.lineStartIndex+e.lineLength,ee=q(M,b,F,j,u,e,A,m);if(!ee)return{notEnoughRoom:!0};const Z=W(ee.first.point.x,ee.first.point.y,x,m.getElevation).point,oe=W(ee.last.point.x,ee.last.point.y,x,m.getElevation).point;if(c&&!u){const he=re(e.writingMode,Z,oe,E);if(he)return he}$=[ee.first];for(let he=e.glyphStartIndex+1;he<H-1;he++)$.push(Re(M*b.getoffsetX(he),F,j,u,e.segment,K,Y,m,A));$.push(ee.last)}else{if(c&&!u){const K=W(m.tileAnchorPoint.x,m.tileAnchorPoint.y,f,m.getElevation).point,Y=e.lineStartIndex+e.segment+1,ee=new d.P(m.lineVertexArray.getx(Y),m.lineVertexArray.gety(Y)),Z=W(ee.x,ee.y,f,m.getElevation),oe=Z.signedDistanceFromCamera>0?Z.point:function(ge,ke,ze,Ze,Ye,Ve){return fe(ge,ke,ze,1,Ye,Ve)}(m.tileAnchorPoint,ee,K,0,f,m),he=re(e.writingMode,K,oe,E);if(he)return he}const H=Re(M*b.getoffsetX(e.glyphStartIndex),F,j,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,m,A);if(!H||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};$=[H]}for(const H of $)d.aj(T,H.point,H.angle);return{}}function fe(m,e,o,u,c,f){const x=m.add(m.sub(e)._unit()),b=c!==void 0?W(x.x,x.y,c,f.getElevation).point:ve(x.x,x.y,f).point,T=o.sub(b);return o.add(T._mult(u/T.mag()))}function J(m,e,o){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const c=new d.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),f=ve(c.x,c.y,e);if(f.signedDistanceFromCamera>0)return u.projections[m]=f.point,u.anyProjectionOccluded=u.anyProjectionOccluded||f.isOccluded,f.point;const x=m-o.direction;return function(b,T,E,A,M){return fe(b,T,E,A,void 0,M)}(o.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),c,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function ve(m,e,o){const u=m+o.translation[0],c=e+o.translation[1];let f;return!o.pitchWithMap&&o.projection.useSpecialProjectionForSymbols?(f=o.projection.projectTileCoordinates(u,c,o.unwrappedTileID,o.getElevation),f.point.x=(.5*f.point.x+.5)*o.width,f.point.y=(.5*-f.point.y+.5)*o.height):(f=W(u,c,o.labelPlaneMatrix,o.getElevation),f.isOccluded=!1),f}function Se(m,e,o){return m._unit()._perp()._mult(e*o)}function ye(m,e,o,u,c,f,x,b,T){if(b.projectionCache.offsets[m])return b.projectionCache.offsets[m];const E=o.add(e);if(m+T.direction<u||m+T.direction>=c)return b.projectionCache.offsets[m]=E,E;const A=J(m+T.direction,b,T),M=Se(A.sub(o),x,T.direction),F=o.add(M),j=A.add(M);return b.projectionCache.offsets[m]=d.ak(f,E,F,j)||E,b.projectionCache.offsets[m]}function Re(m,e,o,u,c,f,x,b,T){const E=u?m-e:m+e;let A=E>0?1:-1,M=0;u&&(A*=-1,M=Math.PI),A<0&&(M+=Math.PI);let F,j=A>0?f+c:f+c+1;b.projectionCache.cachedAnchorPoint?F=b.projectionCache.cachedAnchorPoint:(F=ve(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=F);let $,H,K=F,Y=F,ee=0,Z=0;const oe=Math.abs(E),he=[];let ge;for(;ee+Z<=oe;){if(j+=A,j<f||j>=x)return null;ee+=Z,Y=K,H=$;const Ze={absOffsetX:oe,direction:A,distanceFromAnchor:ee,previousVertex:Y};if(K=J(j,b,Ze),o===0)he.push(Y),ge=K.sub(Y);else{let Ye;const Ve=K.sub(Y);Ye=Ve.mag()===0?Se(J(j+A,b,Ze).sub(K),o,A):Se(Ve,o,A),H||(H=Y.add(Ye)),$=ye(j,Ye,K,f,x,H,o,b,Ze),he.push(H),ge=$.sub(H)}Z=ge.mag()}const ke=ge._mult((oe-ee)/Z)._add(H||Y),ze=M+Math.atan2(K.y-Y.y,K.x-Y.x);return he.push(ke),{point:ke,angle:T?ze:0,path:he}}const nt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dt(m,e){for(let o=0;o<m;o++){const u=e.length;e.resize(u+4),e.float32.set(nt,3*u)}}function Ut(m,e,o){const u=e[0],c=e[1];return m[0]=o[0]*u+o[4]*c+o[12],m[1]=o[1]*u+o[5]*c+o[13],m[3]=o[3]*u+o[7]*c+o[15],m}const Pt=100;class Nt{constructor(e,o,u=new Un(e.width+200,e.height+200,25),c=new Un(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=o,this.grid=u,this.ignoredGrid=c,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Pt,this.screenBottomBoundary=e.height+Pt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,u,c,f,x,b,T,E,A,M){const F=e.anchorPointX+T[0],j=e.anchorPointY+T[1],$=this.projectAndGetPerspectiveRatio(c,F,j,f,A),H=u*$.perspectiveRatio;let K;if(x||b)K=this._projectCollisionBox(e,H,c,f,x,b,T,$,A,M);else{const he=$.point.x+(M?M.x*H:0),ge=$.point.y+(M?M.y*H:0);K={allPointsOccluded:!1,box:[he+e.x1*H,ge+e.y1*H,he+e.x2*H,ge+e.y2*H]}}const[Y,ee,Z,oe]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(x?K.allPointsOccluded:this.mapProjection.isOccluded(F,j,f))||$.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Y,ee,Z,oe)||o!=="always"&&this.grid.hitTest(Y,ee,Z,oe,o,E)?{box:[Y,ee,Z,oe],placeable:!1,offscreen:!1}:{box:[Y,ee,Z,oe],placeable:!0,offscreen:this.isOffscreen(Y,ee,Z,oe)}}placeCollisionCircles(e,o,u,c,f,x,b,T,E,A,M,F,j,$,H,K){const Y=[],ee=new d.P(o.anchorX,o.anchorY),Z=this.getPerspectiveRatio(x,ee.x,ee.y,b,K),oe=(M?f/Z:f*Z)/d.ap,he={getElevation:K,labelPlaneMatrix:T,lineVertexArray:u,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ee,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:H},ge=q(oe,c,o.lineOffsetX*oe,o.lineOffsetY*oe,!1,o,!1,he);let ke=!1,ze=!1,Ze=!0;if(ge){const Ye=.5*j*Z+$,Ve=new d.P(-100,-100),je=new d.P(this.screenRightBoundary,this.screenBottomBoundary),st=new bt,It=ge.first,Ue=ge.last;let We=[];for(let Ot=It.path.length-1;Ot>=1;Ot--)We.push(It.path[Ot]);for(let Ot=1;Ot<Ue.path.length;Ot++)We.push(Ue.path[Ot]);const Tt=2.5*Ye;if(E){const Ot=this.projectPathToScreenSpace(We,he,E);We=Ot.some(qt=>qt.signedDistanceFromCamera<=0)?[]:Ot.map(qt=>qt.point)}let xr=[];if(We.length>0){const Ot=We[0].clone(),qt=We[0].clone();for(let wr=1;wr<We.length;wr++)Ot.x=Math.min(Ot.x,We[wr].x),Ot.y=Math.min(Ot.y,We[wr].y),qt.x=Math.max(qt.x,We[wr].x),qt.y=Math.max(qt.y,We[wr].y);xr=Ot.x>=Ve.x&&qt.x<=je.x&&Ot.y>=Ve.y&&qt.y<=je.y?[We]:qt.x<Ve.x||Ot.x>je.x||qt.y<Ve.y||Ot.y>je.y?[]:d.al([We],Ve.x,Ve.y,je.x,je.y)}for(const Ot of xr){st.reset(Ot,.25*Ye);let qt=0;qt=st.length<=.5*Ye?1:Math.ceil(st.paddedLength/Tt)+1;for(let wr=0;wr<qt;wr++){const wn=wr/Math.max(qt-1,1),Ri=st.lerp(wn),br=Ri.x+Pt,qn=Ri.y+Pt;Y.push(br,qn,Ye,0);const zn=br-Ye,bn=qn-Ye,Dn=br+Ye,es=qn+Ye;if(Ze=Ze&&this.isOffscreen(zn,bn,Dn,es),ze=ze||this.isInsideGrid(zn,bn,Dn,es),e!=="always"&&this.grid.hitTestCircle(br,qn,Ye,e,F)&&(ke=!0,!A))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!A&&ke||!ze||Z<this.perspectiveRatioCutoff?[]:Y,offscreen:Ze,collisionDetected:ke}}projectPathToScreenSpace(e,o,u){return e.map(c=>W(c.x,c.y,u,o.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,c=1/0,f=-1/0,x=-1/0;for(const A of e){const M=new d.P(A.x+Pt,A.y+Pt);u=Math.min(u,M.x),c=Math.min(c,M.y),f=Math.max(f,M.x),x=Math.max(x,M.y),o.push(M)}const b=this.grid.query(u,c,f,x).concat(this.ignoredGrid.query(u,c,f,x)),T={},E={};for(const A of b){const M=A.key;if(T[M.bucketInstanceId]===void 0&&(T[M.bucketInstanceId]={}),T[M.bucketInstanceId][M.featureIndex])continue;const F=[new d.P(A.x1,A.y1),new d.P(A.x2,A.y1),new d.P(A.x2,A.y2),new d.P(A.x1,A.y2)];d.am(o,F)&&(T[M.bucketInstanceId][M.featureIndex]=!0,E[M.bucketInstanceId]===void 0&&(E[M.bucketInstanceId]=[]),E[M.bucketInstanceId].push(M.featureIndex))}return E}insertCollisionBox(e,o,u,c,f,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:x,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,u,c,f,x){const b=u?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:f,collisionGroupID:x,overlapMode:o};for(let E=0;E<e.length;E+=4)b.insertCircle(T,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,o,u,c,f){let x;f?(x=[o,u,f(o,u),1],d.af(x,x,e)):(x=[o,u,0,1],Ut(x,x,e));const b=x[3];return{point:new d.P((x[0]/b+1)/2*this.transform.width+Pt,(-x[1]/b+1)/2*this.transform.height+Pt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}getPerspectiveRatio(e,o,u,c,f){const x=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(o,u,c,f):W(o,u,e,f);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(e,o,u,c){return u<Pt||e>=this.screenRightBoundary||c<Pt||o>this.screenBottomBoundary}isInsideGrid(e,o,u,c){return u>=0&&e<this.gridRightBoundary&&c>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,u,c,f,x,b,T,E,A){let M=new d.P(1,0),F=new d.P(0,1);const j=new d.P(e.anchorPointX+b[0],e.anchorPointY+b[1]);if(x&&!f){const Ze=this.projectAndGetPerspectiveRatio(u,j.x+1,j.y,c,E).point.sub(T.point).unit(),Ye=Math.atan(Ze.y/Ze.x)+(Ze.x<0?Math.PI:0),Ve=Math.sin(Ye),je=Math.cos(Ye);M=new d.P(je,Ve),F=new d.P(-Ve,je)}else if(!x&&f){const Ze=-this.transform.angle,Ye=Math.sin(Ze),Ve=Math.cos(Ze);M=new d.P(Ve,Ye),F=new d.P(-Ye,Ve)}let $=T.point,H=o;if(f){$=j;const Ze=this.transform.zoom-Math.floor(this.transform.zoom);H=Math.pow(2,-Ze),H*=this.mapProjection.getPitchedTextCorrection(this.transform,j,c),A||(H*=d.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}A&&($=$.add(M.mult(A.x*H)).add(F.mult(A.y*H)));const K=e.x1*H,Y=e.x2*H,ee=(K+Y)/2,Z=e.y1*H,oe=e.y2*H,he=(Z+oe)/2,ge=[{offsetX:K,offsetY:Z},{offsetX:ee,offsetY:Z},{offsetX:Y,offsetY:Z},{offsetX:Y,offsetY:he},{offsetX:Y,offsetY:oe},{offsetX:ee,offsetY:oe},{offsetX:K,offsetY:oe},{offsetX:K,offsetY:he}];let ke=[];for(const{offsetX:Ze,offsetY:Ye}of ge)ke.push(new d.P($.x+M.x*Ze+F.x*Ye,$.y+M.y*Ze+F.y*Ye));let ze=!1;if(f){const Ze=ke.map(Ye=>this.projectAndGetPerspectiveRatio(u,Ye.x,Ye.y,c,E));ze=Ze.some(Ye=>!Ye.isOccluded),ke=Ze.map(Ye=>Ye.point)}else ze=!0;return{box:d.ao(ke),allPointsOccluded:!ze}}}function jt(m,e,o){return e*(d.X/(m.tileSize*Math.pow(2,o-m.tileID.overscaledZ)))}class Cr{constructor(e,o,u,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):c&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class hr{constructor(e,o,u,c,f){this.text=new Cr(e?e.text:null,o,u,f),this.icon=new Cr(e?e.icon:null,o,c,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ft{constructor(e,o,u){this.text=e,this.icon=o,this.skipFade=u}}class tr{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class fr{constructor(e,o,u,c,f){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=c,this.tileID=f}}class Lr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[e]}}function qr(m,e,o,u,c){const{horizontalAlign:f,verticalAlign:x}=d.au(m);return new d.P(-(f-.5)*e+u[0]*c,-(x-.5)*o+u[1]*c)}class Qr{constructor(e,o,u,c,f,x){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new Nt(this.transform,o),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Lr(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(u,c)=>o.getElevation(e,u,c):null}getBucketParts(e,o,u,c){const f=u.getBucket(o),x=u.latestFeatureIndex;if(!f||!x||o.id!==f.layerIds[0])return;const b=u.collisionBoxArray,T=f.layers[0].layout,E=f.layers[0].paint,A=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),M=u.tileSize/d.X,F=u.tileID.toUnwrapped(),j=this.transform.calculatePosMatrix(F),$=T.get("text-pitch-alignment")==="map",H=T.get("text-rotation-alignment")==="map",K=jt(u,1,this.transform.zoom),Y=this.collisionIndex.mapProjection.translatePosition(this.transform,u,E.get("text-translate"),E.get("text-translate-anchor")),ee=this.collisionIndex.mapProjection.translatePosition(this.transform,u,E.get("icon-translate"),E.get("icon-translate-anchor")),Z=Mi(j,$,H,this.transform,K);let oe=null;if($){const ge=fi(j,$,H,this.transform,K);oe=d.L([],this.transform.labelPlaneMatrix,ge)}this.retainedQueryData[f.bucketInstanceId]=new fr(f.bucketInstanceId,x,f.sourceLayerIndex,f.index,u.tileID);const he={bucket:f,layout:T,translationText:Y,translationIcon:ee,posMatrix:j,unwrappedTileID:F,textLabelPlaneMatrix:Z,labelToScreenMatrix:oe,scale:A,textPixelRatio:M,holdingForFade:u.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:d.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(c)for(const ge of f.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:ze,symbolInstanceEnd:Ze}=ge;e.push({sortKey:ke,symbolInstanceStart:ze,symbolInstanceEnd:Ze,parameters:he})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:he})}attemptAnchorPlacement(e,o,u,c,f,x,b,T,E,A,M,F,j,$,H,K,Y,ee,Z){const oe=d.aq[e.textAnchor],he=[e.textOffset0,e.textOffset1],ge=qr(oe,u,c,he,f),ke=this.collisionIndex.placeCollisionBox(o,F,T,E,A,b,x,K,M.predicate,Z,ge);if((!ee||this.collisionIndex.placeCollisionBox(ee,F,T,E,A,b,x,Y,M.predicate,Z,ge).placeable)&&ke.placeable){let ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(ze=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:he,width:u,height:c,anchor:oe,textBoxScale:f,prevAnchor:ze},this.markUsedJustification($,oe,j,H),$.allowVerticalPlacement&&(this.markUsedOrientation($,H,j),this.placedOrientations[j.crossTileID]=H),{shift:ge,placedGlyphBoxes:ke}}}placeLayerBucketPart(e,o,u){const{bucket:c,layout:f,translationText:x,translationIcon:b,posMatrix:T,unwrappedTileID:E,textLabelPlaneMatrix:A,labelToScreenMatrix:M,textPixelRatio:F,holdingForFade:j,collisionBoxArray:$,partiallyEvaluatedTextSize:H,collisionGroup:K}=e.parameters,Y=f.get("text-optional"),ee=f.get("icon-optional"),Z=d.ar(f,"text-overlap","text-allow-overlap"),oe=Z==="always",he=d.ar(f,"icon-overlap","icon-allow-overlap"),ge=he==="always",ke=f.get("text-rotation-alignment")==="map",ze=f.get("text-pitch-alignment")==="map",Ze=f.get("icon-text-fit")!=="none",Ye=f.get("symbol-z-order")==="viewport-y",Ve=oe&&(ge||!c.hasIconData()||ee),je=ge&&(oe||!c.hasTextData()||Y);!c.collisionArrays&&$&&c.deserializeCollisionBoxes($);const st=this._getTerrainElevationFunc(this.retainedQueryData[c.bucketInstanceId].tileID),It=(Ue,We,Tt)=>{var xr,Ot;if(o[Ue.crossTileID])return;if(j)return void(this.placements[Ue.crossTileID]=new Ft(!1,!1,!1));let qt=!1,wr=!1,wn=!0,Ri=null,br={box:null,placeable:!1,offscreen:null},qn={placeable:!1},zn=null,bn=null,Dn=null,es=0,Xo=0,Vl=0;We.textFeatureIndex?es=We.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(es=Ue.featureIndex),We.verticalTextFeatureIndex&&(Xo=We.verticalTextFeatureIndex);const Ko=We.textBox;if(Ko){const xi=cn=>{let Sn=d.ah.horizontal;if(c.allowVerticalPlacement&&!cn&&this.prevPlacement){const oi=this.prevPlacement.placedOrientations[Ue.crossTileID];oi&&(this.placedOrientations[Ue.crossTileID]=oi,Sn=oi,this.markUsedOrientation(c,Sn,Ue))}return Sn},wi=(cn,Sn)=>{if(c.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&We.verticalTextBox){for(const oi of c.writingModes)if(oi===d.ah.vertical?(br=Sn(),qn=br):br=cn(),br&&br.placeable)break}else br=cn()},Fs=Ue.textAnchorOffsetStartIndex,Fi=Ue.textAnchorOffsetEndIndex;if(Fi===Fs){const cn=(Sn,oi)=>{const Ht=this.collisionIndex.placeCollisionBox(Sn,Z,F,T,E,ze,ke,x,K.predicate,st);return Ht&&Ht.placeable&&(this.markUsedOrientation(c,oi,Ue),this.placedOrientations[Ue.crossTileID]=oi),Ht};wi(()=>cn(Ko,d.ah.horizontal),()=>{const Sn=We.verticalTextBox;return c.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&Sn?cn(Sn,d.ah.vertical):{box:null,offscreen:null}}),xi(br&&br.placeable)}else{let cn=d.aq[(Ot=(xr=this.prevPlacement)===null||xr===void 0?void 0:xr.variableOffsets[Ue.crossTileID])===null||Ot===void 0?void 0:Ot.anchor];const Sn=(Ht,lo,Yo)=>{const Jo=Ht.x2-Ht.x1,ed=Ht.y2-Ht.y1,ff=Ue.textBoxScale,td=Ze&&he==="never"?lo:null;let Bs=null,rd=Z==="never"?1:2,$l="never";cn&&rd++;for(let Wa=0;Wa<rd;Wa++){for(let ql=Fs;ql<Fi;ql++){const Zl=c.textAnchorOffsets.get(ql);if(cn&&Zl.textAnchor!==cn)continue;const Qo=this.attemptAnchorPlacement(Zl,Ht,Jo,ed,ff,ke,ze,F,T,E,K,$l,Ue,c,Yo,x,b,td,st);if(Qo&&(Bs=Qo.placedGlyphBoxes,Bs&&Bs.placeable))return qt=!0,Ri=Qo.shift,Bs}cn?cn=null:$l=Z}return u&&!Bs&&(Bs={box:this.collisionIndex.placeCollisionBox(Ko,"always",F,T,E,ze,ke,x,K.predicate,st,new d.P(0,0)).box,offscreen:!1,placeable:!1}),Bs};wi(()=>Sn(Ko,We.iconBox,d.ah.horizontal),()=>{const Ht=We.verticalTextBox;return c.allowVerticalPlacement&&(!br||!br.placeable)&&Ue.numVerticalGlyphVertices>0&&Ht?Sn(Ht,We.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),br&&(qt=br.placeable,wn=br.offscreen);const oi=xi(br&&br.placeable);if(!qt&&this.prevPlacement){const Ht=this.prevPlacement.variableOffsets[Ue.crossTileID];Ht&&(this.variableOffsets[Ue.crossTileID]=Ht,this.markUsedJustification(c,Ht.anchor,Ue,oi))}}}if(zn=br,qt=zn&&zn.placeable,wn=zn&&zn.offscreen,Ue.useRuntimeCollisionCircles){const xi=c.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex),wi=d.ai(c.textSizeData,H,xi),Fs=f.get("text-padding");bn=this.collisionIndex.placeCollisionCircles(Z,xi,c.lineVertexArray,c.glyphOffsetArray,wi,T,E,A,M,u,ze,K.predicate,Ue.collisionCircleDiameter,Fs,x,st),bn.circles.length&&bn.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),qt=oe||bn.circles.length>0&&!bn.collisionDetected,wn=wn&&bn.offscreen}if(We.iconFeatureIndex&&(Vl=We.iconFeatureIndex),We.iconBox){const xi=wi=>this.collisionIndex.placeCollisionBox(wi,he,F,T,E,ze,ke,b,K.predicate,st,Ze&&Ri?Ri:void 0);qn&&qn.placeable&&We.verticalIconBox?(Dn=xi(We.verticalIconBox),wr=Dn.placeable):(Dn=xi(We.iconBox),wr=Dn.placeable),wn=wn&&Dn.offscreen}const vi=Y||Ue.numHorizontalGlyphVertices===0&&Ue.numVerticalGlyphVertices===0,Ul=ee||Ue.numIconVertices===0;vi||Ul?Ul?vi||(wr=wr&&qt):qt=wr&&qt:wr=qt=wr&&qt;const gc=wr&&Dn.placeable;if(qt&&zn.placeable&&this.collisionIndex.insertCollisionBox(zn.box,Z,f.get("text-ignore-placement"),c.bucketInstanceId,qn&&qn.placeable&&Xo?Xo:es,K.ID),gc&&this.collisionIndex.insertCollisionBox(Dn.box,he,f.get("icon-ignore-placement"),c.bucketInstanceId,Vl,K.ID),bn&&qt&&this.collisionIndex.insertCollisionCircles(bn.circles,Z,f.get("text-ignore-placement"),c.bucketInstanceId,es,K.ID),u&&this.storeCollisionData(c.bucketInstanceId,Tt,We,zn,Dn,bn),Ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ue.crossTileID]=new Ft(qt||Ve,wr||je,wn||c.justReloaded),o[Ue.crossTileID]=!0};if(Ye){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ue=c.getSortedSymbolIndexes(this.transform.angle);for(let We=Ue.length-1;We>=0;--We){const Tt=Ue[We];It(c.symbolInstances.get(Tt),c.collisionArrays[Tt],Tt)}}else for(let Ue=e.symbolInstanceStart;Ue<e.symbolInstanceEnd;Ue++)It(c.symbolInstances.get(Ue),c.collisionArrays[Ue],Ue);if(u&&c.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[c.bucketInstanceId];d.as(Ue.invProjMatrix,T),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}storeCollisionData(e,o,u,c,f,x){if(u.textBox||u.iconBox){let b,T;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(o)?T=b.get(o):(T={text:null,icon:null},b.set(o,T)),u.textBox&&(T.text=c.box),u.iconBox&&(T.icon=f.box)}if(x){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=new tr);for(let T=0;T<x.circles.length;T+=4)b.circles.push(x.circles[T+0]),b.circles.push(x.circles[T+1]),b.circles.push(x.circles[T+2]),b.circles.push(x.collisionDetected?1:0)}}markUsedJustification(e,o,u,c){let f;f=c===d.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.at(o)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const b of x)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=f>=0&&b!==f?0:u.crossTileID)}markUsedOrientation(e,o,u){const c=o===d.ah.horizontal||o===d.ah.horizontalOnly?o:0,f=o===d.ah.vertical?o:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const b of x)e.text.placedSymbolArray.get(b).placedOrientation=c;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const c=o?o.symbolFadeChange(e):1,f=o?o.opacities:{},x=o?o.variableOffsets:{},b=o?o.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],A=f[T];A?(this.opacities[T]=new hr(A,c,E.text,E.icon),u=u||E.text!==A.text.placed||E.icon!==A.icon.placed):(this.opacities[T]=new hr(null,c,E.text,E.icon,E.skipFade),u=u||E.text||E.icon)}for(const T in f){const E=f[T];if(!this.opacities[T]){const A=new hr(E,c,!1,!1);A.isHidden()||(this.opacities[T]=A,u=u||E.text.placed||E.icon.placed)}}for(const T in x)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=x[T]);for(const T in b)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=b[T]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const u={};for(const c of o){const f=c.getBucket(e);f&&c.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,c.tileID,u,c.collisionBoxArray)}}updateBucketOpacities(e,o,u,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],x=f.layout,b=new hr(null,0,!1,!1,!0),T=x.get("text-allow-overlap"),E=x.get("icon-allow-overlap"),A=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=x.get("text-rotation-alignment")==="map",F=x.get("text-pitch-alignment")==="map",j=x.get("icon-text-fit")!=="none",$=new hr(null,0,T&&(E||!e.hasIconData()||x.get("icon-optional")),E&&(T||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const H=(Y,ee,Z)=>{for(let oe=0;oe<ee/4;oe++)Y.opacityVertexArray.emplaceBack(Z);Y.hasVisibleVertices=Y.hasVisibleVertices||Z!==Ls},K=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const ee=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:oe,crossTileID:he}=ee;let ge=this.opacities[he];u[he]?ge=b:ge||(ge=$,this.opacities[he]=ge),u[he]=!0;const ke=ee.numIconVertices>0,ze=this.placedOrientations[ee.crossTileID],Ze=ze===d.ah.vertical,Ye=ze===d.ah.horizontal||ze===d.ah.horizontalOnly;if(Z>0||oe>0){const je=en(ge.text);H(e.text,Z,Ze?Ls:je),H(e.text,oe,Ye?Ls:je);const st=ge.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(We=>{We>=0&&(e.text.placedSymbolArray.get(We).hidden=st||Ze?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=st||Ye?1:0);const It=this.variableOffsets[ee.crossTileID];It&&this.markUsedJustification(e,It.anchor,ee,ze);const Ue=this.placedOrientations[ee.crossTileID];Ue&&(this.markUsedJustification(e,"left",ee,Ue),this.markUsedOrientation(e,Ue,ee))}if(ke){const je=en(ge.icon),st=!(j&&ee.verticalPlacedIconSymbolIndex&&Ze);ee.placedIconSymbolIndex>=0&&(H(e.icon,ee.numIconVertices,st?je:Ls),e.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=ge.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,ee.numVerticalIconVertices,st?Ls:je),e.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}const Ve=K&&K.has(Y)?K.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const je=e.collisionArrays[Y];if(je){let st=new d.P(0,0);if(je.textBox||je.verticalTextBox){let It=!0;if(A){const Ue=this.variableOffsets[he];Ue?(st=qr(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale),M&&st._rotate(F?this.transform.angle:-this.transform.angle)):It=!1}if(je.textBox||je.verticalTextBox){let Ue;je.textBox&&(Ue=Ze),je.verticalTextBox&&(Ue=Ye),ps(e.textCollisionBox.collisionVertexArray,ge.text.placed,!It||Ue,Ve.text,st.x,st.y)}}if(je.iconBox||je.verticalIconBox){const It=!!(!Ye&&je.verticalIconBox);let Ue;je.iconBox&&(Ue=It),je.verticalIconBox&&(Ue=!It),ps(e.iconCollisionBox.collisionVertexArray,ge.icon.placed,Ue,Ve.icon,j?st.x:0,j?st.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Y.invProjMatrix,e.placementViewportMatrix=Y.viewportMatrix,e.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function ps(m,e,o,u,c,f){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-Pt,b=u[1]-Pt,T=u[2]-Pt,E=u[3]-Pt;m.emplaceBack(e?1:0,o?1:0,c||0,f||0,x,b),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,T,b),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,T,E),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,x,E)}const rr=Math.pow(2,25),ko=Math.pow(2,24),To=Math.pow(2,17),gn=Math.pow(2,16),Mn=Math.pow(2,9),Ru=Math.pow(2,8),Bt=Math.pow(2,1);function en(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,o=Math.floor(127*m.opacity);return o*rr+e*ko+o*To+e*gn+o*Mn+e*Ru+o*Bt+e}const Ls=0;function Xi(){return{isOccluded:(m,e,o)=>!1,getPitchedTextCorrection:(m,e,o)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,e,o,u){throw new Error("Not implemented.")},translatePosition:(m,e,o,u)=>function(c,f,x,b,T=!1){if(!x[0]&&!x[1])return[0,0];const E=T?b==="map"?c.angle:0:b==="viewport"?-c.angle:0;if(E){const A=Math.sin(E),M=Math.cos(E);x=[x[0]*M-x[1]*A,x[0]*A+x[1]*M]}return[T?x[0]:jt(f,x[0],c.zoom),T?x[1]:jt(f,x[1],c.zoom)]}(m,e,o,u),getCircleRadiusCorrection:m=>1}}class Ir{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,u,c,f){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(x,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((b,T)=>b.sortKey-T.sortKey));this._currentPartIndex<x.length;)if(o.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,f())return!0;return!1}}class Xs{constructor(e,o,u,c,f,x,b,T){this.placement=new Qr(e,Xi(),o,x,b,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,o,u){const c=Q.now(),f=()=>!this._forceFullPlacement&&Q.now()-c>2;for(;this._currentPlacementIndex>=0;){const x=o[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=b)&&(!x.maxzoom||x.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Ir(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const $n=512/d.X/2;class Er{constructor(e,o,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const c=new Map;for(let f=0;f<o.length;f++){const x=o.get(f),b=x.key,T=c.get(b);T?T.push(x):c.set(b,[x])}for(const[f,x]of c){const b={positions:x.map(T=>({x:Math.floor(T.anchorX*$n),y:Math.floor(T.anchorY*$n)})),crossTileIDs:x.map(T=>T.crossTileID)};if(b.positions.length>128){const T=new d.av(b.positions.length,16,Uint16Array);for(const{x:E,y:A}of b.positions)T.add(E,A);T.finish(),delete b.positions,b.index=T}this._symbolsByKey[f]=b}}getScaledCoordinates(e,o){const{x:u,y:c,z:f}=this.tileID.canonical,{x,y:b,z:T}=o.canonical,E=$n/Math.pow(2,T-f),A=(b*d.X+e.anchorY)*E,M=c*d.X*$n;return{x:Math.floor((x*d.X+e.anchorX)*E-u*d.X*$n),y:Math.floor(A-M)}}findMatches(e,o,u){const c=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let f=0;f<e.length;f++){const x=e.get(f);if(x.crossTileID)continue;const b=this._symbolsByKey[x.key];if(!b)continue;const T=this.getScaledCoordinates(x,o);if(b.index){const E=b.index.range(T.x-c,T.y-c,T.x+c,T.y+c).sort();for(const A of E){const M=b.crossTileIDs[A];if(!u[M]){u[M]=!0,x.crossTileID=M;break}}}else if(b.positions)for(let E=0;E<b.positions.length;E++){const A=b.positions[E],M=b.crossTileIDs[E];if(Math.abs(A.x-T.x)<=c&&Math.abs(A.y-T.y)<=c&&!u[M]){u[M]=!0,x.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Co{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ri{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const u in this.indexes){const c=this.indexes[u],f={};for(const x in c){const b=c[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+o),f[b.tileID.key]=b}this.indexes[u]=f}this.lng=e}addBucket(e,o,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<o.symbolInstances.length;f++)o.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const x=this.indexes[f];if(Number(f)>e.overscaledZ)for(const b in x){const T=x[b];T.tileID.isChildOf(e)&&T.findMatches(o.symbolInstances,e,c)}else{const b=x[e.scaledTo(Number(f)).key];b&&b.findMatches(o.symbolInstances,e,c)}}for(let f=0;f<o.symbolInstances.length;f++){const x=o.symbolInstances.get(f);x.crossTileID||(x.crossTileID=u.generate(),c[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Er(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const u of o.getCrossTileIDsLists())for(const c of u)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let o=!1;for(const u in this.indexes){const c=this.indexes[u];for(const f in c)e[c[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,c[f]),delete c[f],o=!0)}return o}}class Ea{constructor(){this.layerIndexes={},this.crossTileIDs=new Co,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,u){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new ri);let f=!1;const x={};c.handleWrapJump(u);for(const b of o){const T=b.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(b.tileID,T,this.crossTileIDs)&&(f=!0),x[T.bucketInstanceId]=!0)}return c.removeStaleBuckets(x)&&(f=!0),f}pruneUnusedLayers(e){const o={};e.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const ni=(m,e)=>d.t(m,e&&e.filter(o=>o.identifier!=="source.canvas")),Fu=d.aw();class Io extends d.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const c=this.sourceCaches[u].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Tr(ir(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,c)=>this.getGlyphs(u,c)),this.dispatcher.registerMessageHandler("GI",(u,c)=>this.getImages(u,c)),this.imageManager=new yt,this.imageManager.setEventedParent(this),this.glyphManager=new er(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new An(256,512),this.crossTileSymbolIndex=new Ea,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),ti().on(De,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const c=this.sourceCaches[u.sourceId];if(!c)return;const f=c.getSource();if(f&&f.vectorLayerIds)for(const x in this._layers){const b=this._layers[x];b.source===f.id&&this._validateLayer(b)}})}loadURL(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const f=this._loadStyleRequest;d.h(c,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,o,u)}).catch(x=>{this._loadStyleRequest=null,x&&!f.signal.aborted&&this.fire(new d.j(x))})}loadJSON(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(Fu,{validate:!1})}_load(e,o,u){var c;const f=o.transformStyle?o.transformStyle(u,e):e;if(!o.validate||!ni(this,d.u(f))){this._loaded=!0,this.stylesheet=f;for(const x in f.sources)this.addSource(x,f.sources[x],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new He(this.stylesheet.light),this.sky=new kt(this.stylesheet.sky),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of e){const u=d.aA(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(e,o=!1,u=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,x,b,T){return d._(this,void 0,void 0,function*(){const E=Et(f),A=b>1?"@2x":"",M={},F={};for(const{id:j,url:$}of E){const H=x.transformRequest(wt($,A,".json"),"SpriteJSON");M[j]=d.h(H,T);const K=x.transformRequest(wt($,A,".png"),"SpriteImage");F[j]=ce.getImage(K,T)}return yield Promise.all([...Object.values(M),...Object.values(F)]),function(j,$){return d._(this,void 0,void 0,function*(){const H={};for(const K in j){H[K]={};const Y=Q.getImageCanvasContext((yield $[K]).data),ee=(yield j[K]).data;for(const Z in ee){const{width:oe,height:he,x:ge,y:ke,sdf:ze,pixelRatio:Ze,stretchX:Ye,stretchY:Ve,content:je,textFitWidth:st,textFitHeight:It}=ee[Z];H[K][Z]={data:null,pixelRatio:Ze,sdf:ze,stretchX:Ye,stretchY:Ve,content:je,textFitWidth:st,textFitHeight:It,spriteData:{width:oe,height:he,x:ge,y:ke,context:Y}}}}return H})}(M,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const x in f){this._spritesImagesIds[x]=[];const b=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(T=>!(T in f)):[];for(const T of b)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in f[x]){const E=x==="default"?T:`${x}:${T}`;this._spritesImagesIds[x].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,f[x][T],!1):this.imageManager.addImage(E,f[x][T]),o&&(this._changedImages[E]=!0)}}}).catch(f=>{this._spriteRequest=null,c=f,this.fire(new d.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),u&&u(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const o=this.sourceCaches[e.source];if(!o)return;const u=e.sourceLayer;if(!u)return;const c=o.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.j(new Error(`Source layer "${u}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?d.aB(u):u);const c=[];for(const f of e)if(u[f]){const x=o?d.aB(u[f]):u[f];c.push(x)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const c=this._layers[u];c.type!=="custom"&&(e[u]=c.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const c=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(c.length||f.length)&&this._updateWorkerLayers(c,f);for(const x in this._updatedSources){const b=this._updatedSources[x];if(b==="reload")this._reloadSource(x);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const c in this.sourceCaches){const f=this.sourceCaches[c];u[c]=f.used,f.used=!1}for(const c of this._order){const f=this._layers[c];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const c in u){const f=this.sourceCaches[c];!!u[c]!=!!f.used&&f.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,o&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var u;this._checkLoaded();const c=this.serialize();if(e=o.transformStyle?o.transformStyle(c,e):e,((u=o.validate)===null||u===void 0||u)&&ni(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const f=d.aC(c,e),x=this._getOperationsToPerform(f);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const b of x.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const o=[],u=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":o.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":o.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,c.args));break;case"setSky":o.push(()=>this.setSky.apply(this,c.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":o.push(()=>{});break;default:u.push(c.command)}return{operations:o,unimplemented:u}}addImage(e,o){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(d.u.source,`sources.${e}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const c=this.sourceCaches[e]=new ft(e,o,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,u={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new d.j(new Error(`Layer "${c}" already exists on this map.`)));let f;if(e.type==="custom"){if(ni(this,d.aD(e)))return;f=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=d.aB(e),e=d.e(e,{source:c})),this._validate(d.u.layer,`layers.${c}`,e,{arrayIndex:-1},u))return;f=d.aA(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:c}})}const x=o?this._order.indexOf(o):this._order.length;if(o&&x===-1)this.fire(new d.j(new Error(`Cannot add layer "${c}" before non-existing layer "${o}".`)));else{if(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._layers[c]=f,this._removedLayers[c]&&f.source&&f.type!=="custom"){const b=this._removedLayers[c];delete this._removedLayers[c],b.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const u=this._order.indexOf(e);this._order.splice(u,1);const c=o?this._order.indexOf(o):this._order.length;o&&c===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,u){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===o&&c.maxzoom===u||(o!=null&&(c.minzoom=o),u!=null&&(c.maxzoom=u),this._updateLayer(c)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,u={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!d.aE(c.filter,o))return o==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(d.u.filter,`layers.${c.id}.filter`,o,null,u)||(c.filter=d.aB(o),this._updateLayer(c)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,o,u,c={}){this._checkLoaded();const f=this.getLayer(e);f?d.aE(f.getLayoutProperty(o),u)||(f.setLayoutProperty(o,u,c),this._updateLayer(f)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const u=this.getLayer(e);if(u)return u.getLayoutProperty(o);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,u,c={}){this._checkLoaded();const f=this.getLayer(e);f?d.aE(f.getPaintProperty(o),u)||(f.setPaintProperty(o,u,c)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const u=e.source,c=e.sourceLayer,f=this.sourceCaches[u];if(f===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const x=f.getSource().type;x==="geojson"&&c?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||c?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(c,e.id,o)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const u=e.source,c=this.sourceCaches[u];if(c===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const f=c.getSource().type,x=f==="vector"?e.sourceLayer:void 0;f!=="vector"||x?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(x,e.id,o):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,u=e.sourceLayer,c=this.sourceCaches[o];if(c!==void 0)return c.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(u,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,f=>f.serialize()),o=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,c=this.stylesheet;return d.aG({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:e,layers:o,terrain:u},f=>f!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=x=>this._layers[x].type==="fill-extrusion",u={},c=[];for(let x=this._order.length-1;x>=0;x--){const b=this._order[x];if(o(b)){u[b]=x;for(const T of e){const E=T[b];if(E)for(const A of E)c.push(A)}}}c.sort((x,b)=>b.intersectionZ-x.intersectionZ);const f=[];for(let x=this._order.length-1;x>=0;x--){const b=this._order[x];if(o(b))for(let T=c.length-1;T>=0;T--){const E=c[T].feature;if(u[E.layer.id]<x)break;f.push(E),c.pop()}else for(const T of e){const E=T[b];if(E)for(const A of E)f.push(A.feature)}}return f}queryRenderedFeatures(e,o,u){o&&o.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);const c={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const b of o.layers){const T=this._layers[b];if(!T)return this.fire(new d.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];c[T.source]=!0}}const f=[];o.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const b in this.sourceCaches)o.layers&&!c[b]||f.push(Nn(this.sourceCaches[b],this._layers,x,e,o,u));return this.placement&&f.push(function(b,T,E,A,M,F,j){const $={},H=F.queryRenderedSymbols(A),K=[];for(const Y of Object.keys(H).map(Number))K.push(j[Y]);K.sort(Ei);for(const Y of K){const ee=Y.featureIndex.lookupSymbolFeatures(H[Y.bucketInstanceId],T,Y.bucketIndex,Y.sourceLayerIndex,M.filter,M.layers,M.availableImages,b);for(const Z in ee){const oe=$[Z]=$[Z]||[],he=ee[Z];he.sort((ge,ke)=>{const ze=Y.featureSortOrder;if(ze){const Ze=ze.indexOf(ge.featureIndex);return ze.indexOf(ke.featureIndex)-Ze}return ke.featureIndex-ge.featureIndex});for(const ge of he)oe.push(ge)}}for(const Y in $)$[Y].forEach(ee=>{const Z=ee.feature,oe=E[b[Y].source].getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=oe});return $}(this._layers,x,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,o){o&&o.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[e];return u?function(c,f){const x=c.getRenderableIds().map(E=>c.getTileByID(E)),b=[],T={};for(let E=0;E<x.length;E++){const A=x[E],M=A.tileID.canonical.key;T[M]||(T[M]=!0,A.querySourceFeatures(b,f))}return b}(u,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const u=this.light.getLight();let c=!1;for(const x in e)if(!d.aE(e[x],u[x])){c=!0;break}if(!c)return;const f={now:Q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(f)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){const u=this.getSky();let c=!1;if(!e&&!u)return;if(e&&!u)c=!0;else if(!e&&u)c=!0;else for(const x in e)if(!d.aE(e[x],u[x])){c=!0;break}if(!c)return;const f={now:Q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(f)}_validate(e,o,u,c,f={}){return(!f||f.validate!==!1)&&ni(this,e.call(d.u,d.e({key:o,style:this.serialize(),value:u,styleSpec:d.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ti().off(De,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,u,c,f=!1){let x=!1,b=!1;const T={};for(const E of this._order){const A=this._layers[E];if(A.type!=="symbol")continue;if(!T[A.source]){const F=this.sourceCaches[A.source];T[A.source]=F.getRenderableIds(!0).map(j=>F.getTileByID(j)).sort((j,$)=>$.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan($.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(A,T[A.source],e.center.lng);x=x||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Q.now(),e.zoom))&&(this.pauseablePlacement=new Xs(e,this.map.terrain,this._order,f,o,u,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Q.now()),b=!0),x&&this.pauseablePlacement.placement.setStale()),b||x)for(const E of this._order){const A=this._layers[E];A.type==="symbol"&&this.placement.updateLayerOpacities(A,T[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Q.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,o.icons),u})}getGlyphs(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,u={},c){this._checkLoaded();const f=[{id:e,url:o}],x=[...Et(this.stylesheet.sprite),...f];this._validate(d.u.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(f,!0,c))}removeSprite(e){this._checkLoaded();const o=Et(this.stylesheet.sprite);if(o.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex(u=>u.id===e),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Et(this.stylesheet.sprite)}setSprite(e,o={},u){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var fs=d.Y([{name:"a_pos",type:"Int16",components:2}]);const Ki={prelude:Kt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Kt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Kt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Kt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Kt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Kt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Kt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Kt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Kt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Kt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Kt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Kt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Kt(m,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),c=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=f?f.concat(c):c,b={};return{fragmentSource:m=m.replace(o,(T,E,A,M,F)=>(b[F]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(o,(T,E,A,M,F)=>{const j=M==="float"?"vec2":"vec4",$=F.match(/color/)?"color":j;return b[F]?E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${j} a_${F};
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${j} a_${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`}),staticAttributes:u,staticUniforms:x}}class Ks{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,u,c,f,x,b,T,E){this.context=e;let A=this.boundPaintVertexBuffers.length!==c.length;for(let M=0;!A&&M<c.length;M++)this.boundPaintVertexBuffers[M]!==c[M]&&(A=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||A||this.boundIndexBuffer!==f||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(o,u,c,f,x,b,T,E):(e.bindVertexArray.set(this.vao),b&&b.bind(),f&&f.dynamicDraw&&f.bind(),T&&T.bind(),E&&E.bind())}freshBind(e,o,u,c,f,x,b,T){const E=e.numAttributes,A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=c,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=T,o.enableAttributes(M,e);for(const F of u)F.enableAttributes(M,e);x&&x.enableAttributes(M,e),b&&b.enableAttributes(M,e),T&&T.enableAttributes(M,e),o.bind(),o.setVertexAttribPointers(M,e,f);for(const F of u)F.bind(),F.setVertexAttribPointers(M,e,f);x&&(x.bind(),x.setVertexAttribPointers(M,e,f)),c&&c.bind(),b&&(b.bind(),b.setVertexAttribPointers(M,e,f)),T&&(T.bind(),T.setVertexAttribPointers(M,e,f)),A.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Pa=(m,e,o,u,c)=>({u_matrix:m,u_texture:0,u_ele_delta:e,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(c):0,u_horizon_color:u?u.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function ms(m){const e=[];for(let o=0;o<m.length;o++){if(m[o]===null)continue;const u=m[o].split(" ");e.push(u.pop())}return e}class Ys{constructor(e,o,u,c,f,x){const b=e.gl;this.program=b.createProgram();const T=ms(o.staticAttributes),E=u?u.getBinderAttributes():[],A=T.concat(E),M=Ki.prelude.staticUniforms?ms(Ki.prelude.staticUniforms):[],F=o.staticUniforms?ms(o.staticUniforms):[],j=u?u.getBinderUniforms():[],$=M.concat(F).concat(j),H=[];for(const ge of $)H.indexOf(ge)<0&&H.push(ge);const K=u?u.defines():[];f&&K.push("#define OVERDRAW_INSPECTOR;"),x&&K.push("#define TERRAIN3D;");const Y=K.concat(Ki.prelude.fragmentSource,o.fragmentSource).join(`
`),ee=K.concat(Ki.prelude.vertexSource,o.vertexSource).join(`
`),Z=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(Z,Y),b.compileShader(Z),!b.getShaderParameter(Z,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(Z)}`);b.attachShader(this.program,Z);const oe=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(oe,ee),b.compileShader(oe),!b.getShaderParameter(oe,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(oe)}`);b.attachShader(this.program,oe),this.attributes={};const he={};this.numAttributes=A.length;for(let ge=0;ge<this.numAttributes;ge++)A[ge]&&(b.bindAttribLocation(this.program,ge,A[ge]),this.attributes[A[ge]]=ge);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(oe),b.deleteShader(Z);for(let ge=0;ge<H.length;ge++){const ke=H[ge];if(ke&&!he[ke]){const ze=b.getUniformLocation(this.program,ke);ze&&(he[ke]=ze)}}this.fixedUniforms=c(e,he),this.terrainUniforms=((ge,ke)=>({u_depth:new d.aH(ge,ke.u_depth),u_terrain:new d.aH(ge,ke.u_terrain),u_terrain_dim:new d.aI(ge,ke.u_terrain_dim),u_terrain_matrix:new d.aJ(ge,ke.u_terrain_matrix),u_terrain_unpack:new d.aK(ge,ke.u_terrain_unpack),u_terrain_exaggeration:new d.aI(ge,ke.u_terrain_exaggeration)}))(e,he),this.binderUniforms=u?u.getUniforms(e,he):[]}draw(e,o,u,c,f,x,b,T,E,A,M,F,j,$,H,K,Y,ee){const Z=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(c),e.setColorMode(f),e.setCullFace(x),T){e.activeTexture.set(Z.TEXTURE2),Z.bindTexture(Z.TEXTURE_2D,T.depthTexture),e.activeTexture.set(Z.TEXTURE3),Z.bindTexture(Z.TEXTURE_2D,T.texture);for(const he in this.terrainUniforms)this.terrainUniforms[he].set(T[he])}for(const he in this.fixedUniforms)this.fixedUniforms[he].set(b[he]);H&&H.setUniforms(e,this.binderUniforms,j,{zoom:$});let oe=0;switch(o){case Z.LINES:oe=2;break;case Z.TRIANGLES:oe=3;break;case Z.LINE_STRIP:oe=1}for(const he of F.get()){const ge=he.vaos||(he.vaos={});(ge[E]||(ge[E]=new Ks)).bind(e,this,A,H?H.getPaintVertexBuffers():[],M,he.vertexOffset,K,Y,ee),Z.drawElements(o,he.primitiveLength*oe,Z.UNSIGNED_SHORT,he.primitiveOffset*oe*2)}}}function Eo(m,e,o){const u=1/jt(o,1,e.transform.tileZoom),c=Math.pow(2,o.tileID.overscaledZ),f=o.tileSize*Math.pow(2,e.transform.tileZoom)/c,x=f*(o.tileID.canonical.x+o.tileID.wrap*c),b=f*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[x>>16,b>>16],u_pixel_coord_lower:[65535&x,65535&b]}}const Yi=(m,e,o,u)=>{const c=e.style.light,f=c.properties.get("position"),x=[f.x,f.y,f.z],b=function(){var E=new d.A(9);return d.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();c.properties.get("anchor")==="viewport"&&function(E,A){var M=Math.sin(A),F=Math.cos(A);E[0]=F,E[1]=M,E[2]=0,E[3]=-M,E[4]=F,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(b,-e.transform.angle),function(E,A,M){var F=A[0],j=A[1],$=A[2];E[0]=F*M[0]+j*M[3]+$*M[6],E[1]=F*M[1]+j*M[4]+$*M[7],E[2]=F*M[2]+j*M[5]+$*M[8]}(x,x,b);const T=c.properties.get("color");return{u_matrix:m,u_lightpos:x,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+o,u_opacity:u}},Po=(m,e,o,u,c,f,x)=>d.e(Yi(m,e,o,u),Eo(f,e,x),{u_height_factor:-Math.pow(2,c.overscaledZ)/x.tileSize/8}),Rs=m=>({u_matrix:m}),gl=(m,e,o,u)=>d.e(Rs(m),Eo(o,e,u)),Aa=(m,e)=>({u_matrix:m,u_world:e}),Ao=(m,e,o,u,c)=>d.e(gl(m,e,o,u),{u_world:c}),Ma=(m,e,o,u)=>{const c=m.transform;let f,x;if(u.paint.get("circle-pitch-alignment")==="map"){const b=jt(o,1,c.zoom);f=!0,x=[b,b]}else f=!1,x=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(e.posMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:x}},gs=(m,e,o)=>({u_matrix:m,u_inv_matrix:e,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}),ys=(m,e,o=1)=>({u_matrix:m,u_color:e,u_overlay:0,u_overlay_scale:o}),yn=m=>({u_matrix:m}),un=(m,e,o,u)=>({u_matrix:m,u_extrude_scale:jt(e,1,o),u_intensity:u}),Mo=(m,e,o,u)=>{const c=d.H();d.aP(c,0,m.width,m.height,0,0,1);const f=m.context.gl;return{u_matrix:c,u_world:[f.drawingBufferWidth,f.drawingBufferHeight],u_image:o,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function Js(m,e){const o=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new d.Z(0,u/o).toLngLat().lat,new d.Z(0,(u+1)/o).toLngLat().lat]}const zo=(m,e,o,u)=>{const c=m.transform;return{u_matrix:pt(m,e,o,u),u_ratio:1/jt(e,1,c.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},ne=(m,e,o,u,c)=>d.e(zo(m,e,o,c),{u_image:0,u_image_height:u}),Te=(m,e,o,u,c)=>{const f=m.transform,x=Be(e,f);return{u_matrix:pt(m,e,o,c),u_texsize:e.imageAtlasTexture.size,u_ratio:1/jt(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},be=(m,e,o,u,c,f)=>{const x=m.lineAtlas,b=Be(e,m.transform),T=o.layout.get("line-cap")==="round",E=x.getDash(u.from,T),A=x.getDash(u.to,T),M=E.width*c.fromScale,F=A.width*c.toScale;return d.e(zo(m,e,o,f),{u_patternscale_a:[b/M,-E.height/2],u_patternscale_b:[b/F,-A.height/2],u_sdfgamma:x.width/(256*Math.min(M,F)*m.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:A.y,u_mix:c.t})};function Be(m,e){return 1/jt(m,1,e.tileZoom)}function pt(m,e,o,u){return m.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const zt=(m,e,o,u,c)=>{return{u_matrix:m,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(x=c.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(f=c.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:Lt(c.paint.get("raster-hue-rotate"))};var f,x};function Lt(m){m*=Math.PI/180;const e=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const _n=(m,e,o,u,c,f,x,b,T,E,A,M,F,j)=>{const $=x.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:$.width/$.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+M,u_pitch_with_map:+u,u_is_along_line:c,u_is_variable_anchor:f,u_texsize:F,u_texture:0,u_translation:A,u_pitched_scale:j}},mr=(m,e,o,u,c,f,x,b,T,E,A,M,F,j,$)=>{const H=x.transform;return d.e(_n(m,e,o,u,c,f,x,b,T,E,A,M,F,$),{u_gamma_scale:u?Math.cos(H._pitch)*H.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},dr=(m,e,o,u,c,f,x,b,T,E,A,M,F,j)=>d.e(mr(m,e,o,u,c,f,x,b,T,E,A,!0,M,!0,j),{u_texsize_icon:F,u_texture_icon:1}),vn=(m,e,o)=>({u_matrix:m,u_opacity:e,u_color:o}),za=(m,e,o,u,c,f)=>d.e(function(x,b,T,E){const A=T.imageManager.getPattern(x.from.toString()),M=T.imageManager.getPattern(x.to.toString()),{width:F,height:j}=T.imageManager.getPixelSize(),$=Math.pow(2,E.tileID.overscaledZ),H=E.tileSize*Math.pow(2,T.transform.tileZoom)/$,K=H*(E.tileID.canonical.x+E.tileID.wrap*$),Y=H*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[F,j],u_mix:b.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/jt(E,1,T.transform.tileZoom),u_pixel_coord_upper:[K>>16,Y>>16],u_pixel_coord_lower:[65535&K,65535&Y]}}(u,f,o,c),{u_matrix:m,u_opacity:e}),yl={fillExtrusion:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_lightpos:new d.aN(m,e.u_lightpos),u_lightintensity:new d.aI(m,e.u_lightintensity),u_lightcolor:new d.aN(m,e.u_lightcolor),u_vertical_gradient:new d.aI(m,e.u_vertical_gradient),u_opacity:new d.aI(m,e.u_opacity)}),fillExtrusionPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_lightpos:new d.aN(m,e.u_lightpos),u_lightintensity:new d.aI(m,e.u_lightintensity),u_lightcolor:new d.aN(m,e.u_lightcolor),u_vertical_gradient:new d.aI(m,e.u_vertical_gradient),u_height_factor:new d.aI(m,e.u_height_factor),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade),u_opacity:new d.aI(m,e.u_opacity)}),fill:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix)}),fillPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),fillOutline:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world)}),fillOutlinePattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),circle:(m,e)=>({u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(m,e.u_scale_with_map),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_extrude_scale:new d.aO(m,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_matrix:new d.aJ(m,e.u_matrix)}),collisionBox:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_pixel_extrude_scale:new d.aO(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_inv_matrix:new d.aJ(m,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_viewport_size:new d.aO(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new d.aL(m,e.u_color),u_matrix:new d.aJ(m,e.u_matrix),u_overlay:new d.aH(m,e.u_overlay),u_overlay_scale:new d.aI(m,e.u_overlay_scale)}),clippingMask:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix)}),heatmap:(m,e)=>({u_extrude_scale:new d.aI(m,e.u_extrude_scale),u_intensity:new d.aI(m,e.u_intensity),u_matrix:new d.aJ(m,e.u_matrix)}),heatmapTexture:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world),u_image:new d.aH(m,e.u_image),u_color_ramp:new d.aH(m,e.u_color_ramp),u_opacity:new d.aI(m,e.u_opacity)}),hillshade:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_latrange:new d.aO(m,e.u_latrange),u_light:new d.aO(m,e.u_light),u_shadow:new d.aL(m,e.u_shadow),u_highlight:new d.aL(m,e.u_highlight),u_accent:new d.aL(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_dimension:new d.aO(m,e.u_dimension),u_zoom:new d.aI(m,e.u_zoom),u_unpack:new d.aK(m,e.u_unpack)}),line:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_image:new d.aH(m,e.u_image),u_image_height:new d.aI(m,e.u_image_height)}),linePattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texsize:new d.aO(m,e.u_texsize),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_image:new d.aH(m,e.u_image),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),lineSDF:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_patternscale_a:new d.aO(m,e.u_patternscale_a),u_patternscale_b:new d.aO(m,e.u_patternscale_b),u_sdfgamma:new d.aI(m,e.u_sdfgamma),u_image:new d.aH(m,e.u_image),u_tex_y_a:new d.aI(m,e.u_tex_y_a),u_tex_y_b:new d.aI(m,e.u_tex_y_b),u_mix:new d.aI(m,e.u_mix)}),raster:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_tl_parent:new d.aO(m,e.u_tl_parent),u_scale_parent:new d.aI(m,e.u_scale_parent),u_buffer_scale:new d.aI(m,e.u_buffer_scale),u_fade_t:new d.aI(m,e.u_fade_t),u_opacity:new d.aI(m,e.u_opacity),u_image0:new d.aH(m,e.u_image0),u_image1:new d.aH(m,e.u_image1),u_brightness_low:new d.aI(m,e.u_brightness_low),u_brightness_high:new d.aI(m,e.u_brightness_high),u_saturation_factor:new d.aI(m,e.u_saturation_factor),u_contrast_factor:new d.aI(m,e.u_contrast_factor),u_spin_weights:new d.aN(m,e.u_spin_weights)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texture:new d.aH(m,e.u_texture),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texture:new d.aH(m,e.u_texture),u_gamma_scale:new d.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_is_halo:new d.aH(m,e.u_is_halo),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texsize_icon:new d.aO(m,e.u_texsize_icon),u_texture:new d.aH(m,e.u_texture),u_texture_icon:new d.aH(m,e.u_texture_icon),u_gamma_scale:new d.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_is_halo:new d.aH(m,e.u_is_halo),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),background:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_opacity:new d.aI(m,e.u_opacity),u_color:new d.aL(m,e.u_color)}),backgroundPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_opacity:new d.aI(m,e.u_opacity),u_image:new d.aH(m,e.u_image),u_pattern_tl_a:new d.aO(m,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(m,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(m,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(m,e.u_pattern_br_b),u_texsize:new d.aO(m,e.u_texsize),u_mix:new d.aI(m,e.u_mix),u_pattern_size_a:new d.aO(m,e.u_pattern_size_a),u_pattern_size_b:new d.aO(m,e.u_pattern_size_b),u_scale_a:new d.aI(m,e.u_scale_a),u_scale_b:new d.aI(m,e.u_scale_b),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texture:new d.aH(m,e.u_texture),u_ele_delta:new d.aI(m,e.u_ele_delta),u_fog_matrix:new d.aJ(m,e.u_fog_matrix),u_fog_color:new d.aL(m,e.u_fog_color),u_fog_ground_blend:new d.aI(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(m,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(m,e.u_horizon_color),u_horizon_fog_blend:new d.aI(m,e.u_horizon_fog_blend)}),terrainDepth:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ele_delta:new d.aI(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texture:new d.aH(m,e.u_texture),u_terrain_coords_id:new d.aI(m,e.u_terrain_coords_id),u_ele_delta:new d.aI(m,e.u_ele_delta)}),sky:(m,e)=>({u_sky_color:new d.aL(m,e.u_sky_color),u_horizon_color:new d.aL(m,e.u_horizon_color),u_horizon:new d.aI(m,e.u_horizon),u_sky_horizon_blend:new d.aI(m,e.u_sky_horizon_blend)})};class At{constructor(e,o,u){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qs{constructor(e,o,u,c){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=c,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let u=0;u<this.attributes.length;u++){const c=o.attributes[this.attributes[u].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,o,u){for(let c=0;c<this.attributes.length;c++){const f=this.attributes[c],x=o.attributes[f.name];x!==void 0&&e.vertexAttribPointer(x,f.components,e[tn[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zi=new WeakMap;function mi(m){var e;if(zi.has(m))return zi.get(m);{const o=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return zi.set(m,o),o}}class Zt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _l extends Zt{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Xp extends Zt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Do extends Zt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Kp extends Zt{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ih extends Zt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Yp extends Zt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Eh extends Zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Bu extends Zt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Ph extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ah extends Zt{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Mh extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class zh extends Zt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class eo extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Dh extends Zt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Jp extends Zt{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Lh extends Zt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Da extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class Qp extends Zt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class vl extends Zt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ef extends Zt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class tf extends Zt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Rh extends Zt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Fh extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Bh extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ou extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Oh extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class xl extends Zt{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _s extends Zt{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const u=this.gl;mi(u)?u.bindVertexArray(e):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Nu extends Zt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ju extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Vu extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class wl extends Zt{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class Uu extends wl{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class to extends wl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class $u extends wl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class rf{constructor(e,o,u,c,f){this.context=e,this.width=o,this.height=u;const x=e.gl,b=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Uu(e,b),c)this.depthAttachment=f?new $u(e,b):new to(e,b);else if(f)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class Rr{constructor(e,o,u){this.blendFunction=e,this.blendColor=o,this.mask=u}}Rr.Replace=[1,0],Rr.disabled=new Rr(Rr.Replace,d.aM.transparent,[!1,!1,!1,!1]),Rr.unblended=new Rr(Rr.Replace,d.aM.transparent,[!0,!0,!0,!0]),Rr.alphaBlended=new Rr([1,771],d.aM.transparent,[!0,!0,!0,!0]);class nf{constructor(e){var o,u;if(this.gl=e,this.clearColor=new _l(this),this.clearDepth=new Xp(this),this.clearStencil=new Do(this),this.colorMask=new Kp(this),this.depthMask=new Ih(this),this.stencilMask=new Yp(this),this.stencilFunc=new Eh(this),this.stencilOp=new Bu(this),this.stencilTest=new Ph(this),this.depthRange=new Ah(this),this.depthTest=new Mh(this),this.depthFunc=new zh(this),this.blend=new eo(this),this.blendFunc=new Dh(this),this.blendColor=new Jp(this),this.blendEquation=new Lh(this),this.cullFace=new Da(this),this.cullFaceSide=new Qp(this),this.frontFace=new vl(this),this.program=new ef(this),this.activeTexture=new tf(this),this.viewport=new Rh(this),this.bindFramebuffer=new Fh(this),this.bindRenderbuffer=new Bh(this),this.bindTexture=new Ou(this),this.bindVertexBuffer=new Oh(this),this.bindElementBuffer=new xl(this),this.bindVertexArray=new _s(this),this.pixelStoreUnpack=new Nu(this),this.pixelStoreUnpackPremultiplyAlpha=new ju(this),this.pixelStoreUnpackFlipY=new Vu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),mi(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new At(this,e,o)}createVertexBuffer(e,o,u){return new Qs(this,e,o,u)}createRenderbuffer(e,o,u){const c=this.gl,f=c.createRenderbuffer();return this.bindRenderbuffer.set(f),c.renderbufferStorage(c.RENDERBUFFER,e,o,u),this.bindRenderbuffer.set(null),f}createFramebuffer(e,o,u,c){return new rf(this,e,o,u,c)}clear({color:e,depth:o,stencil:u}){const c=this.gl;let f=0;e&&(f|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(f|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(f|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),c.clear(f)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,Rr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return mi(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return mi(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Vt{constructor(e,o,u){this.func=e,this.mask=o,this.range=u}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);const bl=7680;class gr{constructor(e,o,u,c,f,x){this.test=e,this.ref=o,this.mask=u,this.fail=c,this.depthFail=f,this.pass=x}}gr.disabled=new gr({func:519,mask:0},0,0,bl,bl,bl);class ar{constructor(e,o,u){this.enable=e,this.mode=o,this.frontFace=u}}let ro;function La(m,e,o,u,c){const f=m.context,x=f.gl,b=m.useProgram("collisionBox"),T=[];let E=0,A=0;for(let Y=0;Y<u.length;Y++){const ee=u[Y],Z=e.getTile(ee).getBucket(o);if(!Z)continue;const oe=c?Z.textCollisionBox:Z.iconCollisionBox,he=Z.collisionCircleArray;if(he.length>0){const ge=d.H();d.aQ(ge,Z.placementInvProjMatrix,m.transform.glCoordMatrix),d.aQ(ge,ge,Z.placementViewportMatrix),T.push({circleArray:he,circleOffset:A,transform:ee.posMatrix,invTransform:ge,coord:ee}),E+=he.length/4,A=E}oe&&b.draw(f,x.LINES,Vt.disabled,gr.disabled,m.colorModeForRenderPass(),ar.disabled,{u_matrix:ee.posMatrix,u_pixel_extrude_scale:[1/(M=m.transform).width,1/M.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee),o.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,m.transform.zoom,null,null,oe.collisionVertexBuffer)}var M;if(!c||!T.length)return;const F=m.useProgram("collisionCircle"),j=new d.aR;j.resize(4*E),j._trim();let $=0;for(const Y of T)for(let ee=0;ee<Y.circleArray.length/4;ee++){const Z=4*ee,oe=Y.circleArray[Z+0],he=Y.circleArray[Z+1],ge=Y.circleArray[Z+2],ke=Y.circleArray[Z+3];j.emplace($++,oe,he,ge,ke,0),j.emplace($++,oe,he,ge,ke,1),j.emplace($++,oe,he,ge,ke,2),j.emplace($++,oe,he,ge,ke,3)}(!ro||ro.length<2*E)&&(ro=function(Y){const ee=2*Y,Z=new d.aT;Z.resize(ee),Z._trim();for(let oe=0;oe<ee;oe++){const he=6*oe;Z.uint16[he+0]=4*oe+0,Z.uint16[he+1]=4*oe+1,Z.uint16[he+2]=4*oe+2,Z.uint16[he+3]=4*oe+2,Z.uint16[he+4]=4*oe+3,Z.uint16[he+5]=4*oe+0}return Z}(E));const H=f.createIndexBuffer(ro,!0),K=f.createVertexBuffer(j,d.aS.members,!0);for(const Y of T){const ee=gs(Y.transform,Y.invTransform,m.transform);F.draw(f,x.TRIANGLES,Vt.disabled,gr.disabled,m.colorModeForRenderPass(),ar.disabled,ee,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y.coord),o.id,K,H,d.a0.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}K.destroy(),H.destroy()}ar.disabled=new ar(!1,1029,2305),ar.backCCW=new ar(!0,1029,2305);const Ra=d.an(new Float32Array(16));function qu(m,e,o,u,c,f){const{horizontalAlign:x,verticalAlign:b}=d.au(m);return new d.P((-(x-.5)*e/c+u[0])*f,(-(b-.5)*o/c+u[1])*f)}function no(m,e,o,u,c,f){const x=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=u.mult(f);o||(b=b.rotate(-c));const T=x.add(b);return W(T.x,T.y,e.labelPlaneMatrix,e.getElevation).point}if(o){const b=ve(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),T=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return m.add(u.rotate(T))}return m.add(u)}function Lo(m,e,o,u,c,f,x,b,T,E,A,M,F,j){const $=m.text.placedSymbolArray,H=m.text.dynamicLayoutVertexArray,K=m.icon.dynamicLayoutVertexArray,Y={};H.clear();for(let ee=0;ee<$.length;ee++){const Z=$.get(ee),oe=Z.hidden||!Z.crossTileID||m.allowVerticalPlacement&&!Z.placedOrientation?null:u[Z.crossTileID];if(oe){const he=new d.P(Z.anchorX,Z.anchorY),ge={getElevation:j,width:c.width,height:c.height,labelPlaneMatrix:f,pitchWithMap:o,projection:A,tileAnchorPoint:he,translation:M,unwrappedTileID:F},ke=o?W(he.x,he.y,x,j):ve(he.x,he.y,ge),ze=D(c.cameraToCenterDistance,ke.signedDistanceFromCamera);let Ze=d.ai(m.textSizeData,T,Z)*ze/d.ap;o&&(Ze*=m.tilePixelRatio/b);const{width:Ye,height:Ve,anchor:je,textOffset:st,textBoxScale:It}=oe,Ue=qu(je,Ye,Ve,st,It,Ze),We=A.getPitchedTextCorrection(c,he.add(new d.P(M[0],M[1])),F),Tt=no(ke.point,ge,e,Ue,c.angle,We),xr=m.allowVerticalPlacement&&Z.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let Ot=0;Ot<Z.numGlyphs;Ot++)d.aj(H,Tt,xr);E&&Z.associatedIconIndex>=0&&(Y[Z.associatedIconIndex]={shiftedAnchor:Tt,angle:xr})}else dt(Z.numGlyphs,H)}if(E){K.clear();const ee=m.icon.placedSymbolArray;for(let Z=0;Z<ee.length;Z++){const oe=ee.get(Z);if(oe.hidden)dt(oe.numGlyphs,K);else{const he=Y[Z];if(he)for(let ge=0;ge<oe.numGlyphs;ge++)d.aj(K,he.shiftedAnchor,he.angle);else dt(oe.numGlyphs,K)}}m.icon.dynamicLayoutVertexBuffer.updateData(K)}m.text.dynamicLayoutVertexBuffer.updateData(H)}function gi(m,e,o){return o.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Zu(m,e,o,u,c,f,x,b,T,E,A,M){const F=m.context,j=F.gl,$=m.transform,H=Xi(),K=b==="map",Y=T==="map",ee=b!=="viewport"&&o.layout.get("symbol-placement")!=="point",Z=K&&!Y&&!ee,oe=!Y&&ee,he=!o.layout.get("symbol-sort-key").isConstant();let ge=!1;const ke=m.depthModeForSublayer(0,Vt.ReadOnly),ze=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ze=[],Ye=H.getCircleRadiusCorrection($);for(const Ve of u){const je=e.getTile(Ve),st=je.getBucket(o);if(!st)continue;const It=c?st.text:st.icon;if(!It||!It.segments.get().length||!It.hasVisibleVertices)continue;const Ue=It.programConfigurations.get(o.id),We=c||st.sdfIcons,Tt=c?st.textSizeData:st.iconSizeData,xr=Y||$.pitch!==0,Ot=m.useProgram(gi(We,c,st),Ue),qt=d.ag(Tt,$.zoom),wr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ve);let wn,Ri,br,qn,zn=[0,0],bn=null;if(c)Ri=je.glyphAtlasTexture,br=j.LINEAR,wn=je.glyphAtlasTexture.size,st.iconsInText&&(zn=je.imageAtlasTexture.size,bn=je.imageAtlasTexture,qn=xr||m.options.rotating||m.options.zooming||Tt.kind==="composite"||Tt.kind==="camera"?j.LINEAR:j.NEAREST);else{const Ht=o.layout.get("icon-size").constantOr(0)!==1||st.iconsNeedLinear;Ri=je.imageAtlasTexture,br=We||m.options.rotating||m.options.zooming||Ht||xr?j.LINEAR:j.NEAREST,wn=je.imageAtlasTexture.size}const Dn=jt(je,1,m.transform.zoom),es=oe?Ve.posMatrix:Ra,Xo=Mi(es,Y,K,m.transform,Dn),Vl=fi(es,Y,K,m.transform,Dn),Ko=fi(Ve.posMatrix,Y,K,m.transform,Dn),vi=H.translatePosition(m.transform,je,f,x),Ul=ze&&st.hasTextData(),gc=o.layout.get("icon-text-fit")!=="none"&&Ul&&st.hasIconData();if(ee){const Ht=m.style.map.terrain?(Yo,Jo)=>m.style.map.terrain.getElevation(Ve,Yo,Jo):null,lo=o.layout.get("text-rotation-alignment")==="map";N(st,Ve.posMatrix,m,c,Xo,Ko,Y,E,lo,H,Ve.toUnwrapped(),$.width,$.height,vi,Ht)}const xi=Ve.posMatrix,wi=c&&ze||gc,Fs=ee||wi?Ra:Xo,Fi=Vl,cn=We&&o.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Sn;Sn=We?st.iconsInText?dr(Tt.kind,qt,Z,Y,ee,wi,m,xi,Fs,Fi,vi,wn,zn,Ye):mr(Tt.kind,qt,Z,Y,ee,wi,m,xi,Fs,Fi,vi,c,wn,!0,Ye):_n(Tt.kind,qt,Z,Y,ee,wi,m,xi,Fs,Fi,vi,c,wn,Ye);const oi={program:Ot,buffers:It,uniformValues:Sn,atlasTexture:Ri,atlasTextureIcon:bn,atlasInterpolation:br,atlasInterpolationIcon:qn,isSDF:We,hasHalo:cn};if(he&&st.canOverlap){ge=!0;const Ht=It.segments.get();for(const lo of Ht)Ze.push({segments:new d.a0([lo]),sortKey:lo.sortKey,state:oi,terrainData:wr})}else Ze.push({segments:It.segments,sortKey:0,state:oi,terrainData:wr})}ge&&Ze.sort((Ve,je)=>Ve.sortKey-je.sortKey);for(const Ve of Ze){const je=Ve.state;if(F.activeTexture.set(j.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,j.CLAMP_TO_EDGE),je.atlasTextureIcon&&(F.activeTexture.set(j.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),je.isSDF){const st=je.uniformValues;je.hasHalo&&(st.u_is_halo=1,Gu(je.buffers,Ve.segments,o,m,je.program,ke,A,M,st,Ve.terrainData)),st.u_is_halo=0}Gu(je.buffers,Ve.segments,o,m,je.program,ke,A,M,je.uniformValues,Ve.terrainData)}}function Gu(m,e,o,u,c,f,x,b,T,E){const A=u.context;c.draw(A,A.gl.TRIANGLES,f,x,b,ar.disabled,T,E,o.id,m.layoutVertexBuffer,m.indexBuffer,e,o.paint,u.transform.zoom,m.programConfigurations.get(o.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Hu(m,e,o,u){const c=m.context,f=c.gl,x=gr.disabled,b=new Rr([f.ONE,f.ONE],d.aM.transparent,[!0,!0,!0,!0]),T=e.getBucket(o);if(!T)return;const E=u.key;let A=o.heatmapFbos.get(E);A||(A=Fa(c,e.tileSize,e.tileSize),o.heatmapFbos.set(E,A)),c.bindFramebuffer.set(A.framebuffer),c.viewport.set([0,0,e.tileSize,e.tileSize]),c.clear({color:d.aM.transparent});const M=T.programConfigurations.get(o.id),F=m.useProgram("heatmap",M),j=m.style.map.terrain.getTerrainData(u);F.draw(c,f.TRIANGLES,Vt.disabled,x,b,ar.disabled,un(u.posMatrix,e,m.transform.zoom,o.paint.get("heatmap-intensity")),j,o.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,o.paint,m.transform.zoom,M)}function io(m,e,o){const u=m.context,c=u.gl;u.setColorMode(m.colorModeForRenderPass());const f=Ba(u,e),x=o.key,b=e.heatmapFbos.get(x);b&&(u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,b.colorAttachment.get()),u.activeTexture.set(c.TEXTURE1),f.bind(c.LINEAR,c.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(u,c.TRIANGLES,Vt.disabled,gr.disabled,m.colorModeForRenderPass(),ar.disabled,Mo(m,e,0,1),null,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,m.transform.zoom),b.destroy(),e.heatmapFbos.delete(x))}function Fa(m,e,o){var u,c;const f=m.gl,x=f.createTexture();f.bindTexture(f.TEXTURE_2D,x),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);const b=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:f.UNSIGNED_BYTE,T=(c=m.RGBA16F)!==null&&c!==void 0?c:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,T,e,o,0,f.RGBA,b,null);const E=m.createFramebuffer(e,o,!1,!1);return E.colorAttachment.set(x),E}function Ba(m,e){return e.colorRampTexture||(e.colorRampTexture=new St(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function Ro(m,e,o,u,c){if(!o||!u||!u.imageAtlas)return;const f=u.imageAtlas.patternPositions;let x=f[o.to.toString()],b=f[o.from.toString()];if(!x&&b&&(x=b),!b&&x&&(b=x),!x||!b){const T=c.getPaintProperty(e);x=f[T],b=f[T]}x&&b&&m.setConstantPatternPositions(x,b)}function Oa(m,e,o,u,c,f,x){const b=m.context.gl,T="fill-pattern",E=o.paint.get(T),A=E&&E.constantOr(1),M=o.getCrossfadeParameters();let F,j,$,H,K;x?(j=A&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=b.LINES):(j=A?"fillPattern":"fill",F=b.TRIANGLES);const Y=E.constantOr(null);for(const ee of u){const Z=e.getTile(ee);if(A&&!Z.patternsLoaded())continue;const oe=Z.getBucket(o);if(!oe)continue;const he=oe.programConfigurations.get(o.id),ge=m.useProgram(j,he),ke=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee);A&&(m.context.activeTexture.set(b.TEXTURE0),Z.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),he.updatePaintBuffers(M)),Ro(he,T,Y,Z,o);const ze=ke?ee:null,Ze=m.translatePosMatrix(ze?ze.posMatrix:ee.posMatrix,Z,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(x){H=oe.indexBuffer2,K=oe.segments2;const Ye=[b.drawingBufferWidth,b.drawingBufferHeight];$=j==="fillOutlinePattern"&&A?Ao(Ze,m,M,Z,Ye):Aa(Ze,Ye)}else H=oe.indexBuffer,K=oe.segments,$=A?gl(Ze,m,M,Z):Rs(Ze);ge.draw(m.context,F,c,m.stencilModeForClipping(ee),f,ar.disabled,$,ke,o.id,oe.layoutVertexBuffer,H,K,o.paint,m.transform.zoom,he)}}function Sl(m,e,o,u,c,f,x){const b=m.context,T=b.gl,E="fill-extrusion-pattern",A=o.paint.get(E),M=A.constantOr(1),F=o.getCrossfadeParameters(),j=o.paint.get("fill-extrusion-opacity"),$=A.constantOr(null);for(const H of u){const K=e.getTile(H),Y=K.getBucket(o);if(!Y)continue;const ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(H),Z=Y.programConfigurations.get(o.id),oe=m.useProgram(M?"fillExtrusionPattern":"fillExtrusion",Z);M&&(m.context.activeTexture.set(T.TEXTURE0),K.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Z.updatePaintBuffers(F)),Ro(Z,E,$,K,o);const he=m.translatePosMatrix(H.posMatrix,K,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ge=o.paint.get("fill-extrusion-vertical-gradient"),ke=M?Po(he,m,ge,j,H,F,K):Yi(he,m,ge,j);oe.draw(b,b.gl.TRIANGLES,c,f,x,ar.backCCW,ke,ee,o.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,o.paint,m.transform.zoom,Z,m.style.map.terrain&&Y.centroidVertexBuffer)}}function Fo(m,e,o,u,c,f,x){const b=m.context,T=b.gl,E=o.fbo;if(!E)return;const A=m.useProgram("hillshade"),M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(e);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,E.colorAttachment.get()),A.draw(b,T.TRIANGLES,c,f,x,ar.disabled,((F,j,$,H)=>{const K=$.paint.get("hillshade-shadow-color"),Y=$.paint.get("hillshade-highlight-color"),ee=$.paint.get("hillshade-accent-color");let Z=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(Z-=F.transform.angle);const oe=!F.options.moving;return{u_matrix:H?H.posMatrix:F.transform.calculatePosMatrix(j.tileID.toUnwrapped(),oe),u_image:0,u_latrange:Js(0,j.tileID),u_light:[$.paint.get("hillshade-exaggeration"),Z],u_shadow:K,u_highlight:Y,u_accent:ee}})(m,o,u,M?e:null),M,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function Bo(m,e,o,u,c,f){const x=m.context,b=x.gl,T=e.dem;if(T&&T.data){const E=T.dim,A=T.stride,M=T.getPixels();if(x.activeTexture.set(b.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||m.getTileTexture(A),e.demTexture){const j=e.demTexture;j.update(M,{premultiply:!1}),j.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else e.demTexture=new St(x,M,b.RGBA,{premultiply:!1}),e.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);x.activeTexture.set(b.TEXTURE0);let F=e.fbo;if(!F){const j=new St(x,{width:E,height:E,data:null},b.RGBA);j.bind(b.LINEAR,b.CLAMP_TO_EDGE),F=e.fbo=x.createFramebuffer(E,E,!0,!1),F.colorAttachment.set(j.texture)}x.bindFramebuffer.set(F.framebuffer),x.viewport.set([0,0,E,E]),m.useProgram("hillshadePrepare").draw(x,b.TRIANGLES,u,c,f,ar.disabled,((j,$)=>{const H=$.stride,K=d.H();return d.aP(K,0,d.X,-d.X,0,0,1),d.J(K,K,[0,-d.X,0]),{u_matrix:K,u_image:1,u_dimension:[H,H],u_zoom:j.overscaledZ,u_unpack:$.getUnpackVector()}})(e.tileID,T),null,o.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Nh(m,e,o,u,c,f){const x=u.paint.get("raster-fade-duration");if(!f&&x>0){const b=Q.now(),T=(b-m.timeAdded)/x,E=e?(b-e.timeAdded)/x:-1,A=o.getSource(),M=c.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(m.tileID.overscaledZ-M),j=F&&m.refreshedUponExpiration?1:d.ac(F?T:1-E,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Wu=new d.aM(1,0,0,1),Jt=new d.aM(0,1,0,1),kl=new d.aM(0,0,1,1),sf=new d.aM(1,0,1,1),jh=new d.aM(0,1,1,1);function Oo(m,e,o,u){Tl(m,0,e+o/2,m.transform.width,o,u)}function Vh(m,e,o,u){Tl(m,e-o/2,0,o,m.transform.height,u)}function Tl(m,e,o,u,c,f){const x=m.context,b=x.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*m.pixelRatio,o*m.pixelRatio,u*m.pixelRatio,c*m.pixelRatio),x.clear({color:f}),b.disable(b.SCISSOR_TEST)}function Uh(m,e,o){const u=m.context,c=u.gl,f=o.posMatrix,x=m.useProgram("debug"),b=Vt.disabled,T=gr.disabled,E=m.colorModeForRenderPass(),A="$debug",M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(o);u.activeTexture.set(c.TEXTURE0);const F=e.getTileByID(o.key).latestRawTileData,j=Math.floor((F&&F.byteLength||0)/1024),$=e.getTile(o).tileSize,H=512/Math.min($,512)*(o.overscaledZ/m.transform.zoom)*.5;let K=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(K+=` => ${o.overscaledZ}`),function(Y,ee){Y.initDebugOverlayCanvas();const Z=Y.debugOverlayCanvas,oe=Y.context.gl,he=Y.debugOverlayCanvas.getContext("2d");he.clearRect(0,0,Z.width,Z.height),he.shadowColor="white",he.shadowBlur=2,he.lineWidth=1.5,he.strokeStyle="white",he.textBaseline="top",he.font="bold 36px Open Sans, sans-serif",he.fillText(ee,5,5),he.strokeText(ee,5,5),Y.debugOverlayTexture.update(Z),Y.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(m,`${K} ${j}kB`),x.draw(u,c.TRIANGLES,b,T,Rr.alphaBlended,ar.disabled,ys(f,d.aM.transparent,H),null,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),x.draw(u,c.LINE_STRIP,b,T,E,ar.disabled,ys(f,d.aM.red),M,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function $h(m,e,o){const u=m.context,c=u.gl,f=m.colorModeForRenderPass(),x=new Vt(c.LEQUAL,Vt.ReadWrite,m.depthRangeFor3D),b=m.useProgram("terrain"),T=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,m.width,m.height]);for(const E of o){const A=m.renderToTexture.getTexture(E),M=e.getTerrainData(E.tileID);u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,A.texture);const F=m.transform.calculatePosMatrix(E.tileID.toUnwrapped()),j=e.getMeshFrameDelta(m.transform.zoom),$=m.transform.calculateFogMatrix(E.tileID.toUnwrapped()),H=Pa(F,j,$,m.style.sky,m.transform.pitch);b.draw(u,c.TRIANGLES,x,gr.disabled,f,ar.backCCW,H,M,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Cl{constructor(e,o,u){this.vertexBuffer=e,this.indexBuffer=o,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Il{constructor(e,o){this.context=new nf(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ft.maxUnderzooming+ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ea}resize(e,o,u){if(this.width=Math.floor(e*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,o=new d.aX;o.emplaceBack(0,0),o.emplaceBack(d.X,0),o.emplaceBack(0,d.X),o.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(o,fs.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const u=new d.aX;u.emplaceBack(0,0),u.emplaceBack(d.X,0),u.emplaceBack(0,d.X),u.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(u,fs.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const c=new d.$;c.emplaceBack(0,0,0,0),c.emplaceBack(d.X,0,d.X,0),c.emplaceBack(0,d.X,0,d.X),c.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,pi.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const f=new d.aX;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,fs.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const x=new d.aZ;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(x);const b=new d.aY;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(b);const T=this.context.gl;this.stencilClearMode=new gr({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.H();d.aP(u,0,this.width,this.height,0,0,1),d.K(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,Vt.disabled,this.stencilClearMode,Rr.disabled,ar.disabled,yn(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;const u=this.context,c=u.gl;this.nextStencilID+o.length>256&&this.clearStencil(),u.setColorMode(Rr.disabled),u.setDepthMode(Vt.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of o){const b=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);f.draw(u,c.TRIANGLES,Vt.disabled,new gr({func:c.ALWAYS,mask:0},b,255,c.KEEP,c.KEEP,c.REPLACE),Rr.disabled,ar.disabled,yn(x.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new gr({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new gr({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){const o=this.context.gl,u=e.sort((x,b)=>b.overscaledZ-x.overscaledZ),c=u[u.length-1].overscaledZ,f=u[0].overscaledZ-c+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const x={};for(let b=0;b<f;b++)x[b+c]=new gr({func:o.GEQUAL,mask:255},b+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=f,[x,u]}return[{[c]:gr.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Rr([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Rr.unblended:Rr.alphaBlended}depthModeForSublayer(e,o,u){if(!this.opaquePassEnabledForLayer())return Vt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Vt(u||this.context.gl.LEQUAL,o,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Q.now()),this.imageManager.beginFrame();const u=this.style._order,c=this.style.sourceCaches,f={},x={},b={};for(const T in c){const E=c[T];E.used&&E.prepare(this.context),f[T]=E.getVisibleCoordinates(),x[T]=f[T].slice().reverse(),b[T]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<u.length;T++)if(this.style._layers[u[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of u){const E=this.style._layers[T];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const A=x[E.source];(E.type==="custom"||A.length)&&this.renderLayer(this,c[E.source],E,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(T,E){const A=T.context,M=A.gl,F=((Y,ee,Z)=>({u_sky_color:Y.properties.get("sky-color"),u_horizon_color:Y.properties.get("horizon-color"),u_horizon:(ee.height/2+ee.getHorizon())*Z,u_sky_horizon_blend:Y.properties.get("sky-horizon-blend")*ee.height/2*Z}))(E,T.style.map.transform,T.pixelRatio),j=new Vt(M.LEQUAL,Vt.ReadWrite,[0,1]),$=gr.disabled,H=T.colorModeForRenderPass(),K=T.useProgram("sky");if(!E.mesh){const Y=new d.aX;Y.emplaceBack(-1,-1),Y.emplaceBack(1,-1),Y.emplaceBack(1,1),Y.emplaceBack(-1,1);const ee=new d.aY;ee.emplaceBack(0,1,2),ee.emplaceBack(0,2,3),E.mesh=new Cl(A.createVertexBuffer(Y,fs.members),A.createIndexBuffer(ee),d.a0.simpleSegment(0,0,Y.length,ee.length))}K.draw(A,M.TRIANGLES,j,$,H,ar.disabled,F,void 0,"sky",E.mesh.vertexBuffer,E.mesh.indexBuffer,E.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[u[this.currentLayer]],E=c[T.source],A=f[T.source];this._renderTileClippingMasks(T,A),this.renderLayer(this,E,T,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const T=this.style._layers[u[this.currentLayer]],E=c[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const A=(T.type==="symbol"?b:x)[T.source];this._renderTileClippingMasks(T,f[T.source]),this.renderLayer(this,E,T,A)}if(this.options.showTileBoundaries){const T=function(E,A){let M=null;const F=Object.values(E._layers).flatMap(K=>K.source&&!K.isHidden(A)?[E.sourceCaches[K.source]]:[]),j=F.filter(K=>K.getSource().type==="vector"),$=F.filter(K=>K.getSource().type!=="vector"),H=K=>{(!M||M.getSource().maxzoom<K.getSource().maxzoom)&&(M=K)};return j.forEach(K=>H(K)),M||$.forEach(K=>H(K)),M}(this.style,this.transform.zoom);T&&function(E,A,M){for(let F=0;F<M.length;F++)Uh(E,A,M[F])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const E=T.transform.padding;Oo(T,T.transform.height-(E.top||0),3,Wu),Oo(T,E.bottom||0,3,Jt),Vh(T,E.left||0,3,kl),Vh(T,T.transform.width-(E.right||0),3,sf);const A=T.transform.centerPoint;(function(M,F,j,$){Tl(M,F-1,j-10,2,20,$),Tl(M,F-10,j-1,20,2,$)})(T,A.x,T.transform.height-A.y,jh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!d.a_(o,u):!d.a$(o,u)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(d.b0(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,x){const b=f.context,T=b.gl,E=Rr.unblended,A=new Vt(T.LEQUAL,Vt.ReadWrite,[0,1]),M=x.getTerrainMesh(),F=x.sourceCache.getRenderableTiles(),j=f.useProgram("terrainDepth");b.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),b.clear({color:d.aM.transparent,depth:1});for(const $ of F){const H=x.getTerrainData($.tileID),K={u_matrix:f.transform.calculatePosMatrix($.tileID.toUnwrapped()),u_ele_delta:x.getMeshFrameDelta(f.transform.zoom)};j.draw(b,T.TRIANGLES,A,gr.disabled,E,ar.backCCW,K,H,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,x){const b=f.context,T=b.gl,E=Rr.unblended,A=new Vt(T.LEQUAL,Vt.ReadWrite,[0,1]),M=x.getTerrainMesh(),F=x.getCoordsTexture(),j=x.sourceCache.getRenderableTiles(),$=f.useProgram("terrainCoords");b.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),b.clear({color:d.aM.transparent,depth:1}),x.coordsIndex=[];for(const H of j){const K=x.getTerrainData(H.tileID);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,F.texture);const Y={u_matrix:f.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(f.transform.zoom)};$.draw(b,T.TRIANGLES,A,gr.disabled,E,ar.backCCW,Y,K,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),x.coordsIndex.push(H.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(e,o,u,c){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(c||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(f,x,b,T,E){if(f.renderPass!=="translucent")return;const A=gr.disabled,M=f.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,j,$,H,K,Y,ee,Z,oe){const he=j.transform,ge=Xi(),ke=K==="map",ze=Y==="map";for(const Ze of F){const Ye=H.getTile(Ze),Ve=Ye.getBucket($);if(!Ve||!Ve.text||!Ve.text.segments.get().length)continue;const je=d.ag(Ve.textSizeData,he.zoom),st=jt(Ye,1,j.transform.zoom),It=Mi(Ze.posMatrix,ze,ke,j.transform,st),Ue=$.layout.get("icon-text-fit")!=="none"&&Ve.hasIconData();if(je){const We=Math.pow(2,he.zoom-Ye.tileID.overscaledZ),Tt=j.style.map.terrain?(Ot,qt)=>j.style.map.terrain.getElevation(Ze,Ot,qt):null,xr=ge.translatePosition(he,Ye,ee,Z);Lo(Ve,ke,ze,oe,he,It,Ze.posMatrix,We,je,Ue,ge,xr,Ze.toUnwrapped(),Tt)}}}(T,f,b,x,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),E),b.paint.get("icon-opacity").constantOr(1)!==0&&Zu(f,x,b,T,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),A,M),b.paint.get("text-opacity").constantOr(1)!==0&&Zu(f,x,b,T,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),A,M),x.map.showCollisionBoxes&&(La(f,x,b,T,!0),La(f,x,b,T,!1))})(e,o,u,c,this.style.placement.variableOffsets);break;case"circle":(function(f,x,b,T){if(f.renderPass!=="translucent")return;const E=b.paint.get("circle-opacity"),A=b.paint.get("circle-stroke-width"),M=b.paint.get("circle-stroke-opacity"),F=!b.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const j=f.context,$=j.gl,H=f.depthModeForSublayer(0,Vt.ReadOnly),K=gr.disabled,Y=f.colorModeForRenderPass(),ee=[];for(let Z=0;Z<T.length;Z++){const oe=T[Z],he=x.getTile(oe),ge=he.getBucket(b);if(!ge)continue;const ke=ge.programConfigurations.get(b.id),ze=f.useProgram("circle",ke),Ze=ge.layoutVertexBuffer,Ye=ge.indexBuffer,Ve=f.style.map.terrain&&f.style.map.terrain.getTerrainData(oe),je={programConfiguration:ke,program:ze,layoutVertexBuffer:Ze,indexBuffer:Ye,uniformValues:Ma(f,oe,he,b),terrainData:Ve};if(F){const st=ge.segments.get();for(const It of st)ee.push({segments:new d.a0([It]),sortKey:It.sortKey,state:je})}else ee.push({segments:ge.segments,sortKey:0,state:je})}F&&ee.sort((Z,oe)=>Z.sortKey-oe.sortKey);for(const Z of ee){const{programConfiguration:oe,program:he,layoutVertexBuffer:ge,indexBuffer:ke,uniformValues:ze,terrainData:Ze}=Z.state;he.draw(j,$.TRIANGLES,H,K,Y,ar.disabled,ze,Ze,b.id,ge,ke,Z.segments,b.paint,f.transform.zoom,oe)}})(e,o,u,c);break;case"heatmap":(function(f,x,b,T){if(b.paint.get("heatmap-opacity")===0)return;const E=f.context;if(f.style.map.terrain){for(const A of T){const M=x.getTile(A);x.hasRenderableParent(A)||(f.renderPass==="offscreen"?Hu(f,M,b,A):f.renderPass==="translucent"&&io(f,b,A))}E.viewport.set([0,0,f.width,f.height])}else f.renderPass==="offscreen"?function(A,M,F,j){const $=A.context,H=$.gl,K=gr.disabled,Y=new Rr([H.ONE,H.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(ee,Z,oe){const he=ee.gl;ee.activeTexture.set(he.TEXTURE1),ee.viewport.set([0,0,Z.width/4,Z.height/4]);let ge=oe.heatmapFbos.get(d.aU);ge?(he.bindTexture(he.TEXTURE_2D,ge.colorAttachment.get()),ee.bindFramebuffer.set(ge.framebuffer)):(ge=Fa(ee,Z.width/4,Z.height/4),oe.heatmapFbos.set(d.aU,ge))})($,A,F),$.clear({color:d.aM.transparent});for(let ee=0;ee<j.length;ee++){const Z=j[ee];if(M.hasRenderableParent(Z))continue;const oe=M.getTile(Z),he=oe.getBucket(F);if(!he)continue;const ge=he.programConfigurations.get(F.id),ke=A.useProgram("heatmap",ge),{zoom:ze}=A.transform;ke.draw($,H.TRIANGLES,Vt.disabled,K,Y,ar.disabled,un(Z.posMatrix,oe,ze,F.paint.get("heatmap-intensity")),null,F.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,F.paint,A.transform.zoom,ge)}$.viewport.set([0,0,A.width,A.height])}(f,x,b,T):f.renderPass==="translucent"&&function(A,M){const F=A.context,j=F.gl;F.setColorMode(A.colorModeForRenderPass());const $=M.heatmapFbos.get(d.aU);$&&(F.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,$.colorAttachment.get()),F.activeTexture.set(j.TEXTURE1),Ba(F,M).bind(j.LINEAR,j.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(F,j.TRIANGLES,Vt.disabled,gr.disabled,A.colorModeForRenderPass(),ar.disabled,Mo(A,M,0,1),null,M.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,M.paint,A.transform.zoom))}(f,b)})(e,o,u,c);break;case"line":(function(f,x,b,T){if(f.renderPass!=="translucent")return;const E=b.paint.get("line-opacity"),A=b.paint.get("line-width");if(E.constantOr(1)===0||A.constantOr(1)===0)return;const M=f.depthModeForSublayer(0,Vt.ReadOnly),F=f.colorModeForRenderPass(),j=b.paint.get("line-dasharray"),$=b.paint.get("line-pattern"),H=$.constantOr(1),K=b.paint.get("line-gradient"),Y=b.getCrossfadeParameters(),ee=H?"linePattern":j?"lineSDF":K?"lineGradient":"line",Z=f.context,oe=Z.gl;let he=!0;for(const ge of T){const ke=x.getTile(ge);if(H&&!ke.patternsLoaded())continue;const ze=ke.getBucket(b);if(!ze)continue;const Ze=ze.programConfigurations.get(b.id),Ye=f.context.program.get(),Ve=f.useProgram(ee,Ze),je=he||Ve.program!==Ye,st=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ge),It=$.constantOr(null);if(It&&ke.imageAtlas){const Tt=ke.imageAtlas,xr=Tt.patternPositions[It.to.toString()],Ot=Tt.patternPositions[It.from.toString()];xr&&Ot&&Ze.setConstantPatternPositions(xr,Ot)}const Ue=st?ge:null,We=H?Te(f,ke,b,Y,Ue):j?be(f,ke,b,j,Y,Ue):K?ne(f,ke,b,ze.lineClipsArray.length,Ue):zo(f,ke,b,Ue);if(H)Z.activeTexture.set(oe.TEXTURE0),ke.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Ze.updatePaintBuffers(Y);else if(j&&(je||f.lineAtlas.dirty))Z.activeTexture.set(oe.TEXTURE0),f.lineAtlas.bind(Z);else if(K){const Tt=ze.gradients[b.id];let xr=Tt.texture;if(b.gradientVersion!==Tt.version){let Ot=256;if(b.stepInterpolant){const qt=x.getSource().maxzoom,wr=ge.canonical.z===qt?Math.ceil(1<<f.transform.maxZoom-ge.canonical.z):1;Ot=d.ac(d.aV(ze.maxLineLength/d.X*1024*wr),256,Z.maxTextureSize)}Tt.gradient=d.aW({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:Tt.gradient||void 0,clips:ze.lineClipsArray}),Tt.texture?Tt.texture.update(Tt.gradient):Tt.texture=new St(Z,Tt.gradient,oe.RGBA),Tt.version=b.gradientVersion,xr=Tt.texture}Z.activeTexture.set(oe.TEXTURE0),xr.bind(b.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}Ve.draw(Z,oe.TRIANGLES,M,f.stencilModeForClipping(ge),F,ar.disabled,We,st,b.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,b.paint,f.transform.zoom,Ze,ze.layoutVertexBuffer2),he=!1}})(e,o,u,c);break;case"fill":(function(f,x,b,T){const E=b.paint.get("fill-color"),A=b.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=f.colorModeForRenderPass(),F=b.paint.get("fill-pattern"),j=f.opaquePassEnabledForLayer()&&!F.constantOr(1)&&E.constantOr(d.aM.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===j){const $=f.depthModeForSublayer(1,f.renderPass==="opaque"?Vt.ReadWrite:Vt.ReadOnly);Oa(f,x,b,T,$,M,!1)}if(f.renderPass==="translucent"&&b.paint.get("fill-antialias")){const $=f.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);Oa(f,x,b,T,$,M,!0)}})(e,o,u,c);break;case"fill-extrusion":(function(f,x,b,T){const E=b.paint.get("fill-extrusion-opacity");if(E!==0&&f.renderPass==="translucent"){const A=new Vt(f.context.gl.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D);if(E!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))Sl(f,x,b,T,A,gr.disabled,Rr.disabled),Sl(f,x,b,T,A,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const M=f.colorModeForRenderPass();Sl(f,x,b,T,A,gr.disabled,M)}}})(e,o,u,c);break;case"hillshade":(function(f,x,b,T){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const E=f.context,A=f.depthModeForSublayer(0,Vt.ReadOnly),M=f.colorModeForRenderPass(),[F,j]=f.renderPass==="translucent"?f.stencilConfigForOverlap(T):[{},T];for(const $ of j){const H=x.getTile($);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&f.renderPass==="offscreen"?Bo(f,H,b,A,gr.disabled,M):f.renderPass==="translucent"&&Fo(f,$,H,b,A,F[$.overscaledZ],M)}E.viewport.set([0,0,f.width,f.height])})(e,o,u,c);break;case"raster":(function(f,x,b,T){if(f.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!T.length)return;const E=f.context,A=E.gl,M=x.getSource(),F=f.useProgram("raster"),j=f.colorModeForRenderPass(),[$,H]=M instanceof Vn?[{},T]:f.stencilConfigForOverlap(T),K=H[H.length-1].overscaledZ,Y=!f.options.moving;for(const ee of H){const Z=f.depthModeForSublayer(ee.overscaledZ-K,b.paint.get("raster-opacity")===1?Vt.ReadWrite:Vt.ReadOnly,A.LESS),oe=x.getTile(ee);oe.registerFadeDuration(b.paint.get("raster-fade-duration"));const he=x.findLoadedParent(ee,0),ge=x.findLoadedSibling(ee),ke=Nh(oe,he||ge||null,x,b,f.transform,f.style.map.terrain);let ze,Ze;const Ye=b.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;E.activeTexture.set(A.TEXTURE0),oe.texture.bind(Ye,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(A.TEXTURE1),he?(he.texture.bind(Ye,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,he.tileID.overscaledZ-oe.tileID.overscaledZ),Ze=[oe.tileID.canonical.x*ze%1,oe.tileID.canonical.y*ze%1]):oe.texture.bind(Ye,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),oe.texture.useMipmap&&E.extTextureFilterAnisotropic&&f.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const Ve=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ee),je=Ve?ee:null,st=je?je.posMatrix:f.transform.calculatePosMatrix(ee.toUnwrapped(),Y),It=zt(st,Ze||[0,0],ze||1,ke,b);M instanceof Vn?F.draw(E,A.TRIANGLES,Z,gr.disabled,j,ar.disabled,It,Ve,b.id,M.boundsBuffer,f.quadTriangleIndexBuffer,M.boundsSegments):F.draw(E,A.TRIANGLES,Z,$[ee.overscaledZ],j,ar.disabled,It,Ve,b.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(e,o,u,c);break;case"background":(function(f,x,b,T){const E=b.paint.get("background-color"),A=b.paint.get("background-opacity");if(A===0)return;const M=f.context,F=M.gl,j=f.transform,$=j.tileSize,H=b.paint.get("background-pattern");if(f.isPatternMissing(H))return;const K=!H&&E.a===1&&A===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==K)return;const Y=gr.disabled,ee=f.depthModeForSublayer(0,K==="opaque"?Vt.ReadWrite:Vt.ReadOnly),Z=f.colorModeForRenderPass(),oe=f.useProgram(H?"backgroundPattern":"background"),he=T||j.coveringTiles({tileSize:$,terrain:f.style.map.terrain});H&&(M.activeTexture.set(F.TEXTURE0),f.imageManager.bind(f.context));const ge=b.getCrossfadeParameters();for(const ke of he){const ze=T?ke.posMatrix:f.transform.calculatePosMatrix(ke.toUnwrapped()),Ze=H?za(ze,A,f,H,{tileID:ke,tileSize:$},ge):vn(ze,A,E),Ye=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ke);oe.draw(M,F.TRIANGLES,ee,Y,Z,ar.disabled,Ze,Ye,b.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(e,0,u,c);break;case"custom":(function(f,x,b){const T=f.context,E=b.implementation;if(f.renderPass==="offscreen"){const A=E.prerender;A&&(f.setCustomLayerDefaults(),T.setColorMode(f.colorModeForRenderPass()),A.call(E,T.gl,f.transform.customLayerMatrix()),T.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),T.setColorMode(f.colorModeForRenderPass()),T.setStencilMode(gr.disabled);const A=E.renderingMode==="3d"?new Vt(f.context.gl.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Vt.ReadOnly);T.setDepthMode(A),E.render(T.gl,f.transform.customLayerMatrix(),{farZ:f.transform.farZ,nearZ:f.transform.nearZ,fov:f.transform._fov,modelViewProjectionMatrix:f.transform.modelViewProjectionMatrix,projectionMatrix:f.transform.projectionMatrix}),T.setDirty(),f.setBaseState(),T.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,o,u,c,f){if(!u[0]&&!u[1])return e;const x=f?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(x){const E=Math.sin(x),A=Math.cos(x);u=[u[0]*A-u[1]*E,u[0]*E+u[1]*A]}const b=[f?u[0]:jt(o,u[0],this.transform.zoom),f?u[1]:jt(o,u[1],this.transform.zoom),0],T=new Float32Array(16);return d.J(T,e,b),T}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!o||!u}useProgram(e,o){this.cache=this.cache||{};const u=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new Ys(this.context,Ki[e],o,yl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new St(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class No{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,u){const c=Math.pow(2,u),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const T=1/(b=d.af([],b,e))[3]/o*c;return d.b1(b,b,[T,T,1/b[3],T])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const T=function(F,j){var $=j[0],H=j[1],K=j[2],Y=$*$+H*H+K*K;return Y>0&&(Y=1/Math.sqrt(Y)),F[0]=j[0]*Y,F[1]=j[1]*Y,F[2]=j[2]*Y,F}([],function(F,j,$){var H=j[0],K=j[1],Y=j[2],ee=$[0],Z=$[1],oe=$[2];return F[0]=K*oe-Y*Z,F[1]=Y*ee-H*oe,F[2]=H*Z-K*ee,F}([],qe([],f[b[0]],f[b[1]]),qe([],f[b[2]],f[b[1]]))),E=-((A=T)[0]*(M=f[b[1]])[0]+A[1]*M[1]+A[2]*M[2]);var A,M;return T.concat(E)});return new No(f,x)}}class jo{constructor(e,o){this.min=e,this.max=o,this.center=function(u,c,f){return u[0]=.5*c[0],u[1]=.5*c[1],u[2]=.5*c[2],u}([],function(u,c,f){return u[0]=c[0]+f[0],u[1]=c[1]+f[1],u[2]=c[2]+f[2],u}([],this.min,this.max))}quadrant(e){const o=[e%2==0,e<2],u=Ne(this.min),c=Ne(this.max);for(let f=0;f<o.length;f++)u[f]=o[f]?this.min[f]:this.center[f],c[f]=o[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new jo(u,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let c=0;c<e.planes.length;c++){const f=e.planes[c];let x=0;for(let b=0;b<o.length;b++)d.b2(f,o[b])>=0&&x++;if(x===0)return 0;x!==o.length&&(u=!1)}if(u)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const T=e.points[b][c]-this.min[c];f=Math.min(f,T),x=Math.max(x,T)}if(x<0||f>this.max[c]-this.min[c])return 0}return 1}}class Vo{constructor(e=0,o=0,u=0,c=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=u,this.right=c}interpolate(e,o,u){return o.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,o.top,u)),o.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,o.bottom,u)),o.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,o.left,u)),o.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,o.right,u)),this}getCenter(e,o){const u=d.ac((this.left+e-this.right)/2,0,e),c=d.ac((this.top+o-this.bottom)/2,0,o);return new d.P(u,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Vo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Xu=85.051129;class Uo{constructor(e,o,u,c,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Vo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Uo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const o=-d.b3(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var u=new d.A(4);return d.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,c,f){var x=c[0],b=c[1],T=c[2],E=c[3],A=Math.sin(f),M=Math.cos(f);u[0]=x*M+T*A,u[1]=b*M+E*A,u[2]=x*-A+T*M,u[3]=b*-A+E*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const o=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,u){this._unmodified=!1,this._edgeInsets.interpolate(e,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){const o=[new d.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new d.P(0,0)),c=this.pointCoordinate(new d.P(this.width,0)),f=this.pointCoordinate(new d.P(this.width,this.height)),x=this.pointCoordinate(new d.P(0,this.height)),b=Math.floor(Math.min(u.x,c.x,f.x,x.x)),T=Math.floor(Math.max(u.x,c.x,f.x,x.x)),E=1;for(let A=b-E;A<=T+E;A++)A!==0&&o.push(new d.b4(A,e))}return o}coveringTiles(e){var o,u;let c=this.coveringZoomLevel(e);const f=c;if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),b=d.Z.fromLngLat(this.center),T=Math.pow(2,c),E=[T*x.x,T*x.y,0],A=[T*b.x,T*b.y,0],M=No.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,c);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=c);const j=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,$=Z=>({aabb:new jo([Z*T,0,0],[(Z+1)*T,T,0]),zoom:0,x:0,y:0,wrap:Z,fullyVisible:!1}),H=[],K=[],Y=c,ee=e.reparseOverscaled?f:c;if(this._renderWorldCopies)for(let Z=1;Z<=3;Z++)H.push($(-Z)),H.push($(Z));for(H.push($(0));H.length>0;){const Z=H.pop(),oe=Z.x,he=Z.y;let ge=Z.fullyVisible;if(!ge){const Ve=Z.aabb.intersects(M);if(Ve===0)continue;ge=Ve===2}const ke=e.terrain?E:A,ze=Z.aabb.distanceX(ke),Ze=Z.aabb.distanceY(ke),Ye=Math.max(Math.abs(ze),Math.abs(Ze));if(Z.zoom===Y||Ye>j+(1<<Y-Z.zoom)-2&&Z.zoom>=F){const Ve=Y-Z.zoom,je=E[0]-.5-(oe<<Ve),st=E[1]-.5-(he<<Ve);K.push({tileID:new d.S(Z.zoom===Y?ee:Z.zoom,Z.wrap,Z.zoom,oe,he),distanceSq:Je([A[0]-.5-oe,A[1]-.5-he]),tileDistanceToCamera:Math.sqrt(je*je+st*st)})}else for(let Ve=0;Ve<4;Ve++){const je=(oe<<1)+Ve%2,st=(he<<1)+(Ve>>1),It=Z.zoom+1;let Ue=Z.aabb.quadrant(Ve);if(e.terrain){const We=new d.S(It,Z.wrap,It,je,st),Tt=e.terrain.getMinMaxElevation(We),xr=(o=Tt.minElevation)!==null&&o!==void 0?o:this.elevation,Ot=(u=Tt.maxElevation)!==null&&u!==void 0?u:this.elevation;Ue=new jo([Ue.min[0],Ue.min[1],xr],[Ue.max[0],Ue.max[1],Ot])}H.push({aabb:Ue,zoom:It,x:je,y:st,wrap:Z.wrap,fullyVisible:ge})}}return K.sort((Z,oe)=>Z.distanceSq-oe.distanceSq).map(Z=>Z.tileID)}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const o=d.ac(e.lat,-85.051129,Xu);return new d.P(d.O(e.lng)*this.worldSize,d.Q(o)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const o=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,e),f=e.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-f))return;const x=u+o-f,b=Math.cos(this._pitch)*this.cameraToCenterDistance/x/d.b5(1,c.lat),T=this.scaleZoom(b/this.tileSize);this._elevation=f,this._center=c,this.zoom=T}setLocationAtPoint(e,o){const u=this.pointCoordinate(o),c=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(e),x=new d.Z(f.x-(u.x-c.x),f.y-(u.y-c.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){const F=o.pointCoordinate(e);if(F!=null)return F}const u=[e.x,e.y,0,1],c=[e.x,e.y,1,1];d.af(u,u,this.pixelMatrixInverse),d.af(c,c,this.pixelMatrixInverse);const f=u[3],x=c[3],b=u[1]/f,T=c[1]/x,E=u[2]/f,A=c[2]/x,M=E===A?0:(0-E)/(A-E);return new d.Z(d.y.number(u[0]/f,c[0]/x,M)/this.worldSize,d.y.number(b,T,M)/this.worldSize)}coordinatePoint(e,o=0,u=this.pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,o,1];return d.af(c,c,u),new d.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new _e().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new _e([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Xu])}calculateTileMatrix(e){const o=e.canonical,u=this.worldSize/this.zoomScale(o.z),c=o.x+Math.pow(2,o.z)*e.wrap,f=d.an(new Float64Array(16));return d.J(f,f,[c*u,o.y*u,0]),d.K(f,f,[u/d.X,u/d.X,1]),f}calculatePosMatrix(e,o=!1){const u=e.key,c=o?this._alignedPosMatrixCache:this._posMatrixCache;if(c[u])return c[u];const f=this.calculateTileMatrix(e);return d.L(f,o?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,f),c[u]=new Float32Array(f),c[u]}calculateFogMatrix(e){const o=e.key,u=this._fogMatrixCache;if(u[o])return u[o];const c=this.calculateTileMatrix(e);return d.L(c,this.fogMatrix,c),u[o]=new Float32Array(c),u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,o){o=d.ac(+o,this.minZoom,this.maxZoom);const u={center:new d.N(e.lng,e.lat),zoom:o};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const Z=179.9999999999;c=[-Z,Z]}const f=this.tileSize*this.zoomScale(u.zoom);let x=0,b=f,T=0,E=f,A=0,M=0;const{x:F,y:j}=this.size;if(this.latRange){const Z=this.latRange;x=d.Q(Z[1])*f,b=d.Q(Z[0])*f,b-x<j&&(A=j/(b-x))}c&&(T=d.b3(d.O(c[0])*f,0,f),E=d.b3(d.O(c[1])*f,0,f),E<T&&(E+=f),E-T<F&&(M=F/(E-T)));const{x:$,y:H}=this.project.call({worldSize:f},e);let K,Y;const ee=Math.max(M||0,A||0);if(ee){const Z=new d.P(M?(E+T)/2:$,A?(b+x)/2:H);return u.center=this.unproject.call({worldSize:f},Z).wrap(),u.zoom+=this.scaleZoom(ee),u}if(this.latRange){const Z=j/2;H-Z<x&&(Y=x+Z),H+Z>b&&(Y=b-Z)}if(c){const Z=(T+E)/2;let oe=$;this._renderWorldCopies&&(oe=d.b3($,Z-f/2,Z+f/2));const he=F/2;oe-he<T&&(K=T+he),oe+he>E&&(K=E-he)}if(K!==void 0||Y!==void 0){const Z=new d.P(K??$,Y??H);u.center=this.unproject.call({worldSize:f},Z).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,o=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let c=d.an(new Float64Array(16));d.K(c,c,[this.width/2,-this.height/2,1]),d.J(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=d.an(new Float64Array(16)),d.K(c,c,[1,-1,1]),d.J(c,c,[-1,-1,0]),d.K(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this.minElevationForCurrentTile),b=f-x*this._pixelPerMeter/Math.cos(this._pitch),T=x<0?b:f,E=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),M=Math.sin(A)*T/Math.sin(d.ac(Math.PI-E-A,.01,Math.PI-.01)),F=this.getHorizon(),j=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),$=Math.sin(j)*T/Math.sin(d.ac(Math.PI-E-j,.01,Math.PI-.01)),H=Math.min(M,$);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*H+T),this.nearZ=this.height/50,c=new Float64Array(16),d.b6(c,this._fov,this.width/this.height,this.nearZ,this.farZ),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,this.projectionMatrix=d.ae(c),d.K(c,c,[1,-1,1]),d.J(c,c,[0,0,-this.cameraToCenterDistance]),d.b7(c,c,this._pitch),d.ad(c,c,this.angle),d.J(c,c,[-o,-u,0]),this.mercatorMatrix=d.K([],c,[this.worldSize,this.worldSize,this.worldSize]),d.K(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,c),d.J(c,c,[0,0,-this.elevation]),this.modelViewProjectionMatrix=c,this.invModelViewProjectionMatrix=d.as([],c),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,f,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-o,-u,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,c);const K=this.width%2/2,Y=this.height%2/2,ee=Math.cos(this.angle),Z=Math.sin(this.angle),oe=o-Math.round(o)+ee*K+Z*Y,he=u-Math.round(u)+ee*Y+Z*K,ge=new Float64Array(c);if(d.J(ge,ge,[oe>.5?oe-1:oe,he>.5?he-1:he,0]),this.alignedModelViewProjectionMatrix=ge,c=d.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let u=o.x,c=o.y,f=o.x,x=o.y;for(const b of e)u=Math.min(u,b.x),c=Math.min(c,b.y),f=Math.max(f,b.x),x=Math.max(x,b.y);return[new d.P(u,c),new d.P(f,c),new d.P(f,x),new d.P(u,x),new d.P(u,c)]}}lngLatToCameraDepth(e,o){const u=this.locationCoordinate(e),c=[u.x*this.worldSize,u.y*this.worldSize,o,1];return d.af(c,c,this.modelViewProjectionMatrix),c[2]/c[3]}}function Na(m,e){let o,u=!1,c=null,f=null;const x=()=>{c=null,u&&(m.apply(f,o),c=setTimeout(x,e),u=!1)};return(...b)=>(u=!0,f=this,o=b,c||x(),c)}class El{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(u=c)}),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const u=o.join("/");let c=u;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${u}`);let f=window.location.hash.replace(c,"");f.startsWith("#&")?f=f.slice(0,1)+f.slice(2):f==="#"&&(f="");let x=window.location.href.replace(/(#.+)?$/,f);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=Na(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,c=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,c),x=Math.round(o.lng*f)/f,b=Math.round(o.lat*f)/f,T=this._map.getBearing(),E=this._map.getPitch();let A="";if(A+=e?`/${x}/${b}/${u}`:`${u}/${b}/${x}`,(T||E)&&(A+="/"+Math.round(10*T)/10),E&&(A+=`/${Math.round(E)}`),this._hashName){const M=this._hashName;let F=!1;const j=window.location.hash.slice(1).split("&").map($=>{const H=$.split("=")[0];return H===M?(F=!0,`${H}=${A}`):$}).filter($=>$);return F||j.push(`${M}=${A}`),`#${j.join("&")}`}return`#${A}`}}const Pl={linearity:.3,easing:d.b8(0,0,.3,1)},Ku=d.e({deceleration:2500,maxSpeed:1400},Pl),of=d.e({deceleration:20,maxSpeed:1400},Pl),qh=d.e({deceleration:1e3,maxSpeed:360},Pl),Al=d.e({deceleration:1e3,maxSpeed:90},Pl);class Yu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Q.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=Q.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)o.zoom+=f.zoomDelta||0,o.bearing+=f.bearingDelta||0,o.pitch+=f.pitchDelta||0,f.panDelta&&o.pan._add(f.panDelta),f.around&&(o.around=f.around),f.pinchAround&&(o.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(o.pan.mag()){const f=Va(o.pan.mag(),u,d.e({},Ku,e||{}));c.offset=o.pan.mult(f.amount/o.pan.mag()),c.center=this._map.transform.center,ja(c,f)}if(o.zoom){const f=Va(o.zoom,u,of);c.zoom=this._map.transform.zoom+f.amount,ja(c,f)}if(o.bearing){const f=Va(o.bearing,u,qh);c.bearing=this._map.transform.bearing+d.ac(f.amount,-179,179),ja(c,f)}if(o.pitch){const f=Va(o.pitch,u,Al);c.pitch=this._map.transform.pitch+f.amount,ja(c,f)}if(c.zoom||c.bearing){const f=o.pinchAround===void 0?o.around:o.pinchAround;c.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),d.e(c,{noMoveStart:!0})}}function ja(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Va(m,e,o){const{maxSpeed:u,linearity:c,deceleration:f}=o,x=d.ac(m*c/(e/1e3),-u,u),b=Math.abs(x)/(f*c);return{easing:o.easing,duration:1e3*b,amount:x*(b/2)}}class xn extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u,c={}){const f=U.mousePos(o.getCanvas(),u),x=o.unproject(f);super(e,d.e({point:f,lngLat:x,originalEvent:u},c)),this._defaultPrevented=!1,this.target=o}}class so extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){const c=e==="touchend"?u.changedTouches:u.touches,f=U.touchPos(o.getCanvasContainer(),c),x=f.map(T=>o.unproject(T)),b=f.reduce((T,E,A,M)=>T.add(E.div(M.length)),new d.P(0,0));super(e,{points:f,point:b,lngLats:x,lngLat:o.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class Zh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class Gh{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Zh(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new xn(e.type,this._map,e))}mouseup(e){this._map.fire(new xn(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new xn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new xn(e.type,this._map,e))}mouseover(e){this._map.fire(new xn(e.type,this._map,e))}mouseout(e){this._map.fire(new xn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new so(e.type,this._map,e))}touchmove(e){this._map.fire(new so(e.type,this._map,e))}touchend(e){this._map.fire(new so(e.type,this._map,e))}touchcancel(e){this._map.fire(new so(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new xn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new xn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Di{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class ii{constructor(e,o){this._map=e,this._tr=new Di(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(U.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=u,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(c.x,u.x),x=Math.max(c.x,u.x),b=Math.min(c.y,u.y),T=Math.max(c.y,u.y);U.setTransform(this._box,`translate(${f}px,${b}px)`),this._box.style.width=x-f+"px",this._box.style.height=T-b+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const u=this._startPos,c=o;if(this.reset(),U.suppressClick(),u.x!==c.x||u.y!==c.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(u,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new d.k(e,{originalEvent:o}))}}function Ua(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const o={};for(let u=0;u<m.length;u++)o[m[u].identifier]=e[u];return o}class Ju{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(c){const f=new d.P(0,0);for(const x of c)f._add(x);return f.div(c.length)}(o),this.touches=Ua(u,o)))}touchmove(e,o,u){if(this.aborted||!this.centroid)return;const c=Ua(u,o);for(const f in this.touches){const x=c[f];(!x||x.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(e,o,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class Ml{constructor(e){this.singleTap=new Ju(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,u){this.singleTap.touchstart(e,o,u)}touchmove(e,o,u){this.singleTap.touchmove(e,o,u)}touchend(e,o,u){const c=this.singleTap.touchend(e,o,u);if(c){const f=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(c)<30;if(f&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class $o{constructor(e){this._tr=new Di(e),this._zoomIn=new Ml({numTouches:1,numTaps:2}),this._zoomOut=new Ml({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,u){this._zoomIn.touchstart(e,o,u),this._zoomOut.touchstart(e,o,u)}touchmove(e,o,u){this._zoomIn.touchmove(e,o,u),this._zoomOut.touchmove(e,o,u)}touchend(e,o,u){const c=this._zoomIn.touchend(e,o,u),f=this._zoomOut.touchend(e,o,u),x=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(c)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vs{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=o.length?o[0]:o;return!this._moved&&c.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(u,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&U.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qu={0:1,2:2};class zl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=U.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(o,u){const c=Qu[u];return o.buttons===void 0||(o.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return U.mouseButton(e)===this._eventButton}}class ec{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Dl=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}},tc=({enable:m,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{const u=new zl({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new vs({clickTolerance:e,move:(c,f)=>({bearingDelta:(f.x-c.x)*o}),moveStateManager:u,enable:m,assignEvents:Dl})},rc=({enable:m,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{const u=new zl({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new vs({clickTolerance:e,move:(c,f)=>({pitchDelta:(f.y-c.y)*o}),moveStateManager:u,enable:m,assignEvents:Dl})};class oo{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,u){return this._calculateTransform(e,o,u)}touchmove(e,o,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,o,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,u){this._calculateTransform(e,o,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,u){u.length>0&&(this._active=!0);const c=Ua(u,o),f=new d.P(0,0),x=new d.P(0,0);let b=0;for(const E in c){const A=c[E],M=this._touches[E];M&&(f._add(A),x._add(A.sub(M)),b++,c[E]=A)}if(this._touches=c,this._shouldBePrevented(b)||!x.mag())return;const T=x.div(b);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(b),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ll{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,u){if(!this._firstTwoTouches)return;e.preventDefault();const[c,f]=this._firstTwoTouches,x=$a(u,o,c),b=$a(u,o,f);if(!x||!b)return;const T=this._aroundCenter?null:x.add(b).div(2);return this._move([x,b],T,e)}touchend(e,o,u){if(!this._firstTwoTouches)return;const[c,f]=this._firstTwoTouches,x=$a(u,o,c),b=$a(u,o,f);x&&b||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function $a(m,e,o){for(let u=0;u<m.length;u++)if(m[u].identifier===o)return e[u]}function nc(m,e){return Math.log(m/e)/Math.LN2}class ic extends Ll{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(nc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:nc(this._distance,u),pinchAround:o}}}function sc(m,e){return 180*m.angleWith(e)/Math.PI}class oc extends Ll{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,u){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:sc(this._vector,c),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,u=sc(e,this._startVector);return Math.abs(u)<o}}function Rl(m){return Math.abs(m.y)>Math.abs(m.x)}class qa extends Ll{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,u){super.touchstart(e,o,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,Rl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,f,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,u){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,f=o.mag()>=2;if(!c&&!f)return;if(!c||!f)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=e.y>0==o.y>0;return Rl(e)&&Rl(o)&&x}}const Hh={panStep:100,bearingStep:15,pitchStep:10};class yi{constructor(e){this._tr=new Di(e);const o=Hh;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,u=0,c=0,f=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,c=0),{cameraAnimation:b=>{const T=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Ji,zoom:o?Math.round(T.zoom)+o*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+u*this._bearingStep,pitch:T.pitch+c*this._pitchStep,offset:[-f*this._panStep,-x*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ji(m){return m*(2-m)}const ac=4.000244140625;class Li{constructor(e,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Di(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=Q.now(),c=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%ac==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=U.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=o.y>u.transform.height/2-u.transform.getHorizon()?d.N.convert(this._aroundCenter?u.center:u.unproject(o)):d.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>ac?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&E!==0&&(E=1/E);const A=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(A*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,c=this._easing;let f,x=!1;const b=Q.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&c&&b){const T=Math.min(b/200,1),E=c(T);f=d.y.number(u,o,E),T<1?this._frameId||(this._frameId=!0):x=!0}else f=o,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=d.b9;if(this._prevEase){const u=this._prevEase,c=(Q.now()-u.start)/u.duration,f=u.easing(c+.01)-u.easing(c),x=.27/Math.sqrt(f*f+1e-4)*.01,b=Math.sqrt(.0729-x*x);o=d.b8(x,b,.25,1)}return this._prevEase={start:Q.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ao{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class af{constructor(e){this._tr=new Di(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lf{constructor(){this._tap=new Ml({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,u){if(!this._swipePoint)if(this._tapTime){const c=o[0],f=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(c)<30;f&&x?u.length>0&&(this._swipePoint=c,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,o,u)}touchmove(e,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const c=o[0],f=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,o,u)}touchend(e,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const c=this._tap.touchend(e,o,u);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wh{constructor(e,o,u){this._el=e,this._mousePan=o,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xh{constructor(e,o,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class lc{constructor(e,o,u,c){this._el=e,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class qo{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=o,this._container.appendChild(c);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=u,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const _i=m=>m.zoom||m.drag||m.pitch||m.rotate;class et extends d.k{}function Fl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class uc{constructor(e,o){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,f)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=c.type==="renderFrame"?void 0:c,b={needsRenderFrame:!1},T={},E={},A=c.touches,M=A?this._getMapTouches(A):void 0,F=M?U.touchPos(this._map.getCanvas(),M):U.mousePos(this._map.getCanvas(),c);for(const{handlerName:H,handler:K,allowed:Y}of this._handlers){if(!K.isEnabled())continue;let ee;this._blockedByActive(E,Y,H)?K.reset():K[f||c.type]&&(ee=K[f||c.type](c,F,M),this.mergeHandlerResult(b,T,ee,H,x),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||K.isActive())&&(E[H]=K)}const j={};for(const H in this._previousActiveHandlers)E[H]||(j[H]=x);this._previousActiveHandlers=E,(Object.keys(j).length||Fl(b))&&(this._changes.push([b,T,j]),this._triggerRenderFrame()),(Object.keys(E).length||Fl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=b;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yu(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,f,x]of this._listeners)U.addEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,o,u]of this._listeners)U.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new Gh(o,e));const c=o.boxZoom=new ii(o,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const f=o.cooperativeGestures=new qo(o,e.cooperativeGestures);this._add("cooperativeGestures",f),e.cooperativeGestures&&f.enable();const x=new $o(o),b=new af(o);o.doubleClickZoom=new ao(b,x),this._add("tapZoom",x),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const T=new lf;this._add("tapDragZoom",T);const E=o.touchPitch=new qa(o);this._add("touchPitch",E),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const A=tc(e),M=rc(e);o.dragRotate=new Xh(e,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const F=(({enable:ee,clickTolerance:Z})=>{const oe=new zl({checkCorrectEvent:he=>U.mouseButton(he)===0&&!he.ctrlKey});return new vs({clickTolerance:Z,move:(he,ge)=>({around:ge,panDelta:ge.sub(he)}),activateOnStart:!0,moveStateManager:oe,enable:ee,assignEvents:Dl})})(e),j=new oo(e,o);o.dragPan=new Wh(u,F,j),this._add("mousePan",F),this._add("touchPan",j,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const $=new oc,H=new ic;o.touchZoomRotate=new lc(u,H,$,T),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);const K=o.scrollZoom=new Li(o,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const Y=o.keyboard=new yi(o);this._add("keyboard",Y),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Fr(o))}_add(e,o,u){this._handlers.push({handlerName:e,handler:o,allowed:u}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_i(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,u){for(const c in e)if(c!==u&&(!o||o.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const u of e)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(e,o,u,c,f){if(!u)return;d.e(e,u);const x={handlerName:c,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(o.zoom=x),u.panDelta!==void 0&&(o.drag=x),u.pitchDelta!==void 0&&(o.pitch=x),u.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){const e={},o={},u={};for(const[c,f,x]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),d.e(o,f),d.e(u,x);this._updateMapTransform(e,o,u),this._changes=[]}_updateMapTransform(e,o,u){const c=this._map,f=c._getTransformForUpdate(),x=c.terrain;if(!(Fl(e)||x&&this._terrainMovement))return this._fireEvents(o,u,!0);let{panDelta:b,zoomDelta:T,bearingDelta:E,pitchDelta:A,around:M,pinchAround:F}=e;F!==void 0&&(M=F),c._stop(!0),M=M||c.transform.centerPoint;const j=f.pointLocation(b?M.sub(b):M);E&&(f.bearing+=E),A&&(f.pitch+=A),T&&(f.zoom+=T),x?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(b)):f.setLocationAtPoint(j,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(j,M)):f.setLocationAtPoint(j,M),c._applyUpdatedTransform(f),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,u,!0)}_fireEvents(e,o,u){const c=_i(this._eventsInProgress),f=_i(e),x={};for(const M in e){const{originalEvent:F}=e[M];this._eventsInProgress[M]||(x[`${M}start`]=F),this._eventsInProgress[M]=e[M]}!c&&f&&this._fireEvent("movestart",f.originalEvent);for(const M in x)this._fireEvent(M,x[M]);f&&this._fireEvent("move",f.originalEvent);for(const M in e){const{originalEvent:F}=e[M];this._fireEvent(M,F)}const b={};let T;for(const M in this._eventsInProgress){const{handlerName:F,originalEvent:j}=this._eventsInProgress[M];this._handlersById[F].isActive()||(delete this._eventsInProgress[M],T=o[F]||j,b[`${M}end`]=T)}for(const M in b)this._fireEvent(M,b[M]);const E=_i(this._eventsInProgress),A=(c||f)&&!E;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(u&&A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!M||!M.essential&&Q.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:T})),F(this._map.getBearing())&&this._map.resetNorth()):(F(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new d.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new et("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Kh extends d.E{constructor(e,o){super(),this._renderFrameCallback=()=>{const u=Math.min((Q.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,u){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},o),u)}panTo(e,o,u){return this.easeTo(d.e({center:e},o),u)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,u){return this.easeTo(d.e({zoom:e},o),u)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,u){return this.easeTo(d.e({bearing:e},o),u)}resetNorth(e,o){return this.rotateTo(0,d.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=_e.convert(e).adjustAntiMeridian();const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,o)}_cameraForBoxAndBearing(e,o,u,c){const f={top:0,bottom:0,right:0,left:0};if(typeof(c=d.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const Ve=c.padding;c.padding={top:Ve,bottom:Ve,right:Ve,left:Ve}}c.padding=d.e(f,c.padding);const x=this.transform,b=x.padding,T=new _e(e,o),E=x.project(T.getNorthWest()),A=x.project(T.getNorthEast()),M=x.project(T.getSouthEast()),F=x.project(T.getSouthWest()),j=d.ba(-u),$=E.rotate(j),H=A.rotate(j),K=M.rotate(j),Y=F.rotate(j),ee=new d.P(Math.max($.x,H.x,Y.x,K.x),Math.max($.y,H.y,Y.y,K.y)),Z=new d.P(Math.min($.x,H.x,Y.x,K.x),Math.min($.y,H.y,Y.y,K.y)),oe=ee.sub(Z),he=(x.width-(b.left+b.right+c.padding.left+c.padding.right))/oe.x,ge=(x.height-(b.top+b.bottom+c.padding.top+c.padding.bottom))/oe.y;if(ge<0||he<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ke=Math.min(x.scaleZoom(x.scale*Math.min(he,ge)),c.maxZoom),ze=d.P.convert(c.offset),Ze=new d.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(d.ba(u)),Ye=ze.add(Ze).mult(x.scale/x.zoomScale(ke));return{center:x.unproject(E.add(M).div(2).sub(Ye)),zoom:ke,bearing:u}}fitBounds(e,o,u){return this._fitInternal(this.cameraForBounds(e,o),o,u)}fitScreenCoordinates(e,o,u,c,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(o)),u,c),c,f)}_fitInternal(e,o,u){return e?(delete(o=d.e(e,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(e,o){this.stop();const u=this._getTransformForUpdate();let c=!1,f=!1,x=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(c=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=d.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(f=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(x=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new d.k("movestart",o)).fire(new d.k("move",o)),c&&this.fire(new d.k("zoomstart",o)).fire(new d.k("zoom",o)).fire(new d.k("zoomend",o)),f&&this.fire(new d.k("rotatestart",o)).fire(new d.k("rotate",o)).fire(new d.k("rotateend",o)),x&&this.fire(new d.k("pitchstart",o)).fire(new d.k("pitch",o)).fire(new d.k("pitchend",o)),this.fire(new d.k("moveend",o))}calculateCameraOptionsFromTo(e,o,u,c=0){const f=d.Z.fromLngLat(e,o),x=d.Z.fromLngLat(u,c),b=x.x-f.x,T=x.y-f.y,E=x.z-f.z,A=Math.hypot(b,T,E);if(A===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(b,T),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),j=180*Math.atan2(b,-T)/Math.PI;let $=180*Math.acos(M/A)/Math.PI;return $=E<0?90-$:90+$,{center:x.toLngLat(),zoom:F,pitch:$,bearing:j}}easeTo(e,o){var u;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&Q.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),f=c.zoom,x=c.bearing,b=c.pitch,T=c.padding,E="bearing"in e?this._normalizeBearing(e.bearing,x):x,A="pitch"in e?+e.pitch:b,M="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let j=c.centerPoint.add(F);const $=c.pointLocation(j),{center:H,zoom:K}=c.getConstrained(d.N.convert(e.center||$),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(H,c);const Y=c.project($),ee=c.project(H).sub(Y),Z=c.zoomScale(K-f);let oe,he;e.around&&(oe=d.N.convert(e.around),he=c.locationPoint(oe));const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==f,this._rotating=this._rotating||x!==E,this._pitching=this._pitching||A!==b,this._padding=!c.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,ge),this.terrain&&this._prepareElevation(H),this._ease(ke=>{if(this._zooming&&(c.zoom=d.y.number(f,K,ke)),this._rotating&&(c.bearing=d.y.number(x,E,ke)),this._pitching&&(c.pitch=d.y.number(b,A,ke)),this._padding&&(c.interpolatePadding(T,M,ke),j=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(ke),oe)c.setLocationAtPoint(oe,he);else{const ze=c.zoomScale(c.zoom-f),Ze=K>f?Math.min(2,Z):Math.max(.5,Z),Ye=Math.pow(Ze,1-ke),Ve=c.unproject(Y.add(ee.mult(ke*Ye)).mult(ze));c.setLocationAtPoint(c.renderWorldCopies?Ve.wrap():Ve,j)}this._applyUpdatedTransform(c),this._fireMoveEvents(o)},ke=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,ke)},e),this}_prepareEase(e,o,u={}){this._moving=!0,o||u.moving||this.fire(new d.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(o-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const o=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(o.lngLat,e.zoom);if(o.altitude<u){const c=this.calculateCameraOptionsFromTo(o.lngLat,u,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(this.terrain&&o.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&o.push(c=>this.transformCameraUpdate(c)),!o.length)return;const u=e.clone();for(const c of o){const f=u.clone(),{center:x,zoom:b,pitch:T,bearing:E,elevation:A}=c(f);x&&(f.center=x),b!==void 0&&(f.zoom=b),T!==void 0&&(f.pitch=T),E!==void 0&&(f.bearing=E),A!==void 0&&(f.elevation=A),u.apply(f)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,c=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new d.k("zoomend",e)),c&&this.fire(new d.k("rotateend",e)),f&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,o){var u;if(!e.essential&&Q.prefersReducedMotion){const We=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(We,o)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const c=this._getTransformForUpdate(),f=c.zoom,x=c.bearing,b=c.pitch,T=c.padding,E="bearing"in e?this._normalizeBearing(e.bearing,x):x,A="pitch"in e?+e.pitch:b,M="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let j=c.centerPoint.add(F);const $=c.pointLocation(j),{center:H,zoom:K}=c.getConstrained(d.N.convert(e.center||$),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(H,c);const Y=c.zoomScale(K-f),ee=c.project($),Z=c.project(H).sub(ee);let oe=e.curve;const he=Math.max(c.width,c.height),ge=he/Y,ke=Z.mag();if("minZoom"in e){const We=d.ac(Math.min(e.minZoom,f,K),c.minZoom,c.maxZoom),Tt=he/c.zoomScale(We-f);oe=Math.sqrt(Tt/ke*2)}const ze=oe*oe;function Ze(We){const Tt=(ge*ge-he*he+(We?-1:1)*ze*ze*ke*ke)/(2*(We?ge:he)*ze*ke);return Math.log(Math.sqrt(Tt*Tt+1)-Tt)}function Ye(We){return(Math.exp(We)-Math.exp(-We))/2}function Ve(We){return(Math.exp(We)+Math.exp(-We))/2}const je=Ze(!1);let st=function(We){return Ve(je)/Ve(je+oe*We)},It=function(We){return he*((Ve(je)*(Ye(Tt=je+oe*We)/Ve(Tt))-Ye(je))/ze)/ke;var Tt},Ue=(Ze(!0)-je)/oe;if(Math.abs(ke)<1e-6||!isFinite(Ue)){if(Math.abs(he-ge)<1e-6)return this.easeTo(e,o);const We=ge<he?-1:1;Ue=Math.abs(Math.log(ge/he))/oe,It=()=>0,st=Tt=>Math.exp(We*oe*Tt)}return e.duration="duration"in e?+e.duration:1e3*Ue/("screenSpeed"in e?+e.screenSpeed/oe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=x!==E,this._pitching=A!==b,this._padding=!c.isPaddingEqual(M),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(H),this._ease(We=>{const Tt=We*Ue,xr=1/st(Tt);c.zoom=We===1?K:f+c.scaleZoom(xr),this._rotating&&(c.bearing=d.y.number(x,E,We)),this._pitching&&(c.pitch=d.y.number(b,A,We)),this._padding&&(c.interpolatePadding(T,M,We),j=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(We);const Ot=We===1?H:c.unproject(ee.add(Z.mult(It(Tt))).mult(xr));c.setLocationAtPoint(c.renderWorldCopies?Ot.wrap():Ot,j),this._applyUpdatedTransform(c),this._fireMoveEvents(o)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,o)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,o,u){u.animate===!1||u.duration===0?(e(1),o()):(this._easeStart=Q.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=d.b3(e,-180,180);const u=Math.abs(e-o);return Math.abs(e-360-o)<u&&(e-=360),Math.abs(e+360-o)<u&&(e+=360),e}_normalizeCenter(e,o){if(!o.renderWorldCopies||o.lngRange)return;const u=e.lng-o.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Zo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Go{constructor(e=Zo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const u=this._map._getUIString(`AttributionControl.${o}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const o=this._map.style.sourceCaches;for(const c in o){const f=o[c];if(f.used||f.usedForTerrain){const x=f.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,f)=>c.length-f.length),e=e.filter((c,f)=>{for(let x=f+1;x<e.length;x++)if(e[x].indexOf(c)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class cc{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");const o=U.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Gt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const c of u)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var hc=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class uf extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];const u={};for(const c of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))u[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),d.aP(c.posMatrix,0,d.X,0,d.X,0,1),this._tiles[c.key]=new Hr(c,this.tileSize));for(const c in this._tiles)u[c]||delete this._tiles[c]}freeRtt(e){for(const o in this._tiles){const u=this._tiles[o];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const o={};for(const u of this._renderableTilesKeys){const c=this._tiles[u].tileID;if(c.canonical.equals(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16),d.aP(f.posMatrix,0,d.X,0,d.X,0,1),o[u]=f}else if(c.canonical.isChildOf(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const x=c.canonical.z-e.canonical.z,b=c.canonical.x-(c.canonical.x>>x<<x),T=c.canonical.y-(c.canonical.y>>x<<x),E=d.X>>x;d.aP(f.posMatrix,0,E,0,E,0,1),d.J(f.posMatrix,f.posMatrix,[-b*E,-T*E,0]),o[u]=f}else if(e.canonical.isChildOf(c.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const x=e.canonical.z-c.canonical.z,b=e.canonical.x-(e.canonical.x>>x<<x),T=e.canonical.y-(e.canonical.y>>x<<x),E=d.X>>x;d.aP(f.posMatrix,0,d.X,0,d.X,0,1),d.J(f.posMatrix,f.posMatrix,[b*E,T*E,0]),d.K(f.posMatrix,f.posMatrix,[1/2**x,1/2**x,0]),o[u]=f}}return o}getSourceTile(e,o){const u=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>u.maxzoom&&(c=u.maxzoom),c<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&o)for(;c>=u.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(c--).key);return f}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=e)}}class dc{constructor(e,o,u){this.painter=e,this.sourceCache=new uf(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,u,c=d.X){var f;if(!(o>=0&&o<c&&u>=0&&u<c))return 0;const x=this.getTerrainData(e),b=(f=x.tile)===null||f===void 0?void 0:f.dem;if(!b)return 0;const T=function($,H,K){var Y=H[0],ee=H[1];return $[0]=K[0]*Y+K[4]*ee+K[12],$[1]=K[1]*Y+K[5]*ee+K[13],$}([],[o/c*d.X,u/c*d.X],x.u_terrain_matrix),E=[T[0]*b.dim,T[1]*b.dim],A=Math.floor(E[0]),M=Math.floor(E[1]),F=E[0]-A,j=E[1]-M;return b.get(A,M)*(1-F)*(1-j)+b.get(A+1,M)*F*(1-j)+b.get(A,M+1)*(1-F)*j+b.get(A+1,M+1)*F*j}getElevationForLngLatZoom(e,o){if(!d.bb(o,e.wrap()))return 0;const{tileID:u,mercatorX:c,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(u,c%d.X,f%d.X,d.X)}getElevation(e,o,u,c=d.X){return this.getDEMElevation(e,o,u,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,f=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new St(c,f,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new St(c,new d.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const c=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new St(c,o.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),o.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const c=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?f=e.canonical.z-c:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>f<<f),b=e.canonical.y-(e.canonical.y>>f<<f),T=d.bc(new Float64Array(16),[1/(d.X<<f),1/(d.X<<f),0]);d.J(T,T,[x*d.X,b*d.X,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,u=o.width/devicePixelRatio,c=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new St(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new St(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,c,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,x=0;f<this._coordsTextureSize;f++)for(let b=0;b<this._coordsTextureSize;b++,x+=4)o[x+0]=255&b,o[x+1]=255&f,o[x+2]=b>>8<<4|f>>8,o[x+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),c=new St(e,u,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,c=u.gl,f=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(f,b-x-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const T=o[0]+(o[2]>>4<<8),E=o[1]+((15&o[2])<<8),A=this.coordsIndex[255-o[3]],M=A&&this.sourceCache.getTileByID(A);if(!M)return null;const F=this._coordsTextureSize,j=(1<<M.tileID.canonical.z)*F;return new d.Z((M.tileID.canonical.x*F+T)/j+M.tileID.wrap,(M.tileID.canonical.y*F+E)/j,this.getElevation(M.tileID,T,E,F))}depthAtPoint(e){const o=new Uint8Array(4),u=this.painter.context,c=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,o=new d.bd,u=new d.aY,c=this.meshSize,f=d.X/c,x=c*c;for(let M=0;M<=c;M++)for(let F=0;F<=c;F++)o.emplaceBack(F*f,M*f,0);for(let M=0;M<x;M+=c+1)for(let F=0;F<c;F++)u.emplaceBack(F+M,c+F+M+1,c+F+M+2),u.emplaceBack(F+M,c+F+M+2,F+M+1);const b=o.length,T=b+2*(c+1);for(const M of[0,1])for(let F=0;F<=c;F++)for(const j of[0,1])o.emplaceBack(F*f,M*d.X,j);for(let M=0;M<2*c;M+=2)u.emplaceBack(T+M,T+M+1,T+M+3),u.emplaceBack(T+M,T+M+3,T+M+2),u.emplaceBack(b+M,b+M+3,b+M+1),u.emplaceBack(b+M,b+M+2,b+M+3);const E=o.length,A=E+2*(c+1);for(const M of[0,1])for(let F=0;F<=c;F++)for(const j of[0,1])o.emplaceBack(M*d.X,F*f,j);for(let M=0;M<2*c;M+=2)u.emplaceBack(E+M,E+M+1,E+M+3),u.emplaceBack(E+M,E+M+3,E+M+2),u.emplaceBack(A+M,A+M+3,A+M+1),u.emplaceBack(A+M,A+M+2,A+M+3);return this._mesh=new Cl(e.createVertexBuffer(o,hc.members),e.createIndexBuffer(u),d.a0.simpleSegment(0,0,o.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var u;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(u=this.getMinMaxElevation(c).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,o){const u=d.Z.fromLngLat(e.wrap()),c=(1<<o)*d.X,f=u.x*c,x=u.y*c,b=Math.floor(f/d.X),T=Math.floor(x/d.X);return{tileID:new d.S(o,0,o,b,T),mercatorX:f,mercatorY:x}}}class cf{constructor(e,o,u){this._context=e,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new St(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:e,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>e.id!==o),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Ho={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Yh{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new cf(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(o)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const c=e.sourceCaches[u].getVisibleCoordinates();for(const f of c){const x=this.terrain.sourceCache.getTerrainCoords(f);for(const b in x)this._coordsDescendingInv[u][b]||(this._coordsDescendingInv[u][b]=[]),this._coordsDescendingInv[u][b].push(x[b])}}this._coordsDescendingInvStr={};for(const u of e._order){const c=e._layers[u],f=c.source;if(Ho[c.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const x in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][x]=this._coordsDescendingInv[f][x].map(b=>b.key).sort().join()}}for(const u of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[c][u.tileID.key];f&&f!==u.rttCoords[c]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const o=e.type,u=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ho[o]&&(this._prevType&&Ho[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!c))return!0;if(Ho[this._prevType]||Ho[o]&&c){this._prevType=o;const f=this._stacks.length-1,x=this._stacks[f]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&($h(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[f]){const E=this.pool.getObjectForId(b.rtt[f].id);if(E.stamp===b.rtt[f].stamp){this.pool.useObject(E);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),b.rtt[f]={id:T.id,stamp:T.stamp},u.context.bindFramebuffer.set(T.fbo.framebuffer),u.context.clear({color:d.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let E=0;E<x.length;E++){const A=u.style._layers[x[E]],M=A.source?this._coordsDescendingInv[A.source][b.tileID.key]:[b.tileID];u.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),u._renderTileClippingMasks(A,M),u.renderLayer(u,u.style.sourceCaches[A.source],A,M),A.source&&(b.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][b.tileID.key])}}return $h(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ho[o]}return!1}}const pc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Jh=V,hf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Zo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},fc=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},df={showCompass:!0,showZoom:!0,visualizePitch:!1};class pf{constructor(e,o,u=!1){this.mousedown=x=>{this.startMouse(d.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),U.mousePos(this.element,x)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,U.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=e.dragRotate._mouseRotate.getClickTolerance(),f=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=tc({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:b,bearingDegreesPerPixelMoved:T=.8})=>{const E=new ec;return new vs({clickTolerance:b,move:(A,M)=>({bearingDelta:(M.x-A.x)*T}),moveStateManager:E,enable:x,assignEvents:fc})})({clickTolerance:c,enable:!0}),this.map=e,u&&(this.mousePitch=rc({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:b,pitchDegreesPerPixelMoved:T=-.5})=>{const E=new ec;return new vs({clickTolerance:b,move:(A,M)=>({pitchDelta:(M.y-A.y)*T}),moveStateManager:E,enable:x,assignEvents:fc})})({clickTolerance:f,enable:!0})),U.addEventListener(o,"mousedown",this.mousedown),U.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),U.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),U.disableDrag()}moveMouse(e,o){const u=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(e,o)||{};f&&u.setPitch(u.getPitch()+f)}}moveTouch(e,o){const u=this.map,{bearingDelta:c}=this.touchRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(e,o)||{};f&&u.setPitch(u.getPitch()+f)}}off(){const e=this.element;U.removeEventListener(e,"mousedown",this.mousedown),U.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let si;function vr(m,e,o){const u=new d.N(m.lng,m.lat);if(m=new d.N(m.lng,m.lat),e){const c=new d.N(m.lng-360,m.lat),f=new d.N(m.lng+360,m.lat),x=o.locationPoint(m).distSqr(e);o.locationPoint(c).distSqr(e)<x?m=c:o.locationPoint(f).distSqr(e)<x&&(m=f)}for(;Math.abs(m.lng-o.center.lng)>180;){const c=o.locationPoint(m);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m.lng!==u.lng&&o.locationPoint(m).y>o.height/2-o.getHorizon()?m:u}const Wo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bl(m,e,o){const u=m.classList;for(const c in Wo)u.remove(`maplibregl-${o}-anchor-${c}`);u.add(`maplibregl-${o}-anchor-${e}`)}class Ol extends d.E{constructor(e){if(super(),this._onKeyPress=o=>{const u=o.code,c=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,c=this._element;this._popup&&(u===c||c.contains(u))&&this.togglePopup()},this._update=o=>{var u;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?vr(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${Wo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${f}`),Q.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div");const o=U.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${c}px`),o.setAttributeNS(null,"viewBox",`0 0 ${c} ${u}`);const f=U.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const x=U.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const b=U.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of T){const ee=U.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",Y.rx),ee.setAttributeNS(null,"ry",Y.ry),b.appendChild(ee)}const E=U.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const A=U.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(A);const M=U.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const F=U.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(F);const j=U.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const $=U.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=U.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const K=U.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),$.appendChild(H),$.appendChild(K),x.appendChild(b),x.appendChild(E),x.appendChild(M),x.appendChild(j),x.appendChild($),o.appendChild(x),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(o),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Bl(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,u;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,f=c.terrain.depthAtPoint(this._pos),x=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,x)-f<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/c.transform._pixelPerMeter,T=Math.sin(c.getPitch()*Math.PI/180)*b,E=c.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),A=c.transform.lngLatToCameraDepth(this._lngLat,x+T)-E>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return e===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Qh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Za=0,Ga=!1;const Qi={maxWidth:100,unit:"metric"};function Ha(m,e,o){const u=o&&o.maxWidth||100,c=m._container.clientHeight/2,f=m.unproject([0,c]),x=m.unproject([u,c]),b=f.distanceTo(x);if(o&&o.unit==="imperial"){const T=3.2808*b;T>5280?it(e,u,T/5280,m._getUIString("ScaleControl.Miles")):it(e,u,T,m._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?it(e,u,b/1852,m._getUIString("ScaleControl.NauticalMiles")):b>=1e3?it(e,u,b/1e3,m._getUIString("ScaleControl.Kilometers")):it(e,u,b,m._getUIString("ScaleControl.Meters"))}function it(m,e,o,u){const c=function(f){const x=Math.pow(10,`${Math.floor(f)}`.length-1);let b=f/x;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E}(b),x*b}(o);m.style.width=e*(c/o)+"px",m.innerHTML=`${c}&nbsp;${u}`}const vt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Nl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jl(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-m),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const e=d.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return jl(new d.P(0,0))}const mc=V;S.AJAXError=d.bh,S.Evented=d.E,S.LngLat=d.N,S.MercatorCoordinate=d.Z,S.Point=d.P,S.addProtocol=d.bi,S.config=d.a,S.removeProtocol=d.bj,S.AttributionControl=Go,S.BoxZoomHandler=ii,S.CanvasSource=Yr,S.CooperativeGesturesHandler=qo,S.DoubleClickZoomHandler=ao,S.DragPanHandler=Wh,S.DragRotateHandler=Xh,S.EdgeInsets=Vo,S.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o==null?void 0:o.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Pi,S.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new d.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,c=this._map.getBearing(),f=d.e({bearing:c},this.options.fitBoundsOptions),x=_e.fromLngLat(o,u);this._map.fitBounds(x,f,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ga)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ol({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ol({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Qh,m)}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(si!==void 0&&!e)return si;if(window.navigator.permissions===void 0)return si=!!window.navigator.geolocation,si;try{si=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{si=!!window.navigator.geolocation}return si})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Za=0,Ga=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),o=m.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),o=m.getNorthEast(),u=e.distanceTo(o),c=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Za--,Ga=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Za++,Za>1?(m={maximumAge:6e5,timeout:0},Ga=!0):(m=this.options.positionOptions,Ga=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=El,S.ImageSource=Vn,S.KeyboardHandler=yi,S.LngLatBounds=_e,S.LogoControl=cc,S.Map=class extends Kh{constructor(m){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},hf),m);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Uo(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Gt,this._controls=[],this._mapId=d.a4(),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},pc),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ce.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ie(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const u=Na(c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())},50);this._resizeObserver=new ResizeObserver(c=>{o?u(c):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new uc(this,e),this._hash=e.hash&&new El(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Go(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new cc,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new d.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new d.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,o,u)}resize(m){var e;const o=this._containerDimensions(),u=o[0],c=o[1],f=this._getClampedPixelRatio(u,c);if(this._resizeCanvas(u,c,f),this.painter.resize(u,c,f),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const T=this._getClampedPixelRatio(u,c);this._resizeCanvas(u,c,T),this.painter.resize(u,c,T)}this.transform.resize(u,c),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,c);const x=!this._moving;return x&&(this.stop(),this.fire(new d.k("movestart",m)).fire(new d.k("move",m))),this.fire(new d.k("resize",m)),x&&this.fire(new d.k("moveend",m)),this}_getClampedPixelRatio(m,e){const{0:o,1:u}=this._maxCanvasSize,c=this.getPixelRatio(),f=m*c,x=e*c;return Math.min(f>o?o/f:1,x>u?u/x:1)*c}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(_e.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(d.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,o){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:f=>{const x=e.filter(T=>this.getLayer(T)),b=x.length!==0?this.queryRenderedFeatures(f.point,{layers:x}):[];b.length?u||(u=!0,o.call(this,new xn(m,this,f.originalEvent,{features:b}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:x=>{const b=e.filter(T=>this.getLayer(T));(b.length!==0?this.queryRenderedFeatures(x.point,{layers:b}):[]).length?u=!0:u&&(u=!1,o.call(this,new xn(m,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,o.call(this,new xn(m,this,x.originalEvent)))}}}}{const u=c=>{const f=e.filter(b=>this.getLayer(b)),x=f.length!==0?this.queryRenderedFeatures(c.point,{layers:f}):[];x.length&&(c.features=x,o.call(this,c),delete c.features)};return{layers:e,listener:o,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,o){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let c=0;c<u.length;c++){const f=u[c];if(f.listener===o&&f.layers.length===e.length&&f.layers.every(x=>e.includes(x))){for(const x in f.delegates)this.off(x,f.delegates[x]);return void u.splice(c,1)}}}on(m,e,o){if(o===void 0)return super.on(m,e);const u=this._createDelegatedListener(m,typeof e=="string"?[e]:e,o);this._saveDelegatedListener(m,u);for(const c in u.delegates)this.on(c,u.delegates[c]);return this}once(m,e,o){if(o===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,c=this._createDelegatedListener(m,u,o);for(const f in c.delegates){const x=c.delegates[f];c.delegates[f]=(...b)=>{this._removeDelegatedListener(m,u,o),x(...b)}}this._saveDelegatedListener(m,c);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(m,e,o){return o===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let o;const u=m instanceof d.P||Array.isArray(m),c=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},c instanceof d.P||typeof c[0]=="number")o=[d.P.convert(c)];else{const f=d.P.convert(c[0]),x=d.P.convert(c[1]);o=[f,new d.P(x.x,f.y),x,new d.P(f.x,x.y),f]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Io(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,o):this.style.loadJSON(m,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Io(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const o=this._requestManager.transformRequest(m,"Style");d.h(o,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new d.j(u))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(o){d.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dc(this.painter,e,m),this.painter.renderToTexture=new Yh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const o=m[e]._tiles;for(const u in o){const c=o[u];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,o={}){const{pixelRatio:u=1,sdf:c=!1,stretchX:f,stretchY:x,content:b,textFitWidth:T,textFitHeight:E}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:M,data:F}=e,j=e;return this.style.addImage(m,{data:new d.R({width:A,height:M},new Uint8Array(F)),pixelRatio:u,stretchX:f,stretchY:x,content:b,textFitWidth:T,textFitHeight:E,sdf:c,version:0,userImage:j}),j.onAdd&&j.onAdd(this,m),this}}{const{width:A,height:M,data:F}=Q.getImageData(e);this.style.addImage(m,{data:new d.R({width:A,height:M},F),pixelRatio:u,stretchX:f,stretchY:x,content:b,textFitWidth:T,textFitHeight:E,sdf:c,version:0})}}updateImage(m,e){const o=this.style.getImage(m);if(!o)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||d.b(e)?Q.getImageData(e):e,{width:c,height:f,data:x}=u;if(c===void 0||f===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==o.data.width||f!==o.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||d.b(e));return o.data.replace(x,b),this.style.updateImage(m,o),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return ce.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,o){return this.style.setLayerZoomRange(m,e,o),this._update(!0)}setFilter(m,e,o={}){return this.style.setFilter(m,e,o),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,o,u={}){return this.style.setPaintProperty(m,e,o,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,o,u={}){return this.style.setLayoutProperty(m,e,o,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,o,u=>{u||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,o=>{o||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=U.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const c=this._controlContainer=U.create("div","maplibregl-control-container",m),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{f[x]=U.create("div",`maplibregl-ctrl-${x} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,o){this._canvas.width=Math.floor(o*m),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const o=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!o){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Il(o,this.transform),Le.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,f=Q.now();this.style.zoomHistory.update(c,f);const x=new d.z(c,{now:f,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=x.crossFadingFactor();b===1&&b===this._crossFadingFactor||(o=!0,this._crossFadingFactor=b),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ce.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(m=>{d.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Jh}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=xn,S.MapTouchEvent=so,S.MapWheelEvent=Zh,S.Marker=Ol,S.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);e.title=u,e.setAttribute("aria-label",u)},this.options=d.e({},df,m),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const o=U.create("button",m,this._container);return o.type="button",o.addEventListener("click",e),o}},S.Popup=class extends d.E{constructor(m){super(),this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?vr(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const f=jl(this.options.offset);if(!c){const b=this._container.offsetWidth,T=this._container.offsetHeight;let E;E=u.y+f.bottom.y<T?["top"]:u.y>this._map.transform.height-T?["bottom"]:[],u.x<b/2?E.push("left"):u.x>this._map.transform.width-b/2&&E.push("right"),c=E.length===0?"bottom":E.join("-")}let x=u.add(f[c]);this.options.subpixelPositioning||(x=x.round()),U.setTransform(this._container,`${Wo[c]} translate(${x.x}px,${x.y}px)`),Bl(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(vt),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=m;u=o.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Nl);m&&m.focus()}},S.RasterDEMTileSource=cr,S.RasterTileSource=Xt,S.ScaleControl=class{constructor(m){this._onMove=()=>{Ha(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ha(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Qi),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=Li,S.Style=Io,S.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=qa,S.TwoFingersTouchRotateHandler=oc,S.TwoFingersTouchZoomHandler=ic,S.TwoFingersTouchZoomRotateHandler=lc,S.VectorTileSource=jn,S.VideoSource=Ai,S.addSourceType=(m,e)=>d._(void 0,void 0,void 0,function*(){if(ds(m))throw new Error(`A source type called "${m}" already exists.`);((o,u)=>{hs[o]=u})(m,e)}),S.clearPrewarmedResources=function(){const m=rt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release($r),rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return ti().getRTLTextPluginStatus()},S.getVersion=function(){return mc},S.getWorkerCount=function(){return ct.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(m){return zr().broadcast("IS",m)},S.prewarm=function(){ir().acquire($r)},S.setMaxParallelImageRequests=function(m){d.a.MAX_PARALLEL_IMAGE_REQUESTS=m},S.setRTLTextPlugin=function(m,e){return ti().setRTLTextPlugin(m,e)},S.setWorkerCount=function(m){ct.workerCount=m},S.setWorkerUrl=function(m){d.a.WORKER_URL=m}});var k=l;return k})})(t1);var xT=t1.exports;const os=Ex(xT);function wh(){const r=document.querySelector(".notes-grid");return r?window.getComputedStyle(r).gridTemplateColumns.split(" ").filter(v=>v&&v!=="none").length<=1:window.innerWidth<=480}function sp(){return wh()}class wT{constructor(i=3){this.maxInstances=i,this.activeInstances=new Map,this.pendingQueue=[],this.instanceCounter=0,this.needsControl=sp(),this.desktopInteractiveMap=null,this.desktopCallbacks=new Map}requestInstance(i,l=0){return new Promise(p=>{if(!this.needsControl){const v=++this.instanceCounter;this.activeInstances.set(i,{instanceId:v,priority:l}),p({allowed:!0,instanceId:v});return}if(this.activeInstances.size<this.maxInstances){const v=++this.instanceCounter;this.activeInstances.set(i,{instanceId:v,priority:l}),p({allowed:!0,instanceId:v})}else{this.pendingQueue.push({componentId:i,priority:l,resolve:p}),this.pendingQueue.sort((k,S)=>S.priority-k.priority);const v=this._findLowestPriorityActive();v&&v.priority<l?this.releaseInstance(v.componentId):p({allowed:!1,instanceId:null})}})}releaseInstance(i){this.activeInstances.has(i)&&(this.activeInstances.delete(i),this._processQueue())}updatePriority(i,l){if(this.activeInstances.has(i)){const p=this.activeInstances.get(i);p.priority=l}}_findLowestPriorityActive(){let i=null;for(const[l,p]of this.activeInstances.entries())(!i||p.priority<i.priority)&&(i={componentId:l,...p});return i}_processQueue(){if(this.pendingQueue.length>0&&this.activeInstances.size<this.maxInstances){const i=this.pendingQueue.shift(),l=++this.instanceCounter;this.activeInstances.set(i.componentId,{instanceId:l,priority:i.priority}),i.resolve({allowed:!0,instanceId:l})}}getActiveCount(){return this.activeInstances.size}isActive(i){return this.activeInstances.has(i)}requestDesktopInteractiveMap(i){if(wh())return;if(this.desktopInteractiveMap&&this.desktopInteractiveMap!==i){const p=this.desktopCallbacks.get(this.desktopInteractiveMap);p&&p(),this.releaseInstance(this.desktopInteractiveMap)}this.desktopInteractiveMap=i;const l=++this.instanceCounter;this.activeInstances.set(i,{instanceId:l,priority:100})}registerDesktopCallback(i,l){this.desktopCallbacks.set(i,l)}unregisterDesktopCallback(i){this.desktopCallbacks.delete(i),this.desktopInteractiveMap===i&&(this.desktopInteractiveMap=null)}}const qs=new wT(3);class bT{constructor(){this.container=null,this.map=null,this.isInitialized=!1,this.mapConfig=null,this.zoomLimits={minZoom:0,maxZoom:22},this.renderQueue=[],this.isRendering=!1,this.imageCache=new Map}async initialize(){if(this.isInitialized)return!0;try{const l=await(await fetch("/api/available-tilesets")).json();if(!l.success||!l.map_enabled)return console.log("Map disabled:",l.message),!1;this.mapConfig=l;let p="/tiles/style.json";l.layer_mode==="single"&&l.tilesets.length===1&&(p=`/tiles/${l.tilesets[0].name}/style.json`);const k=await(await fetch(p)).json(),S=Object.values(k.sources)[0];return S&&(this.zoomLimits.minZoom=S.minzoom||0,this.zoomLimits.maxZoom=S.maxzoom||22),this.container||(this.container=document.createElement("div"),this.container.style.width="1176px",this.container.style.height="240px",this.container.style.position="fixed",this.container.style.left="-9999px",this.container.style.top="-9999px",this.container.style.zIndex="-1",document.body.appendChild(this.container)),this.map||(this.map=new os.Map({container:this.container,style:p,center:[121.5654,25.033],zoom:14,minZoom:this.zoomLimits.minZoom,maxZoom:this.zoomLimits.maxZoom-.05,dragRotate:!1,touchPitch:!1,preserveDrawingBuffer:!0}),await new Promise(d=>{this.map.on("load",d)})),this.isInitialized=!0,!0}catch(i){return console.error("Failed to initialize StaticMapRenderer:",i),!1}}generateCacheKey(i,l){return`${i.map(v=>`${v.lat.toFixed(6)},${v.lng.toFixed(6)},${v.label||""}`).join("|")}:${l}`}async renderMapToImage(i,l=14,p=null){if(!this.isInitialized&&!await this.initialize())return console.error("StaticMapRenderer not initialized"),null;const v=this.generateCacheKey(i,l);return this.imageCache.has(v)?this.imageCache.get(v):new Promise(k=>{let S=1/0;p&&(S=p.getBoundingClientRect().top+window.scrollY);const d={locations:i,zoom:l,resolve:k,cacheKey:v,yPosition:S};let V=this.renderQueue.findIndex(se=>se.yPosition>S);V===-1?this.renderQueue.push(d):this.renderQueue.splice(V,0,d),this.isRendering||this.processQueue()})}async processQueue(){if(this.isRendering||this.renderQueue.length===0)return;this.isRendering=!0;const{locations:i,zoom:l,resolve:p,cacheKey:v}=this.renderQueue.shift();try{const k=[],S=["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0","#FF9800","#00BCD4","#E91E63"];await new Promise(d=>{if(i.length===1)this.map.once("moveend",d),this.map.setCenter([i[0].lng,i[0].lat]),this.map.setZoom(l);else if(i.length>1){const V=new os.LngLatBounds;i.forEach(se=>{V.extend([se.lng,se.lat])}),this.map.once("moveend",d),this.map.fitBounds(V,{padding:50,maxZoom:15,duration:0})}else d()}),await new Promise(d=>{this.map.once("idle",d)}),i.forEach((d,V)=>{const se=S[V%S.length],ue=document.createElement("div");if(ue.style.width="30px",ue.style.height="40px",ue.innerHTML=`
          <svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg" style="display: block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
            <path d="M15 0C8.373 0 3 5.373 3 12c0 9 12 28 12 28s12-19 12-28c0-6.627-5.373-12-12-12z" 
                  fill="${se}" 
                  stroke="white" 
                  stroke-width="2"/>
            <circle cx="15" cy="12" r="4" fill="white"/>
          </svg>
        `,d.label){const U=document.createElement("div");U.textContent=d.label,U.style.position="absolute",U.style.bottom="44px",U.style.left="50%",U.style.transform="translateX(-50%)",U.style.backgroundColor="white",U.style.color="#333",U.style.padding="2px 6px",U.style.borderRadius="3px",U.style.fontSize="12px",U.style.fontWeight="bold",U.style.whiteSpace="nowrap",U.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",U.style.pointerEvents="none",ue.appendChild(U)}const Q=new os.Marker({element:ue,anchor:"bottom"}).setLngLat([d.lng,d.lat]).addTo(this.map);k.push(Q)}),await new Promise(d=>{requestAnimationFrame(d)});try{const d=this.map.getCanvas(),V=window.devicePixelRatio||1,se=document.createElement("canvas");se.width=d.width,se.height=d.height;const ue=se.getContext("2d");ue.drawImage(d,0,0),i.forEach((U,Le)=>{const Ee=S[Le%S.length],Fe=this.map.project([U.lng,U.lat]),gt=Fe.x*V,le=Fe.y*V,te=V,ce=30*te,Ie=40*te;if(ue.save(),ue.translate(gt-ce/2,le-Ie),ue.scale(te,te),ue.shadowColor="rgba(0,0,0,0.3)",ue.shadowBlur=4,ue.shadowOffsetX=0,ue.shadowOffsetY=2,ue.strokeStyle="white",ue.lineWidth=2,ue.fillStyle=Ee,ue.beginPath(),ue.moveTo(15,0),ue.bezierCurveTo(8.373,0,3,5.373,3,12),ue.bezierCurveTo(3,21,15,40,15,40),ue.bezierCurveTo(15,40,27,21,27,12),ue.bezierCurveTo(27,5.373,21.627,0,15,0),ue.closePath(),ue.fill(),ue.stroke(),ue.shadowColor="transparent",ue.fillStyle="white",ue.beginPath(),ue.arc(15,12,4,0,Math.PI*2),ue.fill(),ue.restore(),U.label){ue.save();const Ne=12*V;ue.font=`bold ${Ne}px sans-serif`,ue.textAlign="center",ue.textBaseline="bottom";const Ke=U.label,Je=ue.measureText(Ke).width+12*V,Et=20*V,wt=gt,St=le-Ie-4*V;ue.shadowColor="rgba(0,0,0,0.3)",ue.shadowBlur=4*V,ue.shadowOffsetX=0,ue.shadowOffsetY=2*V,ue.fillStyle="white",ue.beginPath(),ue.roundRect(wt-Je/2,St-Et,Je,Et,3*V),ue.fill(),ue.shadowColor="transparent",ue.fillStyle="#333",ue.fillText(Ke,wt,St-4*V),ue.restore()}});const Q=se.toDataURL("image/png");k.forEach(U=>U.remove()),this.imageCache.set(v,Q),p(Q)}catch(d){console.error("Failed to capture map image:",d),k.forEach(V=>V.remove()),p(null)}}catch(k){console.error("Error rendering map:",k),p(null)}finally{this.isRendering=!1,setTimeout(()=>this.processQueue(),0)}}clearCache(){this.imageCache.clear()}destroy(){this.map&&(this.map.remove(),this.map=null),this.container&&this.container.parentNode&&(this.container.parentNode.removeChild(this.container),this.container=null),this.isInitialized=!1,this.imageCache.clear()}}const ST=new bT;let kT=0;function TT({lat:r,lng:i,locations:l,zoom:p=14}){const v=Ce.useRef(null),k=Ce.useRef(null),S=Ce.useRef([]),[d,V]=Ce.useState({minZoom:0,maxZoom:22}),[se,ue]=Ce.useState(!0),[Q,U]=Ce.useState(null),[Le,Ee]=Ce.useState(!sp()),[Fe,gt]=Ce.useState(!sp()),le=Ce.useRef(`location-map-${++kT}`),te=Ce.useRef(null),ce=Ce.useRef(sp()),Ie=Ce.useRef(wh()),[Ne,Ke]=Ce.useState(null),[qe,Je]=Ce.useState(!1),[Et,wt]=Ce.useState(!0),St=Ce.useRef(null);if(Ce.useEffect(()=>(Ie.current||(St.current=()=>{Je(!1),gt(!1)},qs.registerDesktopCallback(le.current,St.current)),()=>{Ie.current||qs.unregisterDesktopCallback(le.current)}),[]),Ce.useEffect(()=>{if(!ce.current||!v.current)return;const yt=new IntersectionObserver(Mt=>{Mt.forEach($t=>{const nr=$t.isIntersecting;Ee(nr),nr?qs.updatePriority(le.current,10):qs.updatePriority(le.current,1)})},{root:null,rootMargin:"50px",threshold:.1});return yt.observe(v.current),te.current=yt,()=>{te.current&&v.current&&te.current.unobserve(v.current)}},[]),Ce.useEffect(()=>{(async()=>{try{const $t=await(await fetch("/api/available-tilesets")).json();if($t.success&&$t.map_enabled){ue(!0),U($t);let nr="/tiles/style.json";$t.layer_mode==="single"&&$t.tilesets.length===1&&(nr=`/tiles/${$t.tilesets[0].name}/style.json`);const Pe=await(await fetch(nr)).json(),lt=Object.values(Pe.sources)[0];if(lt){const He=lt.minzoom||0,Rt=lt.maxzoom||22;V({minZoom:He,maxZoom:Rt})}}else ue(!1),console.log("Map disabled:",$t.message)}catch(Mt){console.error("Failed to fetch map config:",Mt),ue(!1)}})()},[]),Ce.useEffect(()=>{if(!Ie.current&&se&&!qe){const yt=l||(r!==void 0&&i!==void 0?[{lat:r,lng:i}]:[]);if(yt.length===0)return;wt(!0),ST.renderMapToImage(yt,p,v.current).then(Mt=>{Mt&&Ke(Mt),wt(!1)})}},[r,i,l,p,se,qe]),Ce.useEffect(()=>{(async()=>{if(!Ie.current&&!qe){gt(!1);return}if(!ce.current){gt(!0);return}if(!Le){gt(!1);return}const Mt=await qs.requestInstance(le.current,10);gt(Mt.allowed)})()},[Le,qe]),Ce.useEffect(()=>{if(k.current||!se||!Q||!Fe)return;const yt=l||(r!==void 0&&i!==void 0?[{lat:r,lng:i}]:[]);if(yt.length===0)return;const Mt=yt[0];let $t="/tiles/style.json";Q.layer_mode==="single"&&Q.tilesets.length===1&&($t=`/tiles/${Q.tilesets[0].name}/style.json`),k.current=new os.Map({container:v.current,style:$t,center:[Mt.lng,Mt.lat],zoom:p,minZoom:d.minZoom,maxZoom:d.maxZoom-.05,dragRotate:!1,touchPitch:!1,cooperativeGestures:!0}),k.current.touchZoomRotate.disableRotation();const nr=["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0","#FF9800","#00BCD4","#E91E63"];if(yt.forEach((er,Pe)=>{const lt=nr[Pe%nr.length],He=document.createElement("div");if(He.style.width="30px",He.style.height="40px",He.innerHTML=`
        <svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg" style="display: block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
          <path d="M15 0C8.373 0 3 5.373 3 12c0 9 12 28 12 28s12-19 12-28c0-6.627-5.373-12-12-12z" 
                fill="${lt}" 
                stroke="white" 
                stroke-width="2"/>
          <circle cx="15" cy="12" r="4" fill="white"/>
        </svg>
      `,er.label){const kt=document.createElement("div");kt.textContent=er.label,kt.style.position="absolute",kt.style.bottom="44px",kt.style.left="50%",kt.style.transform="translateX(-50%)",kt.style.backgroundColor="white",kt.style.color="#333",kt.style.padding="2px 6px",kt.style.borderRadius="3px",kt.style.fontSize="12px",kt.style.fontWeight="bold",kt.style.whiteSpace="nowrap",kt.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",kt.style.pointerEvents="none",He.appendChild(kt)}const Rt=new os.Marker({element:He,anchor:"bottom"}).setLngLat([er.lng,er.lat]).addTo(k.current);S.current.push(Rt)}),yt.length>1){const er=new os.LngLatBounds;yt.forEach(Pe=>{er.extend([Pe.lng,Pe.lat])}),k.current.fitBounds(er,{padding:50,maxZoom:15})}return k.current.addControl(new os.NavigationControl({showCompass:!1,showZoom:!0,visualizePitch:!1}),"top-right"),()=>{S.current.forEach(er=>er.remove()),S.current=[],k.current&&(k.current.remove(),k.current=null),ce.current&&(qs.releaseInstance(le.current),gt(!1)),!Ie.current&&qe&&qs.releaseInstance(le.current)}},[d,Fe,qe]),Ce.useEffect(()=>{if(!k.current)return;const yt=l||(r!==void 0&&i!==void 0?[{lat:r,lng:i}]:[]);if(yt.length===0)return;S.current.forEach($t=>$t.remove()),S.current=[];const Mt=["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0","#FF9800","#00BCD4","#E91E63"];if(yt.forEach(($t,nr)=>{const er=Mt[nr%Mt.length],Pe=document.createElement("div");if(Pe.style.width="30px",Pe.style.height="40px",Pe.innerHTML=`
        <svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg" style="display: block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
          <path d="M15 0C8.373 0 3 5.373 3 12c0 9 12 28 12 28s12-19 12-28c0-6.627-5.373-12-12-12z" 
                fill="${er}" 
                stroke="white" 
                stroke-width="2"/>
          <circle cx="15" cy="12" r="4" fill="white"/>
        </svg>
      `,$t.label){const He=document.createElement("div");He.textContent=$t.label,He.style.position="absolute",He.style.bottom="44px",He.style.left="50%",He.style.transform="translateX(-50%)",He.style.backgroundColor="white",He.style.color="#333",He.style.padding="2px 6px",He.style.borderRadius="3px",He.style.fontSize="12px",He.style.fontWeight="bold",He.style.whiteSpace="nowrap",He.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",He.style.pointerEvents="none",Pe.appendChild(He)}const lt=new os.Marker({element:Pe,anchor:"bottom"}).setLngLat([$t.lng,$t.lat]).addTo(k.current);S.current.push(lt)}),yt.length===1)k.current.setCenter([yt[0].lng,yt[0].lat]);else if(yt.length>1){const $t=new os.LngLatBounds;yt.forEach(nr=>{$t.extend([nr.lng,nr.lat])}),k.current.fitBounds($t,{padding:50,maxZoom:15})}},[r,i,l]),!se)return de.jsx("div",{style:{width:"98%",margin:"0 auto",height:"240px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",borderRadius:"8px",color:"#666",fontSize:"14px"},children:" mbtiles "});const or=()=>{!Ie.current&&!qe&&(qs.requestDesktopInteractiveMap(le.current),Je(!0))};if(!Fe){const Mt=(l||(r!==void 0&&i!==void 0?[{lat:r,lng:i}]:[]))[0]||{lat:0,lng:0};return!Ie.current&&Ne?de.jsxs("div",{ref:v,onClick:or,style:{width:"98%",margin:"0 auto",boxShadow:"0 4px 8px rgba(0,0,0,0.2)",height:"240px",borderRadius:"8px",overflow:"hidden",cursor:"pointer",position:"relative"},children:[de.jsx("img",{src:Ne,alt:"Map preview",className:"map-preview-fade-in",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}),de.jsx("div",{style:{position:"absolute",bottom:"8px",right:"8px",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:"4px 8px",borderRadius:"4px",fontSize:"11px",color:"#666",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:""})]}):!Ie.current&&Et?de.jsx("div",{ref:v,style:{width:"98%",margin:"0 auto",boxShadow:"0 4px 8px rgba(0,0,0,0.2)",height:"240px",borderRadius:"8px",overflow:"hidden",backgroundColor:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",color:"#999",fontSize:"14px"},children:"..."}):de.jsxs("div",{ref:v,style:{width:"98%",margin:"0 auto",boxShadow:"0 4px 8px rgba(0,0,0,0.2)",height:"240px",borderRadius:"8px",overflow:"hidden",backgroundColor:"#e8e8e8",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",color:"#666",fontSize:"14px",position:"relative"},children:[de.jsx("div",{style:{marginBottom:"8px"},children:""}),de.jsxs("div",{style:{fontSize:"12px",opacity:.7},children:[Mt.lat.toFixed(4),", ",Mt.lng.toFixed(4)]}),!Le&&de.jsx("div",{style:{fontSize:"11px",marginTop:"4px",opacity:.5},children:""})]})}return de.jsx("div",{ref:v,style:{width:"98%",margin:"0 auto",boxShadow:"0 4px 8px rgba(0,0,0,0.2)",height:"240px",borderRadius:"8px",overflow:"hidden"}})}let CT=0;function IT({onConfirm:r,onCancel:i,initialLat:l=25.033,initialLng:p=121.5654,initialText:v="",lastLocation:k=null}){const S=Ce.useRef(null),d=Ce.useRef(null),V=Ce.useRef([]),se=Ce.useRef(0),ue=5,Q=Ce.useRef(`location-picker-${++CT}`),U=Ce.useRef(wh()),[Le,Ee]=Ce.useState(!wh()),[Fe,gt]=Ce.useState(l),[le,te]=Ce.useState(p),[ce,Ie]=Ce.useState(!0),Ne=ct=>{const _t=/([\u4e00-\u9fa5a-zA-Z0-9_\-]+)?@\(([-+]?\d*\.?\d+)\s*,\s*([-+]?\d*\.?\d+)\)/g,rt=[];let xt;for(;(xt=_t.exec(ct))!==null;){const ir={lat:parseFloat(xt[2]),lng:parseFloat(xt[3]),label:xt[1]?xt[1].trim():""};if(rt.push(ir),rt.length>=ue)break}return rt},Ke=ct=>{if(ct.length===0||ct.length===1)return null;const _t=ct.map(xt=>xt.lng),rt=ct.map(xt=>xt.lat);return[[Math.min(..._t),Math.min(...rt)],[Math.max(..._t),Math.max(...rt)]]},qe=()=>{if(v){const ct=Ne(v);if(ct.length>1)return 12;if(ct.length===1&&k&&k.zoom)return k.zoom;if(ct.length===1)return 13}return k&&k.zoom?k.zoom:13},[Je,Et]=Ce.useState(0),[wt,St]=Ce.useState({minZoom:0,maxZoom:22}),[or,yt]=Ce.useState(!0),[Mt,$t]=Ce.useState(null),[nr,er]=Ce.useState(!1);Ce.useEffect(()=>{se.current=Je},[Je]),Ce.useEffect(()=>{(async()=>{try{const rt=await(await fetch("/api/config/map_init_location")).json();if(rt.success){let xt=l,ir=p;rt.config_location?(xt=rt.config_location.lat,ir=rt.config_location.lng):rt.is_device_provide_location&&rt.device_location&&(xt=rt.device_location.lat,ir=rt.device_location.lng),gt(xt),te(ir)}}catch(_t){console.error("Failed to fetch map init location:",_t),gt(l),te(p)}finally{Ie(!1)}})()},[l,p]);const[Pe,lt]=Ce.useState(()=>{if(v){const ct=Ne(v);if(ct.length>0)return ct}return k?[{lat:k.lat,lng:k.lng,label:""}]:[{lat:l,lng:p,label:""}]});Ce.useEffect(()=>{if(!ce&&!nr){let ct=!1;v&&(ct=Ne(v).length>0),!ct&&!k&&lt([{lat:Fe,lng:le,label:""}]),er(!0)}},[ce,Fe,le,v,k,nr]),Ce.useEffect(()=>((async()=>{if(!U.current){Ee(!0);return}const _t=await qs.requestInstance(Q.current,100);Ee(_t.allowed)})(),()=>{U.current&&qs.releaseInstance(Q.current)}),[]),Ce.useEffect(()=>{(async()=>{try{const rt=await(await fetch("/api/available-tilesets")).json();if(rt.success&&rt.map_enabled){yt(!0),$t(rt);let xt="/tiles/style.json";rt.layer_mode==="single"&&rt.tilesets.length===1&&(xt=`/tiles/${rt.tilesets[0].name}/style.json`);const Tr=await(await fetch(xt)).json(),zr=Object.values(Tr.sources)[0];if(zr){const Kr=zr.minzoom||0,Nn=zr.maxzoom||22;St({minZoom:Kr,maxZoom:Nn})}}else yt(!1),console.log("Map disabled:",rt.message)}catch(_t){console.error("Failed to fetch map config:",_t),yt(!1)}})()},[]),Ce.useEffect(()=>{if(d.current||!or||!Mt||!Le||ce||Pe.length===0)return;const ct=qe();let _t="/tiles/style.json";return Mt.layer_mode==="single"&&Mt.tilesets.length===1&&(_t=`/tiles/${Mt.tilesets[0].name}/style.json`),d.current=new os.Map({container:S.current,style:_t,center:[Pe[0].lng,Pe[0].lat],zoom:ct,minZoom:wt.minZoom,maxZoom:wt.maxZoom-.05,dragRotate:!1,touchPitch:!1}),d.current.touchZoomRotate.disableRotation(),d.current.on("click",rt=>{const{lng:xt,lat:ir}=rt.lngLat;He(se.current,{lat:ir,lng:xt})}),d.current.addControl(new os.NavigationControl({showCompass:!1,showZoom:!0,visualizePitch:!1}),"top-right"),d.current.on("load",()=>{if(Pe.length>1){const rt=Ke(Pe);rt&&d.current.fitBounds(rt,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:15})}lt([...Pe])}),()=>{V.current.forEach(rt=>rt.remove()),V.current=[],d.current&&(d.current.remove(),d.current=null)}},[wt,Le,or,Mt,nr]),Ce.useEffect(()=>{if(!d.current)return;V.current.forEach(_t=>_t.remove()),V.current=[];const ct=["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0"];Pe.forEach((_t,rt)=>{const xt=ct[rt%ct.length],ir=document.createElement("div");ir.style.width="30px",ir.style.height="40px",ir.style.cursor="pointer",ir.innerHTML=`
        <svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg" style="display: block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
          <path d="M15 0C8.373 0 3 5.373 3 12c0 9 12 28 12 28s12-19 12-28c0-6.627-5.373-12-12-12z" 
                fill="${xt}" 
                stroke="${Je===rt?"#FFD700":"white"}" 
                stroke-width="${Je===rt?"3":"2"}"/>
          <circle cx="15" cy="12" r="4" fill="white"/>
        </svg>
      `;const Tr=new os.Marker({element:ir,anchor:"bottom",draggable:!0}).setLngLat([_t.lng,_t.lat]).addTo(d.current);Tr.on("dragend",()=>{const zr=Tr.getLngLat();He(rt,{lat:zr.lat,lng:zr.lng})}),ir.addEventListener("click",zr=>{zr.stopPropagation(),Et(rt)}),V.current.push(Tr)})},[Pe,Je]);const He=(ct,_t)=>{lt(rt=>{const xt=[...rt];return xt[ct]={...xt[ct],..._t},xt})},Rt=(ct,_t)=>{lt(rt=>{const xt=[...rt];return xt[ct]={...xt[ct],label:_t},xt})},kt=()=>{if(Pe.length<ue){const ct=d.current.getCenter();lt(_t=>[..._t,{lat:ct.lat,lng:ct.lng,label:""}]),Et(Pe.length)}},An=ct=>{Pe.length>1&&(lt(_t=>_t.filter((rt,xt)=>xt!==ct)),Et(Math.max(0,Math.min(Je,Pe.length-2))))},$r=()=>{const _t=Pe.map(xt=>{const ir=xt.lat.toFixed(6),Tr=xt.lng.toFixed(6),zr=xt.label.trim();return zr?`${zr}@(${ir},${Tr})`:`@(${ir},${Tr})`}).join(" "),rt=d.current?{center:d.current.getCenter(),zoom:d.current.getZoom()}:null;r(_t,rt)};return or?de.jsx("div",{className:"modal-overlay",onClick:i,children:de.jsxs("div",{className:"modal-content location-picker-modal",onClick:ct=>ct.stopPropagation(),children:[de.jsx("div",{className:"modal-header",children:""}),de.jsxs("div",{className:"modal-body",children:[de.jsxs("div",{className:"location-picker-instructions",children:[" (",Pe.length,"/",ue,")"]}),Le?de.jsx("div",{ref:S,className:"location-picker-map",style:{width:"100%",height:"400px",borderRadius:"8px",overflow:"hidden",marginBottom:"12px"}}):de.jsx("div",{style:{width:"100%",height:"400px",borderRadius:"8px",overflow:"hidden",marginBottom:"12px",backgroundColor:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",color:"#666",fontSize:"14px"},children:"..."}),de.jsx("div",{className:"location-list",children:Pe.map((ct,_t)=>de.jsx("div",{className:`location-item ${Je===_t?"selected":""}`,onClick:()=>Et(_t),children:de.jsxs("div",{className:"location-item-header",children:[de.jsx("span",{className:"location-number",style:{backgroundColor:["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0"][_t%5]},children:_t+1}),de.jsxs("div",{className:"location-coords-small",children:[de.jsxs("span",{children:[ct.lat.toFixed(6),","]}),de.jsx("span",{children:ct.lng.toFixed(6)})]}),de.jsx("input",{type:"text",className:"location-label-input-small",placeholder:" ()",value:ct.label,onChange:rt=>Rt(_t,rt.target.value),onClick:rt=>rt.stopPropagation(),maxLength:20}),Pe.length>1&&de.jsx("button",{className:"btn-remove-location",onClick:rt=>{rt.stopPropagation(),An(_t)},title:"",children:""})]})},_t))}),Pe.length<ue&&de.jsx("button",{className:"btn-add-location",onClick:kt,children:"+ "})]}),de.jsxs("div",{className:"modal-actions",children:[de.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:i,children:""}),de.jsx("button",{className:"modal-btn modal-btn-confirm",onClick:$r,children:""})]})]})}):de.jsx("div",{className:"modal-overlay",onClick:i,children:de.jsxs("div",{className:"modal-content location-picker-modal",onClick:ct=>ct.stopPropagation(),children:[de.jsx("div",{className:"modal-header",children:""}),de.jsx("div",{className:"modal-body",children:de.jsx("div",{style:{width:"100%",height:"400px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",borderRadius:"8px",color:"#666",fontSize:"14px",marginBottom:"12px"},children:" mbtiles "})}),de.jsx("div",{className:"modal-actions",children:de.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:i,children:""})})]})})}const Cx="YourChannelName",ks=["hsl(0, 70%, 85%)","hsl(30, 70%, 85%)","hsl(60, 70%, 85%)","hsl(90, 70%, 85%)","hsl(120, 70%, 85%)","hsl(150, 70%, 85%)","hsl(180, 70%, 85%)","hsl(210, 70%, 85%)","hsl(240, 70%, 85%)","hsl(270, 70%, 85%)","hsl(300, 70%, 85%)","hsl(330, 70%, 85%)","hsl(0, 0%, 85%)","hsl(0, 0%, 75%)","hsl(45, 80%, 85%)","hsl(15, 80%, 85%)"];function Ix(){const r="abcdefghijklmnopqrstuvwxyz0123456789",i=crypto.getRandomValues(new Uint8Array(8));let l="";for(let p=0;p<8;p++)l+=r[i[p]%36];return l}function ET(r){let i=0;for(let p=0;p<r.length;p++)i=r.charCodeAt(p)+((i<<5)-i);return{bg:`hsl(${Math.abs(i)%360}, 70%, 85%)`,text:"#333"}}function Ts(r){return new Blob([r]).size}const on=150;function PT(){const[r,i]=Ce.useState(null),[l,p]=Ce.useState([]),[v,k]=Ce.useState(!1),[S,d]=Ce.useState(!1),[V,se]=Ce.useState(null),[ue,Q]=Ce.useState(!1),[U,Le]=Ce.useState(Cx),[Ee,Fe]=Ce.useState(""),[gt,le]=Ce.useState(!1),[te,ce]=Ce.useState(""),[Ie,Ne]=Ce.useState(0),[Ke,qe]=Ce.useState(null),[Je,Et]=Ce.useState(""),[wt,St]=Ce.useState(0),[or,yt]=Ce.useState({show:!1,type:"alert",title:"",message:"",onConfirm:null}),[Mt,$t]=Ce.useState(null),[nr,er]=Ce.useState(0),[Pe,lt]=Ce.useState("newest"),[He,Rt]=Ce.useState(""),[kt,An]=Ce.useState(!1),[$r,ct]=Ce.useState(!0),_t=Ce.useRef(0),rt=Ce.useRef(null),xt=Ce.useRef(null),[ir,Tr]=Ce.useState(0),[zr,Kr]=Ce.useState(0),[Nn,Ei]=Ce.useState(!1),[Ds,_e]=Ce.useState(!1),Wi=Ce.useRef(Pe),[jn,Xt]=Ce.useState(null),[cr,Pi]=Ce.useState(""),[pi,Vn]=Ce.useState(0),[Ai,Yr]=Ce.useState(0),hs=Ce.useRef(null),[ds,De]=Ce.useState(null),ei=Ce.useRef({}),[Dr,ti]=Ce.useState({}),[Hr,Me]=Ce.useState(null),[Dt,ft]=Ce.useState({top:0,left:0}),Jr=Ce.useRef(null),fn=Ce.useRef({}),bt=Ce.useRef({x:0,y:0}),[mn,Un]=Ce.useState(null),[Mi,fi]=Ce.useState({top:0,left:0}),[W,D]=Ce.useState(null),L=Ce.useRef(null),N=Ce.useRef({}),[q,re]=Ce.useState(!1),[ae,fe]=Ce.useState(!1),[J,ve]=Ce.useState(""),[Se,ye]=Ce.useState(!1),[Re,nt]=Ce.useState(""),[dt,Ut]=Ce.useState(""),[Pt,Nt]=Ce.useState(!1),[jt,Cr]=Ce.useState({}),[hr,Ft]=Ce.useState(!1),[tr,fr]=Ce.useState(!0),Lr=Ce.useRef(null),[qr,Qr]=Ce.useState(!1),[ps,rr]=Ce.useState(!1),[ko,To]=Ce.useState(!1);Ce.useEffect(()=>{(async()=>{if(Ee)try{const be=await(await fetch(`/api/user/${Ee}/last-location`)).json();be.success&&be.location&&Cr(Be=>({...Be,[Ee]:be.location}))}catch(Te){console.error("Failed to fetch user last location:",Te)}})()},[Ee]);const gn=async(ne=!1,Te=null)=>{try{const be=Te||U,pt=await(await fetch(`/api/boards/${be}/notes?is_include_deleted=${ne}`)).json();pt.success&&(p(pt.notes),Mn(pt.notes,be))}catch(be){console.error("Failed to fetch notes:",be)}},Mn=async(ne,Te=null)=>{const be=Te||U,Be={},pt=[];ne.forEach(zt=>{pt.push(zt),zt.replyNotes&&pt.push(...zt.replyNotes)});for(const zt of pt)if(zt.noteId)try{const _n=await(await fetch(`/api/boards/${be}/notes/${zt.noteId}/acks`)).json();_n.success&&(Be[zt.noteId]=_n.acks)}catch(Lt){console.error(`Failed to fetch ACKs for note ${zt.noteId}:`,Lt)}ti(Be)},Ru=async ne=>{try{const be=await(await fetch(`/api/boards/${U}/notes/${ne}/acks`)).json();be.success&&ti(Be=>({...Be,[ne]:be.acks}))}catch(Te){console.error(`Failed to fetch ACKs for note ${ne}:`,Te)}};Ce.useEffect(()=>((async()=>{try{const Be=await(await fetch("/api/config/channel_name")).json();Be.success&&Le(Be.channel_name)}catch(be){console.error("Failed to fetch channel name from backend:",be)}try{const Be=await(await fetch("/api/user/uuid")).json();if(Be.success)Fe(Be.uuid);else{const pt=Ix();Fe(pt)}}catch(be){console.error("Failed to fetch UUID from backend:",be);const Be=Ix();Fe(Be)}try{const Be=await(await fetch("/api/user/admin/status")).json();Be.success&&re(Be.is_admin)}catch(be){console.error("Failed to fetch admin status:",be)}try{const Be=await(await fetch("/api/config/post_passcode_required")).json();Be.success&&ye(Be.required)}catch(be){console.error("Failed to fetch post passcode config:",be)}try{const Be=await(await fetch("/api/config/features")).json();Be.success&&Be.features&&Ft(Be.features.map_enabled||!1)}catch(be){console.error("Failed to fetch features config:",be)}const Te=ip();i(Te),Te.on("lora_status",be=>{k(be.online),d(be.channel_validated!==!1),se(be.error_message||null),Q(be.power_issue||!1),be.online&&be.channel_validated===!1&&(console.log(" LoRa  Channel "),be.error_message&&console.log("   "+be.error_message))})})(),()=>{r&&r.close()}),[]),Ce.useEffect(()=>{if(!r)return;const ne=Be=>{gn(kt,U)},Te=Be=>{console.log("ACK received:",Be),Be.note_id&&Ru(Be.note_id)},be=Be=>{console.error("USB connection error:",Be.message),yt({show:!0,type:"alert",title:"",message:Be.message,onConfirm:()=>yt(pt=>({...pt,show:!1}))})};return r.on("refresh_notes",ne),r.on("ack_received",Te),r.on("usb_connection_error",be),()=>{r.off("refresh_notes",ne),r.off("ack_received",Te),r.off("usb_connection_error",be)}},[r,kt,U]),Ce.useEffect(()=>{U!==Cx&&gn(kt)},[kt,U]),Ce.useEffect(()=>{if(Wi.current!==Pe){_e(!0);const ne=setTimeout(()=>{_e(!1)},600);return Wi.current=Pe,()=>clearTimeout(ne)}},[Pe]),Ce.useEffect(()=>{const ne=Te=>{Hr&&Jr.current&&!Jr.current.contains(Te.target)&&(Te.target.closest(".ack-counter")||Me(null))};if(Hr)return document.addEventListener("mousedown",ne),()=>{document.removeEventListener("mousedown",ne)}},[Hr]),Ce.useEffect(()=>{const ne=Te=>{mn&&L.current&&!L.current.contains(Te.target)&&(Te.target.closest(".note-status.sender-clickable")||(Un(null),D(null)))};if(mn)return document.addEventListener("mousedown",ne),()=>{document.removeEventListener("mousedown",ne)}},[mn]),Ce.useEffect(()=>{const ne=()=>{if(window.innerWidth>768){ct(!0);return}const Te=window.scrollY,be=Te-_t.current,Be=document.documentElement.scrollHeight,pt=window.innerHeight,zt=Te+pt>=Be-50;Te<10?ct(!0):be>5&&Te>50&&!zt?ct(!1):be<-5&&!zt&&ct(!0),_t.current=Te};return window.addEventListener("scroll",ne,{passive:!0}),()=>window.removeEventListener("scroll",ne)},[]),Ce.useEffect(()=>{gt&&xt.current&&setTimeout(()=>{if(xt.current){const ne=xt.current.getBoundingClientRect(),be=window.scrollY+ne.top-100;window.scrollTo({top:be,behavior:"smooth"}),xt.current.focus()}},150)},[gt]),Ce.useEffect(()=>{if(ds){let ne=!1;const Te=()=>{const Lt=ei.current[ds];if(Lt&&!ne){const _n=Lt.getBoundingClientRect(),dr=window.scrollY+_n.top-100;return window.scrollTo({top:dr,behavior:"smooth"}),ne=!0,setTimeout(()=>{Lt&&Lt.classList.add("note-paste-animation")},500),!0}return!1};let be=0;const Be=10,pt=setInterval(()=>{be++,(Te()||be>=Be)&&clearInterval(pt)},100),zt=setTimeout(()=>{De(null)},3e3);return()=>{clearInterval(pt),clearTimeout(zt)}}},[ds,l]);const Bt=(ne,Te="")=>{yt({show:!0,type:"alert",title:Te,message:ne,onConfirm:()=>yt({...or,show:!1})})},en=(ne,Te="")=>new Promise(be=>{yt({show:!0,type:"confirm",title:Te,message:ne,onConfirm:()=>{yt({...or,show:!1}),be(!0)},onCancel:()=>{yt({...or,show:!1}),be(!1)}})}),Ls=async()=>{q?await en("","")&&Xs():(fe(!0),ve(""))},Xi=async()=>{if(!J.trim()){Bt("");return}try{const Te=await(await fetch("/api/user/admin/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({passcode:J})})).json();Te.success&&Te.is_admin?(re(!0),fe(!1),ve(""),Bt("","")):(Bt("",""),ve(""))}catch(ne){console.error("Failed to authenticate admin:",ne),Bt(""+ne.message,"")}},Ir=()=>{fe(!1),ve("")},Xs=async()=>{try{const Te=await(await fetch("/api/user/admin/logout",{method:"POST",headers:{"Content-Type":"application/json"}})).json();Te.success?(re(!1),Bt("","")):Bt(""+(Te.error||""),"")}catch(ne){console.error("Failed to logout admin:",ne),Bt(""+ne.message,"")}},$n=async ne=>{if(await en("",""))try{const Be=await(await fetch(`/api/boards/${U}/notes/${ne}/pin`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();Be.success?Bt("",""):Bt(""+(Be.error||""),"")}catch(be){console.error("Failed to pin note:",be),Bt(""+be.message,"")}},Er=()=>{le(!0),ce(""),Ne(0),Tr(0),nt("")},Co=()=>{le(!1),ce(""),Ne(0),Tr(0),nt("")},ri=ne=>{Xt(ne),Pi(""),Vn(0),Yr(0),Ut("")},Ea=()=>{Xt(null),Pi(""),Vn(0),Yr(0),Ut("")},ni=async()=>{const ne=cr.trim();if(!ne){Bt("");return}if(!q&&Se&&!dt.trim()){Bt("");return}if(!ps){rr(!0);try{const be=await(await fetch(`/api/boards/${U}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:ne,author_key:Ee,color_index:pi,parent_note_id:jn,post_passcode:dt})})).json();be.success?(Xt(null),Pi(""),Vn(0),Yr(0),Ut(""),be.note&&be.note.noteId&&De(be.note.noteId)):Bt(""+(be.error||""),"")}catch(Te){console.error("Failed to create reply:",Te),Bt(""+Te.message,"")}finally{rr(!1)}}},Fu=ne=>{const Te=ne.target.value,be=Ts(Te);!Nn&&be>on||(Pi(Te),Yr(be))},Io=async()=>{const ne=te.trim();if(!ne){Bt("");return}if(!q&&Se&&!Re.trim()){Bt("");return}if(!qr){Qr(!0);try{const be=await(await fetch(`/api/boards/${U}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:ne,author_key:Ee,color_index:Ie,post_passcode:Re})})).json();be.success?(le(!1),ce(""),Ne(0),Tr(0),nt(""),be.note&&be.note.noteId&&De(be.note.noteId)):Bt(""+(be.error||""),"")}catch(Te){console.error("Failed to create note:",Te),Bt(""+Te.message,"")}finally{Qr(!1)}}},fs=ne=>{qe(ne.noteId),Et(ne.text),Kr(Ts(ne.text));const Te=ks.findIndex(be=>be===ne.bgColor);St(Te>=0?Te:0)},Ki=()=>{qe(null),Et(""),St(0),Kr(0)},Kt=async ne=>{const Te=Je.trim();if(!Te){Bt("");return}if(!ko){To(!0);try{const Be=await(await fetch(`/api/boards/${U}/notes/${ne}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:Te,author_key:Ee,color_index:wt})})).json();Be.success?(qe(null),Et(""),St(0),Kr(0)):Bt(""+(Be.error||""),"")}catch(be){console.error("Failed to update note:",be),Bt(""+be.message,"")}finally{To(!1)}}},Ks=async(ne,Te=!1,be=null)=>{let Be=!1,pt=l.find(mr=>mr.noteId===ne);if(pt)Be=!0;else for(const mr of l)if(mr.replyNotes&&(pt=mr.replyNotes.find(dr=>dr.noteId===ne),pt)){Be=!1;break}let zt="";if(Be&&(zt+=`

 `),!await en(zt,""))return;const _n=be||Ee;try{let mr;Te?mr=await fetch(`/api/boards/${U}/notes/${ne}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({author_key:_n})}):mr=await fetch(`/api/boards/${U}/notes/${ne}/archive`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author_key:_n,is_admin:q&&be!==null})});const dr=await mr.json();dr.success||Bt(""+(dr.error||""),"")}catch(mr){console.error("Failed to delete note:",mr),Bt(""+mr.message,"")}},Pa=async(ne,Te=null)=>{if(!await en("",""))return;const Be=q&&Te&&Te!==Ee;try{const zt=await(await fetch(`/api/boards/${U}/notes/${ne}/resend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author_key:Ee,is_admin:Be})})).json();zt.success?Bt(` ( ${zt.resent_count} )`,""):Bt(""+(zt.error||""),"")}catch(pt){console.error("Failed to resend note:",pt),Bt(""+pt.message,"")}},ms=ne=>{const Te=ks.findIndex(be=>be===ne.bgColor);er(Te>=0?Te:0),$t(ne)},Ys=()=>{$t(null),er(0)},Eo=async()=>{if(!Mt)return;const ne=Mt.userId===Ee,Te=q&&!ne;try{const Be=await(await fetch(`/api/boards/${U}/notes/${Mt.noteId}/color`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author_key:Ee,color_index:nr,is_admin:Te})})).json();Be.success?Ys():Bt(""+(Be.error||""),"")}catch(be){console.error("Failed to change color:",be),Bt(""+be.message,"")}},Yi=ne=>{switch(ne){case"LoRa received":return"LoRa";case"sent":case"LoRa sent":return"LoRa";case"local":return" ";case"LAN only":return" ";default:return ne}},Po=()=>[...l.filter(be=>{if(He.trim()){const Be=He.toLowerCase(),pt=(be.text||"").toLowerCase(),zt=(be.sender||"").toLowerCase();return pt.includes(Be)||zt.includes(Be)?!0:(be.replyNotes||[]).some(mr=>{const dr=(mr.text||"").toLowerCase(),vn=(mr.sender||"").toLowerCase();return dr.includes(Be)||vn.includes(Be)})}return!0})].sort((be,Be)=>{if(be.isPinedNote&&!Be.isPinedNote)return-1;if(!be.isPinedNote&&Be.isPinedNote)return 1;if(Pe==="newest")return new Date(Be.timestamp||0)-new Date(be.timestamp||0);if(Pe==="oldest")return new Date(be.timestamp||0)-new Date(Be.timestamp||0);if(Pe==="color"){const pt=ks.indexOf(be.bgColor),zt=ks.indexOf(Be.bgColor);return pt-zt}return 0}),Rs=ne=>{const Te=ne.target.value,be=Ts(Te);!Nn&&be>on||(ce(Te),Tr(be))},gl=ne=>{const Te=ne.target.value,be=Ts(Te);!Nn&&be>on||(Et(Te),Kr(be))},Aa=()=>{Ei(!0)},Ao=(ne,Te=!1)=>{Ei(!1);const be=ne.target.value;if(Ts(be)>on){let pt=be;for(;Ts(pt)>on;)pt=pt.slice(0,-1);Te?(Et(pt),Kr(Ts(pt))):(ce(pt),Tr(Ts(pt)))}},Ma=()=>{Nt(!0)},gs=()=>{Nt(!1)},ys=async ne=>{if(!(!ne||!Ee))try{await fetch(`/api/user/${Ee}/last-location`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lat:ne.center.lat,lng:ne.center.lng,zoom:ne.zoom})}),Cr(Te=>({...Te,[Ee]:{lat:ne.center.lat,lng:ne.center.lng,zoom:ne.zoom}}))}catch(Te){console.error("Failed to save user last location:",Te)}},yn=(ne,Te)=>{const be=/([\u4e00-\u9fa5a-zA-Z0-9_\-]+)?@\(([-+]?\d*\.?\d+)\s*,\s*([-+]?\d*\.?\d+)\)/g;if(Ke){const pt=Je.replace(be,"").trim(),zt=pt?`${pt} ${ne}`:ne,Lt=Ts(zt);Lt<=on?(Et(zt),Kr(Lt),Nt(!1),ys(Te),xt.current&&xt.current.focus()):Bt("","")}else if(jn){const pt=cr.replace(be,"").trim(),zt=pt?`${pt} ${ne}`:ne,Lt=Ts(zt);Lt<=on?(Pi(zt),Yr(Lt),Nt(!1),ys(Te),hs.current&&hs.current.focus()):Bt("","")}else{const pt=te.replace(be,"").trim(),zt=pt?`${pt} ${ne}`:ne,Lt=Ts(zt);Lt<=on?(ce(zt),Tr(Lt),Nt(!1),ys(Te),xt.current&&xt.current.focus()):Bt("","")}},un=ne=>{const Te=/([\u4e00-\u9fa5a-zA-Z0-9_\-]+)?@\(([-+]?\d*\.?\d+)\s*,\s*([-+]?\d*\.?\d+)\)/g,be=[];let Be;for(;(Be=Te.exec(ne))!==null;){const pt={lat:parseFloat(Be[2]),lng:parseFloat(Be[3])};Be[1]&&Be[1].trim()&&(pt.label=Be[1].trim()),be.push(pt)}return be.length>0?be:null},Mo=(ne,Te)=>{if(!Te.trim())return ne;const be=ne.toLowerCase(),Be=Te.toLowerCase(),pt=[];let zt=0,Lt=be.indexOf(Be);for(;Lt!==-1;)Lt>zt&&pt.push(ne.substring(zt,Lt)),pt.push(de.jsx("mark",{style:{backgroundColor:"yellow",color:"#333"},children:ne.substring(Lt,Lt+Te.length)},`${Lt}-${zt}`)),zt=Lt+Te.length,Lt=be.indexOf(Be,zt);return zt<ne.length&&pt.push(ne.substring(zt)),pt.length>0?pt:ne},Js=(ne,Te,be=!1)=>{ne.sender;const Be=ne.userId||"unknown-id",pt=ne.text,zt=ne.time||"",Lt=ne.status||"local",_n=ne.bgColor||ET(Be).bg,mr=Be===Ee,dr=mr&&Lt==="LAN only"&&!ne.archived,vn=mr&&Lt!=="LAN only"&&!ne.archived,za=q&&!mr&&!ne.archived&&Lt!=="LAN only";return Ke===ne.noteId?de.jsxs("div",{className:"sticky-note draft-note",style:{backgroundColor:ks[wt],color:"#333"},children:[de.jsx("div",{className:"draft-header",children:""}),de.jsx("textarea",{className:"draft-textarea",value:Je,onChange:gl,onCompositionStart:Aa,onCompositionEnd:At=>Ao(At,!0),placeholder:"...",autoFocus:!0}),hr&&de.jsx("div",{className:"draft-tools",children:de.jsx("button",{className:"btn-location-picker",onClick:Ma,title:"",children:" "})}),de.jsxs("div",{className:"byte-counter-container",children:[de.jsx("div",{className:"byte-counter-bar",children:de.jsx("div",{className:"byte-counter-fill",style:{width:`${Math.min(zr/on*100,100)}%`,backgroundColor:zr>on?"#d32f2f":"#3498db"}})}),de.jsxs("div",{className:"byte-counter-text",style:{color:zr>on?"#d32f2f":"#666"},children:[zr,"/",on]})]}),de.jsx("div",{className:"color-picker",children:ks.map((At,tn)=>de.jsx("div",{className:`color-option ${wt===tn?"selected":""}`,style:{backgroundColor:At},onClick:()=>St(tn)},tn))}),de.jsxs("div",{className:"draft-actions",children:[de.jsx("button",{className:"btn-cancel",onClick:Ki,children:""}),de.jsx("button",{className:"btn-submit",onClick:()=>Kt(ne.noteId),disabled:ko,children:""})]})]},ne.noteId||Te):de.jsxs("div",{ref:At=>{ne.noteId&&(ei.current[ne.noteId]=At)},className:`sticky-note ${Lt==="local"?"note-failed":""} ${Ds?"reordering":""} ${be?"reply-note":""}`,style:{backgroundColor:_n,color:"#333"},children:[(ne.archived||ne.isTempParentNote||ne.isPinedNote)&&de.jsx("div",{className:"note-label",children:ne.archived?"":ne.isPinedNote?"":""}),de.jsx("div",{className:"note-content",children:Mo(pt,He)}),hr&&un(pt)&&de.jsx("div",{style:{marginTop:"10px",marginBottom:"10px"},children:de.jsx(TT,{locations:un(pt)})}),de.jsxs("div",{className:"note-footer",children:[de.jsx("span",{className:"note-time",children:zt}),de.jsx("span",{className:"note-footer-right",children:(Lt==="sent"||Lt==="LoRa sent")&&(ne.userId===Ee||q)&&!ne.archived?de.jsxs("span",{className:"note-status clickable",onClick:At=>{At.stopPropagation(),Pa(ne.noteId,ne.userId)},title:"",children:[Yi(Lt),de.jsxs("span",{className:"ack-counter-wrapper",children:[de.jsx("span",{ref:At=>{ne.noteId&&(fn.current[ne.noteId]=At)},className:"ack-counter",onClick:At=>{if(At.stopPropagation(),Hr===ne.noteId)Me(null);else{const tn=At.currentTarget.getBoundingClientRect();ft({top:tn.bottom+8,left:tn.right-150}),Me(ne.noteId)}},children:Dr[ne.noteId]&&Dr[ne.noteId].length||0}),de.jsx("span",{className:"ack-counter-touch-overlay",onTouchStart:At=>{bt.current={x:At.touches[0].clientX,y:At.touches[0].clientY}},onTouchEnd:At=>{const tn=At.changedTouches[0].clientX,Qs=At.changedTouches[0].clientY,zi=Math.abs(tn-bt.current.x),mi=Math.abs(Qs-bt.current.y);if(zi<10&&mi<10)if(At.preventDefault(),At.stopPropagation(),Hr===ne.noteId)Me(null);else{const Zt=fn.current[ne.noteId].getBoundingClientRect();ft({top:Zt.bottom+8,left:Zt.right-150}),Me(ne.noteId)}}})]})]}):Lt==="sent"||Lt==="LoRa sent"?de.jsxs("span",{className:"note-status",children:[Yi(Lt),de.jsxs("span",{className:"ack-counter-wrapper",children:[de.jsx("span",{ref:At=>{ne.noteId&&(fn.current[ne.noteId]=At)},className:"ack-counter",onClick:At=>{if(At.stopPropagation(),Hr===ne.noteId)Me(null);else{const tn=At.currentTarget.getBoundingClientRect();ft({top:tn.bottom+8,left:tn.right-150}),Me(ne.noteId)}},children:Dr[ne.noteId]&&Dr[ne.noteId].length||0}),de.jsx("span",{className:"ack-counter-touch-overlay",onTouchStart:At=>{bt.current={x:At.touches[0].clientX,y:At.touches[0].clientY}},onTouchEnd:At=>{const tn=At.changedTouches[0].clientX,Qs=At.changedTouches[0].clientY,zi=Math.abs(tn-bt.current.x),mi=Math.abs(Qs-bt.current.y);if(zi<10&&mi<10)if(At.preventDefault(),At.stopPropagation(),Hr===ne.noteId)Me(null);else{const Zt=fn.current[ne.noteId].getBoundingClientRect();ft({top:Zt.bottom+8,left:Zt.right-150}),Me(ne.noteId)}}})]})]}):Lt==="LoRa received"&&ne.senderNodeDisplay?de.jsx("span",{ref:At=>{ne.noteId&&(N.current[ne.noteId]=At)},className:"note-status sender-clickable",onClick:At=>{if(At.stopPropagation(),mn===ne.noteId)Un(null),D(null);else{const tn=At.currentTarget.getBoundingClientRect();fi({top:tn.bottom+8,left:tn.right-150}),Un(ne.noteId),D(ne)}},children:Yi(Lt)}):de.jsx("span",{className:"note-status",children:Yi(Lt)})})]}),dr&&de.jsxs("div",{className:"note-actions",children:[de.jsx("button",{className:"btn-edit",onClick:()=>fs(ne),children:""}),de.jsx("button",{className:"btn-delete",onClick:()=>Ks(ne.noteId,!0),children:""})]}),vn&&de.jsxs("div",{className:"note-actions",children:[de.jsx("button",{className:"btn-delete",onClick:()=>Ks(ne.noteId,!1),children:""}),de.jsx("button",{className:"btn-color",onClick:()=>ms(ne),children:""}),q&&!be&&!ne.replyLoraMessageId&&!ne.isTempParentNote&&!ne.archived&&!ne.isPinedNote&&ne.status!=="Sending"&&de.jsx("button",{className:"btn-pin",onClick:()=>$n(ne.noteId),children:""})]}),za&&de.jsxs("div",{className:"note-actions",children:[de.jsx("button",{className:"btn-delete",onClick:()=>Ks(ne.noteId,!1,Be),children:""}),de.jsx("button",{className:"btn-color",onClick:()=>ms(ne),children:""}),!be&&!ne.replyLoraMessageId&&!ne.isTempParentNote&&!ne.isPinedNote&&ne.status!=="Sending"&&de.jsx("button",{className:"btn-pin",onClick:()=>$n(ne.noteId),children:""})]})]},ne.noteId||Te)},zo=(ne,Te)=>{const Be=[...ne.replyNotes||[]].sort((dr,vn)=>new Date(dr.timestamp||0)-new Date(vn.timestamp||0)),pt=[ne,...Be].filter(dr=>dr.loraMessageId),zt=jn&&pt.some(dr=>dr.loraMessageId===jn),Lt=Be.length>0?Be[Be.length-1]:ne,_n=Lt.loraMessageId,mr=Lt.status;return de.jsxs("div",{className:"note-with-replies",children:[Js(ne,Te,!1),Be.length>0&&de.jsx("div",{className:"reply-notes-container",children:Be.map((dr,vn)=>Js(dr,`${Te}-reply-${vn}`,!0))}),zt?de.jsx("div",{className:"reply-notes-container",children:de.jsxs("div",{className:"sticky-note draft-note reply-note",style:{backgroundColor:ks[pi],color:"#333"},children:[de.jsx("div",{className:"draft-header",children:""}),de.jsx("textarea",{ref:hs,className:"draft-textarea",value:cr,onChange:Fu,onCompositionStart:Aa,onCompositionEnd:dr=>Ao(dr,!1),placeholder:"...",autoFocus:!0}),hr&&de.jsx("div",{className:"draft-tools",children:de.jsx("button",{className:"btn-location-picker",onClick:Ma,title:"",children:" "})}),de.jsxs("div",{className:"byte-counter-container",children:[de.jsx("div",{className:"byte-counter-bar",children:de.jsx("div",{className:"byte-counter-fill",style:{width:`${Math.min(Ai/on*100,100)}%`,backgroundColor:Ai>on?"#d32f2f":"#3498db"}})}),de.jsxs("div",{className:"byte-counter-text",style:{color:Ai>on?"#d32f2f":"#666"},children:[Ai,"/",on]})]}),de.jsx("div",{className:"color-picker",children:ks.map((dr,vn)=>de.jsx("div",{className:`color-option ${pi===vn?"selected":""}`,style:{backgroundColor:dr},onClick:()=>Vn(vn)},vn))}),!q&&Se&&de.jsx("div",{className:"passcode-input-container",children:de.jsx("input",{type:"password",className:"passcode-input",placeholder:"",value:dt,onChange:dr=>Ut(dr.target.value)})}),de.jsxs("div",{className:"draft-actions",children:[de.jsx("button",{className:"btn-cancel",onClick:Ea,children:""}),de.jsx("button",{className:"btn-submit",onClick:ni,disabled:ps,children:""})]})]})}):!jn&&_n&&mr!=="LAN only"?de.jsx("div",{className:"reply-notes-container",children:de.jsx("button",{className:"add-reply-btn",onClick:()=>ri(_n),disabled:gt||jn!==null,children:"+"})}):null]},ne.noteId||Te)};return de.jsxs(de.Fragment,{children:[de.jsxs("header",{className:$r?"header-visible":"header-hidden",children:[de.jsxs("div",{className:"header-left",children:[de.jsxs("div",{className:"app-name",children:["MeshBridge: ",U," "]}),de.jsx("div",{className:"app-link",children:"noteboard.meshbridge.com"})]}),de.jsxs("div",{className:"status-container",style:{position:"relative"},children:[de.jsx("div",{className:`status-dot ${v?S?"online":"warning":""}`}),de.jsx("div",{className:"status-text",children:v?"LoRa ":ue?"LoRa  (RPi)":"LoRa "}),v&&!S&&V&&de.jsx("div",{className:"status-tooltip",children:V})]}),de.jsx("div",{className:"user-role-container",onClick:Ls,style:{cursor:"pointer"},children:de.jsx("div",{className:"user-role-label",children:q?"":""})})]}),de.jsxs("div",{className:"noteboard-container",children:[de.jsxs("div",{className:`filter-bar ${gt?"disabled":""}`,children:[de.jsxs("div",{className:"filter-group",children:[de.jsx("label",{className:"filter-label",children:""}),de.jsxs("select",{className:"filter-select",value:Pe,onChange:ne=>lt(ne.target.value),disabled:gt,children:[de.jsx("option",{value:"newest",children:""}),de.jsx("option",{value:"oldest",children:""}),de.jsx("option",{value:"color",children:""})]})]}),de.jsxs("div",{className:"filter-group",children:[de.jsx("label",{className:"filter-label",children:""}),de.jsx("input",{ref:Lr,type:"text",className:"filter-input",placeholder:"",value:He,onChange:ne=>Rt(ne.target.value),disabled:gt,readOnly:tr,onClick:()=>{tr&&(fr(!1),setTimeout(()=>{Lr.current&&Lr.current.focus()},0))}}),He&&de.jsx("button",{className:"clear-btn",onClick:()=>Rt(""),disabled:gt,children:""})]}),de.jsx("div",{className:"filter-group",children:de.jsxs("label",{className:"filter-checkbox",children:[de.jsx("input",{type:"checkbox",checked:kt,onChange:ne=>An(ne.target.checked),disabled:gt}),de.jsx("span",{children:""})]})})]}),de.jsxs("div",{className:"notes-grid",children:[Po().map((ne,Te)=>zo(ne,Te)),gt&&de.jsxs("div",{ref:rt,className:"sticky-note draft-note",style:{backgroundColor:ks[Ie],color:"#333"},children:[de.jsx("div",{className:"draft-header",children:""}),de.jsx("textarea",{ref:xt,className:"draft-textarea",value:te,onChange:Rs,onCompositionStart:Aa,onCompositionEnd:ne=>Ao(ne,!1),placeholder:"...",autoFocus:!0}),hr&&de.jsx("div",{className:"draft-tools",children:de.jsx("button",{className:"btn-location-picker",onClick:Ma,title:"",children:" "})}),de.jsxs("div",{className:"byte-counter-container",children:[de.jsx("div",{className:"byte-counter-bar",children:de.jsx("div",{className:"byte-counter-fill",style:{width:`${Math.min(ir/on*100,100)}%`,backgroundColor:ir>on?"#d32f2f":"#3498db"}})}),de.jsxs("div",{className:"byte-counter-text",style:{color:ir>on?"#d32f2f":"#666"},children:[ir,"/",on]})]}),de.jsx("div",{className:"color-picker",children:ks.map((ne,Te)=>de.jsx("div",{className:`color-option ${Ie===Te?"selected":""}`,style:{backgroundColor:ne},onClick:()=>Ne(Te)},Te))}),!q&&Se&&de.jsx("div",{className:"passcode-input-container",children:de.jsx("input",{type:"password",className:"passcode-input",placeholder:"",value:Re,onChange:ne=>nt(ne.target.value)})}),de.jsxs("div",{className:"draft-actions",children:[de.jsx("button",{className:"btn-cancel",onClick:Co,children:""}),de.jsx("button",{className:"btn-submit",onClick:Io,disabled:qr,children:""})]})]})]})]}),!gt&&!jn&&de.jsx("button",{className:"fab",onClick:Er,children:"+"}),de.jsxs("footer",{className:"app-footer",children:[de.jsxs("div",{className:"footer-left",children:["uid=",Ee]}),de.jsx("div",{className:"footer-right",children:"MeshNoteboard v0.4.0"})]}),or.show&&de.jsx("div",{className:"modal-overlay modal-overlay-top",onClick:()=>or.type==="alert"&&or.onConfirm(),children:de.jsxs("div",{className:"modal-content",onClick:ne=>ne.stopPropagation(),children:[de.jsx("div",{className:"modal-header",children:or.title}),de.jsx("div",{className:"modal-body",children:or.message}),de.jsxs("div",{className:"modal-actions",children:[or.type==="confirm"&&de.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:or.onCancel,children:""}),de.jsx("button",{className:"modal-btn modal-btn-confirm",onClick:or.onConfirm,children:(or.type==="confirm","")})]})]})}),Mt&&de.jsx("div",{className:"modal-overlay",onClick:Ys,children:de.jsxs("div",{className:"modal-content color-picker-modal",onClick:ne=>ne.stopPropagation(),children:[de.jsx("div",{className:"modal-header",children:""}),de.jsx("div",{className:"modal-body",children:de.jsx("div",{className:"color-picker",children:ks.map((ne,Te)=>de.jsx("div",{className:`color-option ${nr===Te?"selected":""}`,style:{backgroundColor:ne},onClick:()=>er(Te)},Te))})}),de.jsxs("div",{className:"modal-actions",children:[de.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:Ys,children:""}),de.jsx("button",{className:"modal-btn modal-btn-confirm",onClick:Eo,children:""})]})]})}),Hr&&Dr[Hr]&&de.jsxs("div",{className:"ack-tooltip",ref:Jr,style:{top:`${Dt.top}px`,left:`${Dt.left}px`},children:[de.jsx("button",{className:"ack-tooltip-close",onClick:ne=>{ne.stopPropagation(),Me(null)},children:""}),de.jsx("div",{className:"ack-tooltip-header",children:""}),de.jsx("div",{className:"ack-tooltip-list",children:Dr[Hr].map((ne,Te)=>de.jsx("div",{className:"ack-tooltip-item",children:ne.displayId},ne.ackId||Te))})]}),mn&&(W==null?void 0:W.senderNodeDisplay)&&de.jsxs("div",{className:"ack-tooltip",ref:L,style:{top:`${Mi.top}px`,left:`${Mi.left}px`},children:[de.jsx("button",{className:"ack-tooltip-close",onClick:ne=>{ne.stopPropagation(),Un(null),D(null)},children:""}),de.jsx("div",{className:"ack-tooltip-header",children:""}),de.jsx("div",{className:"ack-tooltip-list",children:de.jsx("div",{className:"ack-tooltip-item",children:W.senderNodeDisplay})})]}),ae&&de.jsx("div",{className:"modal-overlay",onClick:Ir,children:de.jsxs("div",{className:"modal-content",onClick:ne=>ne.stopPropagation(),children:[de.jsx("div",{className:"modal-header",children:""}),de.jsxs("div",{className:"modal-body",children:[de.jsx("p",{children:""}),de.jsx("input",{type:"password",className:"admin-passcode-input",placeholder:"",value:J,onChange:ne=>ve(ne.target.value),onKeyPress:ne=>{ne.key==="Enter"&&Xi()},autoFocus:!0})]}),de.jsxs("div",{className:"modal-actions",children:[de.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:Ir,children:""}),de.jsx("button",{className:"modal-btn modal-btn-confirm",onClick:Xi,children:""})]})]})}),Pt&&de.jsx(IT,{onConfirm:yn,onCancel:gs,initialText:Ke?Je:jn?cr:te,lastLocation:Ee?jt[Ee]:null})]})}zm.createRoot(document.getElementById("root")).render(de.jsx(h2.StrictMode,{children:de.jsx(PT,{})}));
