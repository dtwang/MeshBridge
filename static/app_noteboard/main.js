(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))p(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const S of T.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&p(S)}).observe(document,{childList:!0,subtree:!0});function l(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerPolicy&&(T.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?T.credentials="include":x.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function p(x){if(x.ep)return;x.ep=!0;const T=l(x);fetch(x.href,T)}})();var Gb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kx(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Cx={exports:{}},Tp={},Ex={exports:{}},jt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dh=Symbol.for("react.element"),Hb=Symbol.for("react.portal"),Wb=Symbol.for("react.fragment"),Xb=Symbol.for("react.strict_mode"),Kb=Symbol.for("react.profiler"),Yb=Symbol.for("react.provider"),Jb=Symbol.for("react.context"),Qb=Symbol.for("react.forward_ref"),e2=Symbol.for("react.suspense"),t2=Symbol.for("react.memo"),r2=Symbol.for("react.lazy"),cv=Symbol.iterator;function n2(r){return r===null||typeof r!="object"?null:(r=cv&&r[cv]||r["@@iterator"],typeof r=="function"?r:null)}var Ix={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Px=Object.assign,Ax={};function yu(r,i,l){this.props=r,this.context=i,this.refs=Ax,this.updater=l||Ix}yu.prototype.isReactComponent={};yu.prototype.setState=function(r,i){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,i,"setState")};yu.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Mx(){}Mx.prototype=yu.prototype;function Ig(r,i,l){this.props=r,this.context=i,this.refs=Ax,this.updater=l||Ix}var Pg=Ig.prototype=new Mx;Pg.constructor=Ig;Px(Pg,yu.prototype);Pg.isPureReactComponent=!0;var hv=Array.isArray,zx=Object.prototype.hasOwnProperty,Ag={current:null},Dx={key:!0,ref:!0,__self:!0,__source:!0};function Lx(r,i,l){var p,x={},T=null,S=null;if(i!=null)for(p in i.ref!==void 0&&(S=i.ref),i.key!==void 0&&(T=""+i.key),i)zx.call(i,p)&&!Dx.hasOwnProperty(p)&&(x[p]=i[p]);var d=arguments.length-2;if(d===1)x.children=l;else if(1<d){for(var $=Array(d),ne=0;ne<d;ne++)$[ne]=arguments[ne+2];x.children=$}if(r&&r.defaultProps)for(p in d=r.defaultProps,d)x[p]===void 0&&(x[p]=d[p]);return{$$typeof:dh,type:r,key:T,ref:S,props:x,_owner:Ag.current}}function i2(r,i){return{$$typeof:dh,type:r.type,key:i,ref:r.ref,props:r.props,_owner:r._owner}}function Mg(r){return typeof r=="object"&&r!==null&&r.$$typeof===dh}function s2(r){var i={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(l){return i[l]})}var dv=/\/+/g;function em(r,i){return typeof r=="object"&&r!==null&&r.key!=null?s2(""+r.key):i.toString(36)}function Fd(r,i,l,p,x){var T=typeof r;(T==="undefined"||T==="boolean")&&(r=null);var S=!1;if(r===null)S=!0;else switch(T){case"string":case"number":S=!0;break;case"object":switch(r.$$typeof){case dh:case Hb:S=!0}}if(S)return S=r,x=x(S),r=p===""?"."+em(S,0):p,hv(x)?(l="",r!=null&&(l=r.replace(dv,"$&/")+"/"),Fd(x,i,l,"",function(ne){return ne})):x!=null&&(Mg(x)&&(x=i2(x,l+(!x.key||S&&S.key===x.key?"":(""+x.key).replace(dv,"$&/")+"/")+r)),i.push(x)),1;if(S=0,p=p===""?".":p+":",hv(r))for(var d=0;d<r.length;d++){T=r[d];var $=p+em(T,d);S+=Fd(T,i,l,$,x)}else if($=n2(r),typeof $=="function")for(r=$.call(r),d=0;!(T=r.next()).done;)T=T.value,$=p+em(T,d++),S+=Fd(T,i,l,$,x);else if(T==="object")throw i=String(r),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return S}function yd(r,i,l){if(r==null)return r;var p=[],x=0;return Fd(r,p,"","",function(T){return i.call(l,T,x++)}),p}function o2(r){if(r._status===-1){var i=r._result;i=i(),i.then(function(l){(r._status===0||r._status===-1)&&(r._status=1,r._result=l)},function(l){(r._status===0||r._status===-1)&&(r._status=2,r._result=l)}),r._status===-1&&(r._status=0,r._result=i)}if(r._status===1)return r._result.default;throw r._result}var si={current:null},Bd={transition:null},a2={ReactCurrentDispatcher:si,ReactCurrentBatchConfig:Bd,ReactCurrentOwner:Ag};function Rx(){throw Error("act(...) is not supported in production builds of React.")}jt.Children={map:yd,forEach:function(r,i,l){yd(r,function(){i.apply(this,arguments)},l)},count:function(r){var i=0;return yd(r,function(){i++}),i},toArray:function(r){return yd(r,function(i){return i})||[]},only:function(r){if(!Mg(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};jt.Component=yu;jt.Fragment=Wb;jt.Profiler=Kb;jt.PureComponent=Ig;jt.StrictMode=Xb;jt.Suspense=e2;jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=a2;jt.act=Rx;jt.cloneElement=function(r,i,l){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var p=Px({},r.props),x=r.key,T=r.ref,S=r._owner;if(i!=null){if(i.ref!==void 0&&(T=i.ref,S=Ag.current),i.key!==void 0&&(x=""+i.key),r.type&&r.type.defaultProps)var d=r.type.defaultProps;for($ in i)zx.call(i,$)&&!Dx.hasOwnProperty($)&&(p[$]=i[$]===void 0&&d!==void 0?d[$]:i[$])}var $=arguments.length-2;if($===1)p.children=l;else if(1<$){d=Array($);for(var ne=0;ne<$;ne++)d[ne]=arguments[ne+2];p.children=d}return{$$typeof:dh,type:r.type,key:x,ref:T,props:p,_owner:S}};jt.createContext=function(r){return r={$$typeof:Jb,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Yb,_context:r},r.Consumer=r};jt.createElement=Lx;jt.createFactory=function(r){var i=Lx.bind(null,r);return i.type=r,i};jt.createRef=function(){return{current:null}};jt.forwardRef=function(r){return{$$typeof:Qb,render:r}};jt.isValidElement=Mg;jt.lazy=function(r){return{$$typeof:r2,_payload:{_status:-1,_result:r},_init:o2}};jt.memo=function(r,i){return{$$typeof:t2,type:r,compare:i===void 0?null:i}};jt.startTransition=function(r){var i=Bd.transition;Bd.transition={};try{r()}finally{Bd.transition=i}};jt.unstable_act=Rx;jt.useCallback=function(r,i){return si.current.useCallback(r,i)};jt.useContext=function(r){return si.current.useContext(r)};jt.useDebugValue=function(){};jt.useDeferredValue=function(r){return si.current.useDeferredValue(r)};jt.useEffect=function(r,i){return si.current.useEffect(r,i)};jt.useId=function(){return si.current.useId()};jt.useImperativeHandle=function(r,i,l){return si.current.useImperativeHandle(r,i,l)};jt.useInsertionEffect=function(r,i){return si.current.useInsertionEffect(r,i)};jt.useLayoutEffect=function(r,i){return si.current.useLayoutEffect(r,i)};jt.useMemo=function(r,i){return si.current.useMemo(r,i)};jt.useReducer=function(r,i,l){return si.current.useReducer(r,i,l)};jt.useRef=function(r){return si.current.useRef(r)};jt.useState=function(r){return si.current.useState(r)};jt.useSyncExternalStore=function(r,i,l){return si.current.useSyncExternalStore(r,i,l)};jt.useTransition=function(){return si.current.useTransition()};jt.version="18.3.1";Ex.exports=jt;var rt=Ex.exports;const l2=kx(rt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u2=rt,c2=Symbol.for("react.element"),h2=Symbol.for("react.fragment"),d2=Object.prototype.hasOwnProperty,p2=u2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f2={key:!0,ref:!0,__self:!0,__source:!0};function Fx(r,i,l){var p,x={},T=null,S=null;l!==void 0&&(T=""+l),i.key!==void 0&&(T=""+i.key),i.ref!==void 0&&(S=i.ref);for(p in i)d2.call(i,p)&&!f2.hasOwnProperty(p)&&(x[p]=i[p]);if(r&&r.defaultProps)for(p in i=r.defaultProps,i)x[p]===void 0&&(x[p]=i[p]);return{$$typeof:c2,type:r,key:T,ref:S,props:x,_owner:p2.current}}Tp.Fragment=h2;Tp.jsx=Fx;Tp.jsxs=Fx;Cx.exports=Tp;var me=Cx.exports,Pm={},Bx={exports:{}},Ni={},Ox={exports:{}},Nx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function i(et,_t){var yt=et.length;et.push(_t);e:for(;0<yt;){var Dt=yt-1>>>1,qt=et[Dt];if(0<x(qt,_t))et[Dt]=_t,et[yt]=qt,yt=Dt;else break e}}function l(et){return et.length===0?null:et[0]}function p(et){if(et.length===0)return null;var _t=et[0],yt=et.pop();if(yt!==_t){et[0]=yt;e:for(var Dt=0,qt=et.length,ln=qt>>>1;Dt<ln;){var jr=2*(Dt+1)-1,un=et[jr],gr=jr+1,vr=et[gr];if(0>x(un,yt))gr<qt&&0>x(vr,un)?(et[Dt]=vr,et[gr]=yt,Dt=gr):(et[Dt]=un,et[jr]=yt,Dt=jr);else if(gr<qt&&0>x(vr,yt))et[Dt]=vr,et[gr]=yt,Dt=gr;else break e}}return _t}function x(et,_t){var yt=et.sortIndex-_t.sortIndex;return yt!==0?yt:et.id-_t.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;r.unstable_now=function(){return T.now()}}else{var S=Date,d=S.now();r.unstable_now=function(){return S.now()-d}}var $=[],ne=[],ge=1,Q=null,V=3,Ce=!1,Ee=!1,Me=!1,pt=typeof setTimeout=="function"?setTimeout:null,oe=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function de(et){for(var _t=l(ne);_t!==null;){if(_t.callback===null)p(ne);else if(_t.startTime<=et)p(ne),_t.sortIndex=_t.expirationTime,i($,_t);else break;_t=l(ne)}}function Pe(et){if(Me=!1,de(et),!Ee)if(l($)!==null)Ee=!0,Nr(qe);else{var _t=l(ne);_t!==null&&an(Pe,_t.startTime-et)}}function qe(et,_t){Ee=!1,Me&&(Me=!1,oe(Le),Le=-1),Ce=!0;var yt=V;try{for(de(_t),Q=l($);Q!==null&&(!(Q.expirationTime>_t)||et&&!Ye());){var Dt=Q.callback;if(typeof Dt=="function"){Q.callback=null,V=Q.priorityLevel;var qt=Dt(Q.expirationTime<=_t);_t=r.unstable_now(),typeof qt=="function"?Q.callback=qt:Q===l($)&&p($),de(_t)}else p($);Q=l($)}if(Q!==null)var ln=!0;else{var jr=l(ne);jr!==null&&an(Pe,jr.startTime-_t),ln=!1}return ln}finally{Q=null,V=yt,Ce=!1}}var Qe=!1,Xe=null,Le=-1,it=5,Ge=-1;function Ye(){return!(r.unstable_now()-Ge<it)}function Kt(){if(Xe!==null){var et=r.unstable_now();Ge=et;var _t=!0;try{_t=Xe(!0,et)}finally{_t?Vt():(Qe=!1,Xe=null)}}else Qe=!1}var Vt;if(typeof ie=="function")Vt=function(){ie(Kt)};else if(typeof MessageChannel<"u"){var Yt=new MessageChannel,Sn=Yt.port2;Yt.port1.onmessage=Kt,Vt=function(){Sn.postMessage(null)}}else Vt=function(){pt(Kt,0)};function Nr(et){Xe=et,Qe||(Qe=!0,Vt())}function an(et,_t){Le=pt(function(){et(r.unstable_now())},_t)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(et){et.callback=null},r.unstable_continueExecution=function(){Ee||Ce||(Ee=!0,Nr(qe))},r.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<et?Math.floor(1e3/et):5},r.unstable_getCurrentPriorityLevel=function(){return V},r.unstable_getFirstCallbackNode=function(){return l($)},r.unstable_next=function(et){switch(V){case 1:case 2:case 3:var _t=3;break;default:_t=V}var yt=V;V=_t;try{return et()}finally{V=yt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(et,_t){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var yt=V;V=et;try{return _t()}finally{V=yt}},r.unstable_scheduleCallback=function(et,_t,yt){var Dt=r.unstable_now();switch(typeof yt=="object"&&yt!==null?(yt=yt.delay,yt=typeof yt=="number"&&0<yt?Dt+yt:Dt):yt=Dt,et){case 1:var qt=-1;break;case 2:qt=250;break;case 5:qt=1073741823;break;case 4:qt=1e4;break;default:qt=5e3}return qt=yt+qt,et={id:ge++,callback:_t,priorityLevel:et,startTime:yt,expirationTime:qt,sortIndex:-1},yt>Dt?(et.sortIndex=yt,i(ne,et),l($)===null&&et===l(ne)&&(Me?(oe(Le),Le=-1):Me=!0,an(Pe,yt-Dt))):(et.sortIndex=qt,i($,et),Ee||Ce||(Ee=!0,Nr(qe))),et},r.unstable_shouldYield=Ye,r.unstable_wrapCallback=function(et){var _t=V;return function(){var yt=V;V=_t;try{return et.apply(this,arguments)}finally{V=yt}}}})(Nx);Ox.exports=Nx;var m2=Ox.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g2=rt,Oi=m2;function Be(r){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+r,l=1;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+r+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jx=new Set,Xc={};function Qa(r,i){cu(r,i),cu(r+"Capture",i)}function cu(r,i){for(Xc[r]=i,r=0;r<i.length;r++)jx.add(i[r])}var ho=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Am=Object.prototype.hasOwnProperty,y2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pv={},fv={};function _2(r){return Am.call(fv,r)?!0:Am.call(pv,r)?!1:y2.test(r)?fv[r]=!0:(pv[r]=!0,!1)}function v2(r,i,l,p){if(l!==null&&l.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return p?!1:l!==null?!l.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function x2(r,i,l,p){if(i===null||typeof i>"u"||v2(r,i,l,p))return!0;if(p)return!1;if(l!==null)switch(l.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function oi(r,i,l,p,x,T,S){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=p,this.attributeNamespace=x,this.mustUseProperty=l,this.propertyName=r,this.type=i,this.sanitizeURL=T,this.removeEmptyString=S}var Ln={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Ln[r]=new oi(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var i=r[0];Ln[i]=new oi(i,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Ln[r]=new oi(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Ln[r]=new oi(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Ln[r]=new oi(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Ln[r]=new oi(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Ln[r]=new oi(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Ln[r]=new oi(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Ln[r]=new oi(r,5,!1,r.toLowerCase(),null,!1,!1)});var zg=/[\-:]([a-z])/g;function Dg(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var i=r.replace(zg,Dg);Ln[i]=new oi(i,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var i=r.replace(zg,Dg);Ln[i]=new oi(i,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var i=r.replace(zg,Dg);Ln[i]=new oi(i,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Ln[r]=new oi(r,1,!1,r.toLowerCase(),null,!1,!1)});Ln.xlinkHref=new oi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Ln[r]=new oi(r,1,!1,r.toLowerCase(),null,!0,!0)});function Lg(r,i,l,p){var x=Ln.hasOwnProperty(i)?Ln[i]:null;(x!==null?x.type!==0:p||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(x2(i,l,x,p)&&(l=null),p||x===null?_2(i)&&(l===null?r.removeAttribute(i):r.setAttribute(i,""+l)):x.mustUseProperty?r[x.propertyName]=l===null?x.type===3?!1:"":l:(i=x.attributeName,p=x.attributeNamespace,l===null?r.removeAttribute(i):(x=x.type,l=x===3||x===4&&l===!0?"":""+l,p?r.setAttributeNS(p,i,l):r.setAttribute(i,l))))}var go=g2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_d=Symbol.for("react.element"),Zl=Symbol.for("react.portal"),Gl=Symbol.for("react.fragment"),Rg=Symbol.for("react.strict_mode"),Mm=Symbol.for("react.profiler"),Vx=Symbol.for("react.provider"),Ux=Symbol.for("react.context"),Fg=Symbol.for("react.forward_ref"),zm=Symbol.for("react.suspense"),Dm=Symbol.for("react.suspense_list"),Bg=Symbol.for("react.memo"),Wo=Symbol.for("react.lazy"),$x=Symbol.for("react.offscreen"),mv=Symbol.iterator;function Cc(r){return r===null||typeof r!="object"?null:(r=mv&&r[mv]||r["@@iterator"],typeof r=="function"?r:null)}var Rr=Object.assign,tm;function Rc(r){if(tm===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);tm=i&&i[1]||""}return`
`+tm+r}var rm=!1;function nm(r,i){if(!r||rm)return"";rm=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(ne){var p=ne}Reflect.construct(r,[],i)}else{try{i.call()}catch(ne){p=ne}r.call(i.prototype)}else{try{throw Error()}catch(ne){p=ne}r()}}catch(ne){if(ne&&p&&typeof ne.stack=="string"){for(var x=ne.stack.split(`
`),T=p.stack.split(`
`),S=x.length-1,d=T.length-1;1<=S&&0<=d&&x[S]!==T[d];)d--;for(;1<=S&&0<=d;S--,d--)if(x[S]!==T[d]){if(S!==1||d!==1)do if(S--,d--,0>d||x[S]!==T[d]){var $=`
`+x[S].replace(" at new "," at ");return r.displayName&&$.includes("<anonymous>")&&($=$.replace("<anonymous>",r.displayName)),$}while(1<=S&&0<=d);break}}}finally{rm=!1,Error.prepareStackTrace=l}return(r=r?r.displayName||r.name:"")?Rc(r):""}function w2(r){switch(r.tag){case 5:return Rc(r.type);case 16:return Rc("Lazy");case 13:return Rc("Suspense");case 19:return Rc("SuspenseList");case 0:case 2:case 15:return r=nm(r.type,!1),r;case 11:return r=nm(r.type.render,!1),r;case 1:return r=nm(r.type,!0),r;default:return""}}function Lm(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Gl:return"Fragment";case Zl:return"Portal";case Mm:return"Profiler";case Rg:return"StrictMode";case zm:return"Suspense";case Dm:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case Ux:return(r.displayName||"Context")+".Consumer";case Vx:return(r._context.displayName||"Context")+".Provider";case Fg:var i=r.render;return r=r.displayName,r||(r=i.displayName||i.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Bg:return i=r.displayName||null,i!==null?i:Lm(r.type)||"Memo";case Wo:i=r._payload,r=r._init;try{return Lm(r(i))}catch{}}return null}function b2(r){var i=r.type;switch(r.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=i.render,r=r.displayName||r.name||"",i.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Lm(i);case 8:return i===Rg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function ua(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function qx(r){var i=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function S2(r){var i=qx(r)?"checked":"value",l=Object.getOwnPropertyDescriptor(r.constructor.prototype,i),p=""+r[i];if(!r.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var x=l.get,T=l.set;return Object.defineProperty(r,i,{configurable:!0,get:function(){return x.call(this)},set:function(S){p=""+S,T.call(this,S)}}),Object.defineProperty(r,i,{enumerable:l.enumerable}),{getValue:function(){return p},setValue:function(S){p=""+S},stopTracking:function(){r._valueTracker=null,delete r[i]}}}}function vd(r){r._valueTracker||(r._valueTracker=S2(r))}function Zx(r){if(!r)return!1;var i=r._valueTracker;if(!i)return!0;var l=i.getValue(),p="";return r&&(p=qx(r)?r.checked?"true":"false":r.value),r=p,r!==l?(i.setValue(r),!0):!1}function Qd(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Rm(r,i){var l=i.checked;return Rr({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??r._wrapperState.initialChecked})}function gv(r,i){var l=i.defaultValue==null?"":i.defaultValue,p=i.checked!=null?i.checked:i.defaultChecked;l=ua(i.value!=null?i.value:l),r._wrapperState={initialChecked:p,initialValue:l,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Gx(r,i){i=i.checked,i!=null&&Lg(r,"checked",i,!1)}function Fm(r,i){Gx(r,i);var l=ua(i.value),p=i.type;if(l!=null)p==="number"?(l===0&&r.value===""||r.value!=l)&&(r.value=""+l):r.value!==""+l&&(r.value=""+l);else if(p==="submit"||p==="reset"){r.removeAttribute("value");return}i.hasOwnProperty("value")?Bm(r,i.type,l):i.hasOwnProperty("defaultValue")&&Bm(r,i.type,ua(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(r.defaultChecked=!!i.defaultChecked)}function yv(r,i,l){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var p=i.type;if(!(p!=="submit"&&p!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+r._wrapperState.initialValue,l||i===r.value||(r.value=i),r.defaultValue=i}l=r.name,l!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,l!==""&&(r.name=l)}function Bm(r,i,l){(i!=="number"||Qd(r.ownerDocument)!==r)&&(l==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+l&&(r.defaultValue=""+l))}var Fc=Array.isArray;function nu(r,i,l,p){if(r=r.options,i){i={};for(var x=0;x<l.length;x++)i["$"+l[x]]=!0;for(l=0;l<r.length;l++)x=i.hasOwnProperty("$"+r[l].value),r[l].selected!==x&&(r[l].selected=x),x&&p&&(r[l].defaultSelected=!0)}else{for(l=""+ua(l),i=null,x=0;x<r.length;x++){if(r[x].value===l){r[x].selected=!0,p&&(r[x].defaultSelected=!0);return}i!==null||r[x].disabled||(i=r[x])}i!==null&&(i.selected=!0)}}function Om(r,i){if(i.dangerouslySetInnerHTML!=null)throw Error(Be(91));return Rr({},i,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function _v(r,i){var l=i.value;if(l==null){if(l=i.children,i=i.defaultValue,l!=null){if(i!=null)throw Error(Be(92));if(Fc(l)){if(1<l.length)throw Error(Be(93));l=l[0]}i=l}i==null&&(i=""),l=i}r._wrapperState={initialValue:ua(l)}}function Hx(r,i){var l=ua(i.value),p=ua(i.defaultValue);l!=null&&(l=""+l,l!==r.value&&(r.value=l),i.defaultValue==null&&r.defaultValue!==l&&(r.defaultValue=l)),p!=null&&(r.defaultValue=""+p)}function vv(r){var i=r.textContent;i===r._wrapperState.initialValue&&i!==""&&i!==null&&(r.value=i)}function Wx(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nm(r,i){return r==null||r==="http://www.w3.org/1999/xhtml"?Wx(i):r==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var xd,Xx=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,l,p,x){MSApp.execUnsafeLocalFunction(function(){return r(i,l,p,x)})}:r}(function(r,i){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=i;else{for(xd=xd||document.createElement("div"),xd.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=xd.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;i.firstChild;)r.appendChild(i.firstChild)}});function Kc(r,i){if(i){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=i;return}}r.textContent=i}var jc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},T2=["Webkit","ms","Moz","O"];Object.keys(jc).forEach(function(r){T2.forEach(function(i){i=i+r.charAt(0).toUpperCase()+r.substring(1),jc[i]=jc[r]})});function Kx(r,i,l){return i==null||typeof i=="boolean"||i===""?"":l||typeof i!="number"||i===0||jc.hasOwnProperty(r)&&jc[r]?(""+i).trim():i+"px"}function Yx(r,i){r=r.style;for(var l in i)if(i.hasOwnProperty(l)){var p=l.indexOf("--")===0,x=Kx(l,i[l],p);l==="float"&&(l="cssFloat"),p?r.setProperty(l,x):r[l]=x}}var k2=Rr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function jm(r,i){if(i){if(k2[r]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(Be(137,r));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(Be(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(Be(61))}if(i.style!=null&&typeof i.style!="object")throw Error(Be(62))}}function Vm(r,i){if(r.indexOf("-")===-1)return typeof i.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Um=null;function Og(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var $m=null,iu=null,su=null;function xv(r){if(r=mh(r)){if(typeof $m!="function")throw Error(Be(280));var i=r.stateNode;i&&(i=Pp(i),$m(r.stateNode,r.type,i))}}function Jx(r){iu?su?su.push(r):su=[r]:iu=r}function Qx(){if(iu){var r=iu,i=su;if(su=iu=null,xv(r),i)for(r=0;r<i.length;r++)xv(i[r])}}function e0(r,i){return r(i)}function t0(){}var im=!1;function r0(r,i,l){if(im)return r(i,l);im=!0;try{return e0(r,i,l)}finally{im=!1,(iu!==null||su!==null)&&(t0(),Qx())}}function Yc(r,i){var l=r.stateNode;if(l===null)return null;var p=Pp(l);if(p===null)return null;l=p[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(Be(231,i,typeof l));return l}var qm=!1;if(ho)try{var Ec={};Object.defineProperty(Ec,"passive",{get:function(){qm=!0}}),window.addEventListener("test",Ec,Ec),window.removeEventListener("test",Ec,Ec)}catch{qm=!1}function C2(r,i,l,p,x,T,S,d,$){var ne=Array.prototype.slice.call(arguments,3);try{i.apply(l,ne)}catch(ge){this.onError(ge)}}var Vc=!1,ep=null,tp=!1,Zm=null,E2={onError:function(r){Vc=!0,ep=r}};function I2(r,i,l,p,x,T,S,d,$){Vc=!1,ep=null,C2.apply(E2,arguments)}function P2(r,i,l,p,x,T,S,d,$){if(I2.apply(this,arguments),Vc){if(Vc){var ne=ep;Vc=!1,ep=null}else throw Error(Be(198));tp||(tp=!0,Zm=ne)}}function el(r){var i=r,l=r;if(r.alternate)for(;i.return;)i=i.return;else{r=i;do i=r,i.flags&4098&&(l=i.return),r=i.return;while(r)}return i.tag===3?l:null}function n0(r){if(r.tag===13){var i=r.memoizedState;if(i===null&&(r=r.alternate,r!==null&&(i=r.memoizedState)),i!==null)return i.dehydrated}return null}function wv(r){if(el(r)!==r)throw Error(Be(188))}function A2(r){var i=r.alternate;if(!i){if(i=el(r),i===null)throw Error(Be(188));return i!==r?null:r}for(var l=r,p=i;;){var x=l.return;if(x===null)break;var T=x.alternate;if(T===null){if(p=x.return,p!==null){l=p;continue}break}if(x.child===T.child){for(T=x.child;T;){if(T===l)return wv(x),r;if(T===p)return wv(x),i;T=T.sibling}throw Error(Be(188))}if(l.return!==p.return)l=x,p=T;else{for(var S=!1,d=x.child;d;){if(d===l){S=!0,l=x,p=T;break}if(d===p){S=!0,p=x,l=T;break}d=d.sibling}if(!S){for(d=T.child;d;){if(d===l){S=!0,l=T,p=x;break}if(d===p){S=!0,p=T,l=x;break}d=d.sibling}if(!S)throw Error(Be(189))}}if(l.alternate!==p)throw Error(Be(190))}if(l.tag!==3)throw Error(Be(188));return l.stateNode.current===l?r:i}function i0(r){return r=A2(r),r!==null?s0(r):null}function s0(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var i=s0(r);if(i!==null)return i;r=r.sibling}return null}var o0=Oi.unstable_scheduleCallback,bv=Oi.unstable_cancelCallback,M2=Oi.unstable_shouldYield,z2=Oi.unstable_requestPaint,qr=Oi.unstable_now,D2=Oi.unstable_getCurrentPriorityLevel,Ng=Oi.unstable_ImmediatePriority,a0=Oi.unstable_UserBlockingPriority,rp=Oi.unstable_NormalPriority,L2=Oi.unstable_LowPriority,l0=Oi.unstable_IdlePriority,kp=null,js=null;function R2(r){if(js&&typeof js.onCommitFiberRoot=="function")try{js.onCommitFiberRoot(kp,r,void 0,(r.current.flags&128)===128)}catch{}}var Ts=Math.clz32?Math.clz32:O2,F2=Math.log,B2=Math.LN2;function O2(r){return r>>>=0,r===0?32:31-(F2(r)/B2|0)|0}var wd=64,bd=4194304;function Bc(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function np(r,i){var l=r.pendingLanes;if(l===0)return 0;var p=0,x=r.suspendedLanes,T=r.pingedLanes,S=l&268435455;if(S!==0){var d=S&~x;d!==0?p=Bc(d):(T&=S,T!==0&&(p=Bc(T)))}else S=l&~x,S!==0?p=Bc(S):T!==0&&(p=Bc(T));if(p===0)return 0;if(i!==0&&i!==p&&!(i&x)&&(x=p&-p,T=i&-i,x>=T||x===16&&(T&4194240)!==0))return i;if(p&4&&(p|=l&16),i=r.entangledLanes,i!==0)for(r=r.entanglements,i&=p;0<i;)l=31-Ts(i),x=1<<l,p|=r[l],i&=~x;return p}function N2(r,i){switch(r){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function j2(r,i){for(var l=r.suspendedLanes,p=r.pingedLanes,x=r.expirationTimes,T=r.pendingLanes;0<T;){var S=31-Ts(T),d=1<<S,$=x[S];$===-1?(!(d&l)||d&p)&&(x[S]=N2(d,i)):$<=i&&(r.expiredLanes|=d),T&=~d}}function Gm(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function u0(){var r=wd;return wd<<=1,!(wd&4194240)&&(wd=64),r}function sm(r){for(var i=[],l=0;31>l;l++)i.push(r);return i}function ph(r,i,l){r.pendingLanes|=i,i!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,i=31-Ts(i),r[i]=l}function V2(r,i){var l=r.pendingLanes&~i;r.pendingLanes=i,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=i,r.mutableReadLanes&=i,r.entangledLanes&=i,i=r.entanglements;var p=r.eventTimes;for(r=r.expirationTimes;0<l;){var x=31-Ts(l),T=1<<x;i[x]=0,p[x]=-1,r[x]=-1,l&=~T}}function jg(r,i){var l=r.entangledLanes|=i;for(r=r.entanglements;l;){var p=31-Ts(l),x=1<<p;x&i|r[p]&i&&(r[p]|=i),l&=~x}}var or=0;function c0(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var h0,Vg,d0,p0,f0,Hm=!1,Sd=[],ea=null,ta=null,ra=null,Jc=new Map,Qc=new Map,Ko=[],U2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sv(r,i){switch(r){case"focusin":case"focusout":ea=null;break;case"dragenter":case"dragleave":ta=null;break;case"mouseover":case"mouseout":ra=null;break;case"pointerover":case"pointerout":Jc.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qc.delete(i.pointerId)}}function Ic(r,i,l,p,x,T){return r===null||r.nativeEvent!==T?(r={blockedOn:i,domEventName:l,eventSystemFlags:p,nativeEvent:T,targetContainers:[x]},i!==null&&(i=mh(i),i!==null&&Vg(i)),r):(r.eventSystemFlags|=p,i=r.targetContainers,x!==null&&i.indexOf(x)===-1&&i.push(x),r)}function $2(r,i,l,p,x){switch(i){case"focusin":return ea=Ic(ea,r,i,l,p,x),!0;case"dragenter":return ta=Ic(ta,r,i,l,p,x),!0;case"mouseover":return ra=Ic(ra,r,i,l,p,x),!0;case"pointerover":var T=x.pointerId;return Jc.set(T,Ic(Jc.get(T)||null,r,i,l,p,x)),!0;case"gotpointercapture":return T=x.pointerId,Qc.set(T,Ic(Qc.get(T)||null,r,i,l,p,x)),!0}return!1}function m0(r){var i=$a(r.target);if(i!==null){var l=el(i);if(l!==null){if(i=l.tag,i===13){if(i=n0(l),i!==null){r.blockedOn=i,f0(r.priority,function(){d0(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Od(r){if(r.blockedOn!==null)return!1;for(var i=r.targetContainers;0<i.length;){var l=Wm(r.domEventName,r.eventSystemFlags,i[0],r.nativeEvent);if(l===null){l=r.nativeEvent;var p=new l.constructor(l.type,l);Um=p,l.target.dispatchEvent(p),Um=null}else return i=mh(l),i!==null&&Vg(i),r.blockedOn=l,!1;i.shift()}return!0}function Tv(r,i,l){Od(r)&&l.delete(i)}function q2(){Hm=!1,ea!==null&&Od(ea)&&(ea=null),ta!==null&&Od(ta)&&(ta=null),ra!==null&&Od(ra)&&(ra=null),Jc.forEach(Tv),Qc.forEach(Tv)}function Pc(r,i){r.blockedOn===i&&(r.blockedOn=null,Hm||(Hm=!0,Oi.unstable_scheduleCallback(Oi.unstable_NormalPriority,q2)))}function eh(r){function i(x){return Pc(x,r)}if(0<Sd.length){Pc(Sd[0],r);for(var l=1;l<Sd.length;l++){var p=Sd[l];p.blockedOn===r&&(p.blockedOn=null)}}for(ea!==null&&Pc(ea,r),ta!==null&&Pc(ta,r),ra!==null&&Pc(ra,r),Jc.forEach(i),Qc.forEach(i),l=0;l<Ko.length;l++)p=Ko[l],p.blockedOn===r&&(p.blockedOn=null);for(;0<Ko.length&&(l=Ko[0],l.blockedOn===null);)m0(l),l.blockedOn===null&&Ko.shift()}var ou=go.ReactCurrentBatchConfig,ip=!0;function Z2(r,i,l,p){var x=or,T=ou.transition;ou.transition=null;try{or=1,Ug(r,i,l,p)}finally{or=x,ou.transition=T}}function G2(r,i,l,p){var x=or,T=ou.transition;ou.transition=null;try{or=4,Ug(r,i,l,p)}finally{or=x,ou.transition=T}}function Ug(r,i,l,p){if(ip){var x=Wm(r,i,l,p);if(x===null)mm(r,i,p,sp,l),Sv(r,p);else if($2(x,r,i,l,p))p.stopPropagation();else if(Sv(r,p),i&4&&-1<U2.indexOf(r)){for(;x!==null;){var T=mh(x);if(T!==null&&h0(T),T=Wm(r,i,l,p),T===null&&mm(r,i,p,sp,l),T===x)break;x=T}x!==null&&p.stopPropagation()}else mm(r,i,p,null,l)}}var sp=null;function Wm(r,i,l,p){if(sp=null,r=Og(p),r=$a(r),r!==null)if(i=el(r),i===null)r=null;else if(l=i.tag,l===13){if(r=n0(i),r!==null)return r;r=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;r=null}else i!==r&&(r=null);return sp=r,null}function g0(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(D2()){case Ng:return 1;case a0:return 4;case rp:case L2:return 16;case l0:return 536870912;default:return 16}default:return 16}}var Jo=null,$g=null,Nd=null;function y0(){if(Nd)return Nd;var r,i=$g,l=i.length,p,x="value"in Jo?Jo.value:Jo.textContent,T=x.length;for(r=0;r<l&&i[r]===x[r];r++);var S=l-r;for(p=1;p<=S&&i[l-p]===x[T-p];p++);return Nd=x.slice(r,1<p?1-p:void 0)}function jd(r){var i=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&i===13&&(r=13)):r=i,r===10&&(r=13),32<=r||r===13?r:0}function Td(){return!0}function kv(){return!1}function ji(r){function i(l,p,x,T,S){this._reactName=l,this._targetInst=x,this.type=p,this.nativeEvent=T,this.target=S,this.currentTarget=null;for(var d in r)r.hasOwnProperty(d)&&(l=r[d],this[d]=l?l(T):T[d]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Td:kv,this.isPropagationStopped=kv,this}return Rr(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Td)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Td)},persist:function(){},isPersistent:Td}),i}var _u={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qg=ji(_u),fh=Rr({},_u,{view:0,detail:0}),H2=ji(fh),om,am,Ac,Cp=Rr({},fh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zg,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ac&&(Ac&&r.type==="mousemove"?(om=r.screenX-Ac.screenX,am=r.screenY-Ac.screenY):am=om=0,Ac=r),om)},movementY:function(r){return"movementY"in r?r.movementY:am}}),Cv=ji(Cp),W2=Rr({},Cp,{dataTransfer:0}),X2=ji(W2),K2=Rr({},fh,{relatedTarget:0}),lm=ji(K2),Y2=Rr({},_u,{animationName:0,elapsedTime:0,pseudoElement:0}),J2=ji(Y2),Q2=Rr({},_u,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),eS=ji(Q2),tS=Rr({},_u,{data:0}),Ev=ji(tS),rS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sS(r){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(r):(r=iS[r])?!!i[r]:!1}function Zg(){return sS}var oS=Rr({},fh,{key:function(r){if(r.key){var i=rS[r.key]||r.key;if(i!=="Unidentified")return i}return r.type==="keypress"?(r=jd(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?nS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zg,charCode:function(r){return r.type==="keypress"?jd(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?jd(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),aS=ji(oS),lS=Rr({},Cp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Iv=ji(lS),uS=Rr({},fh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zg}),cS=ji(uS),hS=Rr({},_u,{propertyName:0,elapsedTime:0,pseudoElement:0}),dS=ji(hS),pS=Rr({},Cp,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),fS=ji(pS),mS=[9,13,27,32],Gg=ho&&"CompositionEvent"in window,Uc=null;ho&&"documentMode"in document&&(Uc=document.documentMode);var gS=ho&&"TextEvent"in window&&!Uc,_0=ho&&(!Gg||Uc&&8<Uc&&11>=Uc),Pv=" ",Av=!1;function v0(r,i){switch(r){case"keyup":return mS.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function x0(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Hl=!1;function yS(r,i){switch(r){case"compositionend":return x0(i);case"keypress":return i.which!==32?null:(Av=!0,Pv);case"textInput":return r=i.data,r===Pv&&Av?null:r;default:return null}}function _S(r,i){if(Hl)return r==="compositionend"||!Gg&&v0(r,i)?(r=y0(),Nd=$g=Jo=null,Hl=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return _0&&i.locale!=="ko"?null:i.data;default:return null}}var vS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mv(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i==="input"?!!vS[r.type]:i==="textarea"}function w0(r,i,l,p){Jx(p),i=op(i,"onChange"),0<i.length&&(l=new qg("onChange","change",null,l,p),r.push({event:l,listeners:i}))}var $c=null,th=null;function xS(r){z0(r,0)}function Ep(r){var i=Kl(r);if(Zx(i))return r}function wS(r,i){if(r==="change")return i}var b0=!1;if(ho){var um;if(ho){var cm="oninput"in document;if(!cm){var zv=document.createElement("div");zv.setAttribute("oninput","return;"),cm=typeof zv.oninput=="function"}um=cm}else um=!1;b0=um&&(!document.documentMode||9<document.documentMode)}function Dv(){$c&&($c.detachEvent("onpropertychange",S0),th=$c=null)}function S0(r){if(r.propertyName==="value"&&Ep(th)){var i=[];w0(i,th,r,Og(r)),r0(xS,i)}}function bS(r,i,l){r==="focusin"?(Dv(),$c=i,th=l,$c.attachEvent("onpropertychange",S0)):r==="focusout"&&Dv()}function SS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Ep(th)}function TS(r,i){if(r==="click")return Ep(i)}function kS(r,i){if(r==="input"||r==="change")return Ep(i)}function CS(r,i){return r===i&&(r!==0||1/r===1/i)||r!==r&&i!==i}var Cs=typeof Object.is=="function"?Object.is:CS;function rh(r,i){if(Cs(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;var l=Object.keys(r),p=Object.keys(i);if(l.length!==p.length)return!1;for(p=0;p<l.length;p++){var x=l[p];if(!Am.call(i,x)||!Cs(r[x],i[x]))return!1}return!0}function Lv(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Rv(r,i){var l=Lv(r);r=0;for(var p;l;){if(l.nodeType===3){if(p=r+l.textContent.length,r<=i&&p>=i)return{node:l,offset:i-r};r=p}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Lv(l)}}function T0(r,i){return r&&i?r===i?!0:r&&r.nodeType===3?!1:i&&i.nodeType===3?T0(r,i.parentNode):"contains"in r?r.contains(i):r.compareDocumentPosition?!!(r.compareDocumentPosition(i)&16):!1:!1}function k0(){for(var r=window,i=Qd();i instanceof r.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)r=i.contentWindow;else break;i=Qd(r.document)}return i}function Hg(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i&&(i==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||i==="textarea"||r.contentEditable==="true")}function ES(r){var i=k0(),l=r.focusedElem,p=r.selectionRange;if(i!==l&&l&&l.ownerDocument&&T0(l.ownerDocument.documentElement,l)){if(p!==null&&Hg(l)){if(i=p.start,r=p.end,r===void 0&&(r=i),"selectionStart"in l)l.selectionStart=i,l.selectionEnd=Math.min(r,l.value.length);else if(r=(i=l.ownerDocument||document)&&i.defaultView||window,r.getSelection){r=r.getSelection();var x=l.textContent.length,T=Math.min(p.start,x);p=p.end===void 0?T:Math.min(p.end,x),!r.extend&&T>p&&(x=p,p=T,T=x),x=Rv(l,T);var S=Rv(l,p);x&&S&&(r.rangeCount!==1||r.anchorNode!==x.node||r.anchorOffset!==x.offset||r.focusNode!==S.node||r.focusOffset!==S.offset)&&(i=i.createRange(),i.setStart(x.node,x.offset),r.removeAllRanges(),T>p?(r.addRange(i),r.extend(S.node,S.offset)):(i.setEnd(S.node,S.offset),r.addRange(i)))}}for(i=[],r=l;r=r.parentNode;)r.nodeType===1&&i.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<i.length;l++)r=i[l],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var IS=ho&&"documentMode"in document&&11>=document.documentMode,Wl=null,Xm=null,qc=null,Km=!1;function Fv(r,i,l){var p=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Km||Wl==null||Wl!==Qd(p)||(p=Wl,"selectionStart"in p&&Hg(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),qc&&rh(qc,p)||(qc=p,p=op(Xm,"onSelect"),0<p.length&&(i=new qg("onSelect","select",null,i,l),r.push({event:i,listeners:p}),i.target=Wl)))}function kd(r,i){var l={};return l[r.toLowerCase()]=i.toLowerCase(),l["Webkit"+r]="webkit"+i,l["Moz"+r]="moz"+i,l}var Xl={animationend:kd("Animation","AnimationEnd"),animationiteration:kd("Animation","AnimationIteration"),animationstart:kd("Animation","AnimationStart"),transitionend:kd("Transition","TransitionEnd")},hm={},C0={};ho&&(C0=document.createElement("div").style,"AnimationEvent"in window||(delete Xl.animationend.animation,delete Xl.animationiteration.animation,delete Xl.animationstart.animation),"TransitionEvent"in window||delete Xl.transitionend.transition);function Ip(r){if(hm[r])return hm[r];if(!Xl[r])return r;var i=Xl[r],l;for(l in i)if(i.hasOwnProperty(l)&&l in C0)return hm[r]=i[l];return r}var E0=Ip("animationend"),I0=Ip("animationiteration"),P0=Ip("animationstart"),A0=Ip("transitionend"),M0=new Map,Bv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ha(r,i){M0.set(r,i),Qa(i,[r])}for(var dm=0;dm<Bv.length;dm++){var pm=Bv[dm],PS=pm.toLowerCase(),AS=pm[0].toUpperCase()+pm.slice(1);ha(PS,"on"+AS)}ha(E0,"onAnimationEnd");ha(I0,"onAnimationIteration");ha(P0,"onAnimationStart");ha("dblclick","onDoubleClick");ha("focusin","onFocus");ha("focusout","onBlur");ha(A0,"onTransitionEnd");cu("onMouseEnter",["mouseout","mouseover"]);cu("onMouseLeave",["mouseout","mouseover"]);cu("onPointerEnter",["pointerout","pointerover"]);cu("onPointerLeave",["pointerout","pointerover"]);Qa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Qa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Qa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Qa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Qa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Qa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),MS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oc));function Ov(r,i,l){var p=r.type||"unknown-event";r.currentTarget=l,P2(p,i,void 0,r),r.currentTarget=null}function z0(r,i){i=(i&4)!==0;for(var l=0;l<r.length;l++){var p=r[l],x=p.event;p=p.listeners;e:{var T=void 0;if(i)for(var S=p.length-1;0<=S;S--){var d=p[S],$=d.instance,ne=d.currentTarget;if(d=d.listener,$!==T&&x.isPropagationStopped())break e;Ov(x,d,ne),T=$}else for(S=0;S<p.length;S++){if(d=p[S],$=d.instance,ne=d.currentTarget,d=d.listener,$!==T&&x.isPropagationStopped())break e;Ov(x,d,ne),T=$}}}if(tp)throw r=Zm,tp=!1,Zm=null,r}function br(r,i){var l=i[tg];l===void 0&&(l=i[tg]=new Set);var p=r+"__bubble";l.has(p)||(D0(i,r,2,!1),l.add(p))}function fm(r,i,l){var p=0;i&&(p|=4),D0(l,r,p,i)}var Cd="_reactListening"+Math.random().toString(36).slice(2);function nh(r){if(!r[Cd]){r[Cd]=!0,jx.forEach(function(l){l!=="selectionchange"&&(MS.has(l)||fm(l,!1,r),fm(l,!0,r))});var i=r.nodeType===9?r:r.ownerDocument;i===null||i[Cd]||(i[Cd]=!0,fm("selectionchange",!1,i))}}function D0(r,i,l,p){switch(g0(i)){case 1:var x=Z2;break;case 4:x=G2;break;default:x=Ug}l=x.bind(null,i,l,r),x=void 0,!qm||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(x=!0),p?x!==void 0?r.addEventListener(i,l,{capture:!0,passive:x}):r.addEventListener(i,l,!0):x!==void 0?r.addEventListener(i,l,{passive:x}):r.addEventListener(i,l,!1)}function mm(r,i,l,p,x){var T=p;if(!(i&1)&&!(i&2)&&p!==null)e:for(;;){if(p===null)return;var S=p.tag;if(S===3||S===4){var d=p.stateNode.containerInfo;if(d===x||d.nodeType===8&&d.parentNode===x)break;if(S===4)for(S=p.return;S!==null;){var $=S.tag;if(($===3||$===4)&&($=S.stateNode.containerInfo,$===x||$.nodeType===8&&$.parentNode===x))return;S=S.return}for(;d!==null;){if(S=$a(d),S===null)return;if($=S.tag,$===5||$===6){p=T=S;continue e}d=d.parentNode}}p=p.return}r0(function(){var ne=T,ge=Og(l),Q=[];e:{var V=M0.get(r);if(V!==void 0){var Ce=qg,Ee=r;switch(r){case"keypress":if(jd(l)===0)break e;case"keydown":case"keyup":Ce=aS;break;case"focusin":Ee="focus",Ce=lm;break;case"focusout":Ee="blur",Ce=lm;break;case"beforeblur":case"afterblur":Ce=lm;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ce=Cv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ce=X2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ce=cS;break;case E0:case I0:case P0:Ce=J2;break;case A0:Ce=dS;break;case"scroll":Ce=H2;break;case"wheel":Ce=fS;break;case"copy":case"cut":case"paste":Ce=eS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ce=Iv}var Me=(i&4)!==0,pt=!Me&&r==="scroll",oe=Me?V!==null?V+"Capture":null:V;Me=[];for(var ie=ne,de;ie!==null;){de=ie;var Pe=de.stateNode;if(de.tag===5&&Pe!==null&&(de=Pe,oe!==null&&(Pe=Yc(ie,oe),Pe!=null&&Me.push(ih(ie,Pe,de)))),pt)break;ie=ie.return}0<Me.length&&(V=new Ce(V,Ee,null,l,ge),Q.push({event:V,listeners:Me}))}}if(!(i&7)){e:{if(V=r==="mouseover"||r==="pointerover",Ce=r==="mouseout"||r==="pointerout",V&&l!==Um&&(Ee=l.relatedTarget||l.fromElement)&&($a(Ee)||Ee[po]))break e;if((Ce||V)&&(V=ge.window===ge?ge:(V=ge.ownerDocument)?V.defaultView||V.parentWindow:window,Ce?(Ee=l.relatedTarget||l.toElement,Ce=ne,Ee=Ee?$a(Ee):null,Ee!==null&&(pt=el(Ee),Ee!==pt||Ee.tag!==5&&Ee.tag!==6)&&(Ee=null)):(Ce=null,Ee=ne),Ce!==Ee)){if(Me=Cv,Pe="onMouseLeave",oe="onMouseEnter",ie="mouse",(r==="pointerout"||r==="pointerover")&&(Me=Iv,Pe="onPointerLeave",oe="onPointerEnter",ie="pointer"),pt=Ce==null?V:Kl(Ce),de=Ee==null?V:Kl(Ee),V=new Me(Pe,ie+"leave",Ce,l,ge),V.target=pt,V.relatedTarget=de,Pe=null,$a(ge)===ne&&(Me=new Me(oe,ie+"enter",Ee,l,ge),Me.target=de,Me.relatedTarget=pt,Pe=Me),pt=Pe,Ce&&Ee)t:{for(Me=Ce,oe=Ee,ie=0,de=Me;de;de=ql(de))ie++;for(de=0,Pe=oe;Pe;Pe=ql(Pe))de++;for(;0<ie-de;)Me=ql(Me),ie--;for(;0<de-ie;)oe=ql(oe),de--;for(;ie--;){if(Me===oe||oe!==null&&Me===oe.alternate)break t;Me=ql(Me),oe=ql(oe)}Me=null}else Me=null;Ce!==null&&Nv(Q,V,Ce,Me,!1),Ee!==null&&pt!==null&&Nv(Q,pt,Ee,Me,!0)}}e:{if(V=ne?Kl(ne):window,Ce=V.nodeName&&V.nodeName.toLowerCase(),Ce==="select"||Ce==="input"&&V.type==="file")var qe=wS;else if(Mv(V))if(b0)qe=kS;else{qe=SS;var Qe=bS}else(Ce=V.nodeName)&&Ce.toLowerCase()==="input"&&(V.type==="checkbox"||V.type==="radio")&&(qe=TS);if(qe&&(qe=qe(r,ne))){w0(Q,qe,l,ge);break e}Qe&&Qe(r,V,ne),r==="focusout"&&(Qe=V._wrapperState)&&Qe.controlled&&V.type==="number"&&Bm(V,"number",V.value)}switch(Qe=ne?Kl(ne):window,r){case"focusin":(Mv(Qe)||Qe.contentEditable==="true")&&(Wl=Qe,Xm=ne,qc=null);break;case"focusout":qc=Xm=Wl=null;break;case"mousedown":Km=!0;break;case"contextmenu":case"mouseup":case"dragend":Km=!1,Fv(Q,l,ge);break;case"selectionchange":if(IS)break;case"keydown":case"keyup":Fv(Q,l,ge)}var Xe;if(Gg)e:{switch(r){case"compositionstart":var Le="onCompositionStart";break e;case"compositionend":Le="onCompositionEnd";break e;case"compositionupdate":Le="onCompositionUpdate";break e}Le=void 0}else Hl?v0(r,l)&&(Le="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(Le="onCompositionStart");Le&&(_0&&l.locale!=="ko"&&(Hl||Le!=="onCompositionStart"?Le==="onCompositionEnd"&&Hl&&(Xe=y0()):(Jo=ge,$g="value"in Jo?Jo.value:Jo.textContent,Hl=!0)),Qe=op(ne,Le),0<Qe.length&&(Le=new Ev(Le,r,null,l,ge),Q.push({event:Le,listeners:Qe}),Xe?Le.data=Xe:(Xe=x0(l),Xe!==null&&(Le.data=Xe)))),(Xe=gS?yS(r,l):_S(r,l))&&(ne=op(ne,"onBeforeInput"),0<ne.length&&(ge=new Ev("onBeforeInput","beforeinput",null,l,ge),Q.push({event:ge,listeners:ne}),ge.data=Xe))}z0(Q,i)})}function ih(r,i,l){return{instance:r,listener:i,currentTarget:l}}function op(r,i){for(var l=i+"Capture",p=[];r!==null;){var x=r,T=x.stateNode;x.tag===5&&T!==null&&(x=T,T=Yc(r,l),T!=null&&p.unshift(ih(r,T,x)),T=Yc(r,i),T!=null&&p.push(ih(r,T,x))),r=r.return}return p}function ql(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Nv(r,i,l,p,x){for(var T=i._reactName,S=[];l!==null&&l!==p;){var d=l,$=d.alternate,ne=d.stateNode;if($!==null&&$===p)break;d.tag===5&&ne!==null&&(d=ne,x?($=Yc(l,T),$!=null&&S.unshift(ih(l,$,d))):x||($=Yc(l,T),$!=null&&S.push(ih(l,$,d)))),l=l.return}S.length!==0&&r.push({event:i,listeners:S})}var zS=/\r\n?/g,DS=/\u0000|\uFFFD/g;function jv(r){return(typeof r=="string"?r:""+r).replace(zS,`
`).replace(DS,"")}function Ed(r,i,l){if(i=jv(i),jv(r)!==i&&l)throw Error(Be(425))}function ap(){}var Ym=null,Jm=null;function Qm(r,i){return r==="textarea"||r==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var eg=typeof setTimeout=="function"?setTimeout:void 0,LS=typeof clearTimeout=="function"?clearTimeout:void 0,Vv=typeof Promise=="function"?Promise:void 0,RS=typeof queueMicrotask=="function"?queueMicrotask:typeof Vv<"u"?function(r){return Vv.resolve(null).then(r).catch(FS)}:eg;function FS(r){setTimeout(function(){throw r})}function gm(r,i){var l=i,p=0;do{var x=l.nextSibling;if(r.removeChild(l),x&&x.nodeType===8)if(l=x.data,l==="/$"){if(p===0){r.removeChild(x),eh(i);return}p--}else l!=="$"&&l!=="$?"&&l!=="$!"||p++;l=x}while(l);eh(i)}function na(r){for(;r!=null;r=r.nextSibling){var i=r.nodeType;if(i===1||i===3)break;if(i===8){if(i=r.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return r}function Uv(r){r=r.previousSibling;for(var i=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"){if(i===0)return r;i--}else l==="/$"&&i++}r=r.previousSibling}return null}var vu=Math.random().toString(36).slice(2),Ns="__reactFiber$"+vu,sh="__reactProps$"+vu,po="__reactContainer$"+vu,tg="__reactEvents$"+vu,BS="__reactListeners$"+vu,OS="__reactHandles$"+vu;function $a(r){var i=r[Ns];if(i)return i;for(var l=r.parentNode;l;){if(i=l[po]||l[Ns]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(r=Uv(r);r!==null;){if(l=r[Ns])return l;r=Uv(r)}return i}r=l,l=r.parentNode}return null}function mh(r){return r=r[Ns]||r[po],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Kl(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Be(33))}function Pp(r){return r[sh]||null}var rg=[],Yl=-1;function da(r){return{current:r}}function Sr(r){0>Yl||(r.current=rg[Yl],rg[Yl]=null,Yl--)}function _r(r,i){Yl++,rg[Yl]=r.current,r.current=i}var ca={},Wn=da(ca),xi=da(!1),Wa=ca;function hu(r,i){var l=r.type.contextTypes;if(!l)return ca;var p=r.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===i)return p.__reactInternalMemoizedMaskedChildContext;var x={},T;for(T in l)x[T]=i[T];return p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=x),x}function wi(r){return r=r.childContextTypes,r!=null}function lp(){Sr(xi),Sr(Wn)}function $v(r,i,l){if(Wn.current!==ca)throw Error(Be(168));_r(Wn,i),_r(xi,l)}function L0(r,i,l){var p=r.stateNode;if(i=i.childContextTypes,typeof p.getChildContext!="function")return l;p=p.getChildContext();for(var x in p)if(!(x in i))throw Error(Be(108,b2(r)||"Unknown",x));return Rr({},l,p)}function up(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||ca,Wa=Wn.current,_r(Wn,r),_r(xi,xi.current),!0}function qv(r,i,l){var p=r.stateNode;if(!p)throw Error(Be(169));l?(r=L0(r,i,Wa),p.__reactInternalMemoizedMergedChildContext=r,Sr(xi),Sr(Wn),_r(Wn,r)):Sr(xi),_r(xi,l)}var oo=null,Ap=!1,ym=!1;function R0(r){oo===null?oo=[r]:oo.push(r)}function NS(r){Ap=!0,R0(r)}function pa(){if(!ym&&oo!==null){ym=!0;var r=0,i=or;try{var l=oo;for(or=1;r<l.length;r++){var p=l[r];do p=p(!0);while(p!==null)}oo=null,Ap=!1}catch(x){throw oo!==null&&(oo=oo.slice(r+1)),o0(Ng,pa),x}finally{or=i,ym=!1}}return null}var Jl=[],Ql=0,cp=null,hp=0,Yi=[],Ji=0,Xa=null,lo=1,uo="";function Va(r,i){Jl[Ql++]=hp,Jl[Ql++]=cp,cp=r,hp=i}function F0(r,i,l){Yi[Ji++]=lo,Yi[Ji++]=uo,Yi[Ji++]=Xa,Xa=r;var p=lo;r=uo;var x=32-Ts(p)-1;p&=~(1<<x),l+=1;var T=32-Ts(i)+x;if(30<T){var S=x-x%5;T=(p&(1<<S)-1).toString(32),p>>=S,x-=S,lo=1<<32-Ts(i)+x|l<<x|p,uo=T+r}else lo=1<<T|l<<x|p,uo=r}function Wg(r){r.return!==null&&(Va(r,1),F0(r,1,0))}function Xg(r){for(;r===cp;)cp=Jl[--Ql],Jl[Ql]=null,hp=Jl[--Ql],Jl[Ql]=null;for(;r===Xa;)Xa=Yi[--Ji],Yi[Ji]=null,uo=Yi[--Ji],Yi[Ji]=null,lo=Yi[--Ji],Yi[Ji]=null}var Bi=null,Fi=null,Ir=!1,Ss=null;function B0(r,i){var l=es(5,null,null,0);l.elementType="DELETED",l.stateNode=i,l.return=r,i=r.deletions,i===null?(r.deletions=[l],r.flags|=16):i.push(l)}function Zv(r,i){switch(r.tag){case 5:var l=r.type;return i=i.nodeType!==1||l.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(r.stateNode=i,Bi=r,Fi=na(i.firstChild),!0):!1;case 6:return i=r.pendingProps===""||i.nodeType!==3?null:i,i!==null?(r.stateNode=i,Bi=r,Fi=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(l=Xa!==null?{id:lo,overflow:uo}:null,r.memoizedState={dehydrated:i,treeContext:l,retryLane:1073741824},l=es(18,null,null,0),l.stateNode=i,l.return=r,r.child=l,Bi=r,Fi=null,!0):!1;default:return!1}}function ng(r){return(r.mode&1)!==0&&(r.flags&128)===0}function ig(r){if(Ir){var i=Fi;if(i){var l=i;if(!Zv(r,i)){if(ng(r))throw Error(Be(418));i=na(l.nextSibling);var p=Bi;i&&Zv(r,i)?B0(p,l):(r.flags=r.flags&-4097|2,Ir=!1,Bi=r)}}else{if(ng(r))throw Error(Be(418));r.flags=r.flags&-4097|2,Ir=!1,Bi=r}}}function Gv(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Bi=r}function Id(r){if(r!==Bi)return!1;if(!Ir)return Gv(r),Ir=!0,!1;var i;if((i=r.tag!==3)&&!(i=r.tag!==5)&&(i=r.type,i=i!=="head"&&i!=="body"&&!Qm(r.type,r.memoizedProps)),i&&(i=Fi)){if(ng(r))throw O0(),Error(Be(418));for(;i;)B0(r,i),i=na(i.nextSibling)}if(Gv(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Be(317));e:{for(r=r.nextSibling,i=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"){if(i===0){Fi=na(r.nextSibling);break e}i--}else l!=="$"&&l!=="$!"&&l!=="$?"||i++}r=r.nextSibling}Fi=null}}else Fi=Bi?na(r.stateNode.nextSibling):null;return!0}function O0(){for(var r=Fi;r;)r=na(r.nextSibling)}function du(){Fi=Bi=null,Ir=!1}function Kg(r){Ss===null?Ss=[r]:Ss.push(r)}var jS=go.ReactCurrentBatchConfig;function Mc(r,i,l){if(r=l.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Be(309));var p=l.stateNode}if(!p)throw Error(Be(147,r));var x=p,T=""+r;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===T?i.ref:(i=function(S){var d=x.refs;S===null?delete d[T]:d[T]=S},i._stringRef=T,i)}if(typeof r!="string")throw Error(Be(284));if(!l._owner)throw Error(Be(290,r))}return r}function Pd(r,i){throw r=Object.prototype.toString.call(i),Error(Be(31,r==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":r))}function Hv(r){var i=r._init;return i(r._payload)}function N0(r){function i(oe,ie){if(r){var de=oe.deletions;de===null?(oe.deletions=[ie],oe.flags|=16):de.push(ie)}}function l(oe,ie){if(!r)return null;for(;ie!==null;)i(oe,ie),ie=ie.sibling;return null}function p(oe,ie){for(oe=new Map;ie!==null;)ie.key!==null?oe.set(ie.key,ie):oe.set(ie.index,ie),ie=ie.sibling;return oe}function x(oe,ie){return oe=aa(oe,ie),oe.index=0,oe.sibling=null,oe}function T(oe,ie,de){return oe.index=de,r?(de=oe.alternate,de!==null?(de=de.index,de<ie?(oe.flags|=2,ie):de):(oe.flags|=2,ie)):(oe.flags|=1048576,ie)}function S(oe){return r&&oe.alternate===null&&(oe.flags|=2),oe}function d(oe,ie,de,Pe){return ie===null||ie.tag!==6?(ie=Tm(de,oe.mode,Pe),ie.return=oe,ie):(ie=x(ie,de),ie.return=oe,ie)}function $(oe,ie,de,Pe){var qe=de.type;return qe===Gl?ge(oe,ie,de.props.children,Pe,de.key):ie!==null&&(ie.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===Wo&&Hv(qe)===ie.type)?(Pe=x(ie,de.props),Pe.ref=Mc(oe,ie,de),Pe.return=oe,Pe):(Pe=Hd(de.type,de.key,de.props,null,oe.mode,Pe),Pe.ref=Mc(oe,ie,de),Pe.return=oe,Pe)}function ne(oe,ie,de,Pe){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==de.containerInfo||ie.stateNode.implementation!==de.implementation?(ie=km(de,oe.mode,Pe),ie.return=oe,ie):(ie=x(ie,de.children||[]),ie.return=oe,ie)}function ge(oe,ie,de,Pe,qe){return ie===null||ie.tag!==7?(ie=Ha(de,oe.mode,Pe,qe),ie.return=oe,ie):(ie=x(ie,de),ie.return=oe,ie)}function Q(oe,ie,de){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return ie=Tm(""+ie,oe.mode,de),ie.return=oe,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case _d:return de=Hd(ie.type,ie.key,ie.props,null,oe.mode,de),de.ref=Mc(oe,null,ie),de.return=oe,de;case Zl:return ie=km(ie,oe.mode,de),ie.return=oe,ie;case Wo:var Pe=ie._init;return Q(oe,Pe(ie._payload),de)}if(Fc(ie)||Cc(ie))return ie=Ha(ie,oe.mode,de,null),ie.return=oe,ie;Pd(oe,ie)}return null}function V(oe,ie,de,Pe){var qe=ie!==null?ie.key:null;if(typeof de=="string"&&de!==""||typeof de=="number")return qe!==null?null:d(oe,ie,""+de,Pe);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case _d:return de.key===qe?$(oe,ie,de,Pe):null;case Zl:return de.key===qe?ne(oe,ie,de,Pe):null;case Wo:return qe=de._init,V(oe,ie,qe(de._payload),Pe)}if(Fc(de)||Cc(de))return qe!==null?null:ge(oe,ie,de,Pe,null);Pd(oe,de)}return null}function Ce(oe,ie,de,Pe,qe){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return oe=oe.get(de)||null,d(ie,oe,""+Pe,qe);if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case _d:return oe=oe.get(Pe.key===null?de:Pe.key)||null,$(ie,oe,Pe,qe);case Zl:return oe=oe.get(Pe.key===null?de:Pe.key)||null,ne(ie,oe,Pe,qe);case Wo:var Qe=Pe._init;return Ce(oe,ie,de,Qe(Pe._payload),qe)}if(Fc(Pe)||Cc(Pe))return oe=oe.get(de)||null,ge(ie,oe,Pe,qe,null);Pd(ie,Pe)}return null}function Ee(oe,ie,de,Pe){for(var qe=null,Qe=null,Xe=ie,Le=ie=0,it=null;Xe!==null&&Le<de.length;Le++){Xe.index>Le?(it=Xe,Xe=null):it=Xe.sibling;var Ge=V(oe,Xe,de[Le],Pe);if(Ge===null){Xe===null&&(Xe=it);break}r&&Xe&&Ge.alternate===null&&i(oe,Xe),ie=T(Ge,ie,Le),Qe===null?qe=Ge:Qe.sibling=Ge,Qe=Ge,Xe=it}if(Le===de.length)return l(oe,Xe),Ir&&Va(oe,Le),qe;if(Xe===null){for(;Le<de.length;Le++)Xe=Q(oe,de[Le],Pe),Xe!==null&&(ie=T(Xe,ie,Le),Qe===null?qe=Xe:Qe.sibling=Xe,Qe=Xe);return Ir&&Va(oe,Le),qe}for(Xe=p(oe,Xe);Le<de.length;Le++)it=Ce(Xe,oe,Le,de[Le],Pe),it!==null&&(r&&it.alternate!==null&&Xe.delete(it.key===null?Le:it.key),ie=T(it,ie,Le),Qe===null?qe=it:Qe.sibling=it,Qe=it);return r&&Xe.forEach(function(Ye){return i(oe,Ye)}),Ir&&Va(oe,Le),qe}function Me(oe,ie,de,Pe){var qe=Cc(de);if(typeof qe!="function")throw Error(Be(150));if(de=qe.call(de),de==null)throw Error(Be(151));for(var Qe=qe=null,Xe=ie,Le=ie=0,it=null,Ge=de.next();Xe!==null&&!Ge.done;Le++,Ge=de.next()){Xe.index>Le?(it=Xe,Xe=null):it=Xe.sibling;var Ye=V(oe,Xe,Ge.value,Pe);if(Ye===null){Xe===null&&(Xe=it);break}r&&Xe&&Ye.alternate===null&&i(oe,Xe),ie=T(Ye,ie,Le),Qe===null?qe=Ye:Qe.sibling=Ye,Qe=Ye,Xe=it}if(Ge.done)return l(oe,Xe),Ir&&Va(oe,Le),qe;if(Xe===null){for(;!Ge.done;Le++,Ge=de.next())Ge=Q(oe,Ge.value,Pe),Ge!==null&&(ie=T(Ge,ie,Le),Qe===null?qe=Ge:Qe.sibling=Ge,Qe=Ge);return Ir&&Va(oe,Le),qe}for(Xe=p(oe,Xe);!Ge.done;Le++,Ge=de.next())Ge=Ce(Xe,oe,Le,Ge.value,Pe),Ge!==null&&(r&&Ge.alternate!==null&&Xe.delete(Ge.key===null?Le:Ge.key),ie=T(Ge,ie,Le),Qe===null?qe=Ge:Qe.sibling=Ge,Qe=Ge);return r&&Xe.forEach(function(Kt){return i(oe,Kt)}),Ir&&Va(oe,Le),qe}function pt(oe,ie,de,Pe){if(typeof de=="object"&&de!==null&&de.type===Gl&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case _d:e:{for(var qe=de.key,Qe=ie;Qe!==null;){if(Qe.key===qe){if(qe=de.type,qe===Gl){if(Qe.tag===7){l(oe,Qe.sibling),ie=x(Qe,de.props.children),ie.return=oe,oe=ie;break e}}else if(Qe.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===Wo&&Hv(qe)===Qe.type){l(oe,Qe.sibling),ie=x(Qe,de.props),ie.ref=Mc(oe,Qe,de),ie.return=oe,oe=ie;break e}l(oe,Qe);break}else i(oe,Qe);Qe=Qe.sibling}de.type===Gl?(ie=Ha(de.props.children,oe.mode,Pe,de.key),ie.return=oe,oe=ie):(Pe=Hd(de.type,de.key,de.props,null,oe.mode,Pe),Pe.ref=Mc(oe,ie,de),Pe.return=oe,oe=Pe)}return S(oe);case Zl:e:{for(Qe=de.key;ie!==null;){if(ie.key===Qe)if(ie.tag===4&&ie.stateNode.containerInfo===de.containerInfo&&ie.stateNode.implementation===de.implementation){l(oe,ie.sibling),ie=x(ie,de.children||[]),ie.return=oe,oe=ie;break e}else{l(oe,ie);break}else i(oe,ie);ie=ie.sibling}ie=km(de,oe.mode,Pe),ie.return=oe,oe=ie}return S(oe);case Wo:return Qe=de._init,pt(oe,ie,Qe(de._payload),Pe)}if(Fc(de))return Ee(oe,ie,de,Pe);if(Cc(de))return Me(oe,ie,de,Pe);Pd(oe,de)}return typeof de=="string"&&de!==""||typeof de=="number"?(de=""+de,ie!==null&&ie.tag===6?(l(oe,ie.sibling),ie=x(ie,de),ie.return=oe,oe=ie):(l(oe,ie),ie=Tm(de,oe.mode,Pe),ie.return=oe,oe=ie),S(oe)):l(oe,ie)}return pt}var pu=N0(!0),j0=N0(!1),dp=da(null),pp=null,eu=null,Yg=null;function Jg(){Yg=eu=pp=null}function Qg(r){var i=dp.current;Sr(dp),r._currentValue=i}function sg(r,i,l){for(;r!==null;){var p=r.alternate;if((r.childLanes&i)!==i?(r.childLanes|=i,p!==null&&(p.childLanes|=i)):p!==null&&(p.childLanes&i)!==i&&(p.childLanes|=i),r===l)break;r=r.return}}function au(r,i){pp=r,Yg=eu=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&i&&(vi=!0),r.firstContext=null)}function rs(r){var i=r._currentValue;if(Yg!==r)if(r={context:r,memoizedValue:i,next:null},eu===null){if(pp===null)throw Error(Be(308));eu=r,pp.dependencies={lanes:0,firstContext:r}}else eu=eu.next=r;return i}var qa=null;function ey(r){qa===null?qa=[r]:qa.push(r)}function V0(r,i,l,p){var x=i.interleaved;return x===null?(l.next=l,ey(i)):(l.next=x.next,x.next=l),i.interleaved=l,fo(r,p)}function fo(r,i){r.lanes|=i;var l=r.alternate;for(l!==null&&(l.lanes|=i),l=r,r=r.return;r!==null;)r.childLanes|=i,l=r.alternate,l!==null&&(l.childLanes|=i),l=r,r=r.return;return l.tag===3?l.stateNode:null}var Xo=!1;function ty(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function U0(r,i){r=r.updateQueue,i.updateQueue===r&&(i.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function co(r,i){return{eventTime:r,lane:i,tag:0,payload:null,callback:null,next:null}}function ia(r,i,l){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,Xt&2){var x=p.pending;return x===null?i.next=i:(i.next=x.next,x.next=i),p.pending=i,fo(r,l)}return x=p.interleaved,x===null?(i.next=i,ey(p)):(i.next=x.next,x.next=i),p.interleaved=i,fo(r,l)}function Vd(r,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194240)!==0)){var p=i.lanes;p&=r.pendingLanes,l|=p,i.lanes=l,jg(r,l)}}function Wv(r,i){var l=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,l===p)){var x=null,T=null;if(l=l.firstBaseUpdate,l!==null){do{var S={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};T===null?x=T=S:T=T.next=S,l=l.next}while(l!==null);T===null?x=T=i:T=T.next=i}else x=T=i;l={baseState:p.baseState,firstBaseUpdate:x,lastBaseUpdate:T,shared:p.shared,effects:p.effects},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=i:r.next=i,l.lastBaseUpdate=i}function fp(r,i,l,p){var x=r.updateQueue;Xo=!1;var T=x.firstBaseUpdate,S=x.lastBaseUpdate,d=x.shared.pending;if(d!==null){x.shared.pending=null;var $=d,ne=$.next;$.next=null,S===null?T=ne:S.next=ne,S=$;var ge=r.alternate;ge!==null&&(ge=ge.updateQueue,d=ge.lastBaseUpdate,d!==S&&(d===null?ge.firstBaseUpdate=ne:d.next=ne,ge.lastBaseUpdate=$))}if(T!==null){var Q=x.baseState;S=0,ge=ne=$=null,d=T;do{var V=d.lane,Ce=d.eventTime;if((p&V)===V){ge!==null&&(ge=ge.next={eventTime:Ce,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Ee=r,Me=d;switch(V=i,Ce=l,Me.tag){case 1:if(Ee=Me.payload,typeof Ee=="function"){Q=Ee.call(Ce,Q,V);break e}Q=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=Me.payload,V=typeof Ee=="function"?Ee.call(Ce,Q,V):Ee,V==null)break e;Q=Rr({},Q,V);break e;case 2:Xo=!0}}d.callback!==null&&d.lane!==0&&(r.flags|=64,V=x.effects,V===null?x.effects=[d]:V.push(d))}else Ce={eventTime:Ce,lane:V,tag:d.tag,payload:d.payload,callback:d.callback,next:null},ge===null?(ne=ge=Ce,$=Q):ge=ge.next=Ce,S|=V;if(d=d.next,d===null){if(d=x.shared.pending,d===null)break;V=d,d=V.next,V.next=null,x.lastBaseUpdate=V,x.shared.pending=null}}while(!0);if(ge===null&&($=Q),x.baseState=$,x.firstBaseUpdate=ne,x.lastBaseUpdate=ge,i=x.shared.interleaved,i!==null){x=i;do S|=x.lane,x=x.next;while(x!==i)}else T===null&&(x.shared.lanes=0);Ya|=S,r.lanes=S,r.memoizedState=Q}}function Xv(r,i,l){if(r=i.effects,i.effects=null,r!==null)for(i=0;i<r.length;i++){var p=r[i],x=p.callback;if(x!==null){if(p.callback=null,p=l,typeof x!="function")throw Error(Be(191,x));x.call(p)}}}var gh={},Vs=da(gh),oh=da(gh),ah=da(gh);function Za(r){if(r===gh)throw Error(Be(174));return r}function ry(r,i){switch(_r(ah,i),_r(oh,r),_r(Vs,gh),r=i.nodeType,r){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Nm(null,"");break;default:r=r===8?i.parentNode:i,i=r.namespaceURI||null,r=r.tagName,i=Nm(i,r)}Sr(Vs),_r(Vs,i)}function fu(){Sr(Vs),Sr(oh),Sr(ah)}function $0(r){Za(ah.current);var i=Za(Vs.current),l=Nm(i,r.type);i!==l&&(_r(oh,r),_r(Vs,l))}function ny(r){oh.current===r&&(Sr(Vs),Sr(oh))}var Dr=da(0);function mp(r){for(var i=r;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var _m=[];function iy(){for(var r=0;r<_m.length;r++)_m[r]._workInProgressVersionPrimary=null;_m.length=0}var Ud=go.ReactCurrentDispatcher,vm=go.ReactCurrentBatchConfig,Ka=0,Lr=null,sn=null,wn=null,gp=!1,Zc=!1,lh=0,VS=0;function Zn(){throw Error(Be(321))}function sy(r,i){if(i===null)return!1;for(var l=0;l<i.length&&l<r.length;l++)if(!Cs(r[l],i[l]))return!1;return!0}function oy(r,i,l,p,x,T){if(Ka=T,Lr=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Ud.current=r===null||r.memoizedState===null?ZS:GS,r=l(p,x),Zc){T=0;do{if(Zc=!1,lh=0,25<=T)throw Error(Be(301));T+=1,wn=sn=null,i.updateQueue=null,Ud.current=HS,r=l(p,x)}while(Zc)}if(Ud.current=yp,i=sn!==null&&sn.next!==null,Ka=0,wn=sn=Lr=null,gp=!1,i)throw Error(Be(300));return r}function ay(){var r=lh!==0;return lh=0,r}function Os(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wn===null?Lr.memoizedState=wn=r:wn=wn.next=r,wn}function ns(){if(sn===null){var r=Lr.alternate;r=r!==null?r.memoizedState:null}else r=sn.next;var i=wn===null?Lr.memoizedState:wn.next;if(i!==null)wn=i,sn=r;else{if(r===null)throw Error(Be(310));sn=r,r={memoizedState:sn.memoizedState,baseState:sn.baseState,baseQueue:sn.baseQueue,queue:sn.queue,next:null},wn===null?Lr.memoizedState=wn=r:wn=wn.next=r}return wn}function uh(r,i){return typeof i=="function"?i(r):i}function xm(r){var i=ns(),l=i.queue;if(l===null)throw Error(Be(311));l.lastRenderedReducer=r;var p=sn,x=p.baseQueue,T=l.pending;if(T!==null){if(x!==null){var S=x.next;x.next=T.next,T.next=S}p.baseQueue=x=T,l.pending=null}if(x!==null){T=x.next,p=p.baseState;var d=S=null,$=null,ne=T;do{var ge=ne.lane;if((Ka&ge)===ge)$!==null&&($=$.next={lane:0,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null}),p=ne.hasEagerState?ne.eagerState:r(p,ne.action);else{var Q={lane:ge,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null};$===null?(d=$=Q,S=p):$=$.next=Q,Lr.lanes|=ge,Ya|=ge}ne=ne.next}while(ne!==null&&ne!==T);$===null?S=p:$.next=d,Cs(p,i.memoizedState)||(vi=!0),i.memoizedState=p,i.baseState=S,i.baseQueue=$,l.lastRenderedState=p}if(r=l.interleaved,r!==null){x=r;do T=x.lane,Lr.lanes|=T,Ya|=T,x=x.next;while(x!==r)}else x===null&&(l.lanes=0);return[i.memoizedState,l.dispatch]}function wm(r){var i=ns(),l=i.queue;if(l===null)throw Error(Be(311));l.lastRenderedReducer=r;var p=l.dispatch,x=l.pending,T=i.memoizedState;if(x!==null){l.pending=null;var S=x=x.next;do T=r(T,S.action),S=S.next;while(S!==x);Cs(T,i.memoizedState)||(vi=!0),i.memoizedState=T,i.baseQueue===null&&(i.baseState=T),l.lastRenderedState=T}return[T,p]}function q0(){}function Z0(r,i){var l=Lr,p=ns(),x=i(),T=!Cs(p.memoizedState,x);if(T&&(p.memoizedState=x,vi=!0),p=p.queue,ly(W0.bind(null,l,p,r),[r]),p.getSnapshot!==i||T||wn!==null&&wn.memoizedState.tag&1){if(l.flags|=2048,ch(9,H0.bind(null,l,p,x,i),void 0,null),bn===null)throw Error(Be(349));Ka&30||G0(l,i,x)}return x}function G0(r,i,l){r.flags|=16384,r={getSnapshot:i,value:l},i=Lr.updateQueue,i===null?(i={lastEffect:null,stores:null},Lr.updateQueue=i,i.stores=[r]):(l=i.stores,l===null?i.stores=[r]:l.push(r))}function H0(r,i,l,p){i.value=l,i.getSnapshot=p,X0(i)&&K0(r)}function W0(r,i,l){return l(function(){X0(i)&&K0(r)})}function X0(r){var i=r.getSnapshot;r=r.value;try{var l=i();return!Cs(r,l)}catch{return!0}}function K0(r){var i=fo(r,1);i!==null&&ks(i,r,1,-1)}function Kv(r){var i=Os();return typeof r=="function"&&(r=r()),i.memoizedState=i.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uh,lastRenderedState:r},i.queue=r,r=r.dispatch=qS.bind(null,Lr,r),[i.memoizedState,r]}function ch(r,i,l,p){return r={tag:r,create:i,destroy:l,deps:p,next:null},i=Lr.updateQueue,i===null?(i={lastEffect:null,stores:null},Lr.updateQueue=i,i.lastEffect=r.next=r):(l=i.lastEffect,l===null?i.lastEffect=r.next=r:(p=l.next,l.next=r,r.next=p,i.lastEffect=r)),r}function Y0(){return ns().memoizedState}function $d(r,i,l,p){var x=Os();Lr.flags|=r,x.memoizedState=ch(1|i,l,void 0,p===void 0?null:p)}function Mp(r,i,l,p){var x=ns();p=p===void 0?null:p;var T=void 0;if(sn!==null){var S=sn.memoizedState;if(T=S.destroy,p!==null&&sy(p,S.deps)){x.memoizedState=ch(i,l,T,p);return}}Lr.flags|=r,x.memoizedState=ch(1|i,l,T,p)}function Yv(r,i){return $d(8390656,8,r,i)}function ly(r,i){return Mp(2048,8,r,i)}function J0(r,i){return Mp(4,2,r,i)}function Q0(r,i){return Mp(4,4,r,i)}function ew(r,i){if(typeof i=="function")return r=r(),i(r),function(){i(null)};if(i!=null)return r=r(),i.current=r,function(){i.current=null}}function tw(r,i,l){return l=l!=null?l.concat([r]):null,Mp(4,4,ew.bind(null,i,r),l)}function uy(){}function rw(r,i){var l=ns();i=i===void 0?null:i;var p=l.memoizedState;return p!==null&&i!==null&&sy(i,p[1])?p[0]:(l.memoizedState=[r,i],r)}function nw(r,i){var l=ns();i=i===void 0?null:i;var p=l.memoizedState;return p!==null&&i!==null&&sy(i,p[1])?p[0]:(r=r(),l.memoizedState=[r,i],r)}function iw(r,i,l){return Ka&21?(Cs(l,i)||(l=u0(),Lr.lanes|=l,Ya|=l,r.baseState=!0),i):(r.baseState&&(r.baseState=!1,vi=!0),r.memoizedState=l)}function US(r,i){var l=or;or=l!==0&&4>l?l:4,r(!0);var p=vm.transition;vm.transition={};try{r(!1),i()}finally{or=l,vm.transition=p}}function sw(){return ns().memoizedState}function $S(r,i,l){var p=oa(r);if(l={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null},ow(r))aw(i,l);else if(l=V0(r,i,l,p),l!==null){var x=ii();ks(l,r,p,x),lw(l,i,p)}}function qS(r,i,l){var p=oa(r),x={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null};if(ow(r))aw(i,x);else{var T=r.alternate;if(r.lanes===0&&(T===null||T.lanes===0)&&(T=i.lastRenderedReducer,T!==null))try{var S=i.lastRenderedState,d=T(S,l);if(x.hasEagerState=!0,x.eagerState=d,Cs(d,S)){var $=i.interleaved;$===null?(x.next=x,ey(i)):(x.next=$.next,$.next=x),i.interleaved=x;return}}catch{}finally{}l=V0(r,i,x,p),l!==null&&(x=ii(),ks(l,r,p,x),lw(l,i,p))}}function ow(r){var i=r.alternate;return r===Lr||i!==null&&i===Lr}function aw(r,i){Zc=gp=!0;var l=r.pending;l===null?i.next=i:(i.next=l.next,l.next=i),r.pending=i}function lw(r,i,l){if(l&4194240){var p=i.lanes;p&=r.pendingLanes,l|=p,i.lanes=l,jg(r,l)}}var yp={readContext:rs,useCallback:Zn,useContext:Zn,useEffect:Zn,useImperativeHandle:Zn,useInsertionEffect:Zn,useLayoutEffect:Zn,useMemo:Zn,useReducer:Zn,useRef:Zn,useState:Zn,useDebugValue:Zn,useDeferredValue:Zn,useTransition:Zn,useMutableSource:Zn,useSyncExternalStore:Zn,useId:Zn,unstable_isNewReconciler:!1},ZS={readContext:rs,useCallback:function(r,i){return Os().memoizedState=[r,i===void 0?null:i],r},useContext:rs,useEffect:Yv,useImperativeHandle:function(r,i,l){return l=l!=null?l.concat([r]):null,$d(4194308,4,ew.bind(null,i,r),l)},useLayoutEffect:function(r,i){return $d(4194308,4,r,i)},useInsertionEffect:function(r,i){return $d(4,2,r,i)},useMemo:function(r,i){var l=Os();return i=i===void 0?null:i,r=r(),l.memoizedState=[r,i],r},useReducer:function(r,i,l){var p=Os();return i=l!==void 0?l(i):i,p.memoizedState=p.baseState=i,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:i},p.queue=r,r=r.dispatch=$S.bind(null,Lr,r),[p.memoizedState,r]},useRef:function(r){var i=Os();return r={current:r},i.memoizedState=r},useState:Kv,useDebugValue:uy,useDeferredValue:function(r){return Os().memoizedState=r},useTransition:function(){var r=Kv(!1),i=r[0];return r=US.bind(null,r[1]),Os().memoizedState=r,[i,r]},useMutableSource:function(){},useSyncExternalStore:function(r,i,l){var p=Lr,x=Os();if(Ir){if(l===void 0)throw Error(Be(407));l=l()}else{if(l=i(),bn===null)throw Error(Be(349));Ka&30||G0(p,i,l)}x.memoizedState=l;var T={value:l,getSnapshot:i};return x.queue=T,Yv(W0.bind(null,p,T,r),[r]),p.flags|=2048,ch(9,H0.bind(null,p,T,l,i),void 0,null),l},useId:function(){var r=Os(),i=bn.identifierPrefix;if(Ir){var l=uo,p=lo;l=(p&~(1<<32-Ts(p)-1)).toString(32)+l,i=":"+i+"R"+l,l=lh++,0<l&&(i+="H"+l.toString(32)),i+=":"}else l=VS++,i=":"+i+"r"+l.toString(32)+":";return r.memoizedState=i},unstable_isNewReconciler:!1},GS={readContext:rs,useCallback:rw,useContext:rs,useEffect:ly,useImperativeHandle:tw,useInsertionEffect:J0,useLayoutEffect:Q0,useMemo:nw,useReducer:xm,useRef:Y0,useState:function(){return xm(uh)},useDebugValue:uy,useDeferredValue:function(r){var i=ns();return iw(i,sn.memoizedState,r)},useTransition:function(){var r=xm(uh)[0],i=ns().memoizedState;return[r,i]},useMutableSource:q0,useSyncExternalStore:Z0,useId:sw,unstable_isNewReconciler:!1},HS={readContext:rs,useCallback:rw,useContext:rs,useEffect:ly,useImperativeHandle:tw,useInsertionEffect:J0,useLayoutEffect:Q0,useMemo:nw,useReducer:wm,useRef:Y0,useState:function(){return wm(uh)},useDebugValue:uy,useDeferredValue:function(r){var i=ns();return sn===null?i.memoizedState=r:iw(i,sn.memoizedState,r)},useTransition:function(){var r=wm(uh)[0],i=ns().memoizedState;return[r,i]},useMutableSource:q0,useSyncExternalStore:Z0,useId:sw,unstable_isNewReconciler:!1};function xs(r,i){if(r&&r.defaultProps){i=Rr({},i),r=r.defaultProps;for(var l in r)i[l]===void 0&&(i[l]=r[l]);return i}return i}function og(r,i,l,p){i=r.memoizedState,l=l(p,i),l=l==null?i:Rr({},i,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var zp={isMounted:function(r){return(r=r._reactInternals)?el(r)===r:!1},enqueueSetState:function(r,i,l){r=r._reactInternals;var p=ii(),x=oa(r),T=co(p,x);T.payload=i,l!=null&&(T.callback=l),i=ia(r,T,x),i!==null&&(ks(i,r,x,p),Vd(i,r,x))},enqueueReplaceState:function(r,i,l){r=r._reactInternals;var p=ii(),x=oa(r),T=co(p,x);T.tag=1,T.payload=i,l!=null&&(T.callback=l),i=ia(r,T,x),i!==null&&(ks(i,r,x,p),Vd(i,r,x))},enqueueForceUpdate:function(r,i){r=r._reactInternals;var l=ii(),p=oa(r),x=co(l,p);x.tag=2,i!=null&&(x.callback=i),i=ia(r,x,p),i!==null&&(ks(i,r,p,l),Vd(i,r,p))}};function Jv(r,i,l,p,x,T,S){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,T,S):i.prototype&&i.prototype.isPureReactComponent?!rh(l,p)||!rh(x,T):!0}function uw(r,i,l){var p=!1,x=ca,T=i.contextType;return typeof T=="object"&&T!==null?T=rs(T):(x=wi(i)?Wa:Wn.current,p=i.contextTypes,T=(p=p!=null)?hu(r,x):ca),i=new i(l,T),r.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=zp,r.stateNode=i,i._reactInternals=r,p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=x,r.__reactInternalMemoizedMaskedChildContext=T),i}function Qv(r,i,l,p){r=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,p),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,p),i.state!==r&&zp.enqueueReplaceState(i,i.state,null)}function ag(r,i,l,p){var x=r.stateNode;x.props=l,x.state=r.memoizedState,x.refs={},ty(r);var T=i.contextType;typeof T=="object"&&T!==null?x.context=rs(T):(T=wi(i)?Wa:Wn.current,x.context=hu(r,T)),x.state=r.memoizedState,T=i.getDerivedStateFromProps,typeof T=="function"&&(og(r,i,T,l),x.state=r.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(i=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),i!==x.state&&zp.enqueueReplaceState(x,x.state,null),fp(r,l,x,p),x.state=r.memoizedState),typeof x.componentDidMount=="function"&&(r.flags|=4194308)}function mu(r,i){try{var l="",p=i;do l+=w2(p),p=p.return;while(p);var x=l}catch(T){x=`
Error generating stack: `+T.message+`
`+T.stack}return{value:r,source:i,stack:x,digest:null}}function bm(r,i,l){return{value:r,source:null,stack:l??null,digest:i??null}}function lg(r,i){try{console.error(i.value)}catch(l){setTimeout(function(){throw l})}}var WS=typeof WeakMap=="function"?WeakMap:Map;function cw(r,i,l){l=co(-1,l),l.tag=3,l.payload={element:null};var p=i.value;return l.callback=function(){vp||(vp=!0,_g=p),lg(r,i)},l}function hw(r,i,l){l=co(-1,l),l.tag=3;var p=r.type.getDerivedStateFromError;if(typeof p=="function"){var x=i.value;l.payload=function(){return p(x)},l.callback=function(){lg(r,i)}}var T=r.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(l.callback=function(){lg(r,i),typeof p!="function"&&(sa===null?sa=new Set([this]):sa.add(this));var S=i.stack;this.componentDidCatch(i.value,{componentStack:S!==null?S:""})}),l}function ex(r,i,l){var p=r.pingCache;if(p===null){p=r.pingCache=new WS;var x=new Set;p.set(i,x)}else x=p.get(i),x===void 0&&(x=new Set,p.set(i,x));x.has(l)||(x.add(l),r=lT.bind(null,r,i,l),i.then(r,r))}function tx(r){do{var i;if((i=r.tag===13)&&(i=r.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return r;r=r.return}while(r!==null);return null}function rx(r,i,l,p,x){return r.mode&1?(r.flags|=65536,r.lanes=x,r):(r===i?r.flags|=65536:(r.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(i=co(-1,1),i.tag=2,ia(l,i,1))),l.lanes|=1),r)}var XS=go.ReactCurrentOwner,vi=!1;function ni(r,i,l,p){i.child=r===null?j0(i,null,l,p):pu(i,r.child,l,p)}function nx(r,i,l,p,x){l=l.render;var T=i.ref;return au(i,x),p=oy(r,i,l,p,T,x),l=ay(),r!==null&&!vi?(i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~x,mo(r,i,x)):(Ir&&l&&Wg(i),i.flags|=1,ni(r,i,p,x),i.child)}function ix(r,i,l,p,x){if(r===null){var T=l.type;return typeof T=="function"&&!yy(T)&&T.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(i.tag=15,i.type=T,dw(r,i,T,p,x)):(r=Hd(l.type,null,p,i,i.mode,x),r.ref=i.ref,r.return=i,i.child=r)}if(T=r.child,!(r.lanes&x)){var S=T.memoizedProps;if(l=l.compare,l=l!==null?l:rh,l(S,p)&&r.ref===i.ref)return mo(r,i,x)}return i.flags|=1,r=aa(T,p),r.ref=i.ref,r.return=i,i.child=r}function dw(r,i,l,p,x){if(r!==null){var T=r.memoizedProps;if(rh(T,p)&&r.ref===i.ref)if(vi=!1,i.pendingProps=p=T,(r.lanes&x)!==0)r.flags&131072&&(vi=!0);else return i.lanes=r.lanes,mo(r,i,x)}return ug(r,i,l,p,x)}function pw(r,i,l){var p=i.pendingProps,x=p.children,T=r!==null?r.memoizedState:null;if(p.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},_r(ru,Ri),Ri|=l;else{if(!(l&1073741824))return r=T!==null?T.baseLanes|l:l,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:r,cachePool:null,transitions:null},i.updateQueue=null,_r(ru,Ri),Ri|=r,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=T!==null?T.baseLanes:l,_r(ru,Ri),Ri|=p}else T!==null?(p=T.baseLanes|l,i.memoizedState=null):p=l,_r(ru,Ri),Ri|=p;return ni(r,i,x,l),i.child}function fw(r,i){var l=i.ref;(r===null&&l!==null||r!==null&&r.ref!==l)&&(i.flags|=512,i.flags|=2097152)}function ug(r,i,l,p,x){var T=wi(l)?Wa:Wn.current;return T=hu(i,T),au(i,x),l=oy(r,i,l,p,T,x),p=ay(),r!==null&&!vi?(i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~x,mo(r,i,x)):(Ir&&p&&Wg(i),i.flags|=1,ni(r,i,l,x),i.child)}function sx(r,i,l,p,x){if(wi(l)){var T=!0;up(i)}else T=!1;if(au(i,x),i.stateNode===null)qd(r,i),uw(i,l,p),ag(i,l,p,x),p=!0;else if(r===null){var S=i.stateNode,d=i.memoizedProps;S.props=d;var $=S.context,ne=l.contextType;typeof ne=="object"&&ne!==null?ne=rs(ne):(ne=wi(l)?Wa:Wn.current,ne=hu(i,ne));var ge=l.getDerivedStateFromProps,Q=typeof ge=="function"||typeof S.getSnapshotBeforeUpdate=="function";Q||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==p||$!==ne)&&Qv(i,S,p,ne),Xo=!1;var V=i.memoizedState;S.state=V,fp(i,p,S,x),$=i.memoizedState,d!==p||V!==$||xi.current||Xo?(typeof ge=="function"&&(og(i,l,ge,p),$=i.memoizedState),(d=Xo||Jv(i,l,d,p,V,$,ne))?(Q||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(i.flags|=4194308)):(typeof S.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=p,i.memoizedState=$),S.props=p,S.state=$,S.context=ne,p=d):(typeof S.componentDidMount=="function"&&(i.flags|=4194308),p=!1)}else{S=i.stateNode,U0(r,i),d=i.memoizedProps,ne=i.type===i.elementType?d:xs(i.type,d),S.props=ne,Q=i.pendingProps,V=S.context,$=l.contextType,typeof $=="object"&&$!==null?$=rs($):($=wi(l)?Wa:Wn.current,$=hu(i,$));var Ce=l.getDerivedStateFromProps;(ge=typeof Ce=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==Q||V!==$)&&Qv(i,S,p,$),Xo=!1,V=i.memoizedState,S.state=V,fp(i,p,S,x);var Ee=i.memoizedState;d!==Q||V!==Ee||xi.current||Xo?(typeof Ce=="function"&&(og(i,l,Ce,p),Ee=i.memoizedState),(ne=Xo||Jv(i,l,ne,p,V,Ee,$)||!1)?(ge||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(p,Ee,$),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(p,Ee,$)),typeof S.componentDidUpdate=="function"&&(i.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===r.memoizedProps&&V===r.memoizedState||(i.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&V===r.memoizedState||(i.flags|=1024),i.memoizedProps=p,i.memoizedState=Ee),S.props=p,S.state=Ee,S.context=$,p=ne):(typeof S.componentDidUpdate!="function"||d===r.memoizedProps&&V===r.memoizedState||(i.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===r.memoizedProps&&V===r.memoizedState||(i.flags|=1024),p=!1)}return cg(r,i,l,p,T,x)}function cg(r,i,l,p,x,T){fw(r,i);var S=(i.flags&128)!==0;if(!p&&!S)return x&&qv(i,l,!1),mo(r,i,T);p=i.stateNode,XS.current=i;var d=S&&typeof l.getDerivedStateFromError!="function"?null:p.render();return i.flags|=1,r!==null&&S?(i.child=pu(i,r.child,null,T),i.child=pu(i,null,d,T)):ni(r,i,d,T),i.memoizedState=p.state,x&&qv(i,l,!0),i.child}function mw(r){var i=r.stateNode;i.pendingContext?$v(r,i.pendingContext,i.pendingContext!==i.context):i.context&&$v(r,i.context,!1),ry(r,i.containerInfo)}function ox(r,i,l,p,x){return du(),Kg(x),i.flags|=256,ni(r,i,l,p),i.child}var hg={dehydrated:null,treeContext:null,retryLane:0};function dg(r){return{baseLanes:r,cachePool:null,transitions:null}}function gw(r,i,l){var p=i.pendingProps,x=Dr.current,T=!1,S=(i.flags&128)!==0,d;if((d=S)||(d=r!==null&&r.memoizedState===null?!1:(x&2)!==0),d?(T=!0,i.flags&=-129):(r===null||r.memoizedState!==null)&&(x|=1),_r(Dr,x&1),r===null)return ig(i),r=i.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(i.mode&1?r.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(S=p.children,r=p.fallback,T?(p=i.mode,T=i.child,S={mode:"hidden",children:S},!(p&1)&&T!==null?(T.childLanes=0,T.pendingProps=S):T=Rp(S,p,0,null),r=Ha(r,p,l,null),T.return=i,r.return=i,T.sibling=r,i.child=T,i.child.memoizedState=dg(l),i.memoizedState=hg,r):cy(i,S));if(x=r.memoizedState,x!==null&&(d=x.dehydrated,d!==null))return KS(r,i,S,p,d,x,l);if(T){T=p.fallback,S=i.mode,x=r.child,d=x.sibling;var $={mode:"hidden",children:p.children};return!(S&1)&&i.child!==x?(p=i.child,p.childLanes=0,p.pendingProps=$,i.deletions=null):(p=aa(x,$),p.subtreeFlags=x.subtreeFlags&14680064),d!==null?T=aa(d,T):(T=Ha(T,S,l,null),T.flags|=2),T.return=i,p.return=i,p.sibling=T,i.child=p,p=T,T=i.child,S=r.child.memoizedState,S=S===null?dg(l):{baseLanes:S.baseLanes|l,cachePool:null,transitions:S.transitions},T.memoizedState=S,T.childLanes=r.childLanes&~l,i.memoizedState=hg,p}return T=r.child,r=T.sibling,p=aa(T,{mode:"visible",children:p.children}),!(i.mode&1)&&(p.lanes=l),p.return=i,p.sibling=null,r!==null&&(l=i.deletions,l===null?(i.deletions=[r],i.flags|=16):l.push(r)),i.child=p,i.memoizedState=null,p}function cy(r,i){return i=Rp({mode:"visible",children:i},r.mode,0,null),i.return=r,r.child=i}function Ad(r,i,l,p){return p!==null&&Kg(p),pu(i,r.child,null,l),r=cy(i,i.pendingProps.children),r.flags|=2,i.memoizedState=null,r}function KS(r,i,l,p,x,T,S){if(l)return i.flags&256?(i.flags&=-257,p=bm(Error(Be(422))),Ad(r,i,S,p)):i.memoizedState!==null?(i.child=r.child,i.flags|=128,null):(T=p.fallback,x=i.mode,p=Rp({mode:"visible",children:p.children},x,0,null),T=Ha(T,x,S,null),T.flags|=2,p.return=i,T.return=i,p.sibling=T,i.child=p,i.mode&1&&pu(i,r.child,null,S),i.child.memoizedState=dg(S),i.memoizedState=hg,T);if(!(i.mode&1))return Ad(r,i,S,null);if(x.data==="$!"){if(p=x.nextSibling&&x.nextSibling.dataset,p)var d=p.dgst;return p=d,T=Error(Be(419)),p=bm(T,p,void 0),Ad(r,i,S,p)}if(d=(S&r.childLanes)!==0,vi||d){if(p=bn,p!==null){switch(S&-S){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=x&(p.suspendedLanes|S)?0:x,x!==0&&x!==T.retryLane&&(T.retryLane=x,fo(r,x),ks(p,r,x,-1))}return gy(),p=bm(Error(Be(421))),Ad(r,i,S,p)}return x.data==="$?"?(i.flags|=128,i.child=r.child,i=uT.bind(null,r),x._reactRetry=i,null):(r=T.treeContext,Fi=na(x.nextSibling),Bi=i,Ir=!0,Ss=null,r!==null&&(Yi[Ji++]=lo,Yi[Ji++]=uo,Yi[Ji++]=Xa,lo=r.id,uo=r.overflow,Xa=i),i=cy(i,p.children),i.flags|=4096,i)}function ax(r,i,l){r.lanes|=i;var p=r.alternate;p!==null&&(p.lanes|=i),sg(r.return,i,l)}function Sm(r,i,l,p,x){var T=r.memoizedState;T===null?r.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:p,tail:l,tailMode:x}:(T.isBackwards=i,T.rendering=null,T.renderingStartTime=0,T.last=p,T.tail=l,T.tailMode=x)}function yw(r,i,l){var p=i.pendingProps,x=p.revealOrder,T=p.tail;if(ni(r,i,p.children,l),p=Dr.current,p&2)p=p&1|2,i.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=i.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&ax(r,l,i);else if(r.tag===19)ax(r,l,i);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break e;for(;r.sibling===null;){if(r.return===null||r.return===i)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}p&=1}if(_r(Dr,p),!(i.mode&1))i.memoizedState=null;else switch(x){case"forwards":for(l=i.child,x=null;l!==null;)r=l.alternate,r!==null&&mp(r)===null&&(x=l),l=l.sibling;l=x,l===null?(x=i.child,i.child=null):(x=l.sibling,l.sibling=null),Sm(i,!1,x,l,T);break;case"backwards":for(l=null,x=i.child,i.child=null;x!==null;){if(r=x.alternate,r!==null&&mp(r)===null){i.child=x;break}r=x.sibling,x.sibling=l,l=x,x=r}Sm(i,!0,l,null,T);break;case"together":Sm(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function qd(r,i){!(i.mode&1)&&r!==null&&(r.alternate=null,i.alternate=null,i.flags|=2)}function mo(r,i,l){if(r!==null&&(i.dependencies=r.dependencies),Ya|=i.lanes,!(l&i.childLanes))return null;if(r!==null&&i.child!==r.child)throw Error(Be(153));if(i.child!==null){for(r=i.child,l=aa(r,r.pendingProps),i.child=l,l.return=i;r.sibling!==null;)r=r.sibling,l=l.sibling=aa(r,r.pendingProps),l.return=i;l.sibling=null}return i.child}function YS(r,i,l){switch(i.tag){case 3:mw(i),du();break;case 5:$0(i);break;case 1:wi(i.type)&&up(i);break;case 4:ry(i,i.stateNode.containerInfo);break;case 10:var p=i.type._context,x=i.memoizedProps.value;_r(dp,p._currentValue),p._currentValue=x;break;case 13:if(p=i.memoizedState,p!==null)return p.dehydrated!==null?(_r(Dr,Dr.current&1),i.flags|=128,null):l&i.child.childLanes?gw(r,i,l):(_r(Dr,Dr.current&1),r=mo(r,i,l),r!==null?r.sibling:null);_r(Dr,Dr.current&1);break;case 19:if(p=(l&i.childLanes)!==0,r.flags&128){if(p)return yw(r,i,l);i.flags|=128}if(x=i.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),_r(Dr,Dr.current),p)break;return null;case 22:case 23:return i.lanes=0,pw(r,i,l)}return mo(r,i,l)}var _w,pg,vw,xw;_w=function(r,i){for(var l=i.child;l!==null;){if(l.tag===5||l.tag===6)r.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};pg=function(){};vw=function(r,i,l,p){var x=r.memoizedProps;if(x!==p){r=i.stateNode,Za(Vs.current);var T=null;switch(l){case"input":x=Rm(r,x),p=Rm(r,p),T=[];break;case"select":x=Rr({},x,{value:void 0}),p=Rr({},p,{value:void 0}),T=[];break;case"textarea":x=Om(r,x),p=Om(r,p),T=[];break;default:typeof x.onClick!="function"&&typeof p.onClick=="function"&&(r.onclick=ap)}jm(l,p);var S;l=null;for(ne in x)if(!p.hasOwnProperty(ne)&&x.hasOwnProperty(ne)&&x[ne]!=null)if(ne==="style"){var d=x[ne];for(S in d)d.hasOwnProperty(S)&&(l||(l={}),l[S]="")}else ne!=="dangerouslySetInnerHTML"&&ne!=="children"&&ne!=="suppressContentEditableWarning"&&ne!=="suppressHydrationWarning"&&ne!=="autoFocus"&&(Xc.hasOwnProperty(ne)?T||(T=[]):(T=T||[]).push(ne,null));for(ne in p){var $=p[ne];if(d=x!=null?x[ne]:void 0,p.hasOwnProperty(ne)&&$!==d&&($!=null||d!=null))if(ne==="style")if(d){for(S in d)!d.hasOwnProperty(S)||$&&$.hasOwnProperty(S)||(l||(l={}),l[S]="");for(S in $)$.hasOwnProperty(S)&&d[S]!==$[S]&&(l||(l={}),l[S]=$[S])}else l||(T||(T=[]),T.push(ne,l)),l=$;else ne==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,d=d?d.__html:void 0,$!=null&&d!==$&&(T=T||[]).push(ne,$)):ne==="children"?typeof $!="string"&&typeof $!="number"||(T=T||[]).push(ne,""+$):ne!=="suppressContentEditableWarning"&&ne!=="suppressHydrationWarning"&&(Xc.hasOwnProperty(ne)?($!=null&&ne==="onScroll"&&br("scroll",r),T||d===$||(T=[])):(T=T||[]).push(ne,$))}l&&(T=T||[]).push("style",l);var ne=T;(i.updateQueue=ne)&&(i.flags|=4)}};xw=function(r,i,l,p){l!==p&&(i.flags|=4)};function zc(r,i){if(!Ir)switch(r.tailMode){case"hidden":i=r.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var p=null;l!==null;)l.alternate!==null&&(p=l),l=l.sibling;p===null?i||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function Gn(r){var i=r.alternate!==null&&r.alternate.child===r.child,l=0,p=0;if(i)for(var x=r.child;x!==null;)l|=x.lanes|x.childLanes,p|=x.subtreeFlags&14680064,p|=x.flags&14680064,x.return=r,x=x.sibling;else for(x=r.child;x!==null;)l|=x.lanes|x.childLanes,p|=x.subtreeFlags,p|=x.flags,x.return=r,x=x.sibling;return r.subtreeFlags|=p,r.childLanes=l,i}function JS(r,i,l){var p=i.pendingProps;switch(Xg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gn(i),null;case 1:return wi(i.type)&&lp(),Gn(i),null;case 3:return p=i.stateNode,fu(),Sr(xi),Sr(Wn),iy(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(r===null||r.child===null)&&(Id(i)?i.flags|=4:r===null||r.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Ss!==null&&(wg(Ss),Ss=null))),pg(r,i),Gn(i),null;case 5:ny(i);var x=Za(ah.current);if(l=i.type,r!==null&&i.stateNode!=null)vw(r,i,l,p,x),r.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!p){if(i.stateNode===null)throw Error(Be(166));return Gn(i),null}if(r=Za(Vs.current),Id(i)){p=i.stateNode,l=i.type;var T=i.memoizedProps;switch(p[Ns]=i,p[sh]=T,r=(i.mode&1)!==0,l){case"dialog":br("cancel",p),br("close",p);break;case"iframe":case"object":case"embed":br("load",p);break;case"video":case"audio":for(x=0;x<Oc.length;x++)br(Oc[x],p);break;case"source":br("error",p);break;case"img":case"image":case"link":br("error",p),br("load",p);break;case"details":br("toggle",p);break;case"input":gv(p,T),br("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!T.multiple},br("invalid",p);break;case"textarea":_v(p,T),br("invalid",p)}jm(l,T),x=null;for(var S in T)if(T.hasOwnProperty(S)){var d=T[S];S==="children"?typeof d=="string"?p.textContent!==d&&(T.suppressHydrationWarning!==!0&&Ed(p.textContent,d,r),x=["children",d]):typeof d=="number"&&p.textContent!==""+d&&(T.suppressHydrationWarning!==!0&&Ed(p.textContent,d,r),x=["children",""+d]):Xc.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&br("scroll",p)}switch(l){case"input":vd(p),yv(p,T,!0);break;case"textarea":vd(p),vv(p);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(p.onclick=ap)}p=x,i.updateQueue=p,p!==null&&(i.flags|=4)}else{S=x.nodeType===9?x:x.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=Wx(l)),r==="http://www.w3.org/1999/xhtml"?l==="script"?(r=S.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof p.is=="string"?r=S.createElement(l,{is:p.is}):(r=S.createElement(l),l==="select"&&(S=r,p.multiple?S.multiple=!0:p.size&&(S.size=p.size))):r=S.createElementNS(r,l),r[Ns]=i,r[sh]=p,_w(r,i,!1,!1),i.stateNode=r;e:{switch(S=Vm(l,p),l){case"dialog":br("cancel",r),br("close",r),x=p;break;case"iframe":case"object":case"embed":br("load",r),x=p;break;case"video":case"audio":for(x=0;x<Oc.length;x++)br(Oc[x],r);x=p;break;case"source":br("error",r),x=p;break;case"img":case"image":case"link":br("error",r),br("load",r),x=p;break;case"details":br("toggle",r),x=p;break;case"input":gv(r,p),x=Rm(r,p),br("invalid",r);break;case"option":x=p;break;case"select":r._wrapperState={wasMultiple:!!p.multiple},x=Rr({},p,{value:void 0}),br("invalid",r);break;case"textarea":_v(r,p),x=Om(r,p),br("invalid",r);break;default:x=p}jm(l,x),d=x;for(T in d)if(d.hasOwnProperty(T)){var $=d[T];T==="style"?Yx(r,$):T==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,$!=null&&Xx(r,$)):T==="children"?typeof $=="string"?(l!=="textarea"||$!=="")&&Kc(r,$):typeof $=="number"&&Kc(r,""+$):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Xc.hasOwnProperty(T)?$!=null&&T==="onScroll"&&br("scroll",r):$!=null&&Lg(r,T,$,S))}switch(l){case"input":vd(r),yv(r,p,!1);break;case"textarea":vd(r),vv(r);break;case"option":p.value!=null&&r.setAttribute("value",""+ua(p.value));break;case"select":r.multiple=!!p.multiple,T=p.value,T!=null?nu(r,!!p.multiple,T,!1):p.defaultValue!=null&&nu(r,!!p.multiple,p.defaultValue,!0);break;default:typeof x.onClick=="function"&&(r.onclick=ap)}switch(l){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return Gn(i),null;case 6:if(r&&i.stateNode!=null)xw(r,i,r.memoizedProps,p);else{if(typeof p!="string"&&i.stateNode===null)throw Error(Be(166));if(l=Za(ah.current),Za(Vs.current),Id(i)){if(p=i.stateNode,l=i.memoizedProps,p[Ns]=i,(T=p.nodeValue!==l)&&(r=Bi,r!==null))switch(r.tag){case 3:Ed(p.nodeValue,l,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Ed(p.nodeValue,l,(r.mode&1)!==0)}T&&(i.flags|=4)}else p=(l.nodeType===9?l:l.ownerDocument).createTextNode(p),p[Ns]=i,i.stateNode=p}return Gn(i),null;case 13:if(Sr(Dr),p=i.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Ir&&Fi!==null&&i.mode&1&&!(i.flags&128))O0(),du(),i.flags|=98560,T=!1;else if(T=Id(i),p!==null&&p.dehydrated!==null){if(r===null){if(!T)throw Error(Be(318));if(T=i.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(Be(317));T[Ns]=i}else du(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;Gn(i),T=!1}else Ss!==null&&(wg(Ss),Ss=null),T=!0;if(!T)return i.flags&65536?i:null}return i.flags&128?(i.lanes=l,i):(p=p!==null,p!==(r!==null&&r.memoizedState!==null)&&p&&(i.child.flags|=8192,i.mode&1&&(r===null||Dr.current&1?on===0&&(on=3):gy())),i.updateQueue!==null&&(i.flags|=4),Gn(i),null);case 4:return fu(),pg(r,i),r===null&&nh(i.stateNode.containerInfo),Gn(i),null;case 10:return Qg(i.type._context),Gn(i),null;case 17:return wi(i.type)&&lp(),Gn(i),null;case 19:if(Sr(Dr),T=i.memoizedState,T===null)return Gn(i),null;if(p=(i.flags&128)!==0,S=T.rendering,S===null)if(p)zc(T,!1);else{if(on!==0||r!==null&&r.flags&128)for(r=i.child;r!==null;){if(S=mp(r),S!==null){for(i.flags|=128,zc(T,!1),p=S.updateQueue,p!==null&&(i.updateQueue=p,i.flags|=4),i.subtreeFlags=0,p=l,l=i.child;l!==null;)T=l,r=p,T.flags&=14680066,S=T.alternate,S===null?(T.childLanes=0,T.lanes=r,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=S.childLanes,T.lanes=S.lanes,T.child=S.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=S.memoizedProps,T.memoizedState=S.memoizedState,T.updateQueue=S.updateQueue,T.type=S.type,r=S.dependencies,T.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),l=l.sibling;return _r(Dr,Dr.current&1|2),i.child}r=r.sibling}T.tail!==null&&qr()>gu&&(i.flags|=128,p=!0,zc(T,!1),i.lanes=4194304)}else{if(!p)if(r=mp(S),r!==null){if(i.flags|=128,p=!0,l=r.updateQueue,l!==null&&(i.updateQueue=l,i.flags|=4),zc(T,!0),T.tail===null&&T.tailMode==="hidden"&&!S.alternate&&!Ir)return Gn(i),null}else 2*qr()-T.renderingStartTime>gu&&l!==1073741824&&(i.flags|=128,p=!0,zc(T,!1),i.lanes=4194304);T.isBackwards?(S.sibling=i.child,i.child=S):(l=T.last,l!==null?l.sibling=S:i.child=S,T.last=S)}return T.tail!==null?(i=T.tail,T.rendering=i,T.tail=i.sibling,T.renderingStartTime=qr(),i.sibling=null,l=Dr.current,_r(Dr,p?l&1|2:l&1),i):(Gn(i),null);case 22:case 23:return my(),p=i.memoizedState!==null,r!==null&&r.memoizedState!==null!==p&&(i.flags|=8192),p&&i.mode&1?Ri&1073741824&&(Gn(i),i.subtreeFlags&6&&(i.flags|=8192)):Gn(i),null;case 24:return null;case 25:return null}throw Error(Be(156,i.tag))}function QS(r,i){switch(Xg(i),i.tag){case 1:return wi(i.type)&&lp(),r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 3:return fu(),Sr(xi),Sr(Wn),iy(),r=i.flags,r&65536&&!(r&128)?(i.flags=r&-65537|128,i):null;case 5:return ny(i),null;case 13:if(Sr(Dr),r=i.memoizedState,r!==null&&r.dehydrated!==null){if(i.alternate===null)throw Error(Be(340));du()}return r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 19:return Sr(Dr),null;case 4:return fu(),null;case 10:return Qg(i.type._context),null;case 22:case 23:return my(),null;case 24:return null;default:return null}}var Md=!1,Hn=!1,eT=typeof WeakSet=="function"?WeakSet:Set,dt=null;function tu(r,i){var l=r.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(p){Or(r,i,p)}else l.current=null}function fg(r,i,l){try{l()}catch(p){Or(r,i,p)}}var lx=!1;function tT(r,i){if(Ym=ip,r=k0(),Hg(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var p=l.getSelection&&l.getSelection();if(p&&p.rangeCount!==0){l=p.anchorNode;var x=p.anchorOffset,T=p.focusNode;p=p.focusOffset;try{l.nodeType,T.nodeType}catch{l=null;break e}var S=0,d=-1,$=-1,ne=0,ge=0,Q=r,V=null;t:for(;;){for(var Ce;Q!==l||x!==0&&Q.nodeType!==3||(d=S+x),Q!==T||p!==0&&Q.nodeType!==3||($=S+p),Q.nodeType===3&&(S+=Q.nodeValue.length),(Ce=Q.firstChild)!==null;)V=Q,Q=Ce;for(;;){if(Q===r)break t;if(V===l&&++ne===x&&(d=S),V===T&&++ge===p&&($=S),(Ce=Q.nextSibling)!==null)break;Q=V,V=Q.parentNode}Q=Ce}l=d===-1||$===-1?null:{start:d,end:$}}else l=null}l=l||{start:0,end:0}}else l=null;for(Jm={focusedElem:r,selectionRange:l},ip=!1,dt=i;dt!==null;)if(i=dt,r=i.child,(i.subtreeFlags&1028)!==0&&r!==null)r.return=i,dt=r;else for(;dt!==null;){i=dt;try{var Ee=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Ee!==null){var Me=Ee.memoizedProps,pt=Ee.memoizedState,oe=i.stateNode,ie=oe.getSnapshotBeforeUpdate(i.elementType===i.type?Me:xs(i.type,Me),pt);oe.__reactInternalSnapshotBeforeUpdate=ie}break;case 3:var de=i.stateNode.containerInfo;de.nodeType===1?de.textContent="":de.nodeType===9&&de.documentElement&&de.removeChild(de.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Be(163))}}catch(Pe){Or(i,i.return,Pe)}if(r=i.sibling,r!==null){r.return=i.return,dt=r;break}dt=i.return}return Ee=lx,lx=!1,Ee}function Gc(r,i,l){var p=i.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var x=p=p.next;do{if((x.tag&r)===r){var T=x.destroy;x.destroy=void 0,T!==void 0&&fg(i,l,T)}x=x.next}while(x!==p)}}function Dp(r,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var l=i=i.next;do{if((l.tag&r)===r){var p=l.create;l.destroy=p()}l=l.next}while(l!==i)}}function mg(r){var i=r.ref;if(i!==null){var l=r.stateNode;switch(r.tag){case 5:r=l;break;default:r=l}typeof i=="function"?i(r):i.current=r}}function ww(r){var i=r.alternate;i!==null&&(r.alternate=null,ww(i)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(i=r.stateNode,i!==null&&(delete i[Ns],delete i[sh],delete i[tg],delete i[BS],delete i[OS])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function bw(r){return r.tag===5||r.tag===3||r.tag===4}function ux(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||bw(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function gg(r,i,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,i?l.nodeType===8?l.parentNode.insertBefore(r,i):l.insertBefore(r,i):(l.nodeType===8?(i=l.parentNode,i.insertBefore(r,l)):(i=l,i.appendChild(r)),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=ap));else if(p!==4&&(r=r.child,r!==null))for(gg(r,i,l),r=r.sibling;r!==null;)gg(r,i,l),r=r.sibling}function yg(r,i,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,i?l.insertBefore(r,i):l.appendChild(r);else if(p!==4&&(r=r.child,r!==null))for(yg(r,i,l),r=r.sibling;r!==null;)yg(r,i,l),r=r.sibling}var zn=null,ws=!1;function Ho(r,i,l){for(l=l.child;l!==null;)Sw(r,i,l),l=l.sibling}function Sw(r,i,l){if(js&&typeof js.onCommitFiberUnmount=="function")try{js.onCommitFiberUnmount(kp,l)}catch{}switch(l.tag){case 5:Hn||tu(l,i);case 6:var p=zn,x=ws;zn=null,Ho(r,i,l),zn=p,ws=x,zn!==null&&(ws?(r=zn,l=l.stateNode,r.nodeType===8?r.parentNode.removeChild(l):r.removeChild(l)):zn.removeChild(l.stateNode));break;case 18:zn!==null&&(ws?(r=zn,l=l.stateNode,r.nodeType===8?gm(r.parentNode,l):r.nodeType===1&&gm(r,l),eh(r)):gm(zn,l.stateNode));break;case 4:p=zn,x=ws,zn=l.stateNode.containerInfo,ws=!0,Ho(r,i,l),zn=p,ws=x;break;case 0:case 11:case 14:case 15:if(!Hn&&(p=l.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){x=p=p.next;do{var T=x,S=T.destroy;T=T.tag,S!==void 0&&(T&2||T&4)&&fg(l,i,S),x=x.next}while(x!==p)}Ho(r,i,l);break;case 1:if(!Hn&&(tu(l,i),p=l.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=l.memoizedProps,p.state=l.memoizedState,p.componentWillUnmount()}catch(d){Or(l,i,d)}Ho(r,i,l);break;case 21:Ho(r,i,l);break;case 22:l.mode&1?(Hn=(p=Hn)||l.memoizedState!==null,Ho(r,i,l),Hn=p):Ho(r,i,l);break;default:Ho(r,i,l)}}function cx(r){var i=r.updateQueue;if(i!==null){r.updateQueue=null;var l=r.stateNode;l===null&&(l=r.stateNode=new eT),i.forEach(function(p){var x=cT.bind(null,r,p);l.has(p)||(l.add(p),p.then(x,x))})}}function ys(r,i){var l=i.deletions;if(l!==null)for(var p=0;p<l.length;p++){var x=l[p];try{var T=r,S=i,d=S;e:for(;d!==null;){switch(d.tag){case 5:zn=d.stateNode,ws=!1;break e;case 3:zn=d.stateNode.containerInfo,ws=!0;break e;case 4:zn=d.stateNode.containerInfo,ws=!0;break e}d=d.return}if(zn===null)throw Error(Be(160));Sw(T,S,x),zn=null,ws=!1;var $=x.alternate;$!==null&&($.return=null),x.return=null}catch(ne){Or(x,i,ne)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)Tw(i,r),i=i.sibling}function Tw(r,i){var l=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(ys(i,r),Bs(r),p&4){try{Gc(3,r,r.return),Dp(3,r)}catch(Me){Or(r,r.return,Me)}try{Gc(5,r,r.return)}catch(Me){Or(r,r.return,Me)}}break;case 1:ys(i,r),Bs(r),p&512&&l!==null&&tu(l,l.return);break;case 5:if(ys(i,r),Bs(r),p&512&&l!==null&&tu(l,l.return),r.flags&32){var x=r.stateNode;try{Kc(x,"")}catch(Me){Or(r,r.return,Me)}}if(p&4&&(x=r.stateNode,x!=null)){var T=r.memoizedProps,S=l!==null?l.memoizedProps:T,d=r.type,$=r.updateQueue;if(r.updateQueue=null,$!==null)try{d==="input"&&T.type==="radio"&&T.name!=null&&Gx(x,T),Vm(d,S);var ne=Vm(d,T);for(S=0;S<$.length;S+=2){var ge=$[S],Q=$[S+1];ge==="style"?Yx(x,Q):ge==="dangerouslySetInnerHTML"?Xx(x,Q):ge==="children"?Kc(x,Q):Lg(x,ge,Q,ne)}switch(d){case"input":Fm(x,T);break;case"textarea":Hx(x,T);break;case"select":var V=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!T.multiple;var Ce=T.value;Ce!=null?nu(x,!!T.multiple,Ce,!1):V!==!!T.multiple&&(T.defaultValue!=null?nu(x,!!T.multiple,T.defaultValue,!0):nu(x,!!T.multiple,T.multiple?[]:"",!1))}x[sh]=T}catch(Me){Or(r,r.return,Me)}}break;case 6:if(ys(i,r),Bs(r),p&4){if(r.stateNode===null)throw Error(Be(162));x=r.stateNode,T=r.memoizedProps;try{x.nodeValue=T}catch(Me){Or(r,r.return,Me)}}break;case 3:if(ys(i,r),Bs(r),p&4&&l!==null&&l.memoizedState.isDehydrated)try{eh(i.containerInfo)}catch(Me){Or(r,r.return,Me)}break;case 4:ys(i,r),Bs(r);break;case 13:ys(i,r),Bs(r),x=r.child,x.flags&8192&&(T=x.memoizedState!==null,x.stateNode.isHidden=T,!T||x.alternate!==null&&x.alternate.memoizedState!==null||(py=qr())),p&4&&cx(r);break;case 22:if(ge=l!==null&&l.memoizedState!==null,r.mode&1?(Hn=(ne=Hn)||ge,ys(i,r),Hn=ne):ys(i,r),Bs(r),p&8192){if(ne=r.memoizedState!==null,(r.stateNode.isHidden=ne)&&!ge&&r.mode&1)for(dt=r,ge=r.child;ge!==null;){for(Q=dt=ge;dt!==null;){switch(V=dt,Ce=V.child,V.tag){case 0:case 11:case 14:case 15:Gc(4,V,V.return);break;case 1:tu(V,V.return);var Ee=V.stateNode;if(typeof Ee.componentWillUnmount=="function"){p=V,l=V.return;try{i=p,Ee.props=i.memoizedProps,Ee.state=i.memoizedState,Ee.componentWillUnmount()}catch(Me){Or(p,l,Me)}}break;case 5:tu(V,V.return);break;case 22:if(V.memoizedState!==null){dx(Q);continue}}Ce!==null?(Ce.return=V,dt=Ce):dx(Q)}ge=ge.sibling}e:for(ge=null,Q=r;;){if(Q.tag===5){if(ge===null){ge=Q;try{x=Q.stateNode,ne?(T=x.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(d=Q.stateNode,$=Q.memoizedProps.style,S=$!=null&&$.hasOwnProperty("display")?$.display:null,d.style.display=Kx("display",S))}catch(Me){Or(r,r.return,Me)}}}else if(Q.tag===6){if(ge===null)try{Q.stateNode.nodeValue=ne?"":Q.memoizedProps}catch(Me){Or(r,r.return,Me)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===r)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===r)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===r)break e;ge===Q&&(ge=null),Q=Q.return}ge===Q&&(ge=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:ys(i,r),Bs(r),p&4&&cx(r);break;case 21:break;default:ys(i,r),Bs(r)}}function Bs(r){var i=r.flags;if(i&2){try{e:{for(var l=r.return;l!==null;){if(bw(l)){var p=l;break e}l=l.return}throw Error(Be(160))}switch(p.tag){case 5:var x=p.stateNode;p.flags&32&&(Kc(x,""),p.flags&=-33);var T=ux(r);yg(r,T,x);break;case 3:case 4:var S=p.stateNode.containerInfo,d=ux(r);gg(r,d,S);break;default:throw Error(Be(161))}}catch($){Or(r,r.return,$)}r.flags&=-3}i&4096&&(r.flags&=-4097)}function rT(r,i,l){dt=r,kw(r)}function kw(r,i,l){for(var p=(r.mode&1)!==0;dt!==null;){var x=dt,T=x.child;if(x.tag===22&&p){var S=x.memoizedState!==null||Md;if(!S){var d=x.alternate,$=d!==null&&d.memoizedState!==null||Hn;d=Md;var ne=Hn;if(Md=S,(Hn=$)&&!ne)for(dt=x;dt!==null;)S=dt,$=S.child,S.tag===22&&S.memoizedState!==null?px(x):$!==null?($.return=S,dt=$):px(x);for(;T!==null;)dt=T,kw(T),T=T.sibling;dt=x,Md=d,Hn=ne}hx(r)}else x.subtreeFlags&8772&&T!==null?(T.return=x,dt=T):hx(r)}}function hx(r){for(;dt!==null;){var i=dt;if(i.flags&8772){var l=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:Hn||Dp(5,i);break;case 1:var p=i.stateNode;if(i.flags&4&&!Hn)if(l===null)p.componentDidMount();else{var x=i.elementType===i.type?l.memoizedProps:xs(i.type,l.memoizedProps);p.componentDidUpdate(x,l.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var T=i.updateQueue;T!==null&&Xv(i,T,p);break;case 3:var S=i.updateQueue;if(S!==null){if(l=null,i.child!==null)switch(i.child.tag){case 5:l=i.child.stateNode;break;case 1:l=i.child.stateNode}Xv(i,S,l)}break;case 5:var d=i.stateNode;if(l===null&&i.flags&4){l=d;var $=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":$.autoFocus&&l.focus();break;case"img":$.src&&(l.src=$.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var ne=i.alternate;if(ne!==null){var ge=ne.memoizedState;if(ge!==null){var Q=ge.dehydrated;Q!==null&&eh(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Be(163))}Hn||i.flags&512&&mg(i)}catch(V){Or(i,i.return,V)}}if(i===r){dt=null;break}if(l=i.sibling,l!==null){l.return=i.return,dt=l;break}dt=i.return}}function dx(r){for(;dt!==null;){var i=dt;if(i===r){dt=null;break}var l=i.sibling;if(l!==null){l.return=i.return,dt=l;break}dt=i.return}}function px(r){for(;dt!==null;){var i=dt;try{switch(i.tag){case 0:case 11:case 15:var l=i.return;try{Dp(4,i)}catch($){Or(i,l,$)}break;case 1:var p=i.stateNode;if(typeof p.componentDidMount=="function"){var x=i.return;try{p.componentDidMount()}catch($){Or(i,x,$)}}var T=i.return;try{mg(i)}catch($){Or(i,T,$)}break;case 5:var S=i.return;try{mg(i)}catch($){Or(i,S,$)}}}catch($){Or(i,i.return,$)}if(i===r){dt=null;break}var d=i.sibling;if(d!==null){d.return=i.return,dt=d;break}dt=i.return}}var nT=Math.ceil,_p=go.ReactCurrentDispatcher,hy=go.ReactCurrentOwner,ts=go.ReactCurrentBatchConfig,Xt=0,bn=null,Jr=null,Dn=0,Ri=0,ru=da(0),on=0,hh=null,Ya=0,Lp=0,dy=0,Hc=null,_i=null,py=0,gu=1/0,so=null,vp=!1,_g=null,sa=null,zd=!1,Qo=null,xp=0,Wc=0,vg=null,Zd=-1,Gd=0;function ii(){return Xt&6?qr():Zd!==-1?Zd:Zd=qr()}function oa(r){return r.mode&1?Xt&2&&Dn!==0?Dn&-Dn:jS.transition!==null?(Gd===0&&(Gd=u0()),Gd):(r=or,r!==0||(r=window.event,r=r===void 0?16:g0(r.type)),r):1}function ks(r,i,l,p){if(50<Wc)throw Wc=0,vg=null,Error(Be(185));ph(r,l,p),(!(Xt&2)||r!==bn)&&(r===bn&&(!(Xt&2)&&(Lp|=l),on===4&&Yo(r,Dn)),bi(r,p),l===1&&Xt===0&&!(i.mode&1)&&(gu=qr()+500,Ap&&pa()))}function bi(r,i){var l=r.callbackNode;j2(r,i);var p=np(r,r===bn?Dn:0);if(p===0)l!==null&&bv(l),r.callbackNode=null,r.callbackPriority=0;else if(i=p&-p,r.callbackPriority!==i){if(l!=null&&bv(l),i===1)r.tag===0?NS(fx.bind(null,r)):R0(fx.bind(null,r)),RS(function(){!(Xt&6)&&pa()}),l=null;else{switch(c0(p)){case 1:l=Ng;break;case 4:l=a0;break;case 16:l=rp;break;case 536870912:l=l0;break;default:l=rp}l=Dw(l,Cw.bind(null,r))}r.callbackPriority=i,r.callbackNode=l}}function Cw(r,i){if(Zd=-1,Gd=0,Xt&6)throw Error(Be(327));var l=r.callbackNode;if(lu()&&r.callbackNode!==l)return null;var p=np(r,r===bn?Dn:0);if(p===0)return null;if(p&30||p&r.expiredLanes||i)i=wp(r,p);else{i=p;var x=Xt;Xt|=2;var T=Iw();(bn!==r||Dn!==i)&&(so=null,gu=qr()+500,Ga(r,i));do try{oT();break}catch(d){Ew(r,d)}while(!0);Jg(),_p.current=T,Xt=x,Jr!==null?i=0:(bn=null,Dn=0,i=on)}if(i!==0){if(i===2&&(x=Gm(r),x!==0&&(p=x,i=xg(r,x))),i===1)throw l=hh,Ga(r,0),Yo(r,p),bi(r,qr()),l;if(i===6)Yo(r,p);else{if(x=r.current.alternate,!(p&30)&&!iT(x)&&(i=wp(r,p),i===2&&(T=Gm(r),T!==0&&(p=T,i=xg(r,T))),i===1))throw l=hh,Ga(r,0),Yo(r,p),bi(r,qr()),l;switch(r.finishedWork=x,r.finishedLanes=p,i){case 0:case 1:throw Error(Be(345));case 2:Ua(r,_i,so);break;case 3:if(Yo(r,p),(p&130023424)===p&&(i=py+500-qr(),10<i)){if(np(r,0)!==0)break;if(x=r.suspendedLanes,(x&p)!==p){ii(),r.pingedLanes|=r.suspendedLanes&x;break}r.timeoutHandle=eg(Ua.bind(null,r,_i,so),i);break}Ua(r,_i,so);break;case 4:if(Yo(r,p),(p&4194240)===p)break;for(i=r.eventTimes,x=-1;0<p;){var S=31-Ts(p);T=1<<S,S=i[S],S>x&&(x=S),p&=~T}if(p=x,p=qr()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*nT(p/1960))-p,10<p){r.timeoutHandle=eg(Ua.bind(null,r,_i,so),p);break}Ua(r,_i,so);break;case 5:Ua(r,_i,so);break;default:throw Error(Be(329))}}}return bi(r,qr()),r.callbackNode===l?Cw.bind(null,r):null}function xg(r,i){var l=Hc;return r.current.memoizedState.isDehydrated&&(Ga(r,i).flags|=256),r=wp(r,i),r!==2&&(i=_i,_i=l,i!==null&&wg(i)),r}function wg(r){_i===null?_i=r:_i.push.apply(_i,r)}function iT(r){for(var i=r;;){if(i.flags&16384){var l=i.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var p=0;p<l.length;p++){var x=l[p],T=x.getSnapshot;x=x.value;try{if(!Cs(T(),x))return!1}catch{return!1}}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Yo(r,i){for(i&=~dy,i&=~Lp,r.suspendedLanes|=i,r.pingedLanes&=~i,r=r.expirationTimes;0<i;){var l=31-Ts(i),p=1<<l;r[l]=-1,i&=~p}}function fx(r){if(Xt&6)throw Error(Be(327));lu();var i=np(r,0);if(!(i&1))return bi(r,qr()),null;var l=wp(r,i);if(r.tag!==0&&l===2){var p=Gm(r);p!==0&&(i=p,l=xg(r,p))}if(l===1)throw l=hh,Ga(r,0),Yo(r,i),bi(r,qr()),l;if(l===6)throw Error(Be(345));return r.finishedWork=r.current.alternate,r.finishedLanes=i,Ua(r,_i,so),bi(r,qr()),null}function fy(r,i){var l=Xt;Xt|=1;try{return r(i)}finally{Xt=l,Xt===0&&(gu=qr()+500,Ap&&pa())}}function Ja(r){Qo!==null&&Qo.tag===0&&!(Xt&6)&&lu();var i=Xt;Xt|=1;var l=ts.transition,p=or;try{if(ts.transition=null,or=1,r)return r()}finally{or=p,ts.transition=l,Xt=i,!(Xt&6)&&pa()}}function my(){Ri=ru.current,Sr(ru)}function Ga(r,i){r.finishedWork=null,r.finishedLanes=0;var l=r.timeoutHandle;if(l!==-1&&(r.timeoutHandle=-1,LS(l)),Jr!==null)for(l=Jr.return;l!==null;){var p=l;switch(Xg(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&lp();break;case 3:fu(),Sr(xi),Sr(Wn),iy();break;case 5:ny(p);break;case 4:fu();break;case 13:Sr(Dr);break;case 19:Sr(Dr);break;case 10:Qg(p.type._context);break;case 22:case 23:my()}l=l.return}if(bn=r,Jr=r=aa(r.current,null),Dn=Ri=i,on=0,hh=null,dy=Lp=Ya=0,_i=Hc=null,qa!==null){for(i=0;i<qa.length;i++)if(l=qa[i],p=l.interleaved,p!==null){l.interleaved=null;var x=p.next,T=l.pending;if(T!==null){var S=T.next;T.next=x,p.next=S}l.pending=p}qa=null}return r}function Ew(r,i){do{var l=Jr;try{if(Jg(),Ud.current=yp,gp){for(var p=Lr.memoizedState;p!==null;){var x=p.queue;x!==null&&(x.pending=null),p=p.next}gp=!1}if(Ka=0,wn=sn=Lr=null,Zc=!1,lh=0,hy.current=null,l===null||l.return===null){on=1,hh=i,Jr=null;break}e:{var T=r,S=l.return,d=l,$=i;if(i=Dn,d.flags|=32768,$!==null&&typeof $=="object"&&typeof $.then=="function"){var ne=$,ge=d,Q=ge.tag;if(!(ge.mode&1)&&(Q===0||Q===11||Q===15)){var V=ge.alternate;V?(ge.updateQueue=V.updateQueue,ge.memoizedState=V.memoizedState,ge.lanes=V.lanes):(ge.updateQueue=null,ge.memoizedState=null)}var Ce=tx(S);if(Ce!==null){Ce.flags&=-257,rx(Ce,S,d,T,i),Ce.mode&1&&ex(T,ne,i),i=Ce,$=ne;var Ee=i.updateQueue;if(Ee===null){var Me=new Set;Me.add($),i.updateQueue=Me}else Ee.add($);break e}else{if(!(i&1)){ex(T,ne,i),gy();break e}$=Error(Be(426))}}else if(Ir&&d.mode&1){var pt=tx(S);if(pt!==null){!(pt.flags&65536)&&(pt.flags|=256),rx(pt,S,d,T,i),Kg(mu($,d));break e}}T=$=mu($,d),on!==4&&(on=2),Hc===null?Hc=[T]:Hc.push(T),T=S;do{switch(T.tag){case 3:T.flags|=65536,i&=-i,T.lanes|=i;var oe=cw(T,$,i);Wv(T,oe);break e;case 1:d=$;var ie=T.type,de=T.stateNode;if(!(T.flags&128)&&(typeof ie.getDerivedStateFromError=="function"||de!==null&&typeof de.componentDidCatch=="function"&&(sa===null||!sa.has(de)))){T.flags|=65536,i&=-i,T.lanes|=i;var Pe=hw(T,d,i);Wv(T,Pe);break e}}T=T.return}while(T!==null)}Aw(l)}catch(qe){i=qe,Jr===l&&l!==null&&(Jr=l=l.return);continue}break}while(!0)}function Iw(){var r=_p.current;return _p.current=yp,r===null?yp:r}function gy(){(on===0||on===3||on===2)&&(on=4),bn===null||!(Ya&268435455)&&!(Lp&268435455)||Yo(bn,Dn)}function wp(r,i){var l=Xt;Xt|=2;var p=Iw();(bn!==r||Dn!==i)&&(so=null,Ga(r,i));do try{sT();break}catch(x){Ew(r,x)}while(!0);if(Jg(),Xt=l,_p.current=p,Jr!==null)throw Error(Be(261));return bn=null,Dn=0,on}function sT(){for(;Jr!==null;)Pw(Jr)}function oT(){for(;Jr!==null&&!M2();)Pw(Jr)}function Pw(r){var i=zw(r.alternate,r,Ri);r.memoizedProps=r.pendingProps,i===null?Aw(r):Jr=i,hy.current=null}function Aw(r){var i=r;do{var l=i.alternate;if(r=i.return,i.flags&32768){if(l=QS(l,i),l!==null){l.flags&=32767,Jr=l;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{on=6,Jr=null;return}}else if(l=JS(l,i,Ri),l!==null){Jr=l;return}if(i=i.sibling,i!==null){Jr=i;return}Jr=i=r}while(i!==null);on===0&&(on=5)}function Ua(r,i,l){var p=or,x=ts.transition;try{ts.transition=null,or=1,aT(r,i,l,p)}finally{ts.transition=x,or=p}return null}function aT(r,i,l,p){do lu();while(Qo!==null);if(Xt&6)throw Error(Be(327));l=r.finishedWork;var x=r.finishedLanes;if(l===null)return null;if(r.finishedWork=null,r.finishedLanes=0,l===r.current)throw Error(Be(177));r.callbackNode=null,r.callbackPriority=0;var T=l.lanes|l.childLanes;if(V2(r,T),r===bn&&(Jr=bn=null,Dn=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||zd||(zd=!0,Dw(rp,function(){return lu(),null})),T=(l.flags&15990)!==0,l.subtreeFlags&15990||T){T=ts.transition,ts.transition=null;var S=or;or=1;var d=Xt;Xt|=4,hy.current=null,tT(r,l),Tw(l,r),ES(Jm),ip=!!Ym,Jm=Ym=null,r.current=l,rT(l),z2(),Xt=d,or=S,ts.transition=T}else r.current=l;if(zd&&(zd=!1,Qo=r,xp=x),T=r.pendingLanes,T===0&&(sa=null),R2(l.stateNode),bi(r,qr()),i!==null)for(p=r.onRecoverableError,l=0;l<i.length;l++)x=i[l],p(x.value,{componentStack:x.stack,digest:x.digest});if(vp)throw vp=!1,r=_g,_g=null,r;return xp&1&&r.tag!==0&&lu(),T=r.pendingLanes,T&1?r===vg?Wc++:(Wc=0,vg=r):Wc=0,pa(),null}function lu(){if(Qo!==null){var r=c0(xp),i=ts.transition,l=or;try{if(ts.transition=null,or=16>r?16:r,Qo===null)var p=!1;else{if(r=Qo,Qo=null,xp=0,Xt&6)throw Error(Be(331));var x=Xt;for(Xt|=4,dt=r.current;dt!==null;){var T=dt,S=T.child;if(dt.flags&16){var d=T.deletions;if(d!==null){for(var $=0;$<d.length;$++){var ne=d[$];for(dt=ne;dt!==null;){var ge=dt;switch(ge.tag){case 0:case 11:case 15:Gc(8,ge,T)}var Q=ge.child;if(Q!==null)Q.return=ge,dt=Q;else for(;dt!==null;){ge=dt;var V=ge.sibling,Ce=ge.return;if(ww(ge),ge===ne){dt=null;break}if(V!==null){V.return=Ce,dt=V;break}dt=Ce}}}var Ee=T.alternate;if(Ee!==null){var Me=Ee.child;if(Me!==null){Ee.child=null;do{var pt=Me.sibling;Me.sibling=null,Me=pt}while(Me!==null)}}dt=T}}if(T.subtreeFlags&2064&&S!==null)S.return=T,dt=S;else e:for(;dt!==null;){if(T=dt,T.flags&2048)switch(T.tag){case 0:case 11:case 15:Gc(9,T,T.return)}var oe=T.sibling;if(oe!==null){oe.return=T.return,dt=oe;break e}dt=T.return}}var ie=r.current;for(dt=ie;dt!==null;){S=dt;var de=S.child;if(S.subtreeFlags&2064&&de!==null)de.return=S,dt=de;else e:for(S=ie;dt!==null;){if(d=dt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:Dp(9,d)}}catch(qe){Or(d,d.return,qe)}if(d===S){dt=null;break e}var Pe=d.sibling;if(Pe!==null){Pe.return=d.return,dt=Pe;break e}dt=d.return}}if(Xt=x,pa(),js&&typeof js.onPostCommitFiberRoot=="function")try{js.onPostCommitFiberRoot(kp,r)}catch{}p=!0}return p}finally{or=l,ts.transition=i}}return!1}function mx(r,i,l){i=mu(l,i),i=cw(r,i,1),r=ia(r,i,1),i=ii(),r!==null&&(ph(r,1,i),bi(r,i))}function Or(r,i,l){if(r.tag===3)mx(r,r,l);else for(;i!==null;){if(i.tag===3){mx(i,r,l);break}else if(i.tag===1){var p=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(sa===null||!sa.has(p))){r=mu(l,r),r=hw(i,r,1),i=ia(i,r,1),r=ii(),i!==null&&(ph(i,1,r),bi(i,r));break}}i=i.return}}function lT(r,i,l){var p=r.pingCache;p!==null&&p.delete(i),i=ii(),r.pingedLanes|=r.suspendedLanes&l,bn===r&&(Dn&l)===l&&(on===4||on===3&&(Dn&130023424)===Dn&&500>qr()-py?Ga(r,0):dy|=l),bi(r,i)}function Mw(r,i){i===0&&(r.mode&1?(i=bd,bd<<=1,!(bd&130023424)&&(bd=4194304)):i=1);var l=ii();r=fo(r,i),r!==null&&(ph(r,i,l),bi(r,l))}function uT(r){var i=r.memoizedState,l=0;i!==null&&(l=i.retryLane),Mw(r,l)}function cT(r,i){var l=0;switch(r.tag){case 13:var p=r.stateNode,x=r.memoizedState;x!==null&&(l=x.retryLane);break;case 19:p=r.stateNode;break;default:throw Error(Be(314))}p!==null&&p.delete(i),Mw(r,l)}var zw;zw=function(r,i,l){if(r!==null)if(r.memoizedProps!==i.pendingProps||xi.current)vi=!0;else{if(!(r.lanes&l)&&!(i.flags&128))return vi=!1,YS(r,i,l);vi=!!(r.flags&131072)}else vi=!1,Ir&&i.flags&1048576&&F0(i,hp,i.index);switch(i.lanes=0,i.tag){case 2:var p=i.type;qd(r,i),r=i.pendingProps;var x=hu(i,Wn.current);au(i,l),x=oy(null,i,p,r,x,l);var T=ay();return i.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,wi(p)?(T=!0,up(i)):T=!1,i.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,ty(i),x.updater=zp,i.stateNode=x,x._reactInternals=i,ag(i,p,r,l),i=cg(null,i,p,!0,T,l)):(i.tag=0,Ir&&T&&Wg(i),ni(null,i,x,l),i=i.child),i;case 16:p=i.elementType;e:{switch(qd(r,i),r=i.pendingProps,x=p._init,p=x(p._payload),i.type=p,x=i.tag=dT(p),r=xs(p,r),x){case 0:i=ug(null,i,p,r,l);break e;case 1:i=sx(null,i,p,r,l);break e;case 11:i=nx(null,i,p,r,l);break e;case 14:i=ix(null,i,p,xs(p.type,r),l);break e}throw Error(Be(306,p,""))}return i;case 0:return p=i.type,x=i.pendingProps,x=i.elementType===p?x:xs(p,x),ug(r,i,p,x,l);case 1:return p=i.type,x=i.pendingProps,x=i.elementType===p?x:xs(p,x),sx(r,i,p,x,l);case 3:e:{if(mw(i),r===null)throw Error(Be(387));p=i.pendingProps,T=i.memoizedState,x=T.element,U0(r,i),fp(i,p,null,l);var S=i.memoizedState;if(p=S.element,T.isDehydrated)if(T={element:p,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},i.updateQueue.baseState=T,i.memoizedState=T,i.flags&256){x=mu(Error(Be(423)),i),i=ox(r,i,p,l,x);break e}else if(p!==x){x=mu(Error(Be(424)),i),i=ox(r,i,p,l,x);break e}else for(Fi=na(i.stateNode.containerInfo.firstChild),Bi=i,Ir=!0,Ss=null,l=j0(i,null,p,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(du(),p===x){i=mo(r,i,l);break e}ni(r,i,p,l)}i=i.child}return i;case 5:return $0(i),r===null&&ig(i),p=i.type,x=i.pendingProps,T=r!==null?r.memoizedProps:null,S=x.children,Qm(p,x)?S=null:T!==null&&Qm(p,T)&&(i.flags|=32),fw(r,i),ni(r,i,S,l),i.child;case 6:return r===null&&ig(i),null;case 13:return gw(r,i,l);case 4:return ry(i,i.stateNode.containerInfo),p=i.pendingProps,r===null?i.child=pu(i,null,p,l):ni(r,i,p,l),i.child;case 11:return p=i.type,x=i.pendingProps,x=i.elementType===p?x:xs(p,x),nx(r,i,p,x,l);case 7:return ni(r,i,i.pendingProps,l),i.child;case 8:return ni(r,i,i.pendingProps.children,l),i.child;case 12:return ni(r,i,i.pendingProps.children,l),i.child;case 10:e:{if(p=i.type._context,x=i.pendingProps,T=i.memoizedProps,S=x.value,_r(dp,p._currentValue),p._currentValue=S,T!==null)if(Cs(T.value,S)){if(T.children===x.children&&!xi.current){i=mo(r,i,l);break e}}else for(T=i.child,T!==null&&(T.return=i);T!==null;){var d=T.dependencies;if(d!==null){S=T.child;for(var $=d.firstContext;$!==null;){if($.context===p){if(T.tag===1){$=co(-1,l&-l),$.tag=2;var ne=T.updateQueue;if(ne!==null){ne=ne.shared;var ge=ne.pending;ge===null?$.next=$:($.next=ge.next,ge.next=$),ne.pending=$}}T.lanes|=l,$=T.alternate,$!==null&&($.lanes|=l),sg(T.return,l,i),d.lanes|=l;break}$=$.next}}else if(T.tag===10)S=T.type===i.type?null:T.child;else if(T.tag===18){if(S=T.return,S===null)throw Error(Be(341));S.lanes|=l,d=S.alternate,d!==null&&(d.lanes|=l),sg(S,l,i),S=T.sibling}else S=T.child;if(S!==null)S.return=T;else for(S=T;S!==null;){if(S===i){S=null;break}if(T=S.sibling,T!==null){T.return=S.return,S=T;break}S=S.return}T=S}ni(r,i,x.children,l),i=i.child}return i;case 9:return x=i.type,p=i.pendingProps.children,au(i,l),x=rs(x),p=p(x),i.flags|=1,ni(r,i,p,l),i.child;case 14:return p=i.type,x=xs(p,i.pendingProps),x=xs(p.type,x),ix(r,i,p,x,l);case 15:return dw(r,i,i.type,i.pendingProps,l);case 17:return p=i.type,x=i.pendingProps,x=i.elementType===p?x:xs(p,x),qd(r,i),i.tag=1,wi(p)?(r=!0,up(i)):r=!1,au(i,l),uw(i,p,x),ag(i,p,x,l),cg(null,i,p,!0,r,l);case 19:return yw(r,i,l);case 22:return pw(r,i,l)}throw Error(Be(156,i.tag))};function Dw(r,i){return o0(r,i)}function hT(r,i,l,p){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function es(r,i,l,p){return new hT(r,i,l,p)}function yy(r){return r=r.prototype,!(!r||!r.isReactComponent)}function dT(r){if(typeof r=="function")return yy(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Fg)return 11;if(r===Bg)return 14}return 2}function aa(r,i){var l=r.alternate;return l===null?(l=es(r.tag,i,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=i,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&14680064,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,i=r.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l}function Hd(r,i,l,p,x,T){var S=2;if(p=r,typeof r=="function")yy(r)&&(S=1);else if(typeof r=="string")S=5;else e:switch(r){case Gl:return Ha(l.children,x,T,i);case Rg:S=8,x|=8;break;case Mm:return r=es(12,l,i,x|2),r.elementType=Mm,r.lanes=T,r;case zm:return r=es(13,l,i,x),r.elementType=zm,r.lanes=T,r;case Dm:return r=es(19,l,i,x),r.elementType=Dm,r.lanes=T,r;case $x:return Rp(l,x,T,i);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Vx:S=10;break e;case Ux:S=9;break e;case Fg:S=11;break e;case Bg:S=14;break e;case Wo:S=16,p=null;break e}throw Error(Be(130,r==null?r:typeof r,""))}return i=es(S,l,i,x),i.elementType=r,i.type=p,i.lanes=T,i}function Ha(r,i,l,p){return r=es(7,r,p,i),r.lanes=l,r}function Rp(r,i,l,p){return r=es(22,r,p,i),r.elementType=$x,r.lanes=l,r.stateNode={isHidden:!1},r}function Tm(r,i,l){return r=es(6,r,null,i),r.lanes=l,r}function km(r,i,l){return i=es(4,r.children!==null?r.children:[],r.key,i),i.lanes=l,i.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},i}function pT(r,i,l,p,x){this.tag=i,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sm(0),this.expirationTimes=sm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sm(0),this.identifierPrefix=p,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function _y(r,i,l,p,x,T,S,d,$){return r=new pT(r,i,l,d,$),i===1?(i=1,T===!0&&(i|=8)):i=0,T=es(3,null,null,i),r.current=T,T.stateNode=r,T.memoizedState={element:p,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},ty(T),r}function fT(r,i,l){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Zl,key:p==null?null:""+p,children:r,containerInfo:i,implementation:l}}function Lw(r){if(!r)return ca;r=r._reactInternals;e:{if(el(r)!==r||r.tag!==1)throw Error(Be(170));var i=r;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(wi(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(Be(171))}if(r.tag===1){var l=r.type;if(wi(l))return L0(r,l,i)}return i}function Rw(r,i,l,p,x,T,S,d,$){return r=_y(l,p,!0,r,x,T,S,d,$),r.context=Lw(null),l=r.current,p=ii(),x=oa(l),T=co(p,x),T.callback=i??null,ia(l,T,x),r.current.lanes=x,ph(r,x,p),bi(r,p),r}function Fp(r,i,l,p){var x=i.current,T=ii(),S=oa(x);return l=Lw(l),i.context===null?i.context=l:i.pendingContext=l,i=co(T,S),i.payload={element:r},p=p===void 0?null:p,p!==null&&(i.callback=p),r=ia(x,i,S),r!==null&&(ks(r,x,S,T),Vd(r,x,S)),S}function bp(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function gx(r,i){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<i?l:i}}function vy(r,i){gx(r,i),(r=r.alternate)&&gx(r,i)}function mT(){return null}var Fw=typeof reportError=="function"?reportError:function(r){console.error(r)};function xy(r){this._internalRoot=r}Bp.prototype.render=xy.prototype.render=function(r){var i=this._internalRoot;if(i===null)throw Error(Be(409));Fp(r,i,null,null)};Bp.prototype.unmount=xy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var i=r.containerInfo;Ja(function(){Fp(null,r,null,null)}),i[po]=null}};function Bp(r){this._internalRoot=r}Bp.prototype.unstable_scheduleHydration=function(r){if(r){var i=p0();r={blockedOn:null,target:r,priority:i};for(var l=0;l<Ko.length&&i!==0&&i<Ko[l].priority;l++);Ko.splice(l,0,r),l===0&&m0(r)}};function wy(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Op(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function yx(){}function gT(r,i,l,p,x){if(x){if(typeof p=="function"){var T=p;p=function(){var ne=bp(S);T.call(ne)}}var S=Rw(i,p,r,0,null,!1,!1,"",yx);return r._reactRootContainer=S,r[po]=S.current,nh(r.nodeType===8?r.parentNode:r),Ja(),S}for(;x=r.lastChild;)r.removeChild(x);if(typeof p=="function"){var d=p;p=function(){var ne=bp($);d.call(ne)}}var $=_y(r,0,!1,null,null,!1,!1,"",yx);return r._reactRootContainer=$,r[po]=$.current,nh(r.nodeType===8?r.parentNode:r),Ja(function(){Fp(i,$,l,p)}),$}function Np(r,i,l,p,x){var T=l._reactRootContainer;if(T){var S=T;if(typeof x=="function"){var d=x;x=function(){var $=bp(S);d.call($)}}Fp(i,S,r,x)}else S=gT(l,i,r,x,p);return bp(S)}h0=function(r){switch(r.tag){case 3:var i=r.stateNode;if(i.current.memoizedState.isDehydrated){var l=Bc(i.pendingLanes);l!==0&&(jg(i,l|1),bi(i,qr()),!(Xt&6)&&(gu=qr()+500,pa()))}break;case 13:Ja(function(){var p=fo(r,1);if(p!==null){var x=ii();ks(p,r,1,x)}}),vy(r,1)}};Vg=function(r){if(r.tag===13){var i=fo(r,134217728);if(i!==null){var l=ii();ks(i,r,134217728,l)}vy(r,134217728)}};d0=function(r){if(r.tag===13){var i=oa(r),l=fo(r,i);if(l!==null){var p=ii();ks(l,r,i,p)}vy(r,i)}};p0=function(){return or};f0=function(r,i){var l=or;try{return or=r,i()}finally{or=l}};$m=function(r,i,l){switch(i){case"input":if(Fm(r,l),i=l.name,l.type==="radio"&&i!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<l.length;i++){var p=l[i];if(p!==r&&p.form===r.form){var x=Pp(p);if(!x)throw Error(Be(90));Zx(p),Fm(p,x)}}}break;case"textarea":Hx(r,l);break;case"select":i=l.value,i!=null&&nu(r,!!l.multiple,i,!1)}};e0=fy;t0=Ja;var yT={usingClientEntryPoint:!1,Events:[mh,Kl,Pp,Jx,Qx,fy]},Dc={findFiberByHostInstance:$a,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_T={bundleType:Dc.bundleType,version:Dc.version,rendererPackageName:Dc.rendererPackageName,rendererConfig:Dc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:go.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=i0(r),r===null?null:r.stateNode},findFiberByHostInstance:Dc.findFiberByHostInstance||mT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dd.isDisabled&&Dd.supportsFiber)try{kp=Dd.inject(_T),js=Dd}catch{}}Ni.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yT;Ni.createPortal=function(r,i){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!wy(i))throw Error(Be(200));return fT(r,i,null,l)};Ni.createRoot=function(r,i){if(!wy(r))throw Error(Be(299));var l=!1,p="",x=Fw;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(p=i.identifierPrefix),i.onRecoverableError!==void 0&&(x=i.onRecoverableError)),i=_y(r,1,!1,null,null,l,!1,p,x),r[po]=i.current,nh(r.nodeType===8?r.parentNode:r),new xy(i)};Ni.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var i=r._reactInternals;if(i===void 0)throw typeof r.render=="function"?Error(Be(188)):(r=Object.keys(r).join(","),Error(Be(268,r)));return r=i0(i),r=r===null?null:r.stateNode,r};Ni.flushSync=function(r){return Ja(r)};Ni.hydrate=function(r,i,l){if(!Op(i))throw Error(Be(200));return Np(null,r,i,!0,l)};Ni.hydrateRoot=function(r,i,l){if(!wy(r))throw Error(Be(405));var p=l!=null&&l.hydratedSources||null,x=!1,T="",S=Fw;if(l!=null&&(l.unstable_strictMode===!0&&(x=!0),l.identifierPrefix!==void 0&&(T=l.identifierPrefix),l.onRecoverableError!==void 0&&(S=l.onRecoverableError)),i=Rw(i,null,r,1,l??null,x,!1,T,S),r[po]=i.current,nh(r),p)for(r=0;r<p.length;r++)l=p[r],x=l._getVersion,x=x(l._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[l,x]:i.mutableSourceEagerHydrationData.push(l,x);return new Bp(i)};Ni.render=function(r,i,l){if(!Op(i))throw Error(Be(200));return Np(null,r,i,!1,l)};Ni.unmountComponentAtNode=function(r){if(!Op(r))throw Error(Be(40));return r._reactRootContainer?(Ja(function(){Np(null,null,r,!1,function(){r._reactRootContainer=null,r[po]=null})}),!0):!1};Ni.unstable_batchedUpdates=fy;Ni.unstable_renderSubtreeIntoContainer=function(r,i,l,p){if(!Op(l))throw Error(Be(200));if(r==null||r._reactInternals===void 0)throw Error(Be(38));return Np(r,i,l,!1,p)};Ni.version="18.3.1-next-f1338f8080-20240426";function Bw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Bw)}catch(r){console.error(r)}}Bw(),Bx.exports=Ni;var vT=Bx.exports,_x=vT;Pm.createRoot=_x.createRoot,Pm.hydrateRoot=_x.hydrateRoot;const Us=Object.create(null);Us.open="0";Us.close="1";Us.ping="2";Us.pong="3";Us.message="4";Us.upgrade="5";Us.noop="6";const Wd=Object.create(null);Object.keys(Us).forEach(r=>{Wd[Us[r]]=r});const bg={type:"error",data:"parser error"},Ow=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Nw=typeof ArrayBuffer=="function",jw=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,by=({type:r,data:i},l,p)=>Ow&&i instanceof Blob?l?p(i):vx(i,p):Nw&&(i instanceof ArrayBuffer||jw(i))?l?p(i):vx(new Blob([i]),p):p(Us[r]+(i||"")),vx=(r,i)=>{const l=new FileReader;return l.onload=function(){const p=l.result.split(",")[1];i("b"+(p||""))},l.readAsDataURL(r)};function xx(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let Cm;function xT(r,i){if(Ow&&r.data instanceof Blob)return r.data.arrayBuffer().then(xx).then(i);if(Nw&&(r.data instanceof ArrayBuffer||jw(r.data)))return i(xx(r.data));by(r,!1,l=>{Cm||(Cm=new TextEncoder),i(Cm.encode(l))})}const wx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Nc=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<wx.length;r++)Nc[wx.charCodeAt(r)]=r;const wT=r=>{let i=r.length*.75,l=r.length,p,x=0,T,S,d,$;r[r.length-1]==="="&&(i--,r[r.length-2]==="="&&i--);const ne=new ArrayBuffer(i),ge=new Uint8Array(ne);for(p=0;p<l;p+=4)T=Nc[r.charCodeAt(p)],S=Nc[r.charCodeAt(p+1)],d=Nc[r.charCodeAt(p+2)],$=Nc[r.charCodeAt(p+3)],ge[x++]=T<<2|S>>4,ge[x++]=(S&15)<<4|d>>2,ge[x++]=(d&3)<<6|$&63;return ne},bT=typeof ArrayBuffer=="function",Sy=(r,i)=>{if(typeof r!="string")return{type:"message",data:Vw(r,i)};const l=r.charAt(0);return l==="b"?{type:"message",data:ST(r.substring(1),i)}:Wd[l]?r.length>1?{type:Wd[l],data:r.substring(1)}:{type:Wd[l]}:bg},ST=(r,i)=>{if(bT){const l=wT(r);return Vw(l,i)}else return{base64:!0,data:r}},Vw=(r,i)=>{switch(i){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Uw="",TT=(r,i)=>{const l=r.length,p=new Array(l);let x=0;r.forEach((T,S)=>{by(T,!1,d=>{p[S]=d,++x===l&&i(p.join(Uw))})})},kT=(r,i)=>{const l=r.split(Uw),p=[];for(let x=0;x<l.length;x++){const T=Sy(l[x],i);if(p.push(T),T.type==="error")break}return p};function CT(){return new TransformStream({transform(r,i){xT(r,l=>{const p=l.length;let x;if(p<126)x=new Uint8Array(1),new DataView(x.buffer).setUint8(0,p);else if(p<65536){x=new Uint8Array(3);const T=new DataView(x.buffer);T.setUint8(0,126),T.setUint16(1,p)}else{x=new Uint8Array(9);const T=new DataView(x.buffer);T.setUint8(0,127),T.setBigUint64(1,BigInt(p))}r.data&&typeof r.data!="string"&&(x[0]|=128),i.enqueue(x),i.enqueue(l)})}})}let Em;function Ld(r){return r.reduce((i,l)=>i+l.length,0)}function Rd(r,i){if(r[0].length===i)return r.shift();const l=new Uint8Array(i);let p=0;for(let x=0;x<i;x++)l[x]=r[0][p++],p===r[0].length&&(r.shift(),p=0);return r.length&&p<r[0].length&&(r[0]=r[0].slice(p)),l}function ET(r,i){Em||(Em=new TextDecoder);const l=[];let p=0,x=-1,T=!1;return new TransformStream({transform(S,d){for(l.push(S);;){if(p===0){if(Ld(l)<1)break;const $=Rd(l,1);T=($[0]&128)===128,x=$[0]&127,x<126?p=3:x===126?p=1:p=2}else if(p===1){if(Ld(l)<2)break;const $=Rd(l,2);x=new DataView($.buffer,$.byteOffset,$.length).getUint16(0),p=3}else if(p===2){if(Ld(l)<8)break;const $=Rd(l,8),ne=new DataView($.buffer,$.byteOffset,$.length),ge=ne.getUint32(0);if(ge>Math.pow(2,21)-1){d.enqueue(bg);break}x=ge*Math.pow(2,32)+ne.getUint32(4),p=3}else{if(Ld(l)<x)break;const $=Rd(l,x);d.enqueue(Sy(T?$:Em.decode($),i)),p=0}if(x===0||x>r){d.enqueue(bg);break}}}})}const $w=4;function Qr(r){if(r)return IT(r)}function IT(r){for(var i in Qr.prototype)r[i]=Qr.prototype[i];return r}Qr.prototype.on=Qr.prototype.addEventListener=function(r,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(i),this};Qr.prototype.once=function(r,i){function l(){this.off(r,l),i.apply(this,arguments)}return l.fn=i,this.on(r,l),this};Qr.prototype.off=Qr.prototype.removeListener=Qr.prototype.removeAllListeners=Qr.prototype.removeEventListener=function(r,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var l=this._callbacks["$"+r];if(!l)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var p,x=0;x<l.length;x++)if(p=l[x],p===i||p.fn===i){l.splice(x,1);break}return l.length===0&&delete this._callbacks["$"+r],this};Qr.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),l=this._callbacks["$"+r],p=1;p<arguments.length;p++)i[p-1]=arguments[p];if(l){l=l.slice(0);for(var p=0,x=l.length;p<x;++p)l[p].apply(this,i)}return this};Qr.prototype.emitReserved=Qr.prototype.emit;Qr.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Qr.prototype.hasListeners=function(r){return!!this.listeners(r).length};const jp=typeof Promise=="function"&&typeof Promise.resolve=="function"?i=>Promise.resolve().then(i):(i,l)=>l(i,0),Qi=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),PT="arraybuffer";function qw(r,...i){return i.reduce((l,p)=>(r.hasOwnProperty(p)&&(l[p]=r[p]),l),{})}const AT=Qi.setTimeout,MT=Qi.clearTimeout;function Vp(r,i){i.useNativeTimers?(r.setTimeoutFn=AT.bind(Qi),r.clearTimeoutFn=MT.bind(Qi)):(r.setTimeoutFn=Qi.setTimeout.bind(Qi),r.clearTimeoutFn=Qi.clearTimeout.bind(Qi))}const zT=1.33;function DT(r){return typeof r=="string"?LT(r):Math.ceil((r.byteLength||r.size)*zT)}function LT(r){let i=0,l=0;for(let p=0,x=r.length;p<x;p++)i=r.charCodeAt(p),i<128?l+=1:i<2048?l+=2:i<55296||i>=57344?l+=3:(p++,l+=4);return l}function Zw(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function RT(r){let i="";for(let l in r)r.hasOwnProperty(l)&&(i.length&&(i+="&"),i+=encodeURIComponent(l)+"="+encodeURIComponent(r[l]));return i}function FT(r){let i={},l=r.split("&");for(let p=0,x=l.length;p<x;p++){let T=l[p].split("=");i[decodeURIComponent(T[0])]=decodeURIComponent(T[1])}return i}class BT extends Error{constructor(i,l,p){super(i),this.description=l,this.context=p,this.type="TransportError"}}class Ty extends Qr{constructor(i){super(),this.writable=!1,Vp(this,i),this.opts=i,this.query=i.query,this.socket=i.socket,this.supportsBinary=!i.forceBase64}onError(i,l,p){return super.emitReserved("error",new BT(i,l,p)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(i){this.readyState==="open"&&this.write(i)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(i){const l=Sy(i,this.socket.binaryType);this.onPacket(l)}onPacket(i){super.emitReserved("packet",i)}onClose(i){this.readyState="closed",super.emitReserved("close",i)}pause(i){}createUri(i,l={}){return i+"://"+this._hostname()+this._port()+this.opts.path+this._query(l)}_hostname(){const i=this.opts.hostname;return i.indexOf(":")===-1?i:"["+i+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(i){const l=RT(i);return l.length?"?"+l:""}}class OT extends Ty{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(i){this.readyState="pausing";const l=()=>{this.readyState="paused",i()};if(this._polling||!this.writable){let p=0;this._polling&&(p++,this.once("pollComplete",function(){--p||l()})),this.writable||(p++,this.once("drain",function(){--p||l()}))}else l()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(i){const l=p=>{if(this.readyState==="opening"&&p.type==="open"&&this.onOpen(),p.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(p)};kT(i,this.socket.binaryType).forEach(l),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const i=()=>{this.write([{type:"close"}])};this.readyState==="open"?i():this.once("open",i)}write(i){this.writable=!1,TT(i,l=>{this.doWrite(l,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const i=this.opts.secure?"https":"http",l=this.query||{};return this.opts.timestampRequests!==!1&&(l[this.opts.timestampParam]=Zw()),!this.supportsBinary&&!l.sid&&(l.b64=1),this.createUri(i,l)}}let Gw=!1;try{Gw=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const NT=Gw;function jT(){}class VT extends OT{constructor(i){if(super(i),typeof location<"u"){const l=location.protocol==="https:";let p=location.port;p||(p=l?"443":"80"),this.xd=typeof location<"u"&&i.hostname!==location.hostname||p!==i.port}}doWrite(i,l){const p=this.request({method:"POST",data:i});p.on("success",l),p.on("error",(x,T)=>{this.onError("xhr post error",x,T)})}doPoll(){const i=this.request();i.on("data",this.onData.bind(this)),i.on("error",(l,p)=>{this.onError("xhr poll error",l,p)}),this.pollXhr=i}}let uu=class Xd extends Qr{constructor(i,l,p){super(),this.createRequest=i,Vp(this,p),this._opts=p,this._method=p.method||"GET",this._uri=l,this._data=p.data!==void 0?p.data:null,this._create()}_create(){var i;const l=qw(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");l.xdomain=!!this._opts.xd;const p=this._xhr=this.createRequest(l);try{p.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){p.setDisableHeaderCheck&&p.setDisableHeaderCheck(!0);for(let x in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(x)&&p.setRequestHeader(x,this._opts.extraHeaders[x])}}catch{}if(this._method==="POST")try{p.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{p.setRequestHeader("Accept","*/*")}catch{}(i=this._opts.cookieJar)===null||i===void 0||i.addCookies(p),"withCredentials"in p&&(p.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(p.timeout=this._opts.requestTimeout),p.onreadystatechange=()=>{var x;p.readyState===3&&((x=this._opts.cookieJar)===null||x===void 0||x.parseCookies(p.getResponseHeader("set-cookie"))),p.readyState===4&&(p.status===200||p.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof p.status=="number"?p.status:0)},0))},p.send(this._data)}catch(x){this.setTimeoutFn(()=>{this._onError(x)},0);return}typeof document<"u"&&(this._index=Xd.requestsCount++,Xd.requests[this._index]=this)}_onError(i){this.emitReserved("error",i,this._xhr),this._cleanup(!0)}_cleanup(i){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=jT,i)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Xd.requests[this._index],this._xhr=null}}_onLoad(){const i=this._xhr.responseText;i!==null&&(this.emitReserved("data",i),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};uu.requestsCount=0;uu.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",bx);else if(typeof addEventListener=="function"){const r="onpagehide"in Qi?"pagehide":"unload";addEventListener(r,bx,!1)}}function bx(){for(let r in uu.requests)uu.requests.hasOwnProperty(r)&&uu.requests[r].abort()}const UT=function(){const r=Hw({xdomain:!1});return r&&r.responseType!==null}();class $T extends VT{constructor(i){super(i);const l=i&&i.forceBase64;this.supportsBinary=UT&&!l}request(i={}){return Object.assign(i,{xd:this.xd},this.opts),new uu(Hw,this.uri(),i)}}function Hw(r){const i=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!i||NT))return new XMLHttpRequest}catch{}if(!i)try{return new Qi[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Ww=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class qT extends Ty{get name(){return"websocket"}doOpen(){const i=this.uri(),l=this.opts.protocols,p=Ww?{}:qw(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(p.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(i,l,p)}catch(x){return this.emitReserved("error",x)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=i=>this.onClose({description:"websocket connection closed",context:i}),this.ws.onmessage=i=>this.onData(i.data),this.ws.onerror=i=>this.onError("websocket error",i)}write(i){this.writable=!1;for(let l=0;l<i.length;l++){const p=i[l],x=l===i.length-1;by(p,this.supportsBinary,T=>{try{this.doWrite(p,T)}catch{}x&&jp(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const i=this.opts.secure?"wss":"ws",l=this.query||{};return this.opts.timestampRequests&&(l[this.opts.timestampParam]=Zw()),this.supportsBinary||(l.b64=1),this.createUri(i,l)}}const Im=Qi.WebSocket||Qi.MozWebSocket;class ZT extends qT{createSocket(i,l,p){return Ww?new Im(i,l,p):l?new Im(i,l):new Im(i)}doWrite(i,l){this.ws.send(l)}}class GT extends Ty{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(i){return this.emitReserved("error",i)}this._transport.closed.then(()=>{this.onClose()}).catch(i=>{this.onError("webtransport error",i)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(i=>{const l=ET(Number.MAX_SAFE_INTEGER,this.socket.binaryType),p=i.readable.pipeThrough(l).getReader(),x=CT();x.readable.pipeTo(i.writable),this._writer=x.writable.getWriter();const T=()=>{p.read().then(({done:d,value:$})=>{d||(this.onPacket($),T())}).catch(d=>{})};T();const S={type:"open"};this.query.sid&&(S.data=`{"sid":"${this.query.sid}"}`),this._writer.write(S).then(()=>this.onOpen())})})}write(i){this.writable=!1;for(let l=0;l<i.length;l++){const p=i[l],x=l===i.length-1;this._writer.write(p).then(()=>{x&&jp(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var i;(i=this._transport)===null||i===void 0||i.close()}}const HT={websocket:ZT,webtransport:GT,polling:$T},WT=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,XT=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Sg(r){if(r.length>8e3)throw"URI too long";const i=r,l=r.indexOf("["),p=r.indexOf("]");l!=-1&&p!=-1&&(r=r.substring(0,l)+r.substring(l,p).replace(/:/g,";")+r.substring(p,r.length));let x=WT.exec(r||""),T={},S=14;for(;S--;)T[XT[S]]=x[S]||"";return l!=-1&&p!=-1&&(T.source=i,T.host=T.host.substring(1,T.host.length-1).replace(/;/g,":"),T.authority=T.authority.replace("[","").replace("]","").replace(/;/g,":"),T.ipv6uri=!0),T.pathNames=KT(T,T.path),T.queryKey=YT(T,T.query),T}function KT(r,i){const l=/\/{2,9}/g,p=i.replace(l,"/").split("/");return(i.slice(0,1)=="/"||i.length===0)&&p.splice(0,1),i.slice(-1)=="/"&&p.splice(p.length-1,1),p}function YT(r,i){const l={};return i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(p,x,T){x&&(l[x]=T)}),l}const Tg=typeof addEventListener=="function"&&typeof removeEventListener=="function",Kd=[];Tg&&addEventListener("offline",()=>{Kd.forEach(r=>r())},!1);class la extends Qr{constructor(i,l){if(super(),this.binaryType=PT,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,i&&typeof i=="object"&&(l=i,i=null),i){const p=Sg(i);l.hostname=p.host,l.secure=p.protocol==="https"||p.protocol==="wss",l.port=p.port,p.query&&(l.query=p.query)}else l.host&&(l.hostname=Sg(l.host).host);Vp(this,l),this.secure=l.secure!=null?l.secure:typeof location<"u"&&location.protocol==="https:",l.hostname&&!l.port&&(l.port=this.secure?"443":"80"),this.hostname=l.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=l.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},l.transports.forEach(p=>{const x=p.prototype.name;this.transports.push(x),this._transportsByName[x]=p}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},l),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=FT(this.opts.query)),Tg&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Kd.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(i){const l=Object.assign({},this.opts.query);l.EIO=$w,l.transport=i,this.id&&(l.sid=this.id);const p=Object.assign({},this.opts,{query:l,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[i]);return new this._transportsByName[i](p)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const i=this.opts.rememberUpgrade&&la.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const l=this.createTransport(i);l.open(),this.setTransport(l)}setTransport(i){this.transport&&this.transport.removeAllListeners(),this.transport=i,i.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",l=>this._onClose("transport close",l))}onOpen(){this.readyState="open",la.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",i),this.emitReserved("heartbeat"),i.type){case"open":this.onHandshake(JSON.parse(i.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const l=new Error("server error");l.code=i.data,this._onError(l);break;case"message":this.emitReserved("data",i.data),this.emitReserved("message",i.data);break}}onHandshake(i){this.emitReserved("handshake",i),this.id=i.sid,this.transport.query.sid=i.sid,this._pingInterval=i.pingInterval,this._pingTimeout=i.pingTimeout,this._maxPayload=i.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const i=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+i,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},i),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const i=this._getWritablePackets();this.transport.send(i),this._prevBufferLen=i.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let l=1;for(let p=0;p<this.writeBuffer.length;p++){const x=this.writeBuffer[p].data;if(x&&(l+=DT(x)),p>0&&l>this._maxPayload)return this.writeBuffer.slice(0,p);l+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const i=Date.now()>this._pingTimeoutTime;return i&&(this._pingTimeoutTime=0,jp(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),i}write(i,l,p){return this._sendPacket("message",i,l,p),this}send(i,l,p){return this._sendPacket("message",i,l,p),this}_sendPacket(i,l,p,x){if(typeof l=="function"&&(x=l,l=void 0),typeof p=="function"&&(x=p,p=null),this.readyState==="closing"||this.readyState==="closed")return;p=p||{},p.compress=p.compress!==!1;const T={type:i,data:l,options:p};this.emitReserved("packetCreate",T),this.writeBuffer.push(T),x&&this.once("flush",x),this.flush()}close(){const i=()=>{this._onClose("forced close"),this.transport.close()},l=()=>{this.off("upgrade",l),this.off("upgradeError",l),i()},p=()=>{this.once("upgrade",l),this.once("upgradeError",l)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?p():i()}):this.upgrading?p():i()),this}_onError(i){if(la.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",i),this._onClose("transport error",i)}_onClose(i,l){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Tg&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const p=Kd.indexOf(this._offlineEventListener);p!==-1&&Kd.splice(p,1)}this.readyState="closed",this.id=null,this.emitReserved("close",i,l),this.writeBuffer=[],this._prevBufferLen=0}}}la.protocol=$w;class JT extends la{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let i=0;i<this._upgrades.length;i++)this._probe(this._upgrades[i])}_probe(i){let l=this.createTransport(i),p=!1;la.priorWebsocketSuccess=!1;const x=()=>{p||(l.send([{type:"ping",data:"probe"}]),l.once("packet",Q=>{if(!p)if(Q.type==="pong"&&Q.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",l),!l)return;la.priorWebsocketSuccess=l.name==="websocket",this.transport.pause(()=>{p||this.readyState!=="closed"&&(ge(),this.setTransport(l),l.send([{type:"upgrade"}]),this.emitReserved("upgrade",l),l=null,this.upgrading=!1,this.flush())})}else{const V=new Error("probe error");V.transport=l.name,this.emitReserved("upgradeError",V)}}))};function T(){p||(p=!0,ge(),l.close(),l=null)}const S=Q=>{const V=new Error("probe error: "+Q);V.transport=l.name,T(),this.emitReserved("upgradeError",V)};function d(){S("transport closed")}function $(){S("socket closed")}function ne(Q){l&&Q.name!==l.name&&T()}const ge=()=>{l.removeListener("open",x),l.removeListener("error",S),l.removeListener("close",d),this.off("close",$),this.off("upgrading",ne)};l.once("open",x),l.once("error",S),l.once("close",d),this.once("close",$),this.once("upgrading",ne),this._upgrades.indexOf("webtransport")!==-1&&i!=="webtransport"?this.setTimeoutFn(()=>{p||l.open()},200):l.open()}onHandshake(i){this._upgrades=this._filterUpgrades(i.upgrades),super.onHandshake(i)}_filterUpgrades(i){const l=[];for(let p=0;p<i.length;p++)~this.transports.indexOf(i[p])&&l.push(i[p]);return l}}let QT=class extends JT{constructor(i,l={}){const p=typeof i=="object"?i:l;(!p.transports||p.transports&&typeof p.transports[0]=="string")&&(p.transports=(p.transports||["polling","websocket","webtransport"]).map(x=>HT[x]).filter(x=>!!x)),super(i,p)}};function ek(r,i="",l){let p=r;l=l||typeof location<"u"&&location,r==null&&(r=l.protocol+"//"+l.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=l.protocol+r:r=l.host+r),/^(https?|wss?):\/\//.test(r)||(typeof l<"u"?r=l.protocol+"//"+r:r="https://"+r),p=Sg(r)),p.port||(/^(http|ws)$/.test(p.protocol)?p.port="80":/^(http|ws)s$/.test(p.protocol)&&(p.port="443")),p.path=p.path||"/";const T=p.host.indexOf(":")!==-1?"["+p.host+"]":p.host;return p.id=p.protocol+"://"+T+":"+p.port+i,p.href=p.protocol+"://"+T+(l&&l.port===p.port?"":":"+p.port),p}const tk=typeof ArrayBuffer=="function",rk=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Xw=Object.prototype.toString,nk=typeof Blob=="function"||typeof Blob<"u"&&Xw.call(Blob)==="[object BlobConstructor]",ik=typeof File=="function"||typeof File<"u"&&Xw.call(File)==="[object FileConstructor]";function ky(r){return tk&&(r instanceof ArrayBuffer||rk(r))||nk&&r instanceof Blob||ik&&r instanceof File}function Yd(r,i){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let l=0,p=r.length;l<p;l++)if(Yd(r[l]))return!0;return!1}if(ky(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return Yd(r.toJSON(),!0);for(const l in r)if(Object.prototype.hasOwnProperty.call(r,l)&&Yd(r[l]))return!0;return!1}function sk(r){const i=[],l=r.data,p=r;return p.data=kg(l,i),p.attachments=i.length,{packet:p,buffers:i}}function kg(r,i){if(!r)return r;if(ky(r)){const l={_placeholder:!0,num:i.length};return i.push(r),l}else if(Array.isArray(r)){const l=new Array(r.length);for(let p=0;p<r.length;p++)l[p]=kg(r[p],i);return l}else if(typeof r=="object"&&!(r instanceof Date)){const l={};for(const p in r)Object.prototype.hasOwnProperty.call(r,p)&&(l[p]=kg(r[p],i));return l}return r}function ok(r,i){return r.data=Cg(r.data,i),delete r.attachments,r}function Cg(r,i){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<i.length)return i[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let l=0;l<r.length;l++)r[l]=Cg(r[l],i);else if(typeof r=="object")for(const l in r)Object.prototype.hasOwnProperty.call(r,l)&&(r[l]=Cg(r[l],i));return r}const Kw=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ak=5;var Bt;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(Bt||(Bt={}));class lk{constructor(i){this.replacer=i}encode(i){return(i.type===Bt.EVENT||i.type===Bt.ACK)&&Yd(i)?this.encodeAsBinary({type:i.type===Bt.EVENT?Bt.BINARY_EVENT:Bt.BINARY_ACK,nsp:i.nsp,data:i.data,id:i.id}):[this.encodeAsString(i)]}encodeAsString(i){let l=""+i.type;return(i.type===Bt.BINARY_EVENT||i.type===Bt.BINARY_ACK)&&(l+=i.attachments+"-"),i.nsp&&i.nsp!=="/"&&(l+=i.nsp+","),i.id!=null&&(l+=i.id),i.data!=null&&(l+=JSON.stringify(i.data,this.replacer)),l}encodeAsBinary(i){const l=sk(i),p=this.encodeAsString(l.packet),x=l.buffers;return x.unshift(p),x}}class Cy extends Qr{constructor(i){super(),this.reviver=i}add(i){let l;if(typeof i=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");l=this.decodeString(i);const p=l.type===Bt.BINARY_EVENT;p||l.type===Bt.BINARY_ACK?(l.type=p?Bt.EVENT:Bt.ACK,this.reconstructor=new uk(l),l.attachments===0&&super.emitReserved("decoded",l)):super.emitReserved("decoded",l)}else if(ky(i)||i.base64)if(this.reconstructor)l=this.reconstructor.takeBinaryData(i),l&&(this.reconstructor=null,super.emitReserved("decoded",l));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+i)}decodeString(i){let l=0;const p={type:Number(i.charAt(0))};if(Bt[p.type]===void 0)throw new Error("unknown packet type "+p.type);if(p.type===Bt.BINARY_EVENT||p.type===Bt.BINARY_ACK){const T=l+1;for(;i.charAt(++l)!=="-"&&l!=i.length;);const S=i.substring(T,l);if(S!=Number(S)||i.charAt(l)!=="-")throw new Error("Illegal attachments");p.attachments=Number(S)}if(i.charAt(l+1)==="/"){const T=l+1;for(;++l&&!(i.charAt(l)===","||l===i.length););p.nsp=i.substring(T,l)}else p.nsp="/";const x=i.charAt(l+1);if(x!==""&&Number(x)==x){const T=l+1;for(;++l;){const S=i.charAt(l);if(S==null||Number(S)!=S){--l;break}if(l===i.length)break}p.id=Number(i.substring(T,l+1))}if(i.charAt(++l)){const T=this.tryParse(i.substr(l));if(Cy.isPayloadValid(p.type,T))p.data=T;else throw new Error("invalid payload")}return p}tryParse(i){try{return JSON.parse(i,this.reviver)}catch{return!1}}static isPayloadValid(i,l){switch(i){case Bt.CONNECT:return Sp(l);case Bt.DISCONNECT:return l===void 0;case Bt.CONNECT_ERROR:return typeof l=="string"||Sp(l);case Bt.EVENT:case Bt.BINARY_EVENT:return Array.isArray(l)&&(typeof l[0]=="number"||typeof l[0]=="string"&&Kw.indexOf(l[0])===-1);case Bt.ACK:case Bt.BINARY_ACK:return Array.isArray(l)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class uk{constructor(i){this.packet=i,this.buffers=[],this.reconPack=i}takeBinaryData(i){if(this.buffers.push(i),this.buffers.length===this.reconPack.attachments){const l=ok(this.reconPack,this.buffers);return this.finishedReconstruction(),l}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ck(r){return typeof r=="string"}const hk=Number.isInteger||function(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r};function dk(r){return r===void 0||hk(r)}function Sp(r){return Object.prototype.toString.call(r)==="[object Object]"}function pk(r,i){switch(r){case Bt.CONNECT:return i===void 0||Sp(i);case Bt.DISCONNECT:return i===void 0;case Bt.EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&Kw.indexOf(i[0])===-1);case Bt.ACK:return Array.isArray(i);case Bt.CONNECT_ERROR:return typeof i=="string"||Sp(i);default:return!1}}function fk(r){return ck(r.nsp)&&dk(r.id)&&pk(r.type,r.data)}const mk=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Cy,Encoder:lk,get PacketType(){return Bt},isPacketValid:fk,protocol:ak},Symbol.toStringTag,{value:"Module"}));function bs(r,i,l){return r.on(i,l),function(){r.off(i,l)}}const gk=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Yw extends Qr{constructor(i,l,p){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=i,this.nsp=l,p&&p.auth&&(this.auth=p.auth),this._opts=Object.assign({},p),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const i=this.io;this.subs=[bs(i,"open",this.onopen.bind(this)),bs(i,"packet",this.onpacket.bind(this)),bs(i,"error",this.onerror.bind(this)),bs(i,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...i){return i.unshift("message"),this.emit.apply(this,i),this}emit(i,...l){var p,x,T;if(gk.hasOwnProperty(i))throw new Error('"'+i.toString()+'" is a reserved event name');if(l.unshift(i),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(l),this;const S={type:Bt.EVENT,data:l};if(S.options={},S.options.compress=this.flags.compress!==!1,typeof l[l.length-1]=="function"){const ge=this.ids++,Q=l.pop();this._registerAckCallback(ge,Q),S.id=ge}const d=(x=(p=this.io.engine)===null||p===void 0?void 0:p.transport)===null||x===void 0?void 0:x.writable,$=this.connected&&!(!((T=this.io.engine)===null||T===void 0)&&T._hasPingExpired());return this.flags.volatile&&!d||($?(this.notifyOutgoingListeners(S),this.packet(S)):this.sendBuffer.push(S)),this.flags={},this}_registerAckCallback(i,l){var p;const x=(p=this.flags.timeout)!==null&&p!==void 0?p:this._opts.ackTimeout;if(x===void 0){this.acks[i]=l;return}const T=this.io.setTimeoutFn(()=>{delete this.acks[i];for(let d=0;d<this.sendBuffer.length;d++)this.sendBuffer[d].id===i&&this.sendBuffer.splice(d,1);l.call(this,new Error("operation has timed out"))},x),S=(...d)=>{this.io.clearTimeoutFn(T),l.apply(this,d)};S.withError=!0,this.acks[i]=S}emitWithAck(i,...l){return new Promise((p,x)=>{const T=(S,d)=>S?x(S):p(d);T.withError=!0,l.push(T),this.emit(i,...l)})}_addToQueue(i){let l;typeof i[i.length-1]=="function"&&(l=i.pop());const p={id:this._queueSeq++,tryCount:0,pending:!1,args:i,flags:Object.assign({fromQueue:!0},this.flags)};i.push((x,...T)=>(this._queue[0],x!==null?p.tryCount>this._opts.retries&&(this._queue.shift(),l&&l(x)):(this._queue.shift(),l&&l(null,...T)),p.pending=!1,this._drainQueue())),this._queue.push(p),this._drainQueue()}_drainQueue(i=!1){if(!this.connected||this._queue.length===0)return;const l=this._queue[0];l.pending&&!i||(l.pending=!0,l.tryCount++,this.flags=l.flags,this.emit.apply(this,l.args))}packet(i){i.nsp=this.nsp,this.io._packet(i)}onopen(){typeof this.auth=="function"?this.auth(i=>{this._sendConnectPacket(i)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(i){this.packet({type:Bt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},i):i})}onerror(i){this.connected||this.emitReserved("connect_error",i)}onclose(i,l){this.connected=!1,delete this.id,this.emitReserved("disconnect",i,l),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(i=>{if(!this.sendBuffer.some(p=>String(p.id)===i)){const p=this.acks[i];delete this.acks[i],p.withError&&p.call(this,new Error("socket has been disconnected"))}})}onpacket(i){if(i.nsp===this.nsp)switch(i.type){case Bt.CONNECT:i.data&&i.data.sid?this.onconnect(i.data.sid,i.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Bt.EVENT:case Bt.BINARY_EVENT:this.onevent(i);break;case Bt.ACK:case Bt.BINARY_ACK:this.onack(i);break;case Bt.DISCONNECT:this.ondisconnect();break;case Bt.CONNECT_ERROR:this.destroy();const p=new Error(i.data.message);p.data=i.data.data,this.emitReserved("connect_error",p);break}}onevent(i){const l=i.data||[];i.id!=null&&l.push(this.ack(i.id)),this.connected?this.emitEvent(l):this.receiveBuffer.push(Object.freeze(l))}emitEvent(i){if(this._anyListeners&&this._anyListeners.length){const l=this._anyListeners.slice();for(const p of l)p.apply(this,i)}super.emit.apply(this,i),this._pid&&i.length&&typeof i[i.length-1]=="string"&&(this._lastOffset=i[i.length-1])}ack(i){const l=this;let p=!1;return function(...x){p||(p=!0,l.packet({type:Bt.ACK,id:i,data:x}))}}onack(i){const l=this.acks[i.id];typeof l=="function"&&(delete this.acks[i.id],l.withError&&i.data.unshift(null),l.apply(this,i.data))}onconnect(i,l){this.id=i,this.recovered=l&&this._pid===l,this._pid=l,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(i=>this.emitEvent(i)),this.receiveBuffer=[],this.sendBuffer.forEach(i=>{this.notifyOutgoingListeners(i),this.packet(i)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(i=>i()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Bt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(i){return this.flags.compress=i,this}get volatile(){return this.flags.volatile=!0,this}timeout(i){return this.flags.timeout=i,this}onAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(i),this}prependAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(i),this}offAny(i){if(!this._anyListeners)return this;if(i){const l=this._anyListeners;for(let p=0;p<l.length;p++)if(i===l[p])return l.splice(p,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(i),this}prependAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(i),this}offAnyOutgoing(i){if(!this._anyOutgoingListeners)return this;if(i){const l=this._anyOutgoingListeners;for(let p=0;p<l.length;p++)if(i===l[p])return l.splice(p,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(i){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const l=this._anyOutgoingListeners.slice();for(const p of l)p.apply(this,i.data)}}}function xu(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}xu.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),l=Math.floor(i*this.jitter*r);r=Math.floor(i*10)&1?r+l:r-l}return Math.min(r,this.max)|0};xu.prototype.reset=function(){this.attempts=0};xu.prototype.setMin=function(r){this.ms=r};xu.prototype.setMax=function(r){this.max=r};xu.prototype.setJitter=function(r){this.jitter=r};class Eg extends Qr{constructor(i,l){var p;super(),this.nsps={},this.subs=[],i&&typeof i=="object"&&(l=i,i=void 0),l=l||{},l.path=l.path||"/socket.io",this.opts=l,Vp(this,l),this.reconnection(l.reconnection!==!1),this.reconnectionAttempts(l.reconnectionAttempts||1/0),this.reconnectionDelay(l.reconnectionDelay||1e3),this.reconnectionDelayMax(l.reconnectionDelayMax||5e3),this.randomizationFactor((p=l.randomizationFactor)!==null&&p!==void 0?p:.5),this.backoff=new xu({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(l.timeout==null?2e4:l.timeout),this._readyState="closed",this.uri=i;const x=l.parser||mk;this.encoder=new x.Encoder,this.decoder=new x.Decoder,this._autoConnect=l.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,i||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(i){return i===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var l;return i===void 0?this._reconnectionDelay:(this._reconnectionDelay=i,(l=this.backoff)===null||l===void 0||l.setMin(i),this)}randomizationFactor(i){var l;return i===void 0?this._randomizationFactor:(this._randomizationFactor=i,(l=this.backoff)===null||l===void 0||l.setJitter(i),this)}reconnectionDelayMax(i){var l;return i===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,(l=this.backoff)===null||l===void 0||l.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(i){if(~this._readyState.indexOf("open"))return this;this.engine=new QT(this.uri,this.opts);const l=this.engine,p=this;this._readyState="opening",this.skipReconnect=!1;const x=bs(l,"open",function(){p.onopen(),i&&i()}),T=d=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",d),i?i(d):this.maybeReconnectOnOpen()},S=bs(l,"error",T);if(this._timeout!==!1){const d=this._timeout,$=this.setTimeoutFn(()=>{x(),T(new Error("timeout")),l.close()},d);this.opts.autoUnref&&$.unref(),this.subs.push(()=>{this.clearTimeoutFn($)})}return this.subs.push(x),this.subs.push(S),this}connect(i){return this.open(i)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const i=this.engine;this.subs.push(bs(i,"ping",this.onping.bind(this)),bs(i,"data",this.ondata.bind(this)),bs(i,"error",this.onerror.bind(this)),bs(i,"close",this.onclose.bind(this)),bs(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(i){try{this.decoder.add(i)}catch(l){this.onclose("parse error",l)}}ondecoded(i){jp(()=>{this.emitReserved("packet",i)},this.setTimeoutFn)}onerror(i){this.emitReserved("error",i)}socket(i,l){let p=this.nsps[i];return p?this._autoConnect&&!p.active&&p.connect():(p=new Yw(this,i,l),this.nsps[i]=p),p}_destroy(i){const l=Object.keys(this.nsps);for(const p of l)if(this.nsps[p].active)return;this._close()}_packet(i){const l=this.encoder.encode(i);for(let p=0;p<l.length;p++)this.engine.write(l[p],i.options)}cleanup(){this.subs.forEach(i=>i()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(i,l){var p;this.cleanup(),(p=this.engine)===null||p===void 0||p.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",i,l),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const l=this.backoff.duration();this._reconnecting=!0;const p=this.setTimeoutFn(()=>{i.skipReconnect||(this.emitReserved("reconnect_attempt",i.backoff.attempts),!i.skipReconnect&&i.open(x=>{x?(i._reconnecting=!1,i.reconnect(),this.emitReserved("reconnect_error",x)):i.onreconnect()}))},l);this.opts.autoUnref&&p.unref(),this.subs.push(()=>{this.clearTimeoutFn(p)})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",i)}}const Lc={};function Jd(r,i){typeof r=="object"&&(i=r,r=void 0),i=i||{};const l=ek(r,i.path||"/socket.io"),p=l.source,x=l.id,T=l.path,S=Lc[x]&&T in Lc[x].nsps,d=i.forceNew||i["force new connection"]||i.multiplex===!1||S;let $;return d?$=new Eg(p,i):(Lc[x]||(Lc[x]=new Eg(p,i)),$=Lc[x]),l.query&&!i.query&&(i.query=l.queryKey),$.socket(l.path,i)}Object.assign(Jd,{Manager:Eg,Socket:Yw,io:Jd,connect:Jd});var Jw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,i){(function(l,p){r.exports=p()})(Gb,function(){var l={},p={};function x(S,d,$){if(p[S]=$,S==="index"){var ne="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",ge={};return p.shared(ge),p.index(l,ge),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([ne],{type:"text/javascript"}))),l}}x("shared",["exports"],function(S){function d(n,t,s,a){return new(s||(s=Promise))(function(h,g){function y(C){try{w(a.next(C))}catch(E){g(E)}}function _(C){try{w(a.throw(C))}catch(E){g(E)}}function w(C){var E;C.done?h(C.value):(E=C.value,E instanceof s?E:new s(function(P){P(E)})).then(y,_)}w((a=a.apply(n,t||[])).next())})}function $(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var ne=ge;function ge(n,t){this.x=n,this.y=t}ge.prototype={clone:function(){return new ge(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,s=n.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),s=Math.sin(n),a=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=a,this},_rotateAround:function(n,t){var s=Math.cos(n),a=Math.sin(n),h=t.y+a*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ge.convert=function(n){return n instanceof ge?n:Array.isArray(n)?new ge(n[0],n[1]):n};var Q=$(ne),V=Ce;function Ce(n,t,s,a){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=a}Ce.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,a=0;a<8;a++){var h=this.sampleCurveX(s)-n;if(Math.abs(h)<t)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=h/g}var y=0,_=1;for(s=n,a=0;a<20&&(h=this.sampleCurveX(s),!(Math.abs(h-n)<t));a++)n>h?y=s:_=s,s=.5*(_-y)+y;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Ee=$(V);let Me,pt;function oe(){return Me==null&&(Me=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Me}function ie(){if(pt==null&&(pt=!1,oe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const h=4*a;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&s[a]!==a){pt=!0;break}}}return pt||!1}function de(n,t,s,a){const h=new Ee(n,t,s,a);return g=>h.solve(g)}const Pe=de(.25,.1,.25,1);function qe(n,t,s){return Math.min(s,Math.max(t,n))}function Qe(n,t,s){const a=s-t,h=((n-t)%a+a)%a+t;return h===t?s:h}function Xe(n,...t){for(const s of t)for(const a in s)n[a]=s[a];return n}let Le=1;function it(n,t,s){const a={};for(const h in n)a[h]=t.call(this,n[h],h,n);return a}function Ge(n,t,s){const a={};for(const h in n)t.call(this,n[h],h,n)&&(a[h]=n[h]);return a}function Ye(n){return Array.isArray(n)?n.map(Ye):typeof n=="object"&&n?it(n,Ye):n}const Kt={};function Vt(n){Kt[n]||(typeof console<"u"&&console.warn(n),Kt[n]=!0)}function Yt(n,t,s){return(s.y-n.y)*(t.x-n.x)>(t.y-n.y)*(s.x-n.x)}function Sn(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let Nr=null;function an(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function _t(n,t,s,a,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(n,{timestamp:0});try{const y=g==null?void 0:g.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const _=y.startsWith("BGR"),w=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(w,function(C,E,P,z,R){const B=4*Math.max(-E,0),N=(Math.max(0,P)-P)*z*4+B,G=4*z,X=Math.max(0,E),pe=Math.max(0,P);return{rect:{x:X,y:pe,width:Math.min(C.width,E+z)-X,height:Math.min(C.height,P+R)-pe},layout:[{offset:N,stride:G}]}}(n,t,s,a,h)),_)for(let C=0;C<w.length;C+=4){const E=w[C];w[C]=w[C+2],w[C+2]=E}return w}finally{g.close()}})}let yt,Dt;const qt="AbortError";function ln(){return new Error(qt)}const jr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function un(n){return jr.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const gr="global-dispatcher";class vr extends Error{constructor(t,s,a,h){super(`AJAXError: ${s} (${t}): ${a}`),this.status=t,this.statusText=s,this.url=a,this.body=h}}const Zr=()=>Sn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ai=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const a=un(n.url);if(a)return a(n,t);if(Sn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:gr},t)}if(!(/^file:/.test(s=n.url)||/^file:/.test(Zr())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,h){return d(this,void 0,void 0,function*(){const g=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Zr(),signal:h.signal});a.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const y=yield fetch(g);if(!y.ok){const C=yield y.blob();throw new vr(y.status,y.statusText,a.url,C)}let _;_=a.type==="arrayBuffer"||a.type==="image"?y.arrayBuffer():a.type==="json"?y.json():y.text();const w=yield _;if(h.signal.aborted)throw ln();return{data:w,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})}(n,t);if(Sn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:gr},t)}var s;return function(a,h){return new Promise((g,y)=>{var _;const w=new XMLHttpRequest;w.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(w.responseType="arraybuffer");for(const C in a.headers)w.setRequestHeader(C,a.headers[C]);a.type==="json"&&(w.responseType="text",!((_=a.headers)===null||_===void 0)&&_.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=a.credentials==="include",w.onerror=()=>{y(new Error(w.statusText))},w.onload=()=>{if(!h.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let C=w.response;if(a.type==="json")try{C=JSON.parse(w.response)}catch(E){return void y(E)}g({data:C,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const C=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});y(new vr(w.status,w.statusText,a.url,C))}},h.signal.addEventListener("abort",()=>{w.abort(),y(ln())}),w.send(a.body)})}(n,t)};function Rn(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function is(n,t,s){s[n]&&s[n].indexOf(t)!==-1||(s[n]=s[n]||[],s[n].push(t))}function li(n,t,s){if(s&&s[n]){const a=s[n].indexOf(t);a!==-1&&s[n].splice(a,1)}}class Vi{constructor(t,s={}){Xe(this,s),this.type=t}}class Si extends Vi{constructor(t,s={}){super("error",Xe({error:t},s))}}class ss{on(t,s){return this._listeners=this._listeners||{},is(t,s,this._listeners),this}off(t,s){return li(t,s,this._listeners),li(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},is(t,s,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,s){typeof t=="string"&&(t=new Vi(t,s||{}));const a=t.type;if(this.listens(a)){t.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const _ of h)_.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const _ of g)li(a,_,this._oneTimeListeners),_.call(this,t);const y=this._eventedParent;y&&(Xe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof Si&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ti=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function os(n,t){const s={};for(const a in n)a!=="ref"&&(s[a]=n[a]);return Ti.forEach(a=>{a in t&&(s[a]=t[a])}),s}function Mt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(!Mt(n[s],t[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const s in n)if(!Mt(n[s],t[s]))return!1;return!0}return n===t}function rr(n,t){n.push(t)}function Ui(n,t,s){rr(s,{command:"addSource",args:[n,t[n]]})}function Xn(n,t,s){rr(t,{command:"removeSource",args:[n]}),s[n]=!0}function Tn(n,t,s,a){Xn(n,s,a),Ui(n,t,s)}function $i(n,t,s){let a;for(a in n[s])if(Object.prototype.hasOwnProperty.call(n[s],a)&&a!=="data"&&!Mt(n[s][a],t[s][a]))return!1;for(a in t[s])if(Object.prototype.hasOwnProperty.call(t[s],a)&&a!=="data"&&!Mt(n[s][a],t[s][a]))return!1;return!0}function cn(n,t,s,a,h,g){n=n||{},t=t||{};for(const y in n)Object.prototype.hasOwnProperty.call(n,y)&&(Mt(n[y],t[y])||s.push({command:g,args:[a,y,t[y],h]}));for(const y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(n,y)&&(Mt(n[y],t[y])||s.push({command:g,args:[a,y,t[y],h]}))}function as(n){return n.id}function Es(n,t){return n[t.id]=t,n}class Ae{constructor(t,s,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function Kn(n,...t){for(const s of t)for(const a in s)n[a]=s[a];return n}class ar extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Pr{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[a,h]of s)this.bindings[a]=h}concat(t){return new Pr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ki={kind:"null"},Re={kind:"number"},kt={kind:"string"},ft={kind:"boolean"},Ar={kind:"color"},yr={kind:"object"},vt={kind:"value"},ui={kind:"collator"},Yn={kind:"formatted"},ci={kind:"padding"},hn={kind:"resolvedImage"},W={kind:"variableAnchorOffsetCollection"};function L(n,t){return{kind:"array",itemType:n,N:t}}function D(n){if(n.kind==="array"){const t=D(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const O=[ki,Re,kt,ft,Ar,Yn,yr,L(vt),ci,hn,W];function q(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!q(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const s of O)if(!q(s,t))return null}}return`Expected ${D(n)} but found ${D(t)} instead.`}function te(n,t){return t.some(s=>s.kind===n.kind)}function le(n,t){return t.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function he(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const J=.96422,ve=.82521,ke=4/29,_e=6/29,Fe=3*_e*_e,De=_e*_e*_e,ht=Math.PI/180,Ot=180/Math.PI;function St(n){return(n%=360)<0&&(n+=360),n}function Lt([n,t,s,a]){let h,g;const y=xr((.2225045*(n=Pt(n))+.7168786*(t=Pt(t))+.0606169*(s=Pt(s)))/1);n===t&&t===s?h=g=y:(h=xr((.4360747*n+.3850649*t+.1430804*s)/J),g=xr((.0139322*n+.0971045*t+.7141733*s)/ve));const _=116*y-16;return[_<0?0:_,500*(h-y),200*(y-g),a]}function Pt(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function xr(n){return n>De?Math.pow(n,1/3):n/Fe+ke}function fr([n,t,s,a]){let h=(n+16)/116,g=isNaN(t)?h:h+t/500,y=isNaN(s)?h:h-s/200;return h=1*Zt(h),g=J*Zt(g),y=ve*Zt(y),[Et(3.1338561*g-1.6168667*h-.4906146*y),Et(-.9787684*g+1.9161415*h+.033454*y),Et(.0719453*g-.2289914*h+1.4052427*y),a]}function Et(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Zt(n){return n>_e?n*n*n:Fe*(n-ke)}function nr(n){return parseInt(n.padEnd(2,n),16)/255}function Fr(n,t){return Vr(t?n/100:n,0,1)}function Vr(n,t,s){return Math.min(Math.max(t,n),s)}function en(n){return!n.some(Number.isNaN)}const Is={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Gt{constructor(t,s,a,h=1,g=!0){this.r=t,this.g=s,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,s,a,h]))}static parse(t){if(t instanceof Gt)return t;if(typeof t!="string")return;const s=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Is[a];if(h){const[y,_,w]=h;return[y/255,_/255,w/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let _=1;return[nr(a.slice(_,_+=y)),nr(a.slice(_,_+=y)),nr(a.slice(_,_+=y)),nr(a.slice(_,_+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[_,w,C,E,P,z,R,B,N,G,X,pe]=y,re=[E||" ",R||" ",G].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ce=[C,z,N].join(""),xe=ce==="%%%"?100:ce===""?255:0;if(xe){const Ie=[Vr(+w/xe,0,1),Vr(+P/xe,0,1),Vr(+B/xe,0,1),X?Fr(+X,pe):1];if(en(Ie))return Ie}}return}}const g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,_,w,C,E,P,z,R,B]=g,N=[w||" ",E||" ",z].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const G=[+_,Vr(+C,0,100),Vr(+P,0,100),R?Fr(+R,B):1];if(en(G))return function([X,pe,re,ce]){function xe(Ie){const We=(Ie+X/30)%12,mt=pe*Math.min(re,1-re);return re-mt*Math.max(-1,Math.min(We-3,9-We,1))}return X=St(X),pe/=100,re/=100,[xe(0),xe(8),xe(4),ce]}(G)}}}(t);return s?new Gt(...s,!1):void 0}get rgb(){const{r:t,g:s,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,s/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,a,h,g]=Lt(t),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?St(Math.atan2(h,a)*Ot):NaN,y,s,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Lt(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,a,h]=this.rgb;return`rgba(${[t,s,a].map(g=>Math.round(255*g)).join(",")},${h})`}}Gt.black=new Gt(0,0,0,1),Gt.white=new Gt(1,1,1,1),Gt.transparent=new Gt(0,0,0,0),Gt.red=new Gt(1,0,0,1);class fa{constructor(t,s,a){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $s{constructor(t,s,a,h,g){this.text=t,this.image=s,this.scale=a,this.fontStack=h,this.textColor=g}}class kn{constructor(t){this.sections=t}static fromString(t){return new kn([new $s(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof kn?t:kn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class dn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof dn)return t;if(typeof t=="number")return new dn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new dn(t)}}toString(){return JSON.stringify(this.values)}}const ma=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Fn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const a=t[s],h=t[s+1];if(typeof a!="string"||!ma.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Fn(t)}}toString(){return JSON.stringify(this.values)}}class tn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new tn({name:t,available:!1}):null}}function Ps(n,t,s,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,s,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,s,a]:[n,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ls(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Gt||n instanceof fa||n instanceof kn||n instanceof dn||n instanceof Fn||n instanceof tn)return!0;if(Array.isArray(n)){for(const t of n)if(!ls(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!ls(n[t]))return!1;return!0}return!1}function Tr(n){if(n===null)return ki;if(typeof n=="string")return kt;if(typeof n=="boolean")return ft;if(typeof n=="number")return Re;if(n instanceof Gt)return Ar;if(n instanceof fa)return ui;if(n instanceof kn)return Yn;if(n instanceof dn)return ci;if(n instanceof Fn)return W;if(n instanceof tn)return hn;if(Array.isArray(n)){const t=n.length;let s;for(const a of n){const h=Tr(a);if(s){if(s===h)continue;s=vt;break}s=h}return L(s||vt,t)}return yr}function us(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Gt||n instanceof kn||n instanceof dn||n instanceof Fn||n instanceof tn?n.toString():JSON.stringify(n)}class Cn{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ls(t[1]))return s.error("invalid value");const a=t[1];let h=Tr(a);const g=s.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Cn(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class mr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const yo={string:kt,number:Re,boolean:ft,object:yr};class En{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let a,h=1;const g=t[0];if(g==="array"){let _,w;if(t.length>2){const C=t[1];if(typeof C!="string"||!(C in yo)||C==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);_=yo[C],h++}else _=vt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}a=L(_,w)}else{if(!yo[g])throw new Error(`Types doesn't contain name = ${g}`);a=yo[g]}const y=[];for(;h<t.length;h++){const _=s.parse(t[h],h,vt);if(!_)return null;y.push(_)}return new En(a,y)}evaluate(t){for(let s=0;s<this.args.length;s++){const a=this.args[s].evaluate(t);if(!q(this.type,Tr(a)))return a;if(s===this.args.length-1)throw new mr(`Expected value to be of type ${D(this.type)}, but found ${D(Tr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ga={"to-boolean":ft,"to-color":Ar,"to-number":Re,"to-string":kt};class Bn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const a=t[0];if(!ga[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return s.error("Expected one argument.");const h=ga[a],g=[];for(let y=1;y<t.length;y++){const _=s.parse(t[y],y,vt);if(!_)return null;g.push(_)}return new Bn(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,a;for(const h of this.args){if(s=h.evaluate(t),a=null,s instanceof Gt)return s;if(typeof s=="string"){const g=t.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(a=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Ps(s[0],s[1],s[2],s[3]),!a))return new Gt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new mr(a||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const a of this.args){s=a.evaluate(t);const h=dn.parse(s);if(h)return h}throw new mr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const a of this.args){s=a.evaluate(t);const h=Fn.parse(s);if(h)return h}throw new mr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const a of this.args){if(s=a.evaluate(t),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new mr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return kn.fromString(us(this.args[0].evaluate(t)));case"resolvedImage":return tn.fromString(us(this.args[0].evaluate(t)));default:return us(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const wu=["Unknown","Point","LineString","Polygon"];class qs{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=Gt.parse(t)),s}}class cs{constructor(t,s,a=[],h,g=new Pr,y=[]){this.registry=t,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=s}parse(t,s,a,h,g={}){return s?this.concat(s,a,h)._parse(t,g):this._parse(t,g)}_parse(t,s){function a(h,g,y){return y==="assert"?new En(g,[h]):y==="coerce"?new Bn(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(t,this);if(!y)return null;if(this.expectedType){const _=this.expectedType,w=y.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(_.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(_,w))return null}else y=a(y,_,s.typeAnnotation||"coerce");else y=a(y,_,s.typeAnnotation||"coerce");else y=a(y,_,s.typeAnnotation||"coerce");else y=a(y,_,s.typeAnnotation||"assert")}if(!(y instanceof Cn)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const _=new qs;try{y=new Cn(y.type,y.evaluate(_))}catch(w){return this.error(w.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,a){const h=typeof t=="number"?this.path.concat(t):this.path,g=a?this.scope.concat(a):this.scope;return new cs(this.registry,this._isConstant,h,s||null,g,this.errors)}error(t,...s){const a=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new ar(a,t))}checkSubtype(t,s){const a=q(t,s);return a&&this.error(a),a}}class se{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let g=1;g<t.length-1;g+=2){const y=t[g];if(typeof y!="string")return s.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const _=s.parse(t[g+1],g+1);if(!_)return null;a.push([y,_])}const h=s.parse(t[t.length-1],t.length-1,s.expectedType,a);return h?new se(a,h):null}outputDefined(){return this.result.outputDefined()}}class we{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const a=t[1];return s.scope.has(a)?new we(a,s.scope.get(a)):s.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Se{constructor(t,s,a){this.type=t,this.index=s,this.input=a}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,Re),h=s.parse(t[2],2,L(s.expectedType||vt));return a&&h?new Se(h.type.itemType,a,h):null}evaluate(t){const s=this.index.evaluate(t),a=this.input.evaluate(t);if(s<0)throw new mr(`Array index out of bounds: ${s} < 0.`);if(s>=a.length)throw new mr(`Array index out of bounds: ${s} > ${a.length-1}.`);if(s!==Math.floor(s))throw new mr(`Array index must be an integer, but found ${s} instead.`);return a[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class je{constructor(t,s){this.type=ft,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,vt),h=s.parse(t[2],2,vt);return a&&h?te(a.type,[ft,kt,Re,ki,vt])?new je(a,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!le(s,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${D(Tr(s))} instead.`);if(!le(a,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${D(Tr(a))} instead.`);return a.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class lt{constructor(t,s,a){this.type=Re,this.needle=t,this.haystack=s,this.fromIndex=a}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,vt),h=s.parse(t[2],2,vt);if(!a||!h)return null;if(!te(a.type,[ft,kt,Re,ki,vt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`);if(t.length===4){const g=s.parse(t[3],3,Re);return g?new lt(a,h,g):null}return new lt(a,h)}evaluate(t){const s=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!le(s,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${D(Tr(s))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),le(a,["string"])){const g=a.indexOf(s,h);return g===-1?-1:[...a.slice(0,g)].length}if(le(a,["array"]))return a.indexOf(s,h);throw new mr(`Expected second argument to be of type array or string, but found ${D(Tr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Tt{constructor(t,s,a,h,g,y){this.inputType=t,this.type=s,this.input=a,this.cases=h,this.outputs=g,this.otherwise=y}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let a,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const g={},y=[];for(let C=2;C<t.length-1;C+=2){let E=t[C];const P=t[C+1];Array.isArray(E)||(E=[E]);const z=s.concat(C);if(E.length===0)return z.error("Expected at least one branch label.");for(const B of E){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,Tr(B)))return null}else a=Tr(B);if(g[String(B)]!==void 0)return z.error("Branch labels must be unique.");g[String(B)]=y.length}const R=s.parse(P,C,h);if(!R)return null;h=h||R.type,y.push(R)}const _=s.parse(t[1],1,vt);if(!_)return null;const w=s.parse(t[t.length-1],t.length-1,h);return w?_.type.kind!=="value"&&s.concat(1).checkSubtype(a,_.type)?null:new Tt(a,h,_,g,y,w):null}evaluate(t){const s=this.input.evaluate(t);return(Tr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ct{constructor(t,s,a){this.type=t,this.branches=s,this.otherwise=a}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let a;s.expectedType&&s.expectedType.kind!=="value"&&(a=s.expectedType);const h=[];for(let y=1;y<t.length-1;y+=2){const _=s.parse(t[y],y,ft);if(!_)return null;const w=s.parse(t[y+1],y+1,a);if(!w)return null;h.push([_,w]),a=a||w.type}const g=s.parse(t[t.length-1],t.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new Ct(a,h,g)}evaluate(t){for(const[s,a]of this.branches)if(s.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,a]of this.branches)t(s),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Ur{constructor(t,s,a,h){this.type=t,this.input=s,this.beginIndex=a,this.endIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=s.parse(t[1],1,vt),h=s.parse(t[2],2,Re);if(!a||!h)return null;if(!te(a.type,[L(vt),kt,vt]))return s.error(`Expected first argument to be of type array or string, but found ${D(a.type)} instead`);if(t.length===4){const g=s.parse(t[3],3,Re);return g?new Ur(a.type,a,h,g):null}return new Ur(a.type,a,h)}evaluate(t){const s=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),le(s,["string"]))return[...s].slice(a,h).join("");if(le(s,["array"]))return s.slice(a,h);throw new mr(`Expected first argument to be of type array or string, but found ${D(Tr(s))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function lr(n,t){const s=n.length-1;let a,h,g=0,y=s,_=0;for(;g<=y;)if(_=Math.floor((g+y)/2),a=n[_],h=n[_+1],a<=t){if(_===s||t<h)return _;g=_+1}else{if(!(a>t))throw new mr("Input is not a number.");y=_-1}return 0}class Wt{constructor(t,s,a){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const a=s.parse(t[1],1,Re);if(!a)return null;const h=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let y=1;y<t.length;y+=2){const _=y===1?-1/0:t[y],w=t[y+1],C=y,E=y+1;if(typeof _!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=_)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const P=s.parse(w,E,g);if(!P)return null;g=g||P.type,h.push([_,P])}return new Wt(g,a,h)}evaluate(t){const s=this.labels,a=this.outputs;if(s.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return a[0].evaluate(t);const g=s.length;return h>=s[g-1]?a[g-1].evaluate(t):a[lr(s,h)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function On(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var bu=Su;function Su(n,t,s,a){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=s,this.p2y=a}Su.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,a=0;a<8;a++){var h=this.sampleCurveX(s)-n;if(Math.abs(h)<t)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=h/g}var y=0,_=1;for(s=n,a=0;a<20&&(h=this.sampleCurveX(s),!(Math.abs(h-n)<t));a++)n>h?y=s:_=s,s=.5*(_-y)+y;return s},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Nt=On(bu);function Mr(n,t,s){return n+s*(t-n)}function hs(n,t,s){return n.map((a,h)=>Mr(a,t[h],s))}const Gr={number:Mr,color:function(n,t,s,a="rgb"){switch(a){case"rgb":{const[h,g,y,_]=hs(n.rgb,t.rgb,s);return new Gt(h,g,y,_,!1)}case"hcl":{const[h,g,y,_]=n.hcl,[w,C,E,P]=t.hcl;let z,R;if(isNaN(h)||isNaN(w))isNaN(h)?isNaN(w)?z=NaN:(z=w,y!==1&&y!==0||(R=C)):(z=h,E!==1&&E!==0||(R=g));else{let pe=w-h;w>h&&pe>180?pe-=360:w<h&&h-w>180&&(pe+=360),z=h+s*pe}const[B,N,G,X]=function([pe,re,ce,xe]){return pe=isNaN(pe)?0:pe*ht,fr([ce,Math.cos(pe)*re,Math.sin(pe)*re,xe])}([z,R??Mr(g,C,s),Mr(y,E,s),Mr(_,P,s)]);return new Gt(B,N,G,X,!1)}case"lab":{const[h,g,y,_]=fr(hs(n.lab,t.lab,s));return new Gt(h,g,y,_,!1)}}},array:hs,padding:function(n,t,s){return new dn(hs(n.values,t.values,s))},variableAnchorOffsetCollection:function(n,t,s){const a=n.values,h=t.values;if(a.length!==h.length)throw new mr(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const g=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new mr(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);g.push(a[y]);const[_,w]=a[y+1],[C,E]=h[y+1];g.push([Mr(_,C,s),Mr(w,E,s)])}return new Fn(g)}};class Hr{constructor(t,s,a,h,g){this.type=t,this.operator=s,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,_]of g)this.labels.push(y),this.outputs.push(_)}static interpolationFactor(t,s,a,h){let g=0;if(t.name==="exponential")g=qi(s,t.base,a,h);else if(t.name==="linear")g=qi(s,1,a,h);else if(t.name==="cubic-bezier"){const y=t.controlPoints;g=new Nt(y[0],y[1],y[2],y[3]).solve(qi(s,1,a,h))}return g}static parse(t,s){let[a,h,g,...y]=t;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const C=h[1];if(typeof C!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(C.length!==4||C.some(E=>typeof E!="number"||E<0||E>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,Re),!g)return null;const _=[];let w=null;a==="interpolate-hcl"||a==="interpolate-lab"?w=Ar:s.expectedType&&s.expectedType.kind!=="value"&&(w=s.expectedType);for(let C=0;C<y.length;C+=2){const E=y[C],P=y[C+1],z=C+3,R=C+4;if(typeof E!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(_.length&&_[_.length-1][0]>=E)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const B=s.parse(P,R,w);if(!B)return null;w=w||B.type,_.push([E,B])}return he(w,Re)||he(w,Ar)||he(w,ci)||he(w,W)||he(w,L(Re))?new Hr(w,a,h,g,_):s.error(`Type ${D(w)} is not interpolatable.`)}evaluate(t){const s=this.labels,a=this.outputs;if(s.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return a[0].evaluate(t);const g=s.length;if(h>=s[g-1])return a[g-1].evaluate(t);const y=lr(s,h),_=Hr.interpolationFactor(this.interpolation,h,s[y],s[y+1]),w=a[y].evaluate(t),C=a[y+1].evaluate(t);switch(this.operator){case"interpolate":return Gr[this.type.kind](w,C,_);case"interpolate-hcl":return Gr.color(w,C,_,"hcl");case"interpolate-lab":return Gr.color(w,C,_,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function qi(n,t,s,a){const h=a-s,g=n-s;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class tl{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let a=null;const h=s.expectedType;h&&h.kind!=="value"&&(a=h);const g=[];for(const _ of t.slice(1)){const w=s.parse(_,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,g.push(w)}if(!a)throw new Error("No output type");const y=h&&g.some(_=>q(h,_.type));return new tl(y?vt:a,g)}evaluate(t){let s,a=null,h=0;for(const g of this.args)if(h++,a=g.evaluate(t),a&&a instanceof tn&&!a.available&&(s||(s=a.name),a=null,h===this.args.length&&(a=s)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function rl(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function yh(n,t,s,a){return a.compare(t,s)===0}function _o(n,t,s){const a=n!=="=="&&n!=="!=";return class Qw{constructor(g,y,_){this.type=ft,this.lhs=g,this.rhs=y,this.collator=_,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const _=g[0];let w=y.parse(g[1],1,vt);if(!w)return null;if(!rl(_,w.type))return y.concat(1).error(`"${_}" comparisons are not supported for type '${D(w.type)}'.`);let C=y.parse(g[2],2,vt);if(!C)return null;if(!rl(_,C.type))return y.concat(2).error(`"${_}" comparisons are not supported for type '${D(C.type)}'.`);if(w.type.kind!==C.type.kind&&w.type.kind!=="value"&&C.type.kind!=="value")return y.error(`Cannot compare types '${D(w.type)}' and '${D(C.type)}'.`);a&&(w.type.kind==="value"&&C.type.kind!=="value"?w=new En(C.type,[w]):w.type.kind!=="value"&&C.type.kind==="value"&&(C=new En(w.type,[C])));let E=null;if(g.length===4){if(w.type.kind!=="string"&&C.type.kind!=="string"&&w.type.kind!=="value"&&C.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(E=y.parse(g[3],3,ui),!E)return null}return new Qw(w,C,E)}evaluate(g){const y=this.lhs.evaluate(g),_=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const w=Tr(y),C=Tr(_);if(w.kind!==C.kind||w.kind!=="string"&&w.kind!=="number")throw new mr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=Tr(y),C=Tr(_);if(w.kind!=="string"||C.kind!=="string")return t(g,y,_)}return this.collator?s(g,y,_,this.collator.evaluate(g)):t(g,y,_)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Up=_o("==",function(n,t,s){return t===s},yh),_h=_o("!=",function(n,t,s){return t!==s},function(n,t,s,a){return!yh(0,t,s,a)}),vh=_o("<",function(n,t,s){return t<s},function(n,t,s,a){return a.compare(t,s)<0}),$p=_o(">",function(n,t,s){return t>s},function(n,t,s,a){return a.compare(t,s)>0}),qp=_o("<=",function(n,t,s){return t<=s},function(n,t,s,a){return a.compare(t,s)<=0}),xh=_o(">=",function(n,t,s){return t>=s},function(n,t,s,a){return a.compare(t,s)>=0});class ya{constructor(t,s,a){this.type=ui,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return s.error("Collator options argument must be an object.");const h=s.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ft);if(!h)return null;const g=s.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ft);if(!g)return null;let y=null;return a.locale&&(y=s.parse(a.locale,1,kt),!y)?null:new ya(h,g,y)}evaluate(t){return new fa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Tu{constructor(t,s,a,h,g){this.type=kt,this.number=t,this.locale=s,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const a=s.parse(t[1],1,Re);if(!a)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=s.parse(h.locale,1,kt),!g))return null;let y=null;if(h.currency&&(y=s.parse(h.currency,1,kt),!y))return null;let _=null;if(h["min-fraction-digits"]&&(_=s.parse(h["min-fraction-digits"],1,Re),!_))return null;let w=null;return h["max-fraction-digits"]&&(w=s.parse(h["max-fraction-digits"],1,Re),!w)?null:new Tu(a,g,y,_,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class nl{constructor(t){this.type=Yn,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return s.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=t.length-1;++y){const _=t[y];if(g&&typeof _=="object"&&!Array.isArray(_)){g=!1;let w=null;if(_["font-scale"]&&(w=s.parse(_["font-scale"],1,Re),!w))return null;let C=null;if(_["text-font"]&&(C=s.parse(_["text-font"],1,L(kt)),!C))return null;let E=null;if(_["text-color"]&&(E=s.parse(_["text-color"],1,Ar),!E))return null;const P=h[h.length-1];P.scale=w,P.font=C,P.textColor=E}else{const w=s.parse(t[y],1,vt);if(!w)return null;const C=w.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new nl(h)}evaluate(t){return new kn(this.sections.map(s=>{const a=s.content.evaluate(t);return Tr(a)===hn?new $s("",a,null,null,null):new $s(us(a),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class ku{constructor(t){this.type=hn,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const a=s.parse(t[1],1,kt);return a?new ku(a):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),a=tn.fromString(s);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(s)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class Cu{constructor(t){this.type=Re,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=s.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${D(a.type)} instead.`):new Cu(a):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new mr(`Expected value to be of type string or array, but found ${D(Tr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Zi=8192;function Zp(n,t){const s=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(s*h*Zi),Math.round(a*h*Zi)]}function Eu(n,t){const s=Math.pow(2,t.z);return[(h=(n[0]/Zi+t.x)/s,360*h-180),(a=(n[1]/Zi+t.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,h}function Zs(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function As(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Ht(n,t,s){const a=n[0]-t[0],h=n[1]-t[1],g=n[0]-s[0],y=n[1]-s[1];return a*y-g*h==0&&a*g<=0&&h*y<=0}function il(n,t,s,a){return(h=[a[0]-s[0],a[1]-s[1]])[0]*(g=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*g[0]!=0&&!(!bh(n,t,s,a)||!bh(s,a,n,t));var h,g}function Gp(n,t,s){for(const a of s)for(let h=0;h<a.length-1;++h)if(il(n,t,a[h],a[h+1]))return!0;return!1}function vo(n,t,s=!1){let a=!1;for(const _ of t)for(let w=0;w<_.length-1;w++){if(Ht(n,_[w],_[w+1]))return s;(g=_[w])[1]>(h=n)[1]!=(y=_[w+1])[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(a=!a)}var h,g,y;return a}function Hp(n,t){for(const s of t)if(vo(n,s))return!0;return!1}function wh(n,t){for(const s of n)if(!vo(s,t))return!1;for(let s=0;s<n.length-1;++s)if(Gp(n[s],n[s+1],t))return!1;return!0}function Wp(n,t){for(const s of t)if(wh(n,s))return!0;return!1}function bh(n,t,s,a){const h=a[0]-s[0],g=a[1]-s[1],y=(n[0]-s[0])*g-h*(n[1]-s[1]),_=(t[0]-s[0])*g-h*(t[1]-s[1]);return y>0&&_<0||y<0&&_>0}function Iu(n,t,s){const a=[];for(let h=0;h<n.length;h++){const g=[];for(let y=0;y<n[h].length;y++){const _=Zp(n[h][y],s);Zs(t,_),g.push(_)}a.push(g)}return a}function Sh(n,t,s){const a=[];for(let h=0;h<n.length;h++){const g=Iu(n[h],t,s);a.push(g)}return a}function Th(n,t,s,a){if(n[0]<s[0]||n[0]>s[2]){const h=.5*a;let g=n[0]-s[0]>h?-a:s[0]-n[0]>h?a:0;g===0&&(g=n[0]-s[2]>h?-a:s[2]-n[0]>h?a:0),n[0]+=g}Zs(t,n)}function kh(n,t,s,a){const h=Math.pow(2,a.z)*Zi,g=[a.x*Zi,a.y*Zi],y=[];for(const _ of n)for(const w of _){const C=[w.x+g[0],w.y+g[1]];Th(C,t,s,h),y.push(C)}return y}function Ch(n,t,s,a){const h=Math.pow(2,a.z)*Zi,g=[a.x*Zi,a.y*Zi],y=[];for(const w of n){const C=[];for(const E of w){const P=[E.x+g[0],E.y+g[1]];Zs(t,P),C.push(P)}y.push(C)}if(t[2]-t[0]<=h/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const w of y)for(const C of w)Th(C,t,s,h)}var _;return y}class Gs{constructor(t,s){this.type=ft,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ls(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const h=[];for(const g of a.features){const{type:y,coordinates:_}=g.geometry;y==="Polygon"&&h.push(_),y==="MultiPolygon"&&h.push(..._)}if(h.length)return new Gs(a,{type:"MultiPolygon",coordinates:h})}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Gs(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Gs(a,a)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(a.type==="Polygon"){const _=Iu(a.coordinates,g,y),w=kh(s.geometry(),h,g,y);if(!As(h,g))return!1;for(const C of w)if(!vo(C,_))return!1}if(a.type==="MultiPolygon"){const _=Sh(a.coordinates,g,y),w=kh(s.geometry(),h,g,y);if(!As(h,g))return!1;for(const C of w)if(!Hp(C,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(a.type==="Polygon"){const _=Iu(a.coordinates,g,y),w=Ch(s.geometry(),h,g,y);if(!As(h,g))return!1;for(const C of w)if(!wh(C,_))return!1}if(a.type==="MultiPolygon"){const _=Sh(a.coordinates,g,y),w=Ch(s.geometry(),h,g,y);if(!As(h,g))return!1;for(const C of w)if(!Wp(C,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Eh=class{constructor(n=[],t=(s,a)=>s<a?-1:s>a?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:s}=this,a=t[n];for(;n>0;){const h=n-1>>1,g=t[h];if(s(a,g)>=0)break;t[n]=g,n=h}t[n]=a}_down(n){const{data:t,compare:s}=this,a=this.length>>1,h=t[n];for(;n<a;){let g=1+(n<<1);const y=g+1;if(y<this.length&&s(t[y],t[g])<0&&(g=y),s(t[g],h)>=0)break;t[n]=t[g],n=g}t[n]=h}};function Xp(n,t,s,a,h){Ih(n,t,s,a||n.length-1,h||Kp)}function Ih(n,t,s,a,h){for(;a>s;){if(a-s>600){var g=a-s+1,y=t-s+1,_=Math.log(g),w=.5*Math.exp(2*_/3),C=.5*Math.sqrt(_*w*(g-w)/g)*(y-g/2<0?-1:1);Ih(n,t,Math.max(s,Math.floor(t-y*w/g+C)),Math.min(a,Math.floor(t+(g-y)*w/g+C)),h)}var E=n[t],P=s,z=a;for(_a(n,s,t),h(n[a],E)>0&&_a(n,s,a);P<z;){for(_a(n,P,z),P++,z--;h(n[P],E)<0;)P++;for(;h(n[z],E)>0;)z--}h(n[s],E)===0?_a(n,s,z):_a(n,++z,a),z<=t&&(s=z+1),t<=z&&(a=z-1)}}function _a(n,t,s){var a=n[t];n[t]=n[s],n[s]=a}function Kp(n,t){return n<t?-1:n>t?1:0}function sl(n,t){if(n.length<=1)return[n];const s=[];let a,h;for(const g of n){const y=Jp(g);y!==0&&(g.area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(a&&s.push(a),a=[g]):a.push(g))}if(a&&s.push(a),t>1)for(let g=0;g<s.length;g++)s[g].length<=t||(Xp(s[g],t,1,s[g].length-1,Yp),s[g]=s[g].slice(0,t));return s}function Yp(n,t){return t.area-n.area}function Jp(n){let t=0;for(let s,a,h=0,g=n.length,y=g-1;h<g;y=h++)s=n[h],a=n[y],t+=(a.x-s.x)*(s.y+a.y);return t}const Ph=1/298.257223563,Ah=Ph*(2-Ph),Mh=Math.PI/180;class Pu{constructor(t){const s=6378.137*Mh*1e3,a=Math.cos(t*Mh),h=1/(1-Ah*(1-a*a)),g=Math.sqrt(h);this.kx=s*g*a,this.ky=s*g*h*(1-Ah)}distance(t,s){const a=this.wrap(t[0]-s[0])*this.kx,h=(t[1]-s[1])*this.ky;return Math.sqrt(a*a+h*h)}pointOnLine(t,s){let a,h,g,y,_=1/0;for(let w=0;w<t.length-1;w++){let C=t[w][0],E=t[w][1],P=this.wrap(t[w+1][0]-C)*this.kx,z=(t[w+1][1]-E)*this.ky,R=0;P===0&&z===0||(R=(this.wrap(s[0]-C)*this.kx*P+(s[1]-E)*this.ky*z)/(P*P+z*z),R>1?(C=t[w+1][0],E=t[w+1][1]):R>0&&(C+=P/this.kx*R,E+=z/this.ky*R)),P=this.wrap(s[0]-C)*this.kx,z=(s[1]-E)*this.ky;const B=P*P+z*z;B<_&&(_=B,a=C,h=E,g=w,y=R)}return{point:[a,h],index:g,t:Math.max(0,Math.min(1,y))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function zh(n,t){return t[0]-n[0]}function ol(n){return n[1]-n[0]+1}function ds(n,t){return n[1]>=n[0]&&n[1]<t}function Au(n,t){if(n[0]>n[1])return[null,null];const s=ol(n);if(t){if(s===2)return[n,null];const h=Math.floor(s/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(s===1)return[n,null];const a=Math.floor(s/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function Mu(n,t){if(!ds(t,n.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)Zs(s,n[a]);return s}function zu(n){const t=[1/0,1/0,-1/0,-1/0];for(const s of n)for(const a of s)Zs(t,a);return t}function al(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Du(n,t,s){if(!al(n)||!al(t))return NaN;let a=0,h=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),s.distance([0,0],[a,h])}function Hs(n,t,s){const a=s.pointOnLine(t,n);return s.distance(n,a.point)}function Lu(n,t,s,a,h){const g=Math.min(Hs(n,[s,a],h),Hs(t,[s,a],h)),y=Math.min(Hs(s,[n,t],h),Hs(a,[n,t],h));return Math.min(g,y)}function Qp(n,t,s,a,h){if(!ds(t,n.length)||!ds(a,s.length))return 1/0;let g=1/0;for(let y=t[0];y<t[1];++y){const _=n[y],w=n[y+1];for(let C=a[0];C<a[1];++C){const E=s[C],P=s[C+1];if(il(_,w,E,P))return 0;g=Math.min(g,Lu(_,w,E,P,h))}}return g}function kr(n,t,s,a,h){if(!ds(t,n.length)||!ds(a,s.length))return NaN;let g=1/0;for(let y=t[0];y<=t[1];++y)for(let _=a[0];_<=a[1];++_)if(g=Math.min(g,h.distance(n[y],s[_])),g===0)return g;return g}function ef(n,t,s){if(vo(n,t,!0))return 0;let a=1/0;for(const h of t){const g=h[0],y=h[h.length-1];if(g!==y&&(a=Math.min(a,Hs(n,[y,g],s)),a===0))return a;const _=s.pointOnLine(h,n);if(a=Math.min(a,s.distance(n,_.point)),a===0)return a}return a}function At(n,t,s,a){if(!ds(t,n.length))return NaN;for(let g=t[0];g<=t[1];++g)if(vo(n[g],s,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g){const y=n[g],_=n[g+1];for(const w of s)for(let C=0,E=w.length,P=E-1;C<E;P=C++){const z=w[P],R=w[C];if(il(y,_,z,R))return 0;h=Math.min(h,Lu(y,_,z,R,a))}}return h}function ll(n,t){for(const s of n)for(const a of s)if(vo(a,t,!0))return!0;return!1}function ir(n,t,s,a=1/0){const h=zu(n),g=zu(t);if(a!==1/0&&Du(h,g,s)>=a)return a;if(As(h,g)){if(ll(n,t))return 0}else if(ll(t,n))return 0;let y=1/0;for(const _ of n)for(let w=0,C=_.length,E=C-1;w<C;E=w++){const P=_[E],z=_[w];for(const R of t)for(let B=0,N=R.length,G=N-1;B<N;G=B++){const X=R[G],pe=R[B];if(il(P,z,X,pe))return 0;y=Math.min(y,Lu(P,z,X,pe,s))}}return y}function Jt(n,t,s,a,h,g){if(!g)return;const y=Du(Mu(a,g),h,s);y<t&&n.push([y,g,[0,0]])}function Ws(n,t,s,a,h,g,y){if(!g||!y)return;const _=Du(Mu(a,g),Mu(h,y),s);_<t&&n.push([_,g,y])}function va(n,t,s,a,h=1/0){let g=Math.min(a.distance(n[0],s[0][0]),h);if(g===0)return g;const y=new Eh([[0,[0,n.length-1],[0,0]]],zh),_=zu(s);for(;y.length>0;){const w=y.pop();if(w[0]>=g)continue;const C=w[1],E=t?50:100;if(ol(C)<=E){if(!ds(C,n.length))return NaN;if(t){const P=At(n,C,s,a);if(isNaN(P)||P===0)return P;g=Math.min(g,P)}else for(let P=C[0];P<=C[1];++P){const z=ef(n[P],s,a);if(g=Math.min(g,z),g===0)return 0}}else{const P=Au(C,t);Jt(y,g,a,n,_,P[0]),Jt(y,g,a,n,_,P[1])}}return g}function xa(n,t,s,a,h,g=1/0){let y=Math.min(g,h.distance(n[0],s[0]));if(y===0)return y;const _=new Eh([[0,[0,n.length-1],[0,s.length-1]]],zh);for(;_.length>0;){const w=_.pop();if(w[0]>=y)continue;const C=w[1],E=w[2],P=t?50:100,z=a?50:100;if(ol(C)<=P&&ol(E)<=z){if(!ds(C,n.length)&&ds(E,s.length))return NaN;let R;if(t&&a)R=Qp(n,C,s,E,h),y=Math.min(y,R);else if(t&&!a){const B=n.slice(C[0],C[1]+1);for(let N=E[0];N<=E[1];++N)if(R=Hs(s[N],B,h),y=Math.min(y,R),y===0)return y}else if(!t&&a){const B=s.slice(E[0],E[1]+1);for(let N=C[0];N<=C[1];++N)if(R=Hs(n[N],B,h),y=Math.min(y,R),y===0)return y}else R=kr(n,C,s,E,h),y=Math.min(y,R)}else{const R=Au(C,t),B=Au(E,a);Ws(_,y,h,n,s,R[0],B[0]),Ws(_,y,h,n,s,R[0],B[1]),Ws(_,y,h,n,s,R[1],B[0]),Ws(_,y,h,n,s,R[1],B[1])}}return y}function Ru(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class Xs{constructor(t,s){this.type=Re,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ls(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new Xs(a,a.features.map(h=>Ru(h.geometry)).flat());if(a.type==="Feature")return new Xs(a,Ru(a.geometry));if("type"in a&&"coordinates"in a)return new Xs(a,Ru(a))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,a){const h=s.geometry(),g=h.flat().map(w=>Eu([w.x,w.y],s.canonical));if(h.length===0)return NaN;const y=new Pu(g[0][1]);let _=1/0;for(const w of a){switch(w.type){case"Point":_=Math.min(_,xa(g,!1,[w.coordinates],!1,y,_));break;case"LineString":_=Math.min(_,xa(g,!1,w.coordinates,!0,y,_));break;case"Polygon":_=Math.min(_,va(g,!1,w.coordinates,y,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,a){const h=s.geometry(),g=h.flat().map(w=>Eu([w.x,w.y],s.canonical));if(h.length===0)return NaN;const y=new Pu(g[0][1]);let _=1/0;for(const w of a){switch(w.type){case"Point":_=Math.min(_,xa(g,!0,[w.coordinates],!1,y,_));break;case"LineString":_=Math.min(_,xa(g,!0,w.coordinates,!0,y,_));break;case"Polygon":_=Math.min(_,va(g,!0,w.coordinates,y,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(s,a){const h=s.geometry();if(h.length===0||h[0].length===0)return NaN;const g=sl(h,0).map(w=>w.map(C=>C.map(E=>Eu([E.x,E.y],s.canonical)))),y=new Pu(g[0][0][0][1]);let _=1/0;for(const w of a)for(const C of g){switch(w.type){case"Point":_=Math.min(_,va([w.coordinates],!1,C,y,_));break;case"LineString":_=Math.min(_,va(w.coordinates,!0,C,y,_));break;case"Polygon":_=Math.min(_,ir(C,w.coordinates,y,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const xo={"==":Up,"!=":_h,">":$p,"<":vh,">=":xh,"<=":qp,array:En,at:Se,boolean:En,case:Ct,coalesce:tl,collator:ya,format:nl,image:ku,in:je,"index-of":lt,interpolate:Hr,"interpolate-hcl":Hr,"interpolate-lab":Hr,length:Cu,let:se,literal:Cn,match:Tt,number:En,"number-format":Tu,object:En,slice:Ur,step:Wt,string:En,"to-boolean":Bn,"to-color":Bn,"to-number":Bn,"to-string":Bn,var:we,within:Gs,distance:Xs};class hi{constructor(t,s,a,h){this.name=t,this.type=s,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const a=t[0],h=hi.definitions[a];if(!h)return s.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,_=y.filter(([C])=>!Array.isArray(C)||C.length===t.length-1);let w=null;for(const[C,E]of _){w=new cs(s.registry,wa,s.path,null,s.scope);const P=[];let z=!1;for(let R=1;R<t.length;R++){const B=t[R],N=Array.isArray(C)?C[R-1]:C.type,G=w.parse(B,1+P.length,N);if(!G){z=!0;break}P.push(G)}if(!z)if(Array.isArray(C)&&C.length!==P.length)w.error(`Expected ${C.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const B=Array.isArray(C)?C[R]:C.type,N=P[R];w.concat(R+1).checkSubtype(B,N.type)}if(w.errors.length===0)return new hi(a,g,E,P)}}if(_.length===1)s.errors.push(...w.errors);else{const C=(_.length?_:y).map(([P])=>{return z=P,Array.isArray(z)?`(${z.map(D).join(", ")})`:`(${D(z.type)}...)`;var z}).join(" | "),E=[];for(let P=1;P<t.length;P++){const z=s.parse(t[P],1+E.length);if(!z)return null;E.push(D(z.type))}s.error(`Expected arguments of type ${C}, but found (${E.join(", ")}) instead.`)}return null}static register(t,s){hi.definitions=s;for(const a in s)t[a]=hi}}function Fu(n,[t,s,a,h]){t=t.evaluate(n),s=s.evaluate(n),a=a.evaluate(n);const g=h?h.evaluate(n):1,y=Ps(t,s,a,g);if(y)throw new mr(y);return new Gt(t/255,s/255,a/255,g,!1)}function Bu(n,t){return n in t}function Ou(n,t){const s=t[n];return s===void 0?null:s}function Ks(n){return{type:n}}function wa(n){if(n instanceof we)return wa(n.boundExpression);if(n instanceof hi&&n.name==="error"||n instanceof ya||n instanceof Gs||n instanceof Xs)return!1;const t=n instanceof Bn||n instanceof En;let s=!0;return n.eachChild(a=>{s=t?s&&wa(a):s&&a instanceof Cn}),!!s&&ba(n)&&Sa(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ba(n){if(n instanceof hi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Gs||n instanceof Xs)return!1;let t=!0;return n.eachChild(s=>{t&&!ba(s)&&(t=!1)}),t}function wo(n){if(n instanceof hi&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(s=>{t&&!wo(s)&&(t=!1)}),t}function Sa(n,t){if(n instanceof hi&&t.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(a=>{s&&!Sa(a,t)&&(s=!1)}),s}function ul(n){return{result:"success",value:n}}function bo(n){return{result:"error",value:n}}function So(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Dh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Nu(n){return!!n.expression&&n.expression.interpolated}function Ut(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function cl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function tf(n){return n}function Lh(n,t){const s=t.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",h=a||!(a||n.property!==void 0),g=n.type||(Nu(t)?"exponential":"interval");if(s||t.type==="padding"){const E=s?Gt.parse:dn.parse;(n=Kn({},n)).stops&&(n.stops=n.stops.map(P=>[P[0],E(P[1])])),n.default=E(n.default?n.default:t.default)}if(n.colorSpace&&(y=n.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var y;let _,w,C;if(g==="exponential")_=Fh;else if(g==="interval")_=hl;else if(g==="categorical"){_=Rh,w=Object.create(null);for(const E of n.stops)w[E[0]]=E[1];C=typeof n.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=Bh}if(a){const E={},P=[];for(let B=0;B<n.stops.length;B++){const N=n.stops[B],G=N[0].zoom;E[G]===void 0&&(E[G]={zoom:G,type:n.type,property:n.property,default:n.default,stops:[]},P.push(G)),E[G].stops.push([N[0].value,N[1]])}const z=[];for(const B of P)z.push([E[B].zoom,Lh(E[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Hr.interpolationFactor.bind(void 0,R),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},N)=>Fh({stops:z,base:n.base},t,B).evaluate(B,N)}}if(h){const E=g==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Hr.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(n,t,P,w,C)}}return{kind:"source",evaluate(E,P){const z=P&&P.properties?P.properties[n.property]:void 0;return z===void 0?To(n.default,t.default):_(n,t,z,w,C)}}}function To(n,t,s){return n!==void 0?n:t!==void 0?t:s!==void 0?s:void 0}function Rh(n,t,s,a,h){return To(typeof s===h?a[s]:void 0,n.default,t.default)}function hl(n,t,s){if(Ut(s)!=="number")return To(n.default,t.default);const a=n.stops.length;if(a===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[a-1][0])return n.stops[a-1][1];const h=lr(n.stops.map(g=>g[0]),s);return n.stops[h][1]}function Fh(n,t,s){const a=n.base!==void 0?n.base:1;if(Ut(s)!=="number")return To(n.default,t.default);const h=n.stops.length;if(h===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[h-1][0])return n.stops[h-1][1];const g=lr(n.stops.map(E=>E[0]),s),y=function(E,P,z,R){const B=R-z,N=E-z;return B===0?0:P===1?N/B:(Math.pow(P,N)-1)/(Math.pow(P,B)-1)}(s,a,n.stops[g][0],n.stops[g+1][0]),_=n.stops[g][1],w=n.stops[g+1][1],C=Gr[t.type]||tf;return typeof _.evaluate=="function"?{evaluate(...E){const P=_.evaluate.apply(void 0,E),z=w.evaluate.apply(void 0,E);if(P!==void 0&&z!==void 0)return C(P,z,y,n.colorSpace)}}:C(_,w,y,n.colorSpace)}function Bh(n,t,s){switch(t.type){case"color":s=Gt.parse(s);break;case"formatted":s=kn.fromString(s.toString());break;case"resolvedImage":s=tn.fromString(s.toString());break;case"padding":s=dn.parse(s);break;default:Ut(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return To(s,n.default,t.default)}hi.register(xo,{error:[{kind:"error"},[kt],(n,[t])=>{throw new mr(t.evaluate(n))}],typeof:[kt,[vt],(n,[t])=>D(Tr(t.evaluate(n)))],"to-rgba":[L(Re,4),[Ar],(n,[t])=>{const[s,a,h,g]=t.evaluate(n).rgb;return[255*s,255*a,255*h,g]}],rgb:[Ar,[Re,Re,Re],Fu],rgba:[Ar,[Re,Re,Re,Re],Fu],has:{type:ft,overloads:[[[kt],(n,[t])=>Bu(t.evaluate(n),n.properties())],[[kt,yr],(n,[t,s])=>Bu(t.evaluate(n),s.evaluate(n))]]},get:{type:vt,overloads:[[[kt],(n,[t])=>Ou(t.evaluate(n),n.properties())],[[kt,yr],(n,[t,s])=>Ou(t.evaluate(n),s.evaluate(n))]]},"feature-state":[vt,[kt],(n,[t])=>Ou(t.evaluate(n),n.featureState||{})],properties:[yr,[],n=>n.properties()],"geometry-type":[kt,[],n=>n.geometryType()],id:[vt,[],n=>n.id()],zoom:[Re,[],n=>n.globals.zoom],"heatmap-density":[Re,[],n=>n.globals.heatmapDensity||0],"line-progress":[Re,[],n=>n.globals.lineProgress||0],accumulated:[vt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Re,Ks(Re),(n,t)=>{let s=0;for(const a of t)s+=a.evaluate(n);return s}],"*":[Re,Ks(Re),(n,t)=>{let s=1;for(const a of t)s*=a.evaluate(n);return s}],"-":{type:Re,overloads:[[[Re,Re],(n,[t,s])=>t.evaluate(n)-s.evaluate(n)],[[Re],(n,[t])=>-t.evaluate(n)]]},"/":[Re,[Re,Re],(n,[t,s])=>t.evaluate(n)/s.evaluate(n)],"%":[Re,[Re,Re],(n,[t,s])=>t.evaluate(n)%s.evaluate(n)],ln2:[Re,[],()=>Math.LN2],pi:[Re,[],()=>Math.PI],e:[Re,[],()=>Math.E],"^":[Re,[Re,Re],(n,[t,s])=>Math.pow(t.evaluate(n),s.evaluate(n))],sqrt:[Re,[Re],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Re,[Re],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Re,[Re],(n,[t])=>Math.log(t.evaluate(n))],log2:[Re,[Re],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Re,[Re],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Re,[Re],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Re,[Re],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Re,[Re],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Re,[Re],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Re,[Re],(n,[t])=>Math.atan(t.evaluate(n))],min:[Re,Ks(Re),(n,t)=>Math.min(...t.map(s=>s.evaluate(n)))],max:[Re,Ks(Re),(n,t)=>Math.max(...t.map(s=>s.evaluate(n)))],abs:[Re,[Re],(n,[t])=>Math.abs(t.evaluate(n))],round:[Re,[Re],(n,[t])=>{const s=t.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[Re,[Re],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Re,[Re],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[ft,[kt,vt],(n,[t,s])=>n.properties()[t.value]===s.value],"filter-id-==":[ft,[vt],(n,[t])=>n.id()===t.value],"filter-type-==":[ft,[kt],(n,[t])=>n.geometryType()===t.value],"filter-<":[ft,[kt,vt],(n,[t,s])=>{const a=n.properties()[t.value],h=s.value;return typeof a==typeof h&&a<h}],"filter-id-<":[ft,[vt],(n,[t])=>{const s=n.id(),a=t.value;return typeof s==typeof a&&s<a}],"filter->":[ft,[kt,vt],(n,[t,s])=>{const a=n.properties()[t.value],h=s.value;return typeof a==typeof h&&a>h}],"filter-id->":[ft,[vt],(n,[t])=>{const s=n.id(),a=t.value;return typeof s==typeof a&&s>a}],"filter-<=":[ft,[kt,vt],(n,[t,s])=>{const a=n.properties()[t.value],h=s.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[ft,[vt],(n,[t])=>{const s=n.id(),a=t.value;return typeof s==typeof a&&s<=a}],"filter->=":[ft,[kt,vt],(n,[t,s])=>{const a=n.properties()[t.value],h=s.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[ft,[vt],(n,[t])=>{const s=n.id(),a=t.value;return typeof s==typeof a&&s>=a}],"filter-has":[ft,[vt],(n,[t])=>t.value in n.properties()],"filter-has-id":[ft,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ft,[L(kt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[ft,[L(vt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[ft,[kt,L(vt)],(n,[t,s])=>s.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[ft,[kt,L(vt)],(n,[t,s])=>function(a,h,g,y){for(;g<=y;){const _=g+y>>1;if(h[_]===a)return!0;h[_]>a?y=_-1:g=_+1}return!1}(n.properties()[t.value],s.value,0,s.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(n,[t,s])=>t.evaluate(n)&&s.evaluate(n)],[Ks(ft),(n,t)=>{for(const s of t)if(!s.evaluate(n))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(n,[t,s])=>t.evaluate(n)||s.evaluate(n)],[Ks(ft),(n,t)=>{for(const s of t)if(s.evaluate(n))return!0;return!1}]]},"!":[ft,[ft],(n,[t])=>!t.evaluate(n)],"is-supported-script":[ft,[kt],(n,[t])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(t.evaluate(n))}],upcase:[kt,[kt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[kt,[kt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[kt,Ks(vt),(n,t)=>t.map(s=>us(s.evaluate(n))).join("")],"resolved-locale":[kt,[ui],(n,[t])=>t.evaluate(n).resolvedLocale()]});class dl{constructor(t,s){var a;this.expression=t,this._warningHistory={},this._evaluator=new qs,this._defaultValue=s?(a=s).type==="color"&&cl(a.default)?new Gt(0,0,0,0):a.type==="color"?Gt.parse(a.default)||null:a.type==="padding"?dn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Fn.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,s,a,h,g,y){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function pl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in xo}function ko(n,t){const s=new cs(xo,wa,[],t?function(h){const g={color:Ar,string:kt,number:Re,enum:kt,boolean:ft,formatted:Yn,padding:ci,resolvedImage:hn,variableAnchorOffsetCollection:W};return h.type==="array"?L(g[h.value]||vt,h.length):g[h.type]}(t):void 0),a=s.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?ul(new dl(a,t)):bo(s.errors)}class Co{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!wo(s.expression)}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,s,a,h,g,y)}evaluate(t,s,a,h,g,y){return this._styleExpression.evaluate(t,s,a,h,g,y)}}class Eo{constructor(t,s,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!wo(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,s,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,s,a,h,g,y)}evaluate(t,s,a,h,g,y){return this._styleExpression.evaluate(t,s,a,h,g,y)}interpolationFactor(t,s,a){return this.interpolationType?Hr.interpolationFactor(this.interpolationType,t,s,a):0}}function ju(n,t){const s=ko(n,t);if(s.result==="error")return s;const a=s.value.expression,h=ba(a);if(!h&&!So(t))return bo([new ar("","data expressions not supported")]);const g=Sa(a,["zoom"]);if(!g&&!Dh(t))return bo([new ar("","zoom expressions not supported")]);const y=Ta(a);return y||g?y instanceof ar?bo([y]):y instanceof Hr&&!Nu(t)?bo([new ar("",'"interpolate" expressions cannot be used with this property')]):ul(y?new Eo(h?"camera":"composite",s.value,y.labels,y instanceof Hr?y.interpolation:void 0):new Co(h?"constant":"source",s.value)):bo([new ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Io{constructor(t,s){this._parameters=t,this._specification=s,Kn(this,Lh(this._parameters,this._specification))}static deserialize(t){return new Io(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ta(n){let t=null;if(n instanceof se)t=Ta(n.result);else if(n instanceof tl){for(const s of n.args)if(t=Ta(s),t)break}else(n instanceof Wt||n instanceof Hr)&&n.input instanceof hi&&n.input.name==="zoom"&&(t=n);return t instanceof ar||n.eachChild(s=>{const a=Ta(s);a instanceof ar?t=a:!t&&a?t=new ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new ar("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function fl(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!fl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ml={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vu(n){if(n==null)return{filter:()=>!0,needGeometry:!1};fl(n)||(n=gl(n));const t=ko(n,ml);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,a,h)=>t.value.evaluate(s,a,{},h),needGeometry:Oh(n)}}function rf(n,t){return n<t?-1:n>t?1:0}function Oh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Oh(n[t]))return!0;return!1}function gl(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Uu(n[1],n[2],"=="):t==="!="?pn(Uu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Uu(n[1],n[2],t):t==="any"?(s=n.slice(1),["any"].concat(s.map(gl))):t==="all"?["all"].concat(n.slice(1).map(gl)):t==="none"?["all"].concat(n.slice(1).map(gl).map(pn)):t==="in"?ka(n[1],n.slice(2)):t==="!in"?pn(ka(n[1],n.slice(2))):t==="has"?Ca(n[1]):t!=="!has"||pn(Ca(n[1]));var s}function Uu(n,t,s){switch(n){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,n,t]}}function ka(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",n,["literal",t.sort(rf)]]:["filter-in-small",n,["literal",t]]}}function Ca(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function pn(n){return["!",n]}function Ys(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const g of n)h+=`${Ys(g)},`;return`${h}]`}const s=Object.keys(n).sort();let a="{";for(let h=0;h<s.length;h++)a+=`${JSON.stringify(s[h])}:${Ys(n[s[h]])},`;return`${a}}`}function Nh(n){let t="";for(const s of Ti)t+=`/${Ys(n[s])}`;return t}function jh(n){const t=n.value;return t?[new Ae(n.key,t,"constants have been deprecated as of v8")]:[]}function Cr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ci(n){if(Array.isArray(n))return n.map(Ci);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const s in n)t[s]=Ci(n[s]);return t}return Cr(n)}function Jn(n){const t=n.key,s=n.value,a=n.valueSpec||{},h=n.objectElementValidators||{},g=n.style,y=n.styleSpec,_=n.validateSpec;let w=[];const C=Ut(s);if(C!=="object")return[new Ae(t,s,`object expected, ${C} found`)];for(const E in s){const P=E.split(".")[0],z=a[P]||a["*"];let R;if(h[P])R=h[P];else if(a[P])R=_;else if(h["*"])R=h["*"];else{if(!a["*"]){w.push(new Ae(t,s[E],`unknown property "${E}"`));continue}R=_}w=w.concat(R({key:(t&&`${t}.`)+E,value:s[E],valueSpec:z,style:g,styleSpec:y,object:s,objectKey:E,validateSpec:_},s))}for(const E in a)h[E]||a[E].required&&a[E].default===void 0&&s[E]===void 0&&w.push(new Ae(t,s,`missing required property "${E}"`));return w}function Ea(n){const t=n.value,s=n.valueSpec,a=n.style,h=n.styleSpec,g=n.key,y=n.arrayElementValidator||n.validateSpec;if(Ut(t)!=="array")return[new Ae(g,t,`array expected, ${Ut(t)} found`)];if(s.length&&t.length!==s.length)return[new Ae(g,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Ae(g,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let _={type:s.value,values:s.values};h.$version<7&&(_.function=s.function),Ut(s.value)==="object"&&(_=s.value);let w=[];for(let C=0;C<t.length;C++)w=w.concat(y({array:t,arrayIndex:C,value:t[C],valueSpec:_,validateSpec:n.validateSpec,style:a,styleSpec:h,key:`${g}[${C}]`}));return w}function $u(n){const t=n.key,s=n.value,a=n.valueSpec;let h=Ut(s);return h==="number"&&s!=s&&(h="NaN"),h!=="number"?[new Ae(t,s,`number expected, ${h} found`)]:"minimum"in a&&s<a.minimum?[new Ae(t,s,`${s} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&s>a.maximum?[new Ae(t,s,`${s} is greater than the maximum value ${a.maximum}`)]:[]}function yl(n){const t=n.valueSpec,s=Cr(n.value.type);let a,h,g,y={};const _=s!=="categorical"&&n.value.property===void 0,w=!_,C=Ut(n.value.stops)==="array"&&Ut(n.value.stops[0])==="array"&&Ut(n.value.stops[0][0])==="object",E=Jn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(R){if(s==="identity")return[new Ae(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const N=R.value;return B=B.concat(Ea({key:R.key,value:N,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:P})),Ut(N)==="array"&&N.length===0&&B.push(new Ae(R.key,N,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return s==="identity"&&_&&E.push(new Ae(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||E.push(new Ae(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!Nu(n.valueSpec)&&E.push(new Ae(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!So(n.valueSpec)?E.push(new Ae(n.key,n.value,"property functions not supported")):_&&!Dh(n.valueSpec)&&E.push(new Ae(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!C||n.value.property!==void 0||E.push(new Ae(n.key,n.value,'"property" property is required')),E;function P(R){let B=[];const N=R.value,G=R.key;if(Ut(N)!=="array")return[new Ae(G,N,`array expected, ${Ut(N)} found`)];if(N.length!==2)return[new Ae(G,N,`array length 2 expected, length ${N.length} found`)];if(C){if(Ut(N[0])!=="object")return[new Ae(G,N,`object expected, ${Ut(N[0])} found`)];if(N[0].zoom===void 0)return[new Ae(G,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new Ae(G,N,"object stop key must have value")];if(g&&g>Cr(N[0].zoom))return[new Ae(G,N[0].zoom,"stop zoom values must appear in ascending order")];Cr(N[0].zoom)!==g&&(g=Cr(N[0].zoom),h=void 0,y={}),B=B.concat(Jn({key:`${G}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:$u,value:z}}))}else B=B.concat(z({key:`${G}[0]`,value:N[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},N));return pl(Ci(N[1]))?B.concat([new Ae(`${G}[1]`,N[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${G}[1]`,value:N[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function z(R,B){const N=Ut(R.value),G=Cr(R.value),X=R.value!==null?R.value:B;if(a){if(N!==a)return[new Ae(R.key,X,`${N} stop domain type must match previous stop domain type ${a}`)]}else a=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new Ae(R.key,X,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&s!=="categorical"){let pe=`number expected, ${N} found`;return So(t)&&s===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ae(R.key,X,pe)]}return s!=="categorical"||N!=="number"||isFinite(G)&&Math.floor(G)===G?s!=="categorical"&&N==="number"&&h!==void 0&&G<h?[new Ae(R.key,X,"stop domain values must appear in ascending order")]:(h=G,s==="categorical"&&G in y?[new Ae(R.key,X,"stop domain values must be unique")]:(y[G]=!0,[])):[new Ae(R.key,X,`integer expected, found ${G}`)]}}function Po(n){const t=(n.expressionContext==="property"?ju:ko)(Ci(n.value),n.valueSpec);if(t.result==="error")return t.value.map(a=>new Ae(`${n.key}${a.key}`,n.value,a.message));const s=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new Ae(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!wo(s))return[new Ae(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!wo(s))return[new Ae(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Sa(s,["zoom","feature-state"]))return[new Ae(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ba(s))return[new Ae(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ps(n){const t=n.key,s=n.value,a=n.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Cr(s))===-1&&h.push(new Ae(t,s,`expected one of [${a.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(a.values).indexOf(Cr(s))===-1&&h.push(new Ae(t,s,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function qu(n){return fl(Ci(n.value))?Po(Kn({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):_l(n)}function _l(n){const t=n.value,s=n.key;if(Ut(t)!=="array")return[new Ae(s,t,`array expected, ${Ut(t)} found`)];const a=n.styleSpec;let h,g=[];if(t.length<1)return[new Ae(s,t,"filter array must have at least 1 element")];switch(g=g.concat(ps({key:`${s}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),Cr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Cr(t[1])==="$type"&&g.push(new Ae(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Ae(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Ut(t[1]),h!=="string"&&g.push(new Ae(`${s}[1]`,t[1],`string expected, ${h} found`)));for(let y=2;y<t.length;y++)h=Ut(t[y]),Cr(t[1])==="$type"?g=g.concat(ps({key:`${s}[${y}]`,value:t[y],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Ae(`${s}[${y}]`,t[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(_l({key:`${s}[${y}]`,value:t[y],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=Ut(t[1]),t.length!==2?g.push(new Ae(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Ae(`${s}[1]`,t[1],`string expected, ${h} found`))}return g}function Zu(n,t){const s=n.key,a=n.validateSpec,h=n.style,g=n.styleSpec,y=n.value,_=n.objectKey,w=g[`${t}_${n.layerType}`];if(!w)return[];const C=_.match(/^(.*)-transition$/);if(t==="paint"&&C&&w[C[1]]&&w[C[1]].transition)return a({key:s,value:y,valueSpec:g.transition,style:h,styleSpec:g});const E=n.valueSpec||w[_];if(!E)return[new Ae(s,y,`unknown property "${_}"`)];let P;if(Ut(y)==="string"&&So(E)&&!E.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new Ae(s,y,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const z=[];return n.layerType==="symbol"&&(_==="text-field"&&h&&!h.glyphs&&z.push(new Ae(s,y,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&cl(Ci(y))&&Cr(y.type)==="identity"&&z.push(new Ae(s,y,'"text-font" does not support identity functions'))),z.concat(a({key:n.key,value:y,valueSpec:E,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:_}))}function vl(n){return Zu(n,"paint")}function Gu(n){return Zu(n,"layout")}function Hu(n){let t=[];const s=n.value,a=n.key,h=n.style,g=n.styleSpec;s.type||s.ref||t.push(new Ae(a,s,'either "type" or "ref" is required'));let y=Cr(s.type);const _=Cr(s.ref);if(s.id){const w=Cr(s.id);for(let C=0;C<n.arrayIndex;C++){const E=h.layers[C];Cr(E.id)===w&&t.push(new Ae(a,s.id,`duplicate layer id "${s.id}", previously used at line ${E.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(C=>{C in s&&t.push(new Ae(a,s[C],`"${C}" is prohibited for ref layers`))}),h.layers.forEach(C=>{Cr(C.id)===_&&(w=C)}),w?w.ref?t.push(new Ae(a,s.ref,"ref cannot reference another ref layer")):y=Cr(w.type):t.push(new Ae(a,s.ref,`ref layer "${_}" not found`))}else if(y!=="background")if(s.source){const w=h.sources&&h.sources[s.source],C=w&&Cr(w.type);w?C==="vector"&&y==="raster"?t.push(new Ae(a,s.source,`layer "${s.id}" requires a raster source`)):C!=="raster-dem"&&y==="hillshade"?t.push(new Ae(a,s.source,`layer "${s.id}" requires a raster-dem source`)):C==="raster"&&y!=="raster"?t.push(new Ae(a,s.source,`layer "${s.id}" requires a vector source`)):C!=="vector"||s["source-layer"]?C==="raster-dem"&&y!=="hillshade"?t.push(new Ae(a,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!s.paint||!s.paint["line-gradient"]||C==="geojson"&&w.lineMetrics||t.push(new Ae(a,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ae(a,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Ae(a,s.source,`source "${s.source}" not found`))}else t.push(new Ae(a,s,'missing required property "source"'));return t=t.concat(Jn({key:a,value:s,valueSpec:g.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:s.type,valueSpec:g.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"}),filter:qu,layout:w=>Jn({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":C=>Gu(Kn({layerType:y},C))}}),paint:w=>Jn({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":C=>vl(Kn({layerType:y},C))}})}})),t}function Js(n){const t=n.value,s=n.key,a=Ut(t);return a!=="string"?[new Ae(s,t,`string expected, ${a} found`)]:[]}const xl={promoteId:function({key:n,value:t}){if(Ut(t)==="string")return Js({key:n,value:t});{const s=[];for(const a in t)s.push(...Js({key:`${n}.${a}`,value:t[a]}));return s}}};function Ia(n){const t=n.value,s=n.key,a=n.styleSpec,h=n.style,g=n.validateSpec;if(!t.type)return[new Ae(s,t,'"type" is required')];const y=Cr(t.type);let _;switch(y){case"vector":case"raster":return _=Jn({key:s,value:t,valueSpec:a[`source_${y.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:xl,validateSpec:g}),_;case"raster-dem":return _=function(w){var C;const E=(C=w.sourceName)!==null&&C!==void 0?C:"",P=w.value,z=w.styleSpec,R=z.source_raster_dem,B=w.style;let N=[];const G=Ut(P);if(P===void 0)return N;if(G!=="object")return N.push(new Ae("source_raster_dem",P,`object expected, ${G} found`)),N;const X=Cr(P.encoding)==="custom",pe=["redFactor","greenFactor","blueFactor","baseShift"],re=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const ce in P)!X&&pe.includes(ce)?N.push(new Ae(ce,P[ce],`In "${E}": "${ce}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):R[ce]?N=N.concat(w.validateSpec({key:ce,value:P[ce],valueSpec:R[ce],validateSpec:w.validateSpec,style:B,styleSpec:z})):N.push(new Ae(ce,P[ce],`unknown property "${ce}"`));return N}({sourceName:s,value:t,style:n.style,styleSpec:a,validateSpec:g}),_;case"geojson":if(_=Jn({key:s,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:xl}),t.cluster)for(const w in t.clusterProperties){const[C,E]=t.clusterProperties[w],P=typeof C=="string"?[C,["accumulated"],["get",w]]:C;_.push(...Po({key:`${s}.${w}.map`,value:E,expressionContext:"cluster-map"})),_.push(...Po({key:`${s}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return _;case"video":return Jn({key:s,value:t,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return Jn({key:s,value:t,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new Ae(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ps({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Wu(n){const t=n.value,s=n.styleSpec,a=s.light,h=n.style;let g=[];const y=Ut(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new Ae("light",t,`object expected, ${y} found`)]),g;for(const _ in t){const w=_.match(/^(.*)-transition$/);g=g.concat(w&&a[w[1]]&&a[w[1]].transition?n.validateSpec({key:_,value:t[_],valueSpec:s.transition,validateSpec:n.validateSpec,style:h,styleSpec:s}):a[_]?n.validateSpec({key:_,value:t[_],valueSpec:a[_],validateSpec:n.validateSpec,style:h,styleSpec:s}):[new Ae(_,t[_],`unknown property "${_}"`)])}return g}function Xu(n){const t=n.value,s=n.styleSpec,a=s.sky,h=n.style,g=Ut(t);if(t===void 0)return[];if(g!=="object")return[new Ae("sky",t,`object expected, ${g} found`)];let y=[];for(const _ in t)y=y.concat(a[_]?n.validateSpec({key:_,value:t[_],valueSpec:a[_],style:h,styleSpec:s}):[new Ae(_,t[_],`unknown property "${_}"`)]);return y}function Ku(n){const t=n.value,s=n.styleSpec,a=s.terrain,h=n.style;let g=[];const y=Ut(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new Ae("terrain",t,`object expected, ${y} found`)]),g;for(const _ in t)g=g.concat(a[_]?n.validateSpec({key:_,value:t[_],valueSpec:a[_],validateSpec:n.validateSpec,style:h,styleSpec:s}):[new Ae(_,t[_],`unknown property "${_}"`)]);return g}function Yu(n){let t=[];const s=n.value,a=n.key;if(Array.isArray(s)){const h=[],g=[];for(const y in s)s[y].id&&h.includes(s[y].id)&&t.push(new Ae(a,s,`all the sprites' ids must be unique, but ${s[y].id} is duplicated`)),h.push(s[y].id),s[y].url&&g.includes(s[y].url)&&t.push(new Ae(a,s,`all the sprites' URLs must be unique, but ${s[y].url} is duplicated`)),g.push(s[y].url),t=t.concat(Jn({key:`${a}[${y}]`,value:s[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Js({key:a,value:s})}const wl={"*":()=>[],array:Ea,boolean:function(n){const t=n.value,s=n.key,a=Ut(t);return a!=="boolean"?[new Ae(s,t,`boolean expected, ${a} found`)]:[]},number:$u,color:function(n){const t=n.key,s=n.value,a=Ut(s);return a!=="string"?[new Ae(t,s,`color expected, ${a} found`)]:Gt.parse(String(s))?[]:[new Ae(t,s,`color expected, "${s}" found`)]},constants:jh,enum:ps,filter:qu,function:yl,layer:Hu,object:Jn,source:Ia,light:Wu,sky:Xu,terrain:Ku,projection:function(n){const t=n.value,s=n.styleSpec,a=s.projection,h=n.style,g=Ut(t);if(t===void 0)return[];if(g!=="object")return[new Ae("projection",t,`object expected, ${g} found`)];let y=[];for(const _ in t)y=y.concat(a[_]?n.validateSpec({key:_,value:t[_],valueSpec:a[_],style:h,styleSpec:s}):[new Ae(_,t[_],`unknown property "${_}"`)]);return y},string:Js,formatted:function(n){return Js(n).length===0?[]:Po(n)},resolvedImage:function(n){return Js(n).length===0?[]:Po(n)},padding:function(n){const t=n.key,s=n.value;if(Ut(s)==="array"){if(s.length<1||s.length>4)return[new Ae(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const a={type:"number"};let h=[];for(let g=0;g<s.length;g++)h=h.concat(n.validateSpec({key:`${t}[${g}]`,value:s[g],validateSpec:n.validateSpec,valueSpec:a}));return h}return $u({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,s=n.value,a=Ut(s),h=n.styleSpec;if(a!=="array"||s.length<1||s.length%2!=0)return[new Ae(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<s.length;y+=2)g=g.concat(ps({key:`${t}[${y}]`,value:s[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(Ea({key:`${t}[${y+1}]`,value:s[y+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return g},sprite:Yu};function Pa(n){const t=n.value,s=n.valueSpec,a=n.styleSpec;return n.validateSpec=Pa,s.expression&&cl(Cr(t))?yl(n):s.expression&&pl(Ci(t))?Po(n):s.type&&wl[s.type]?wl[s.type](n):Jn(Kn({},n,{valueSpec:s.type?a[s.type]:s}))}function Vh(n){const t=n.value,s=n.key,a=Js(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Ae(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Ae(s,t,'"glyphs" url must include a "{range}" token'))),a}function di(n,t=ye){let s=[];return s=s.concat(Pa({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Pa,objectElementValidators:{glyphs:Vh,"*":()=>[]}})),n.constants&&(s=s.concat(jh({key:"constants",value:n.constants}))),Ju(s)}function Gi(n){return function(t){return n({...t,validateSpec:Pa})}}function Ju(n){return[].concat(n).sort((t,s)=>t.line-s.line)}function Ei(n){return function(...t){return Ju(n.apply(this,t))}}di.source=Ei(Gi(Ia)),di.sprite=Ei(Gi(Yu)),di.glyphs=Ei(Gi(Vh)),di.light=Ei(Gi(Wu)),di.sky=Ei(Gi(Xu)),di.terrain=Ei(Gi(Ku)),di.layer=Ei(Gi(Hu)),di.filter=Ei(Gi(qu)),di.paintProperty=Ei(Gi(vl)),di.layoutProperty=Ei(Gi(Gu));const Qs=di,nf=Qs.light,sf=Qs.sky,Uh=Qs.paintProperty,$h=Qs.layoutProperty;function Qu(n,t){let s=!1;if(t&&t.length)for(const a of t)n.fire(new Si(new Error(a.message))),s=!0;return s}class Ao{constructor(t,s,a){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(s=y[1])+2*(a=y[2]);for(let w=0;w<this.d*this.d;w++){const C=y[3+w],E=y[3+w+1];h.push(C===E?null:y.subarray(C,E))}const _=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],_),this.bboxes=y.subarray(_),this.insert=this._insertReadonly}else{this.d=s+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=a,this.scale=s/t,this.uid=0;const g=a/s*t;this.min=-g,this.max=t+g}insert(t,s,a,h,g){this._forEachCell(s,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,a,h,g,y){this.cells[g].push(y)}query(t,s,a,h,g){const y=this.min,_=this.max;if(t<=y&&s<=y&&_<=a&&_<=h&&!g)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,s,a,h,this._queryCell,w,{},g),w}}_queryCell(t,s,a,h,g,y,_,w){const C=this.cells[g];if(C!==null){const E=this.keys,P=this.bboxes;for(let z=0;z<C.length;z++){const R=C[z];if(_[R]===void 0){const B=4*R;(w?w(P[B+0],P[B+1],P[B+2],P[B+3]):t<=P[B+2]&&s<=P[B+3]&&a>=P[B+0]&&h>=P[B+1])?(_[R]=!0,y.push(E[R])):_[R]=!1}}}}_forEachCell(t,s,a,h,g,y,_,w){const C=this._convertToCellCoord(t),E=this._convertToCellCoord(s),P=this._convertToCellCoord(a),z=this._convertToCellCoord(h);for(let R=C;R<=P;R++)for(let B=E;B<=z;B++){const N=this.d*B+R;if((!w||w(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&g.call(this,t,s,a,h,N,y,_,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const h=new Int32Array(s+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=s;for(let y=0;y<t.length;y++){const _=t[y];h[3+y]=g,h.set(_,g),g+=_.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,s){const a=t.toArrayBuffer();return s&&s.push(a),{buffer:a}}static deserialize(t){return new Ao(t.buffer)}}const pi={};function tt(n,t,s={}){if(pi[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),pi[n]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}tt("Object",Object),tt("TransferableGridIndex",Ao),tt("Color",Gt),tt("Error",Error),tt("AJAXError",vr),tt("ResolvedImage",tn),tt("StylePropertyFunction",Io),tt("StyleExpression",dl,{omit:["_evaluator"]}),tt("ZoomDependentExpression",Eo),tt("ZoomConstantExpression",Co),tt("CompoundExpression",hi,{omit:["_evaluate"]});for(const n in xo)xo[n]._classRegistryKey||tt(`Expression_${n}`,xo[n]);function bl(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ec(n){return n.$name||n.constructor._classRegistryKey}function qh(n){return!function(t){if(t===null||typeof t!="object")return!1;const s=ec(t);return!(!s||s==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||bl(n)||an(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Mo(n,t){if(qh(n))return(bl(n)||an(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const g=[];for(const y of n)g.push(Mo(y,t));return g}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const s=ec(n);if(!s)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!pi[s])throw new Error(`${s} is not registered.`);const{klass:a}=pi[s],h=a.serialize?a.serialize(n,t):{};if(a.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in n){if(!n.hasOwnProperty(g)||pi[s].omit.indexOf(g)>=0)continue;const y=n[g];h[g]=pi[s].shallow.indexOf(g)>=0?y:Mo(y,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(h.$name=s),h}function zo(n){if(qh(n))return n;if(Array.isArray(n))return n.map(zo);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=ec(n)||"Object";if(!pi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=pi[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(n);const a=Object.create(s.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const g=n[h];a[h]=pi[t].shallow.indexOf(h)>=0?g:zo(g)}return a}class tc{constructor(){this.first=!0}update(t,s){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const Rt={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function rc(n){for(const t of n)if(ic(t.charCodeAt(0)))return!0;return!1}function of(n){for(const t of n)if(!Do(t.charCodeAt(0)))return!1;return!0}function nc(n){const t=n.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(t.join("|"),"u")}const af=nc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Do(n){return!af.test(String.fromCodePoint(n))}const Zh=nc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ic(n){return!(n!==746&&n!==747&&(n<4352||!(Rt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Rt["CJK Compatibility"](n)||Rt["CJK Strokes"](n)||!(!Rt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Rt["Enclosed CJK Letters and Months"](n)||Rt["Ideographic Description Characters"](n)||Rt.Kanbun(n)||Rt.Katakana(n)&&n!==12540||!(!Rt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Rt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Rt["Vertical Forms"](n)||Rt["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Zh.test(String.fromCodePoint(n)))))}function Gh(n){return!(ic(n)||function(t){return!!(Rt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Rt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Rt["Letterlike Symbols"](t)||Rt["Number Forms"](t)||Rt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Rt["Control Pictures"](t)&&t!==9251||Rt["Optical Character Recognition"](t)||Rt["Enclosed Alphanumerics"](t)||Rt["Geometric Shapes"](t)||Rt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Rt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Rt["CJK Symbols and Punctuation"](t)||Rt.Katakana(t)||Rt["Private Use Area"](t)||Rt["CJK Compatibility Forms"](t)||Rt["Small Form Variants"](t)||Rt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const lf=nc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function sc(n){return lf.test(String.fromCodePoint(n))}function uf(n,t){return!(!t&&sc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Rt.Khmer(n))}function cf(n){for(const t of n)if(sc(t.charCodeAt(0)))return!0;return!1}const Qn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ur{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new tc,this.transition={})}isSupportedScript(t){return function(s,a){for(const h of s)if(!uf(h.charCodeAt(0),a))return!1;return!0}(t,Qn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*s}}}class Lo{constructor(t,s){this.property=t,this.value=s,this.expression=function(a,h){if(cl(a))return new Io(a,h);if(pl(a)){const g=ju(a,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=Gt.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=Fn.parse(a)):g=dn.parse(a),{kind:"constant",evaluate:()=>g}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,a){return this.property.possiblyEvaluate(this,t,s,a)}}class Sl{constructor(t){this.property=t,this.value=new Lo(t,void 0)}transitioned(t,s){return new Hh(this.property,this.value,s,Xe({},t.transition,this.transition),t.now)}untransitioned(){return new Hh(this.property,this.value,null,{},0)}}class Tl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ye(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Sl(this._values[t].property)),this._values[t].value=new Lo(this._values[t].property,s===null?void 0:Ye(s))}getTransition(t){return Ye(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Sl(this._values[t].property)),this._values[t].transition=Ye(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const a=this.getValue(s);a!==void 0&&(t[s]=a);const h=this.getTransition(s);h!==void 0&&(t[`${s}-transition`]=h)}return t}transitioned(t,s){const a=new Aa(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,s._values[h]);return a}untransitioned(){const t=new Aa(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Hh{constructor(t,s,a,h,g){this.property=t,this.value=s,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,s,a){const h=t.now||0,g=this.value.possiblyEvaluate(t,s,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(t,s,a);{const _=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,s,a),g,function(w){if(w<=0)return 0;if(w>=1)return 1;const C=w*w,E=C*w;return 4*(w<.5?E:3*(w-C)+E-.75)}(_))}}return g}}class Aa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,a){const h=new za(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,s,a);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ma{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Ye(this._values[t].value)}setValue(t,s){this._values[t]=new Lo(this._values[t].property,s===null?void 0:Ye(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const a=this.getValue(s);a!==void 0&&(t[s]=a)}return t}possiblyEvaluate(t,s,a){const h=new za(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,s,a);return h}}class Hi{constructor(t,s,a){this.property=t,this.value=s,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,a,h){return this.property.evaluate(this.value,this.parameters,t,s,a,h)}}class za{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class st{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,a){const h=Gr[this.specification.type];return h?h(t,s,a):t}}class gt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,a,h){return new Hi(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},a,h)}:t.expression,s)}interpolate(t,s,a){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Hi(this,{kind:"constant",value:void 0},t.parameters);const h=Gr[this.specification.type];if(h){const g=h(t.value.value,s.value.value,a);return new Hi(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,s,a,h,g,y){return t.kind==="constant"?t.value:t.evaluate(s,a,h,g,y)}}class kl extends gt{possiblyEvaluate(t,s,a,h){if(t.value===void 0)return new Hi(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const g=t.expression.evaluate(s,null,{},a,h),y=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,_=this._calculate(y,y,y,s);return new Hi(this,{kind:"constant",value:_},s)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Hi(this,{kind:"constant",value:g},s)}return new Hi(this,t.expression,s)}evaluate(t,s,a,h,g,y){if(t.kind==="source"){const _=t.evaluate(s,a,h,g,y);return this._calculate(_,_,_,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},a,h),t.evaluate({zoom:Math.floor(s.zoom)},a,h),t.evaluate({zoom:Math.floor(s.zoom)+1},a,h),s):t.value}_calculate(t,s,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:a,to:s}}interpolate(t){return t}}class Cl{constructor(t){this.specification=t}possiblyEvaluate(t,s,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(s,null,{},a,h);return this._calculate(g,g,g,s)}return this._calculate(t.expression.evaluate(new ur(Math.floor(s.zoom-1),s)),t.expression.evaluate(new ur(Math.floor(s.zoom),s)),t.expression.evaluate(new ur(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:a,to:s}}interpolate(t){return t}}class oc{constructor(t){this.specification=t}possiblyEvaluate(t,s,a,h){return!!t.expression.evaluate(s,null,{},a,h)}interpolate(){return!1}}class m{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const a=t[s];a.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new Lo(a,void 0),g=this.defaultTransitionablePropertyValues[s]=new Sl(a);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate({})}}}tt("DataDrivenProperty",gt),tt("DataConstantProperty",st),tt("CrossFadedDataDrivenProperty",kl),tt("CrossFadedProperty",Cl),tt("ColorRampProperty",oc);const e="-transition";class o extends ss{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new Ma(s.layout)),s.paint)){this._transitionablePaint=new Tl(s.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new za(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,a={}){s!=null&&this._validate($h,`layers.${this.id}.layout.${t}`,t,s,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,a={}){if(s!=null&&this._validate(Uh,`layers.${this.id}.paint.${t}`,t,s,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),_=h.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(t,_,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ge(t,(s,a)=>!(s===void 0||a==="layout"&&!Object.keys(s).length||a==="paint"&&!Object.keys(s).length))}_validate(t,s,a,h,g={}){return(!g||g.validate!==!1)&&Qu(this,t.call(Qs,{key:s,layerType:this.type,objectKey:a,value:h,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Hi&&So(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class c{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class f{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function v(n,t=1){let s=0,a=0;return{members:n.map(h=>{const g=u[h.type].BYTES_PER_ELEMENT,y=s=b(s,Math.max(t,g)),_=h.components||1;return a=Math.max(a,g),s+=g*_,{name:h.name,type:h.type,components:_,offset:y}}),size:b(s,Math.max(a,t)),alignment:t}}function b(n,t){return Math.ceil(n/t)*t}class k extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.int16[h+0]=s,this.int16[h+1]=a,t}}k.prototype.bytesPerElement=4,tt("StructArrayLayout2i4",k);class I extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.int16[g+0]=s,this.int16[g+1]=a,this.int16[g+2]=h,t}}I.prototype.bytesPerElement=6,tt("StructArrayLayout3i6",I);class A extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,a,h)}emplace(t,s,a,h,g){const y=4*t;return this.int16[y+0]=s,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=g,t}}A.prototype.bytesPerElement=8,tt("StructArrayLayout4i8",A);class M extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,_){const w=6*t;return this.int16[w+0]=s,this.int16[w+1]=a,this.int16[w+2]=h,this.int16[w+3]=g,this.int16[w+4]=y,this.int16[w+5]=_,t}}M.prototype.bytesPerElement=12,tt("StructArrayLayout2i4i12",M);class F extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,_){const w=4*t,C=8*t;return this.int16[w+0]=s,this.int16[w+1]=a,this.uint8[C+4]=h,this.uint8[C+5]=g,this.uint8[C+6]=y,this.uint8[C+7]=_,t}}F.prototype.bytesPerElement=8,tt("StructArrayLayout2i4ub8",F);class j extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.float32[h+0]=s,this.float32[h+1]=a,t}}j.prototype.bytesPerElement=8,tt("StructArrayLayout2f8",j);class U extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C,E){const P=this.length;return this.resize(P+1),this.emplace(P,t,s,a,h,g,y,_,w,C,E)}emplace(t,s,a,h,g,y,_,w,C,E,P){const z=10*t;return this.uint16[z+0]=s,this.uint16[z+1]=a,this.uint16[z+2]=h,this.uint16[z+3]=g,this.uint16[z+4]=y,this.uint16[z+5]=_,this.uint16[z+6]=w,this.uint16[z+7]=C,this.uint16[z+8]=E,this.uint16[z+9]=P,t}}U.prototype.bytesPerElement=20,tt("StructArrayLayout10ui20",U);class H extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C,E,P,z){const R=this.length;return this.resize(R+1),this.emplace(R,t,s,a,h,g,y,_,w,C,E,P,z)}emplace(t,s,a,h,g,y,_,w,C,E,P,z,R){const B=12*t;return this.int16[B+0]=s,this.int16[B+1]=a,this.int16[B+2]=h,this.int16[B+3]=g,this.uint16[B+4]=y,this.uint16[B+5]=_,this.uint16[B+6]=w,this.uint16[B+7]=C,this.int16[B+8]=E,this.int16[B+9]=P,this.int16[B+10]=z,this.int16[B+11]=R,t}}H.prototype.bytesPerElement=24,tt("StructArrayLayout4i4ui4i24",H);class K extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.float32[g+0]=s,this.float32[g+1]=a,this.float32[g+2]=h,t}}K.prototype.bytesPerElement=12,tt("StructArrayLayout3f12",K);class Y extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}Y.prototype.bytesPerElement=4,tt("StructArrayLayout1ul4",Y);class ee extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,a,h,g,y,_,w,C)}emplace(t,s,a,h,g,y,_,w,C,E){const P=10*t,z=5*t;return this.int16[P+0]=s,this.int16[P+1]=a,this.int16[P+2]=h,this.int16[P+3]=g,this.int16[P+4]=y,this.int16[P+5]=_,this.uint32[z+3]=w,this.uint16[P+8]=C,this.uint16[P+9]=E,t}}ee.prototype.bytesPerElement=20,tt("StructArrayLayout6i1ul2ui20",ee);class Z extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,_){const w=6*t;return this.int16[w+0]=s,this.int16[w+1]=a,this.int16[w+2]=h,this.int16[w+3]=g,this.int16[w+4]=y,this.int16[w+5]=_,t}}Z.prototype.bytesPerElement=12,tt("StructArrayLayout2i2i2i12",Z);class ae extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,a,h,g)}emplace(t,s,a,h,g,y){const _=4*t,w=8*t;return this.float32[_+0]=s,this.float32[_+1]=a,this.float32[_+2]=h,this.int16[w+6]=g,this.int16[w+7]=y,t}}ae.prototype.bytesPerElement=16,tt("StructArrayLayout2f1f2i16",ae);class ue extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,a,h,g,y)}emplace(t,s,a,h,g,y,_){const w=16*t,C=4*t,E=8*t;return this.uint8[w+0]=s,this.uint8[w+1]=a,this.float32[C+1]=h,this.float32[C+2]=g,this.int16[E+6]=y,this.int16[E+7]=_,t}}ue.prototype.bytesPerElement=16,tt("StructArrayLayout2ub2f2i16",ue);class fe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.uint16[g+0]=s,this.uint16[g+1]=a,this.uint16[g+2]=h,t}}fe.prototype.bytesPerElement=6,tt("StructArrayLayout3ui6",fe);class Te extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C,E,P,z,R,B,N,G,X){const pe=this.length;return this.resize(pe+1),this.emplace(pe,t,s,a,h,g,y,_,w,C,E,P,z,R,B,N,G,X)}emplace(t,s,a,h,g,y,_,w,C,E,P,z,R,B,N,G,X,pe){const re=24*t,ce=12*t,xe=48*t;return this.int16[re+0]=s,this.int16[re+1]=a,this.uint16[re+2]=h,this.uint16[re+3]=g,this.uint32[ce+2]=y,this.uint32[ce+3]=_,this.uint32[ce+4]=w,this.uint16[re+10]=C,this.uint16[re+11]=E,this.uint16[re+12]=P,this.float32[ce+7]=z,this.float32[ce+8]=R,this.uint8[xe+36]=B,this.uint8[xe+37]=N,this.uint8[xe+38]=G,this.uint32[ce+10]=X,this.int16[re+22]=pe,t}}Te.prototype.bytesPerElement=48,tt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Te);class ze extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h,g,y,_,w,C,E,P,z,R,B,N,G,X,pe,re,ce,xe,Ie,We,mt,Ze,Ue,ut,nt){const Je=this.length;return this.resize(Je+1),this.emplace(Je,t,s,a,h,g,y,_,w,C,E,P,z,R,B,N,G,X,pe,re,ce,xe,Ie,We,mt,Ze,Ue,ut,nt)}emplace(t,s,a,h,g,y,_,w,C,E,P,z,R,B,N,G,X,pe,re,ce,xe,Ie,We,mt,Ze,Ue,ut,nt,Je){const be=32*t,ct=16*t;return this.int16[be+0]=s,this.int16[be+1]=a,this.int16[be+2]=h,this.int16[be+3]=g,this.int16[be+4]=y,this.int16[be+5]=_,this.int16[be+6]=w,this.int16[be+7]=C,this.uint16[be+8]=E,this.uint16[be+9]=P,this.uint16[be+10]=z,this.uint16[be+11]=R,this.uint16[be+12]=B,this.uint16[be+13]=N,this.uint16[be+14]=G,this.uint16[be+15]=X,this.uint16[be+16]=pe,this.uint16[be+17]=re,this.uint16[be+18]=ce,this.uint16[be+19]=xe,this.uint16[be+20]=Ie,this.uint16[be+21]=We,this.uint16[be+22]=mt,this.uint32[ct+12]=Ze,this.float32[ct+13]=Ue,this.float32[ct+14]=ut,this.uint16[be+30]=nt,this.uint16[be+31]=Je,t}}ze.prototype.bytesPerElement=64,tt("StructArrayLayout8i15ui1ul2f2ui64",ze);class $e extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}$e.prototype.bytesPerElement=4,tt("StructArrayLayout1f4",$e);class Ke extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=3*t;return this.uint16[6*t+0]=s,this.float32[g+1]=a,this.float32[g+2]=h,t}}Ke.prototype.bytesPerElement=12,tt("StructArrayLayout1ui2f12",Ke);class Ne extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,a)}emplace(t,s,a,h){const g=4*t;return this.uint32[2*t+0]=s,this.uint16[g+2]=a,this.uint16[g+3]=h,t}}Ne.prototype.bytesPerElement=8,tt("StructArrayLayout1ul2ui8",Ne);class Oe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,s)}emplace(t,s,a){const h=2*t;return this.uint16[h+0]=s,this.uint16[h+1]=a,t}}Oe.prototype.bytesPerElement=4,tt("StructArrayLayout2ui4",Oe);class ot extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}ot.prototype.bytesPerElement=2,tt("StructArrayLayout1ui2",ot);class bt extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,a,h)}emplace(t,s,a,h,g){const y=4*t;return this.float32[y+0]=s,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=g,t}}bt.prototype.bytesPerElement=16,tt("StructArrayLayout4f16",bt);class Ve extends c{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Q(this.anchorPointX,this.anchorPointY)}}Ve.prototype.size=20;class He extends ee{get(t){return new Ve(this,t)}}tt("CollisionBoxArray",He);class xt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}xt.prototype.size=48;class cr extends Te{get(t){return new xt(this,t)}}tt("PlacedSymbolArray",cr);class It extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}It.prototype.size=64;class zt extends ze{get(t){return new It(this,t)}}tt("SymbolInstanceArray",zt);class hr extends $e{getoffsetX(t){return this.float32[1*t+0]}}tt("GlyphOffsetArray",hr);class fn extends I{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}tt("SymbolLineVertexArray",fn);class Ii extends c{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ii.prototype.size=12;class dr extends Ke{get(t){return new Ii(this,t)}}tt("TextAnchorOffsetArray",dr);class Nn extends c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Nn.prototype.size=8;class In extends Ne{get(t){return new Nn(this,t)}}tt("FeatureIndexArray",In);class mn extends k{}class Pn extends k{}class Wi extends k{}class Ro extends M{}class El extends F{}class Fo extends j{}class fi extends U{}class Il extends H{}class ac extends K{}class mi extends Y{}class gi extends Z{}class Ms extends ue{}class Pi extends fe{}class rn extends Oe{}const gn=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:ei}=gn;class Ft{constructor(t=[]){this.segments=t}prepareSegment(t,s,a,h){let g=this.segments[this.segments.length-1];return t>Ft.MAX_VERTEX_ARRAY_LENGTH&&Vt(`Max vertices per segment is ${Ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>Ft.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:s.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,a,h){return new Ft([{vertexOffset:t,primitiveOffset:s,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function eo(n,t){return 256*(n=qe(Math.floor(n),0,255))+qe(Math.floor(t),0,255)}Ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tt("SegmentVector",Ft);const Bo=v([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Oo={exports:{}},Wh={exports:{}};Wh.exports=function(n,t){var s,a,h,g,y,_,w,C;for(a=n.length-(s=3&n.length),h=t,y=3432918353,_=461845907,C=0;C<a;)w=255&n.charCodeAt(C)|(255&n.charCodeAt(++C))<<8|(255&n.charCodeAt(++C))<<16|(255&n.charCodeAt(++C))<<24,++C,h=27492+(65535&(g=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&n.charCodeAt(C+2))<<16;case 2:w^=(255&n.charCodeAt(C+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&n.charCodeAt(C)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var hf=Wh.exports,Xh={exports:{}};Xh.exports=function(n,t){for(var s,a=n.length,h=t^a,g=0;a>=4;)s=1540483477*(65535&(s=255&n.charCodeAt(g)|(255&n.charCodeAt(++g))<<8|(255&n.charCodeAt(++g))<<16|(255&n.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&n.charCodeAt(g+2))<<16;case 2:h^=(255&n.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var zs=hf,Kh=Xh.exports;Oo.exports=zs,Oo.exports.murmur3=zs,Oo.exports.murmur2=Kh;var Pl=$(Oo.exports);class Da{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,a,h){this.ids.push(Al(t)),this.positions.push(s,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Al(t);let a=0,h=this.ids.length-1;for(;a<h;){const y=a+h>>1;this.ids[y]>=s?h=y:a=y+1}const g=[];for(;this.ids[a]===s;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(t,s){const a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Ml(a,h,0,a.length-1),s&&s.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){const s=new Da;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function Al(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Pl(String(n))}function Ml(n,t,s,a){for(;s<a;){const h=n[s+a>>1];let g=s-1,y=a+1;for(;;){do g++;while(n[g]<h);do y--;while(n[y]>h);if(g>=y)break;No(n,g,y),No(t,3*g,3*y),No(t,3*g+1,3*y+1),No(t,3*g+2,3*y+2)}y-s<a-y?(Ml(n,t,s,y),s=y+1):(Ml(n,t,y+1,a),a=y)}}function No(n,t,s){const a=n[t];n[t]=n[s],n[s]=a}tt("FeaturePositionMap",Da);class La{constructor(t,s){this.gl=t.gl,this.location=s}}class Yh extends La{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ey extends La{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Iy extends La{constructor(t,s){super(t,s),this.current=Gt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const e1=new Float32Array(16);function df(n){return[eo(255*n.r,255*n.g),eo(255*n.b,255*n.a)]}class lc{constructor(t,s,a){this.value=t,this.uniformNames=s.map(h=>`u_${h}`),this.type=a}setUniform(t,s,a){t.set(a.constantOr(this.value))}getBinding(t,s,a){return this.type==="color"?new Iy(t,s):new Yh(t,s)}}class zl{constructor(t,s){this.uniformNames=s.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,a,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,s,a){return a.substr(0,9)==="u_pattern"?new Ey(t,s):new Yh(t,s)}}class to{constructor(t,s,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,s,a,h,g){const y=this.paintVertexArray.length,_=this.expression.evaluate(new ur(0),s,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,_)}updatePaintArray(t,s,a,h){const g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,s,g)}_setPaintValue(t,s,a){if(this.type==="color"){const h=df(a);for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<s;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fs{constructor(t,s,a,h,g,y){this.expression=t,this.uniformNames=s.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,s,a,h,g){const y=this.expression.evaluate(new ur(this.zoom),s,{},h,[],g),_=this.expression.evaluate(new ur(this.zoom+1),s,{},h,[],g),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,y,_)}updatePaintArray(t,s,a,h){const g=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,s,g,y)}_setPaintValue(t,s,a,h){if(this.type==="color"){const g=df(a),y=df(h);for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,g[0],g[1],y[0],y[1])}else{for(let g=t;g<s;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const a=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=qe(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,s,a){return new Yh(t,s)}}class jo{constructor(t,s,a,h,g,y){this.expression=t,this.type=s,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,s,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,s.patterns&&s.patterns[this.layerId],a)}updatePaintArray(t,s,a,h,g){this._setPaintValues(t,s,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,s,a,h){if(!h||!a)return;const{min:g,mid:y,max:_}=a,w=h[g],C=h[y],E=h[_];if(w&&C&&E)for(let P=t;P<s;P++)this.zoomInPaintVertexArray.emplace(P,C.tl[0],C.tl[1],C.br[0],C.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],C.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,C.tl[0],C.tl[1],C.br[0],C.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],C.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Bo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Bo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Py{constructor(t,s,a){this.binders={},this._buffers=[];const h=[];for(const g in t.paint._values){if(!a(g))continue;const y=t.paint.get(g);if(!(y instanceof Hi&&So(y.property.specification)))continue;const _=t1(g,t.type),w=y.value,C=y.property.specification.type,E=y.property.useIntegerZoom,P=y.property.specification["property-type"],z=P==="cross-faded"||P==="cross-faded-data-driven";if(w.kind==="constant")this.binders[g]=z?new zl(w.value,_):new lc(w.value,_,C),h.push(`/u_${g}`);else if(w.kind==="source"||z){const R=Ay(g,C,"source");this.binders[g]=z?new jo(w,C,E,s,R,t.id):new to(w,_,C,R),h.push(`/a_${g}`)}else{const R=Ay(g,C,"composite");this.binders[g]=new fs(w,_,C,E,s,R),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof to||s instanceof fs?s.maxValue:0}populatePaintArrays(t,s,a,h,g){for(const y in this.binders){const _=this.binders[y];(_ instanceof to||_ instanceof fs||_ instanceof jo)&&_.populatePaintArray(t,s,a,h,g)}}setConstantPatternPositions(t,s){for(const a in this.binders){const h=this.binders[a];h instanceof zl&&h.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,a,h,g){let y=!1;for(const _ in t){const w=s.getPositions(_);for(const C of w){const E=a.feature(C.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof to||z instanceof fs||z instanceof jo)&&z.expression.isStateDependent===!0){const R=h.paint.get(P);z.expression=R.value,z.updatePaintArray(C.start,C.end,E,t[_],g),y=!0}}}}return y}defines(){const t=[];for(const s in this.binders){const a=this.binders[s];(a instanceof lc||a instanceof zl)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof to||a instanceof fs)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof jo)for(let h=0;h<Bo.members.length;h++)t.push(Bo.members[h].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof lc||a instanceof zl||a instanceof fs)for(const h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const a=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof lc||g instanceof zl||g instanceof fs){for(const y of g.uniformNames)if(s[y]){const _=g.getBinding(t,s[y],y);a.push({name:y,property:h,binding:_})}}}return a}setUniforms(t,s,a,h){for(const{name:g,property:y,binding:_}of s)this.binders[y].setUniform(_,h,a.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const a=this.binders[s];if(t&&a instanceof jo){const h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof to||a instanceof fs)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const s in this.binders){const a=this.binders[s];(a instanceof to||a instanceof fs||a instanceof jo)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof to||s instanceof fs||s instanceof jo)&&s.destroy()}}}class Ra{constructor(t,s,a=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Py(h,s,a);this.needsUpload=!1,this._featureMap=new Da,this._bufferOffset=0}populatePaintArrays(t,s,a,h,g,y){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,s,h,g,y);s.id!==void 0&&this._featureMap.add(s.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,a,h){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,s,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function t1(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Ay(n,t,s){const a={color:{source:j,composite:bt},number:{source:$e,composite:j}},h=function(g){return{"line-pattern":{source:fi,composite:fi},"fill-pattern":{source:fi,composite:fi},"fill-extrusion-pattern":{source:fi,composite:fi}}[g]}(n);return h&&h[s]||a[t][s]}tt("ConstantBinder",lc),tt("CrossFadedConstantBinder",zl),tt("SourceExpressionBinder",to),tt("CrossFadedCompositeBinder",jo),tt("CompositeExpressionBinder",fs),tt("ProgramConfiguration",Py,{omit:["_buffers"]}),tt("ProgramConfigurationSet",Ra);const Br=8192,pf=Math.pow(2,14)-1,My=-pf-1;function Fa(n){const t=Br/n.extent,s=n.loadGeometry();for(let a=0;a<s.length;a++){const h=s[a];for(let g=0;g<h.length;g++){const y=h[g],_=Math.round(y.x*t),w=Math.round(y.y*t);y.x=qe(_,My,pf),y.y=qe(w,My,pf),(_<y.x||_>y.x+1||w<y.y||w>y.y+1)&&Vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Ba(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Fa(n):[]}}function Jh(n,t,s,a,h){n.emplaceBack(2*t+(a+1)/2,2*s+(h+1)/2)}class ff{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Pn,this.indexArray=new Pi,this.segments=new Ft,this.programConfigurations=new Ra(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){const h=this.layers[0],g=[];let y=null,_=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),_=!y.isConstant());for(const{feature:w,id:C,index:E,sourceLayerIndex:P}of t){const z=this.layers[0]._featureFilter.needGeometry,R=Ba(w,z);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),R,a))continue;const B=_?y.evaluate(R,{},a):void 0,N={id:C,properties:w.properties,type:w.type,sourceLayerIndex:P,index:E,geometry:z?R.geometry:Fa(w),patterns:{},sortKey:B};g.push(N)}_&&g.sort((w,C)=>w.sortKey-C.sortKey);for(const w of g){const{geometry:C,index:E,sourceLayerIndex:P}=w,z=t[E].feature;this.addFeature(w,C,E,a),s.featureIndex.insert(z,C,E,P,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ei),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,a,h){for(const g of s)for(const y of g){const _=y.x,w=y.y;if(_<0||_>=Br||w<0||w>=Br)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=C.vertexLength;Jh(this.layoutVertexArray,_,w,-1,-1),Jh(this.layoutVertexArray,_,w,1,-1),Jh(this.layoutVertexArray,_,w,1,1),Jh(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function zy(n,t){for(let s=0;s<n.length;s++)if(Dl(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Dl(n,t[s]))return!0;return!!mf(n,t)}function r1(n,t,s){return!!Dl(n,t)||!!gf(t,n,s)}function Dy(n,t){if(n.length===1)return Ry(t,n[0]);for(let s=0;s<t.length;s++){const a=t[s];for(let h=0;h<a.length;h++)if(Dl(n,a[h]))return!0}for(let s=0;s<n.length;s++)if(Ry(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(mf(n,t[s]))return!0;return!1}function n1(n,t,s){if(n.length>1){if(mf(n,t))return!0;for(let a=0;a<t.length;a++)if(gf(t[a],n,s))return!0}for(let a=0;a<n.length;a++)if(gf(n[a],t,s))return!0;return!1}function mf(n,t){if(n.length===0||t.length===0)return!1;for(let s=0;s<n.length-1;s++){const a=n[s],h=n[s+1];for(let g=0;g<t.length-1;g++)if(i1(a,h,t[g],t[g+1]))return!0}return!1}function i1(n,t,s,a){return Yt(n,s,a)!==Yt(t,s,a)&&Yt(n,t,s)!==Yt(n,t,a)}function gf(n,t,s){const a=s*s;if(t.length===1)return n.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(Ly(n,t[h-1],t[h])<a)return!0;return!1}function Ly(n,t,s){const a=t.distSqr(s);if(a===0)return n.distSqr(t);const h=((n.x-t.x)*(s.x-t.x)+(n.y-t.y)*(s.y-t.y))/a;return n.distSqr(h<0?t:h>1?s:s.sub(t)._mult(h)._add(t))}function Ry(n,t){let s,a,h,g=!1;for(let y=0;y<n.length;y++){s=n[y];for(let _=0,w=s.length-1;_<s.length;w=_++)a=s[_],h=s[w],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function Dl(n,t){let s=!1;for(let a=0,h=n.length-1;a<n.length;h=a++){const g=n[a],y=n[h];g.y>t.y!=y.y>t.y&&t.x<(y.x-g.x)*(t.y-g.y)/(y.y-g.y)+g.x&&(s=!s)}return s}function s1(n,t,s){const a=s[0],h=s[2];if(n.x<a.x&&t.x<a.x||n.x>h.x&&t.x>h.x||n.y<a.y&&t.y<a.y||n.y>h.y&&t.y>h.y)return!1;const g=Yt(n,t,s[0]);return g!==Yt(n,t,s[1])||g!==Yt(n,t,s[2])||g!==Yt(n,t,s[3])}function uc(n,t,s){const a=t.paint.get(n).value;return a.kind==="constant"?a.value:s.programConfigurations.get(t.id).getMaxValue(n)}function Qh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function ed(n,t,s,a,h){if(!t[0]&&!t[1])return n;const g=Q.convert(t)._mult(h);s==="viewport"&&g._rotate(-a);const y=[];for(let _=0;_<n.length;_++)y.push(n[_].sub(g));return y}let Fy,By;tt("CircleBucket",ff,{omit:["layers"]});var o1={get paint(){return By=By||new m({"circle-radius":new gt(ye.paint_circle["circle-radius"]),"circle-color":new gt(ye.paint_circle["circle-color"]),"circle-blur":new gt(ye.paint_circle["circle-blur"]),"circle-opacity":new gt(ye.paint_circle["circle-opacity"]),"circle-translate":new st(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new st(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new st(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new st(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gt(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gt(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gt(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return Fy=Fy||new m({"circle-sort-key":new gt(ye.layout_circle["circle-sort-key"])})}},jn=1e-6,Ll=typeof Float32Array<"u"?Float32Array:Array;function yf(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Oy(n,t,s){var a=t[0],h=t[1],g=t[2],y=t[3],_=t[4],w=t[5],C=t[6],E=t[7],P=t[8],z=t[9],R=t[10],B=t[11],N=t[12],G=t[13],X=t[14],pe=t[15],re=s[0],ce=s[1],xe=s[2],Ie=s[3];return n[0]=re*a+ce*_+xe*P+Ie*N,n[1]=re*h+ce*w+xe*z+Ie*G,n[2]=re*g+ce*C+xe*R+Ie*X,n[3]=re*y+ce*E+xe*B+Ie*pe,n[4]=(re=s[4])*a+(ce=s[5])*_+(xe=s[6])*P+(Ie=s[7])*N,n[5]=re*h+ce*w+xe*z+Ie*G,n[6]=re*g+ce*C+xe*R+Ie*X,n[7]=re*y+ce*E+xe*B+Ie*pe,n[8]=(re=s[8])*a+(ce=s[9])*_+(xe=s[10])*P+(Ie=s[11])*N,n[9]=re*h+ce*w+xe*z+Ie*G,n[10]=re*g+ce*C+xe*R+Ie*X,n[11]=re*y+ce*E+xe*B+Ie*pe,n[12]=(re=s[12])*a+(ce=s[13])*_+(xe=s[14])*P+(Ie=s[15])*N,n[13]=re*h+ce*w+xe*z+Ie*G,n[14]=re*g+ce*C+xe*R+Ie*X,n[15]=re*y+ce*E+xe*B+Ie*pe,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var cc,a1=Oy;function td(n,t,s){var a=t[0],h=t[1],g=t[2],y=t[3];return n[0]=s[0]*a+s[4]*h+s[8]*g+s[12]*y,n[1]=s[1]*a+s[5]*h+s[9]*g+s[13]*y,n[2]=s[2]*a+s[6]*h+s[10]*g+s[14]*y,n[3]=s[3]*a+s[7]*h+s[11]*g+s[15]*y,n}cc=new Ll(4),Ll!=Float32Array&&(cc[0]=0,cc[1]=0,cc[2]=0,cc[3]=0);class l1 extends o{constructor(t){super(t,o1)}createBucket(t){return new ff(t)}queryRadius(t){const s=t;return uc("circle-radius",this,s)+uc("circle-stroke-width",this,s)+Qh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,a,h,g,y,_,w){const C=ed(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,_),E=this.paint.get("circle-radius").evaluate(s,a)+this.paint.get("circle-stroke-width").evaluate(s,a),P=this.paint.get("circle-pitch-alignment")==="map",z=P?C:function(B,N){return B.map(G=>Ny(G,N))}(C,w),R=P?E*_:E;for(const B of h)for(const N of B){const G=P?N:Ny(N,w);let X=R;const pe=td([],[N.x,N.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=pe[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=y.cameraToCenterDistance/pe[3]),r1(z,G,X))return!0}return!1}}function Ny(n,t){const s=td([],[n.x,n.y,0,1],t);return new Q(s[0]/s[3],s[1]/s[3])}class jy extends ff{}let Vy;tt("HeatmapBucket",jy,{omit:["layers"]});var u1={get paint(){return Vy=Vy||new m({"heatmap-radius":new gt(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gt(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new st(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oc(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new st(ye.paint_heatmap["heatmap-opacity"])})}};function _f(n,{width:t,height:s},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*s*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*s*a}`)}else h=new Uint8Array(t*s*a);return n.width=t,n.height=s,n.data=h,n}function Uy(n,{width:t,height:s},a){if(t===n.width&&s===n.height)return;const h=_f({},{width:t,height:s},a);vf(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,s)},a),n.width=t,n.height=s,n.data=h.data}function vf(n,t,s,a,h,g){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||s.x>n.width-h.width||s.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=n.data,_=t.data;if(y===_)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<h.height;w++){const C=((s.y+w)*n.width+s.x)*g,E=((a.y+w)*t.width+a.x)*g;for(let P=0;P<h.width*g;P++)_[E+P]=y[C+P]}return t}class hc{constructor(t,s){_f(this,t,1,s)}resize(t){Uy(this,t,1)}clone(){return new hc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,a,h,g){vf(t,s,a,h,g,1)}}class Ai{constructor(t,s){_f(this,t,4,s)}resize(t){Uy(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ai({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,a,h,g){vf(t,s,a,h,g,4)}}function $y(n){const t={},s=n.resolution||256,a=n.clips?n.clips.length:1,h=n.image||new Ai({width:s,height:a});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const g=(y,_,w)=>{t[n.evaluationKey]=w;const C=n.expression.evaluate(t);h.data[y+_+0]=Math.floor(255*C.r/C.a),h.data[y+_+1]=Math.floor(255*C.g/C.a),h.data[y+_+2]=Math.floor(255*C.b/C.a),h.data[y+_+3]=Math.floor(255*C.a)};if(n.clips)for(let y=0,_=0;y<a;++y,_+=4*s)for(let w=0,C=0;w<s;w++,C+=4){const E=w/(s-1),{start:P,end:z}=n.clips[y];g(_,C,P*(1-E)+z*E)}else for(let y=0,_=0;y<s;y++,_+=4)g(0,_,y/(s-1));return h}tt("AlphaImage",hc),tt("RGBAImage",Ai);const xf="big-fb";class c1 extends o{createBucket(t){return new jy(t)}constructor(t){super(t,u1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$y({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(xf)&&this.heatmapFbos.delete(xf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let qy;var h1={get paint(){return qy=qy||new m({"hillshade-illumination-direction":new st(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new st(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new st(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new st(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new st(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new st(ye.paint_hillshade["hillshade-accent-color"])})}};class d1 extends o{constructor(t){super(t,h1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const p1=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:f1}=p1;function Zy(n,t,s=2){const a=t&&t.length,h=a?t[0]*s:n.length;let g=Gy(n,0,h,s,!0);const y=[];if(!g||g.next===g.prev)return y;let _,w,C;if(a&&(g=function(E,P,z,R){const B=[];for(let N=0,G=P.length;N<G;N++){const X=Gy(E,P[N]*R,N<G-1?P[N+1]*R:E.length,R,!1);X===X.next&&(X.steiner=!0),B.push(b1(X))}B.sort(v1);for(let N=0;N<B.length;N++)z=x1(B[N],z);return z}(n,t,g,s)),n.length>80*s){_=1/0,w=1/0;let E=-1/0,P=-1/0;for(let z=s;z<h;z+=s){const R=n[z],B=n[z+1];R<_&&(_=R),B<w&&(w=B),R>E&&(E=R),B>P&&(P=B)}C=Math.max(E-_,P-w),C=C!==0?32767/C:0}return dc(g,y,s,_,w,C,0),y}function Gy(n,t,s,a,h){let g;if(h===function(y,_,w,C){let E=0;for(let P=_,z=w-C;P<w;P+=C)E+=(y[z]-y[P])*(y[P+1]+y[z+1]),z=P;return E}(n,t,s,a)>0)for(let y=t;y<s;y+=a)g=Xy(y/a|0,n[y],n[y+1],g);else for(let y=s-a;y>=t;y-=a)g=Xy(y/a|0,n[y],n[y+1],g);return g&&rd(g,g.next)&&(fc(g),g=g.next),g}function Oa(n,t){if(!n)return n;t||(t=n);let s,a=n;do if(s=!1,a.steiner||!rd(a,a.next)&&zr(a.prev,a,a.next)!==0)a=a.next;else{if(fc(a),a=t=a.prev,a===a.next)break;s=!0}while(s||a!==t);return t}function dc(n,t,s,a,h,g,y){if(!n)return;!y&&g&&function(w,C,E,P){let z=w;do z.z===0&&(z.z=wf(z.x,z.y,C,E,P)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==w);z.prevZ.nextZ=null,z.prevZ=null,function(R){let B,N=1;do{let G,X=R;R=null;let pe=null;for(B=0;X;){B++;let re=X,ce=0;for(let Ie=0;Ie<N&&(ce++,re=re.nextZ,re);Ie++);let xe=N;for(;ce>0||xe>0&&re;)ce!==0&&(xe===0||!re||X.z<=re.z)?(G=X,X=X.nextZ,ce--):(G=re,re=re.nextZ,xe--),pe?pe.nextZ=G:R=G,G.prevZ=pe,pe=G;X=re}pe.nextZ=null,N*=2}while(B>1)}(z)}(n,a,h,g);let _=n;for(;n.prev!==n.next;){const w=n.prev,C=n.next;if(g?g1(n,a,h,g):m1(n))t.push(w.i,n.i,C.i),fc(n),n=C.next,_=C.next;else if((n=C)===_){y?y===1?dc(n=y1(Oa(n),t),t,s,a,h,g,2):y===2&&_1(n,t,s,a,h,g):dc(Oa(n),t,s,a,h,g,1);break}}}function m1(n){const t=n.prev,s=n,a=n.next;if(zr(t,s,a)>=0)return!1;const h=t.x,g=s.x,y=a.x,_=t.y,w=s.y,C=a.y,E=h<g?h<y?h:y:g<y?g:y,P=_<w?_<C?_:C:w<C?w:C,z=h>g?h>y?h:y:g>y?g:y,R=_>w?_>C?_:C:w>C?w:C;let B=a.next;for(;B!==t;){if(B.x>=E&&B.x<=z&&B.y>=P&&B.y<=R&&Rl(h,_,g,w,y,C,B.x,B.y)&&zr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function g1(n,t,s,a){const h=n.prev,g=n,y=n.next;if(zr(h,g,y)>=0)return!1;const _=h.x,w=g.x,C=y.x,E=h.y,P=g.y,z=y.y,R=_<w?_<C?_:C:w<C?w:C,B=E<P?E<z?E:z:P<z?P:z,N=_>w?_>C?_:C:w>C?w:C,G=E>P?E>z?E:z:P>z?P:z,X=wf(R,B,t,s,a),pe=wf(N,G,t,s,a);let re=n.prevZ,ce=n.nextZ;for(;re&&re.z>=X&&ce&&ce.z<=pe;){if(re.x>=R&&re.x<=N&&re.y>=B&&re.y<=G&&re!==h&&re!==y&&Rl(_,E,w,P,C,z,re.x,re.y)&&zr(re.prev,re,re.next)>=0||(re=re.prevZ,ce.x>=R&&ce.x<=N&&ce.y>=B&&ce.y<=G&&ce!==h&&ce!==y&&Rl(_,E,w,P,C,z,ce.x,ce.y)&&zr(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;re&&re.z>=X;){if(re.x>=R&&re.x<=N&&re.y>=B&&re.y<=G&&re!==h&&re!==y&&Rl(_,E,w,P,C,z,re.x,re.y)&&zr(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ce&&ce.z<=pe;){if(ce.x>=R&&ce.x<=N&&ce.y>=B&&ce.y<=G&&ce!==h&&ce!==y&&Rl(_,E,w,P,C,z,ce.x,ce.y)&&zr(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function y1(n,t){let s=n;do{const a=s.prev,h=s.next.next;!rd(a,h)&&Hy(a,s,s.next,h)&&pc(a,h)&&pc(h,a)&&(t.push(a.i,s.i,h.i),fc(s),fc(s.next),s=n=h),s=s.next}while(s!==n);return Oa(s)}function _1(n,t,s,a,h,g){let y=n;do{let _=y.next.next;for(;_!==y.prev;){if(y.i!==_.i&&S1(y,_)){let w=Wy(y,_);return y=Oa(y,y.next),w=Oa(w,w.next),dc(y,t,s,a,h,g,0),void dc(w,t,s,a,h,g,0)}_=_.next}y=y.next}while(y!==n)}function v1(n,t){return n.x-t.x}function x1(n,t){const s=function(h,g){let y=g;const _=h.x,w=h.y;let C,E=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){const N=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(N<=_&&N>E&&(E=N,C=y.x<y.next.x?y:y.next,N===_))return C}y=y.next}while(y!==g);if(!C)return null;const P=C,z=C.x,R=C.y;let B=1/0;y=C;do{if(_>=y.x&&y.x>=z&&_!==y.x&&Rl(w<R?_:E,w,z,R,w<R?E:_,w,y.x,y.y)){const N=Math.abs(w-y.y)/(_-y.x);pc(y,h)&&(N<B||N===B&&(y.x>C.x||y.x===C.x&&w1(C,y)))&&(C=y,B=N)}y=y.next}while(y!==P);return C}(n,t);if(!s)return t;const a=Wy(s,n);return Oa(a,a.next),Oa(s,s.next)}function w1(n,t){return zr(n.prev,n,t.prev)<0&&zr(t.next,n,n.next)<0}function wf(n,t,s,a,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function b1(n){let t=n,s=n;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==n);return s}function Rl(n,t,s,a,h,g,y,_){return(h-y)*(t-_)>=(n-y)*(g-_)&&(n-y)*(a-_)>=(s-y)*(t-_)&&(s-y)*(g-_)>=(h-y)*(a-_)}function S1(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(s,a){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==a.i&&h.next.i!==a.i&&Hy(h,h.next,s,a))return!0;h=h.next}while(h!==s);return!1}(n,t)&&(pc(n,t)&&pc(t,n)&&function(s,a){let h=s,g=!1;const y=(s.x+a.x)/2,_=(s.y+a.y)/2;do h.y>_!=h.next.y>_&&h.next.y!==h.y&&y<(h.next.x-h.x)*(_-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==s);return g}(n,t)&&(zr(n.prev,n,t.prev)||zr(n,t.prev,t))||rd(n,t)&&zr(n.prev,n,n.next)>0&&zr(t.prev,t,t.next)>0)}function zr(n,t,s){return(t.y-n.y)*(s.x-t.x)-(t.x-n.x)*(s.y-t.y)}function rd(n,t){return n.x===t.x&&n.y===t.y}function Hy(n,t,s,a){const h=id(zr(n,t,s)),g=id(zr(n,t,a)),y=id(zr(s,a,n)),_=id(zr(s,a,t));return h!==g&&y!==_||!(h!==0||!nd(n,s,t))||!(g!==0||!nd(n,a,t))||!(y!==0||!nd(s,n,a))||!(_!==0||!nd(s,t,a))}function nd(n,t,s){return t.x<=Math.max(n.x,s.x)&&t.x>=Math.min(n.x,s.x)&&t.y<=Math.max(n.y,s.y)&&t.y>=Math.min(n.y,s.y)}function id(n){return n>0?1:n<0?-1:0}function pc(n,t){return zr(n.prev,n,n.next)<0?zr(n,t,n.next)>=0&&zr(n,n.prev,t)>=0:zr(n,t,n.prev)<0||zr(n,n.next,t)<0}function Wy(n,t){const s=bf(n.i,n.x,n.y),a=bf(t.i,t.x,t.y),h=n.next,g=t.prev;return n.next=t,t.prev=n,s.next=h,h.prev=s,a.next=s,s.prev=a,g.next=a,a.prev=g,a}function Xy(n,t,s,a){const h=bf(n,t,s);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function fc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function bf(n,t,s){return{i:n,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Sf(n,t,s){const a=s.patternDependencies;let h=!1;for(const g of t){const y=g.paint.get(`${n}-pattern`);y.isConstant()||(h=!0);const _=y.constantOr(null);_&&(h=!0,a[_.to]=!0,a[_.from]=!0)}return h}function Tf(n,t,s,a,h){const g=h.patternDependencies;for(const y of t){const _=y.paint.get(`${n}-pattern`).value;if(_.kind!=="constant"){let w=_.evaluate({zoom:a-1},s,{},h.availableImages),C=_.evaluate({zoom:a},s,{},h.availableImages),E=_.evaluate({zoom:a+1},s,{},h.availableImages);w=w&&w.name?w.name:w,C=C&&C.name?C.name:C,E=E&&E.name?E.name:E,g[w]=!0,g[C]=!0,g[E]=!0,s.patterns[y.id]={min:w,mid:C,max:E}}}return s}class kf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wi,this.indexArray=new Pi,this.indexArray2=new rn,this.programConfigurations=new Ra(t.layers,t.zoom),this.segments=new Ft,this.segments2=new Ft,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.hasPattern=Sf("fill",this.layers,s);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(const{feature:_,id:w,index:C,sourceLayerIndex:E}of t){const P=this.layers[0]._featureFilter.needGeometry,z=Ba(_,P);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),z,a))continue;const R=g?h.evaluate(z,{},a,s.availableImages):void 0,B={id:w,properties:_.properties,type:_.type,sourceLayerIndex:E,index:C,geometry:P?z.geometry:Fa(_),patterns:{},sortKey:R};y.push(B)}g&&y.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of y){const{geometry:w,index:C,sourceLayerIndex:E}=_;if(this.hasPattern){const P=Tf("fill",this.layers,_,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(_,w,C,a,{});s.featureIndex.insert(t[C].feature,w,C,E,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}addFeatures(t,s,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,f1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,a,h,g){for(const y of sl(s,500)){let _=0;for(const R of y)_+=R.length;const w=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),C=w.vertexLength,E=[],P=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&P.push(E.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),N=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(N+R.length-1,N),E.push(R[0].x),E.push(R[0].y);for(let G=1;G<R.length;G++)this.layoutVertexArray.emplaceBack(R[G].x,R[G].y),this.indexArray2.emplaceBack(N+G-1,N+G),E.push(R[G].x),E.push(R[G].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const z=Zy(E,P);for(let R=0;R<z.length;R+=3)this.indexArray.emplaceBack(C+z[R],C+z[R+1],C+z[R+2]);w.vertexLength+=_,w.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}let Ky,Yy;tt("FillBucket",kf,{omit:["layers","patternFeatures"]});var T1={get paint(){return Yy=Yy||new m({"fill-antialias":new st(ye.paint_fill["fill-antialias"]),"fill-opacity":new gt(ye.paint_fill["fill-opacity"]),"fill-color":new gt(ye.paint_fill["fill-color"]),"fill-outline-color":new gt(ye.paint_fill["fill-outline-color"]),"fill-translate":new st(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new st(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new kl(ye.paint_fill["fill-pattern"])})},get layout(){return Ky=Ky||new m({"fill-sort-key":new gt(ye.layout_fill["fill-sort-key"])})}};class k1 extends o{constructor(t){super(t,T1)}recalculate(t,s){super.recalculate(t,s);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new kf(t)}queryRadius(){return Qh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,a,h,g,y,_){return Dy(ed(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,_),h)}isTileClipped(){return!0}}const C1=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),E1=v([{name:"a_centroid",components:2,type:"Int16"}],4),{members:I1}=C1;var Vo={},P1=ne,Jy=Fl;function Fl(n,t,s,a,h){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=h,n.readFields(A1,this,t)}function A1(n,t,s){n==1?t.id=s.readVarint():n==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var y=h._keys[a.readVarint()],_=h._values[a.readVarint()];h.properties[y]=_}}(s,t):n==3?t.type=s.readVarint():n==4&&(t._geometry=s.pos)}function M1(n){for(var t,s,a=0,h=0,g=n.length,y=g-1;h<g;y=h++)a+=((s=n[y]).x-(t=n[h]).x)*(t.y+s.y);return a}Fl.types=["Unknown","Point","LineString","Polygon"],Fl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,s=n.readVarint()+n.pos,a=1,h=0,g=0,y=0,_=[];n.pos<s;){if(h<=0){var w=n.readVarint();a=7&w,h=w>>3}if(h--,a===1||a===2)g+=n.readSVarint(),y+=n.readSVarint(),a===1&&(t&&_.push(t),t=[]),t.push(new P1(g,y));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&_.push(t),_},Fl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,s=1,a=0,h=0,g=0,y=1/0,_=-1/0,w=1/0,C=-1/0;n.pos<t;){if(a<=0){var E=n.readVarint();s=7&E,a=E>>3}if(a--,s===1||s===2)(h+=n.readSVarint())<y&&(y=h),h>_&&(_=h),(g+=n.readSVarint())<w&&(w=g),g>C&&(C=g);else if(s!==7)throw new Error("unknown command "+s)}return[y,w,_,C]},Fl.prototype.toGeoJSON=function(n,t,s){var a,h,g=this.extent*Math.pow(2,s),y=this.extent*n,_=this.extent*t,w=this.loadGeometry(),C=Fl.types[this.type];function E(R){for(var B=0;B<R.length;B++){var N=R[B];R[B]=[360*(N.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+_)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<w.length;a++)P[a]=w[a][0];E(w=P);break;case 2:for(a=0;a<w.length;a++)E(w[a]);break;case 3:for(w=function(R){var B=R.length;if(B<=1)return[R];for(var N,G,X=[],pe=0;pe<B;pe++){var re=M1(R[pe]);re!==0&&(G===void 0&&(G=re<0),G===re<0?(N&&X.push(N),N=[R[pe]]):N.push(R[pe]))}return N&&X.push(N),X}(w),a=0;a<w.length;a++)for(h=0;h<w[a].length;h++)E(w[a][h])}w.length===1?w=w[0]:C="Multi"+C;var z={type:"Feature",geometry:{type:C,coordinates:w},properties:this.properties};return"id"in this&&(z.id=this.id),z};var z1=Jy,Qy=e_;function e_(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(D1,this,t),this.length=this._features.length}function D1(n,t,s){n===15?t.version=s.readVarint():n===1?t.name=s.readString():n===5?t.extent=s.readVarint():n===2?t._features.push(s.pos):n===3?t._keys.push(s.readString()):n===4&&t._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(s))}e_.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new z1(this._pbf,t,this.extent,this._keys,this._values)};var L1=Qy;function R1(n,t,s){if(n===3){var a=new L1(s,s.readVarint()+s.pos);a.length&&(t[a.name]=a)}}Vo.VectorTile=function(n,t){this.layers=n.readFields(R1,{},t)},Vo.VectorTileFeature=Jy,Vo.VectorTileLayer=Qy;const F1=Vo.VectorTileFeature.types,Cf=Math.pow(2,13);function mc(n,t,s,a,h,g,y,_){n.emplaceBack(t,s,2*Math.floor(a*Cf)+y,h*Cf*2,g*Cf*2,Math.round(_))}class Ef{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ro,this.centroidVertexArray=new mn,this.indexArray=new Pi,this.programConfigurations=new Ra(t.layers,t.zoom),this.segments=new Ft,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.features=[],this.hasPattern=Sf("fill-extrusion",this.layers,s);for(const{feature:h,id:g,index:y,sourceLayerIndex:_}of t){const w=this.layers[0]._featureFilter.needGeometry,C=Ba(h,w);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),C,a))continue;const E={id:g,sourceLayerIndex:_,index:y,geometry:w?C.geometry:Fa(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Tf("fill-extrusion",this.layers,E,this.zoom,s)):this.addFeature(E,E.geometry,y,a,{}),s.featureIndex.insert(h,E.geometry,y,_,this.index,!0)}}addFeatures(t,s,a){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,s,a)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,I1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,E1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,a,h,g){for(const y of sl(s,500)){const _={x:0,y:0,vertexCount:0};let w=0;for(const B of y)w+=B.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of y){if(B.length===0||O1(B))continue;let N=0;for(let G=0;G<B.length;G++){const X=B[G];if(G>=1){const pe=B[G-1];if(!B1(X,pe)){C.vertexLength+4>Ft.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const re=X.sub(pe)._perp()._unit(),ce=pe.dist(X);N+ce>32768&&(N=0),mc(this.layoutVertexArray,X.x,X.y,re.x,re.y,0,0,N),mc(this.layoutVertexArray,X.x,X.y,re.x,re.y,0,1,N),_.x+=2*X.x,_.y+=2*X.y,_.vertexCount+=2,N+=ce,mc(this.layoutVertexArray,pe.x,pe.y,re.x,re.y,0,0,N),mc(this.layoutVertexArray,pe.x,pe.y,re.x,re.y,0,1,N),_.x+=2*pe.x,_.y+=2*pe.y,_.vertexCount+=2;const xe=C.vertexLength;this.indexArray.emplaceBack(xe,xe+2,xe+1),this.indexArray.emplaceBack(xe+1,xe+2,xe+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+w>Ft.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),F1[t.type]!=="Polygon")continue;const E=[],P=[],z=C.vertexLength;for(const B of y)if(B.length!==0){B!==y[0]&&P.push(E.length/2);for(let N=0;N<B.length;N++){const G=B[N];mc(this.layoutVertexArray,G.x,G.y,0,0,1,1,0),_.x+=G.x,_.y+=G.y,_.vertexCount+=1,E.push(G.x),E.push(G.y)}}const R=Zy(E,P);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(z+R[B],z+R[B+2],z+R[B+1]);C.primitiveLength+=R.length/3,C.vertexLength+=w;for(let B=0;B<_.vertexCount;B++){const N=Math.floor(_.x/_.vertexCount),G=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(N,G)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}function B1(n,t){return n.x===t.x&&(n.x<0||n.x>Br)||n.y===t.y&&(n.y<0||n.y>Br)}function O1(n){return n.every(t=>t.x<0)||n.every(t=>t.x>Br)||n.every(t=>t.y<0)||n.every(t=>t.y>Br)}let t_;tt("FillExtrusionBucket",Ef,{omit:["layers","features"]});var N1={get paint(){return t_=t_||new m({"fill-extrusion-opacity":new st(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gt(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new st(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new st(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kl(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gt(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gt(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new st(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class j1 extends o{constructor(t){super(t,N1)}createBucket(t){return new Ef(t)}queryRadius(){return Qh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,a,h,g,y,_,w){const C=ed(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,_),E=this.paint.get("fill-extrusion-height").evaluate(s,a),P=this.paint.get("fill-extrusion-base").evaluate(s,a),z=function(B,N,G,X){const pe=[];for(const re of B){const ce=[re.x,re.y,0,1];td(ce,ce,N),pe.push(new Q(ce[0]/ce[3],ce[1]/ce[3]))}return pe}(C,w),R=function(B,N,G,X){const pe=[],re=[],ce=X[8]*N,xe=X[9]*N,Ie=X[10]*N,We=X[11]*N,mt=X[8]*G,Ze=X[9]*G,Ue=X[10]*G,ut=X[11]*G;for(const nt of B){const Je=[],be=[];for(const ct of nt){const at=ct.x,wt=ct.y,tr=X[0]*at+X[4]*wt+X[12],er=X[1]*at+X[5]*wt+X[13],Wr=X[2]*at+X[6]*wt+X[14],Xi=X[3]*at+X[7]*wt+X[15],_n=Wr+Ie,Xr=Xi+We,Vn=tr+mt,Un=er+Ze,$n=Wr+Ue,Er=Xi+ut,Kr=new Q((tr+ce)/Xr,(er+xe)/Xr);Kr.z=_n/Xr,Je.push(Kr);const An=new Q(Vn/Er,Un/Er);An.z=$n/Er,be.push(An)}pe.push(Je),re.push(be)}return[pe,re]}(h,P,E,w);return function(B,N,G){let X=1/0;Dy(G,N)&&(X=r_(G,N[0]));for(let pe=0;pe<N.length;pe++){const re=N[pe],ce=B[pe];for(let xe=0;xe<re.length-1;xe++){const Ie=re[xe],We=[Ie,re[xe+1],ce[xe+1],ce[xe],Ie];zy(G,We)&&(X=Math.min(X,r_(G,We)))}}return X!==1/0&&X}(R[0],R[1],z)}}function gc(n,t){return n.x*t.x+n.y*t.y}function r_(n,t){if(n.length===1){let s=0;const a=t[s++];let h;for(;!h||a.equals(h);)if(h=t[s++],!h)return 1/0;for(;s<t.length;s++){const g=t[s],y=n[0],_=h.sub(a),w=g.sub(a),C=y.sub(a),E=gc(_,_),P=gc(_,w),z=gc(w,w),R=gc(C,_),B=gc(C,w),N=E*z-P*P,G=(z*R-P*B)/N,X=(E*B-P*R)/N,pe=a.z*(1-G-X)+h.z*G+g.z*X;if(isFinite(pe))return pe}return 1/0}{let s=1/0;for(const a of t)s=Math.min(s,a.z);return s}}const V1=v([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:U1}=V1,$1=v([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:q1}=$1,Z1=Vo.VectorTileFeature.types,G1=Math.cos(Math.PI/180*37.5),n_=Math.pow(2,14)/.5;class If{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new El,this.layoutVertexArray2=new Fo,this.indexArray=new Pi,this.programConfigurations=new Ra(t.layers,t.zoom),this.segments=new Ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,a){this.hasPattern=Sf("line",this.layers,s);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(const{feature:_,id:w,index:C,sourceLayerIndex:E}of t){const P=this.layers[0]._featureFilter.needGeometry,z=Ba(_,P);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),z,a))continue;const R=g?h.evaluate(z,{},a):void 0,B={id:w,properties:_.properties,type:_.type,sourceLayerIndex:E,index:C,geometry:P?z.geometry:Fa(_),patterns:{},sortKey:R};y.push(B)}g&&y.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of y){const{geometry:w,index:C,sourceLayerIndex:E}=_;if(this.hasPattern){const P=Tf("line",this.layers,_,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(_,w,C,a,{});s.featureIndex.insert(t[C].feature,w,C,E,this.index)}}update(t,s,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,a)}addFeatures(t,s,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,s,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,q1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,U1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,a,h,g){const y=this.layers[0].layout,_=y.get("line-join").evaluate(t,{}),w=y.get("line-cap"),C=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of s)this.addLine(P,t,_,w,C,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}addLine(t,s,a,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=Z1[s.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let C=0;for(;C<w-1&&t[C].equals(t[C+1]);)C++;if(w<(_?3:2))return;a==="bevel"&&(g=1.05);const E=this.overscaling<=16?15*Br/(512*this.overscaling):0,P=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let z,R,B,N,G;this.e1=this.e2=-1,_&&(z=t[w-2],G=t[C].sub(z)._unit()._perp());for(let X=C;X<w;X++){if(B=X===w-1?_?t[C+1]:void 0:t[X+1],B&&t[X].equals(B))continue;G&&(N=G),z&&(R=z),z=t[X],G=B?B.sub(z)._unit()._perp():N,N=N||G;let pe=N.add(G);pe.x===0&&pe.y===0||pe._unit();const re=N.x*G.x+N.y*G.y,ce=pe.x*G.x+pe.y*G.y,xe=ce!==0?1/ce:1/0,Ie=2*Math.sqrt(2-2*ce),We=ce<G1&&R&&B,mt=N.x*G.y-N.y*G.x>0;if(We&&X>C){const ut=z.dist(R);if(ut>2*E){const nt=z.sub(z.sub(R)._mult(E/ut)._round());this.updateDistance(R,nt),this.addCurrentVertex(nt,N,0,0,P),R=nt}}const Ze=R&&B;let Ue=Ze?a:_?"butt":h;if(Ze&&Ue==="round"&&(xe<y?Ue="miter":xe<=2&&(Ue="fakeround")),Ue==="miter"&&xe>g&&(Ue="bevel"),Ue==="bevel"&&(xe>2&&(Ue="flipbevel"),xe<g&&(Ue="miter")),R&&this.updateDistance(R,z),Ue==="miter")pe._mult(xe),this.addCurrentVertex(z,pe,0,0,P);else if(Ue==="flipbevel"){if(xe>100)pe=G.mult(-1);else{const ut=xe*N.add(G).mag()/N.sub(G).mag();pe._perp()._mult(ut*(mt?-1:1))}this.addCurrentVertex(z,pe,0,0,P),this.addCurrentVertex(z,pe.mult(-1),0,0,P)}else if(Ue==="bevel"||Ue==="fakeround"){const ut=-Math.sqrt(xe*xe-1),nt=mt?ut:0,Je=mt?0:ut;if(R&&this.addCurrentVertex(z,N,nt,Je,P),Ue==="fakeround"){const be=Math.round(180*Ie/Math.PI/20);for(let ct=1;ct<be;ct++){let at=ct/be;if(at!==.5){const tr=at-.5;at+=at*tr*(at-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*tr*tr+(.848013+re*(.215638*re-1.06021)))}const wt=G.sub(N)._mult(at)._add(N)._unit()._mult(mt?-1:1);this.addHalfVertex(z,wt.x,wt.y,!1,mt,0,P)}}B&&this.addCurrentVertex(z,G,-nt,-Je,P)}else if(Ue==="butt")this.addCurrentVertex(z,pe,0,0,P);else if(Ue==="square"){const ut=R?1:-1;this.addCurrentVertex(z,pe,ut,ut,P)}else Ue==="round"&&(R&&(this.addCurrentVertex(z,N,0,0,P),this.addCurrentVertex(z,N,1,1,P,!0)),B&&(this.addCurrentVertex(z,G,-1,-1,P,!0),this.addCurrentVertex(z,G,0,0,P)));if(We&&X<w-1){const ut=z.dist(B);if(ut>2*E){const nt=z.add(B.sub(z)._mult(E/ut)._round());this.updateDistance(z,nt),this.addCurrentVertex(nt,G,0,0,P),z=nt}}}}addCurrentVertex(t,s,a,h,g,y=!1){const _=s.y*h-s.x,w=-s.y-s.x*h;this.addHalfVertex(t,s.x+s.y*a,s.y-s.x*a,y,!1,a,g),this.addHalfVertex(t,_,w,y,!0,-h,g),this.distance>n_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,a,h,g,y))}addHalfVertex({x:t,y:s},a,h,g,y,_,w){const C=.5*(this.lineClips?this.scaledDistance*(n_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(s<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(_===0?0:_<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let i_,s_;tt("LineBucket",If,{omit:["layers","patternFeatures"]});var o_={get paint(){return s_=s_||new m({"line-opacity":new gt(ye.paint_line["line-opacity"]),"line-color":new gt(ye.paint_line["line-color"]),"line-translate":new st(ye.paint_line["line-translate"]),"line-translate-anchor":new st(ye.paint_line["line-translate-anchor"]),"line-width":new gt(ye.paint_line["line-width"]),"line-gap-width":new gt(ye.paint_line["line-gap-width"]),"line-offset":new gt(ye.paint_line["line-offset"]),"line-blur":new gt(ye.paint_line["line-blur"]),"line-dasharray":new Cl(ye.paint_line["line-dasharray"]),"line-pattern":new kl(ye.paint_line["line-pattern"]),"line-gradient":new oc(ye.paint_line["line-gradient"])})},get layout(){return i_=i_||new m({"line-cap":new st(ye.layout_line["line-cap"]),"line-join":new gt(ye.layout_line["line-join"]),"line-miter-limit":new st(ye.layout_line["line-miter-limit"]),"line-round-limit":new st(ye.layout_line["line-round-limit"]),"line-sort-key":new gt(ye.layout_line["line-sort-key"])})}};class H1 extends gt{possiblyEvaluate(t,s){return s=new ur(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,a,h){return s=Xe({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,a,h)}}let sd;class W1 extends o{constructor(t){super(t,o_),this.gradientVersion=0,sd||(sd=new H1(o_.paint.properties["line-width"].specification),sd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof Wt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=sd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new If(t)}queryRadius(t){const s=t,a=a_(uc("line-width",this,s),uc("line-gap-width",this,s)),h=uc("line-offset",this,s);return a/2+Math.abs(h)+Qh(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,a,h,g,y,_){const w=ed(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,_),C=_/2*a_(this.paint.get("line-width").evaluate(s,a),this.paint.get("line-gap-width").evaluate(s,a)),E=this.paint.get("line-offset").evaluate(s,a);return E&&(h=function(P,z){const R=[];for(let B=0;B<P.length;B++){const N=P[B],G=[];for(let X=0;X<N.length;X++){const pe=N[X-1],re=N[X],ce=N[X+1],xe=X===0?new Q(0,0):re.sub(pe)._unit()._perp(),Ie=X===N.length-1?new Q(0,0):ce.sub(re)._unit()._perp(),We=xe._add(Ie)._unit(),mt=We.x*Ie.x+We.y*Ie.y;mt!==0&&We._mult(1/mt),G.push(We._mult(z)._add(re))}R.push(G)}return R}(h,E*_)),function(P,z,R){for(let B=0;B<z.length;B++){const N=z[B];if(P.length>=3){for(let G=0;G<N.length;G++)if(Dl(P,N[G]))return!0}if(n1(P,N,R))return!0}return!1}(w,h,C)}isTileClipped(){return!0}}function a_(n,t){return t>0?t+2*n:n}const X1=v([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),K1=v([{name:"a_projected_pos",components:3,type:"Float32"}],4);v([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Y1=v([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);v([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const l_=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),J1=v([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Q1(n,t,s){return n.sections.forEach(a=>{a.text=function(h,g,y){const _=g.layout.get("text-transform").evaluate(y,{});return _==="uppercase"?h=h.toLocaleUpperCase():_==="lowercase"&&(h=h.toLocaleLowerCase()),Qn.applyArabicShaping&&(h=Qn.applyArabicShaping(h)),h}(a.text,t,s)}),n}v([{name:"triangle",components:3,type:"Uint16"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),v([{type:"Float32",name:"offsetX"}]),v([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),v([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const yc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var $r=24,u_=Qt,c_=function(n,t,s,a,h){var g,y,_=8*h-a-1,w=(1<<_)-1,C=w>>1,E=-7,P=h-1,z=-1,R=n[t+P];for(P+=z,g=R&(1<<-E)-1,R>>=-E,E+=_;E>0;g=256*g+n[t+P],P+=z,E-=8);for(y=g&(1<<-E)-1,g>>=-E,E+=a;E>0;y=256*y+n[t+P],P+=z,E-=8);if(g===0)g=1-C;else{if(g===w)return y?NaN:1/0*(R?-1:1);y+=Math.pow(2,a),g-=C}return(R?-1:1)*y*Math.pow(2,g-a)},h_=function(n,t,s,a,h,g){var y,_,w,C=8*g-h-1,E=(1<<C)-1,P=E>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,B=1,N=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,y=E):(y=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-y))<1&&(y--,w*=2),(t+=y+P>=1?z/w:z*Math.pow(2,1-P))*w>=2&&(y++,w/=2),y+P>=E?(_=0,y=E):y+P>=1?(_=(t*w-1)*Math.pow(2,h),y+=P):(_=t*Math.pow(2,P-1)*Math.pow(2,h),y=0));h>=8;n[s+R]=255&_,R+=B,_/=256,h-=8);for(y=y<<h|_,C+=h;C>0;n[s+R]=255&y,R+=B,y/=256,C-=8);n[s+R-B]|=128*N};function Qt(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Qt.Varint=0,Qt.Fixed64=1,Qt.Bytes=2,Qt.Fixed32=5;var Pf=4294967296,d_=1/Pf,p_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ro(n){return n.type===Qt.Bytes?n.readVarint()+n.pos:n.pos+1}function Bl(n,t,s){return s?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function f_(n,t,s){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(a);for(var h=s.pos-1;h>=n;h--)s.buf[h+a]=s.buf[h]}function eb(n,t){for(var s=0;s<n.length;s++)t.writeVarint(n[s])}function tb(n,t){for(var s=0;s<n.length;s++)t.writeSVarint(n[s])}function rb(n,t){for(var s=0;s<n.length;s++)t.writeFloat(n[s])}function nb(n,t){for(var s=0;s<n.length;s++)t.writeDouble(n[s])}function ib(n,t){for(var s=0;s<n.length;s++)t.writeBoolean(n[s])}function sb(n,t){for(var s=0;s<n.length;s++)t.writeFixed32(n[s])}function ob(n,t){for(var s=0;s<n.length;s++)t.writeSFixed32(n[s])}function ab(n,t){for(var s=0;s<n.length;s++)t.writeFixed64(n[s])}function lb(n,t){for(var s=0;s<n.length;s++)t.writeSFixed64(n[s])}function od(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Ol(n,t,s){n[s]=t,n[s+1]=t>>>8,n[s+2]=t>>>16,n[s+3]=t>>>24}function m_(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}Qt.prototype={destroy:function(){this.buf=null},readFields:function(n,t,s){for(s=s||this.length;this.pos<s;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,n(h,t,this),this.pos===g&&this.skip(a)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=od(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=m_(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=od(this.buf,this.pos)+od(this.buf,this.pos+4)*Pf;return this.pos+=8,n},readSFixed64:function(){var n=od(this.buf,this.pos)+m_(this.buf,this.pos+4)*Pf;return this.pos+=8,n},readFloat:function(){var n=c_(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=c_(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,s,a=this.buf;return t=127&(s=a[this.pos++]),s<128?t:(t|=(127&(s=a[this.pos++]))<<7,s<128?t:(t|=(127&(s=a[this.pos++]))<<14,s<128?t:(t|=(127&(s=a[this.pos++]))<<21,s<128?t:function(h,g,y){var _,w,C=y.buf;if(_=(112&(w=C[y.pos++]))>>4,w<128||(_|=(127&(w=C[y.pos++]))<<3,w<128)||(_|=(127&(w=C[y.pos++]))<<10,w<128)||(_|=(127&(w=C[y.pos++]))<<17,w<128)||(_|=(127&(w=C[y.pos++]))<<24,w<128)||(_|=(1&(w=C[y.pos++]))<<31,w<128))return Bl(h,_,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&p_?function(s,a,h){return p_.decode(s.subarray(a,h))}(this.buf,t,n):function(s,a,h){for(var g="",y=a;y<h;){var _,w,C,E=s[y],P=null,z=E>239?4:E>223?3:E>191?2:1;if(y+z>h)break;z===1?E<128&&(P=E):z===2?(192&(_=s[y+1]))==128&&(P=(31&E)<<6|63&_)<=127&&(P=null):z===3?(w=s[y+2],(192&(_=s[y+1]))==128&&(192&w)==128&&((P=(15&E)<<12|(63&_)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):z===4&&(w=s[y+2],C=s[y+3],(192&(_=s[y+1]))==128&&(192&w)==128&&(192&C)==128&&((P=(15&E)<<18|(63&_)<<12|(63&w)<<6|63&C)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,z=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),y+=z}return g}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==Qt.Bytes)return n.push(this.readVarint(t));var s=ro(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==Qt.Bytes)return n.push(this.readSVarint());var t=ro(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Qt.Bytes)return n.push(this.readBoolean());var t=ro(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Qt.Bytes)return n.push(this.readFloat());var t=ro(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Qt.Bytes)return n.push(this.readDouble());var t=ro(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Qt.Bytes)return n.push(this.readFixed32());var t=ro(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Qt.Bytes)return n.push(this.readSFixed32());var t=ro(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Qt.Bytes)return n.push(this.readFixed64());var t=ro(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Qt.Bytes)return n.push(this.readSFixed64());var t=ro(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===Qt.Varint)for(;this.buf[this.pos++]>127;);else if(t===Qt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Qt.Fixed32)this.pos+=4;else{if(t!==Qt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Ol(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Ol(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Ol(this.buf,-1&n,this.pos),Ol(this.buf,Math.floor(n*d_),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Ol(this.buf,-1&n,this.pos),Ol(this.buf,Math.floor(n*d_),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,s){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,y,_){_.buf[_.pos++]=127&g|128,g>>>=7,_.buf[_.pos++]=127&g|128,g>>>=7,_.buf[_.pos++]=127&g|128,g>>>=7,_.buf[_.pos++]=127&g|128,_.buf[_.pos]=127&(g>>>=7)}(a,0,s),function(g,y){var _=(7&g)<<4;y.buf[y.pos++]|=_|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(a,h,g){for(var y,_,w=0;w<h.length;w++){if((y=h.charCodeAt(w))>55295&&y<57344){if(!_){y>56319||w+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):_=y;continue}if(y<56320){a[g++]=239,a[g++]=191,a[g++]=189,_=y;continue}y=_-55296<<10|y-56320|65536,_=null}else _&&(a[g++]=239,a[g++]=191,a[g++]=189,_=null);y<128?a[g++]=y:(y<2048?a[g++]=y>>6|192:(y<65536?a[g++]=y>>12|224:(a[g++]=y>>18|240,a[g++]=y>>12&63|128),a[g++]=y>>6&63|128),a[g++]=63&y|128)}return g}(this.buf,n,this.pos);var s=this.pos-t;s>=128&&f_(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),h_(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),h_(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,t){this.pos++;var s=this.pos;n(t,this);var a=this.pos-s;a>=128&&f_(s,a,this),this.pos=s-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,t,s){this.writeTag(n,Qt.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,eb,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,tb,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,ib,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,rb,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,nb,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,sb,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,ob,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,ab,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,lb,t)},writeBytesField:function(n,t){this.writeTag(n,Qt.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,Qt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,Qt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,Qt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,Qt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,Qt.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,Qt.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,Qt.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,Qt.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,Qt.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var Af=$(u_);const Mf=3;function ub(n,t,s){n===1&&s.readMessage(cb,t)}function cb(n,t,s){if(n===3){const{id:a,bitmap:h,width:g,height:y,left:_,top:w,advance:C}=s.readMessage(hb,{});t.push({id:a,bitmap:new hc({width:g+2*Mf,height:y+2*Mf},h),metrics:{width:g,height:y,left:_,top:w,advance:C}})}}function hb(n,t,s){n===1?t.id=s.readVarint():n===2?t.bitmap=s.readBytes():n===3?t.width=s.readVarint():n===4?t.height=s.readVarint():n===5?t.left=s.readSVarint():n===6?t.top=s.readSVarint():n===7&&(t.advance=s.readVarint())}const g_=Mf;function y_(n){let t=0,s=0;for(const y of n)t+=y.w*y.h,s=Math.max(s,y.w);n.sort((y,_)=>_.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let h=0,g=0;for(const y of n)for(let _=a.length-1;_>=0;_--){const w=a[_];if(!(y.w>w.w||y.h>w.h)){if(y.x=w.x,y.y=w.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===w.w&&y.h===w.h){const C=a.pop();_<a.length&&(a[_]=C)}else y.h===w.h?(w.x+=y.w,w.w-=y.w):y.w===w.w?(w.y+=y.h,w.h-=y.h):(a.push({x:w.x+y.w,y:w.y,w:w.w-y.w,h:y.h}),w.y+=y.h,w.h-=y.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}const ti=1;class zf{constructor(t,{pixelRatio:s,version:a,stretchX:h,stretchY:g,content:y,textFitWidth:_,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=h,this.stretchY=g,this.content=y,this.version=a,this.textFitWidth=_,this.textFitHeight=w}get tl(){return[this.paddedRect.x+ti,this.paddedRect.y+ti]}get br(){return[this.paddedRect.x+this.paddedRect.w-ti,this.paddedRect.y+this.paddedRect.h-ti]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ti)/this.pixelRatio,(this.paddedRect.h-2*ti)/this.pixelRatio]}}class __{constructor(t,s){const a={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,a,g),this.addImages(s,h,g);const{w:y,h:_}=y_(g),w=new Ai({width:y||1,height:_||1});for(const C in t){const E=t[C],P=a[C].paddedRect;Ai.copy(E.data,w,{x:0,y:0},{x:P.x+ti,y:P.y+ti},E.data)}for(const C in s){const E=s[C],P=h[C].paddedRect,z=P.x+ti,R=P.y+ti,B=E.data.width,N=E.data.height;Ai.copy(E.data,w,{x:0,y:0},{x:z,y:R},E.data),Ai.copy(E.data,w,{x:0,y:N-1},{x:z,y:R-1},{width:B,height:1}),Ai.copy(E.data,w,{x:0,y:0},{x:z,y:R+N},{width:B,height:1}),Ai.copy(E.data,w,{x:B-1,y:0},{x:z-1,y:R},{width:1,height:N}),Ai.copy(E.data,w,{x:0,y:0},{x:z+B,y:R},{width:1,height:N})}this.image=w,this.iconPositions=a,this.patternPositions=h}addImages(t,s,a){for(const h in t){const g=t[h],y={x:0,y:0,w:g.data.width+2*ti,h:g.data.height+2*ti};a.push(y),s[h]=new zf(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),s),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),s)}patchUpdatedImage(t,s,a){if(!t||!s||t.version===s.version)return;t.version=s.version;const[h,g]=t.tl;a.update(s.data,void 0,{x:h,y:g})}}var Uo;tt("ImagePosition",zf),tt("ImageAtlas",__),S.ah=void 0,(Uo=S.ah||(S.ah={}))[Uo.none=0]="none",Uo[Uo.horizontal=1]="horizontal",Uo[Uo.vertical=2]="vertical",Uo[Uo.horizontalOnly=3]="horizontalOnly";const _c=-17;class vc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const a=new vc;return a.scale=t||1,a.fontStack=s,a}static forImage(t){const s=new vc;return s.imageName=t,s}}class Nl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const a=new Nl;for(let h=0;h<t.sections.length;h++){const g=t.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,s)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let a=0;a<t.length;a++){const h=t.charCodeAt(a+1)||null,g=t.charCodeAt(a-1)||null;s+=h&&Gh(h)&&!yc[t[a+1]]||g&&Gh(g)&&!yc[t[a-1]]||!yc[t[a]]?t[a]:yc[t[a]]}return s}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&ld[this.text.charCodeAt(a)];a++)t++;let s=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&ld[this.text.charCodeAt(a)];a--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const a=new Nl;return a.text=this.text.substring(t,s),a.sectionIndex=this.sectionIndex.slice(t,s),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(vc.forText(t.scale,t.fontStack||s));const a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void Vt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(vc.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Vt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ad(n,t,s,a,h,g,y,_,w,C,E,P,z,R,B){const N=Nl.fromFeature(n,h);let G;P===S.ah.vertical&&N.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:pe}=Qn;if(X&&N.sections.length===1){G=[];const xe=X(N.toString(),Df(N,C,g,t,a,R));for(const Ie of xe){const We=new Nl;We.text=Ie,We.sections=N.sections;for(let mt=0;mt<Ie.length;mt++)We.sectionIndex.push(0);G.push(We)}}else if(pe){G=[];const xe=pe(N.text,N.sectionIndex,Df(N,C,g,t,a,R));for(const Ie of xe){const We=new Nl;We.text=Ie[0],We.sectionIndex=Ie[1],We.sections=N.sections,G.push(We)}}else G=function(xe,Ie){const We=[],mt=xe.text;let Ze=0;for(const Ue of Ie)We.push(xe.substring(Ze,Ue)),Ze=Ue;return Ze<mt.length&&We.push(xe.substring(Ze,mt.length)),We}(N,Df(N,C,g,t,a,R));const re=[],ce={positionedLines:re,text:N.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(xe,Ie,We,mt,Ze,Ue,ut,nt,Je,be,ct,at){let wt=0,tr=_c,er=0,Wr=0;const Xi=nt==="right"?1:nt==="left"?0:.5;let _n=0;for(const Er of Ze){Er.trim();const Kr=Er.getMaxScale(),An=(Kr-1)*$r,vn={positionedGlyphs:[],lineOffset:0};xe.positionedLines[_n]=vn;const qn=vn.positionedGlyphs;let xn=0;if(!Er.length()){tr+=Ue,++_n;continue}for(let ri=0;ri<Er.length();ri++){const $t=Er.getSection(ri),sr=Er.getSectionIndex(ri),pr=Er.getCharCode(ri);let yi=0,wr=null,$l=null,Ls=null,Rs=$r;const Ki=!(Je===S.ah.horizontal||!ct&&!ic(pr)||ct&&(ld[pr]||(Xr=pr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Xr)))));if($t.imageName){const Di=mt[$t.imageName];if(!Di)continue;Ls=$t.imageName,xe.iconsInText=xe.iconsInText||!0,$l=Di.paddedRect;const nn=Di.displaySize;$t.scale=$t.scale*$r/at,wr={width:nn[0],height:nn[1],left:ti,top:-g_,advance:Ki?nn[1]:nn[0]},yi=An+($r-nn[1]*$t.scale),Rs=wr.advance;const no=Ki?nn[0]*$t.scale-$r*Kr:nn[1]*$t.scale-$r*Kr;no>0&&no>xn&&(xn=no)}else{const Di=We[$t.fontStack],nn=Di&&Di[pr];if(nn&&nn.rect)$l=nn.rect,wr=nn.metrics;else{const no=Ie[$t.fontStack],kc=no&&no[pr];if(!kc)continue;wr=kc.metrics}yi=(Kr-$t.scale)*$r}Ki?(xe.verticalizable=!0,qn.push({glyph:pr,imageName:Ls,x:wt,y:tr+yi,vertical:Ki,scale:$t.scale,fontStack:$t.fontStack,sectionIndex:sr,metrics:wr,rect:$l}),wt+=Rs*$t.scale+be):(qn.push({glyph:pr,imageName:Ls,x:wt,y:tr+yi,vertical:Ki,scale:$t.scale,fontStack:$t.fontStack,sectionIndex:sr,metrics:wr,rect:$l}),wt+=wr.advance*$t.scale+be)}qn.length!==0&&(er=Math.max(wt-be,er),mb(qn,0,qn.length-1,Xi,xn)),wt=0;const zi=Ue*Kr+xn;vn.lineOffset=Math.max(xn,An),tr+=zi,Wr=Math.max(zi,Wr),++_n}var Xr;const Vn=tr-_c,{horizontalAlign:Un,verticalAlign:$n}=Lf(ut);(function(Er,Kr,An,vn,qn,xn,zi,ri,$t){const sr=(Kr-An)*qn;let pr=0;pr=xn!==zi?-ri*vn-_c:(-vn*$t+.5)*zi;for(const yi of Er)for(const wr of yi.positionedGlyphs)wr.x+=sr,wr.y+=pr})(xe.positionedLines,Xi,Un,$n,er,Wr,Ue,Vn,Ze.length),xe.top+=-$n*Vn,xe.bottom=xe.top+Vn,xe.left+=-Un*er,xe.right=xe.left+er}(ce,t,s,a,G,y,_,w,P,C,z,B),!function(xe){for(const Ie of xe)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(re)&&ce}const ld={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},db={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},pb={40:!0};function v_(n,t,s,a,h,g){if(t.imageName){const y=a[t.imageName];return y?y.displaySize[0]*t.scale*$r/g+h:0}{const y=s[t.fontStack],_=y&&y[n];return _?_.metrics.advance*t.scale+h:0}}function x_(n,t,s,a){const h=Math.pow(n-t,2);return a?n<t?h/2:2*h:h+Math.abs(s)*s}function fb(n,t,s){let a=0;return n===10&&(a-=1e4),s&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function w_(n,t,s,a,h,g){let y=null,_=x_(t,s,h,g);for(const w of a){const C=x_(t-w.x,s,h,g)+w.badness;C<=_&&(y=w,_=C)}return{index:n,x:t,priorBreak:y,badness:_}}function b_(n){return n?b_(n.priorBreak).concat(n.index):[]}function Df(n,t,s,a,h,g){if(!n)return[];const y=[],_=function(P,z,R,B,N,G){let X=0;for(let pe=0;pe<P.length();pe++){const re=P.getSection(pe);X+=v_(P.getCharCode(pe),re,B,N,z,G)}return X/Math.max(1,Math.ceil(X/R))}(n,t,s,a,h,g),w=n.text.indexOf("")>=0;let C=0;for(let P=0;P<n.length();P++){const z=n.getSection(P),R=n.getCharCode(P);if(ld[R]||(C+=v_(R,z,a,h,t,g)),P<n.length()-1){const B=!((E=R)<11904)&&(!!Rt["CJK Compatibility Forms"](E)||!!Rt["CJK Compatibility"](E)||!!Rt["CJK Strokes"](E)||!!Rt["CJK Symbols and Punctuation"](E)||!!Rt["Enclosed CJK Letters and Months"](E)||!!Rt["Halfwidth and Fullwidth Forms"](E)||!!Rt["Ideographic Description Characters"](E)||!!Rt["Vertical Forms"](E)||Zh.test(String.fromCodePoint(E)));(db[R]||B||z.imageName||P!==n.length()-2&&pb[n.getCharCode(P+1)])&&y.push(w_(P+1,C,_,y,fb(R,n.getCharCode(P+1),B&&w),!1))}}var E;return b_(w_(n.length(),C,_,y,0,!0))}function Lf(n){let t=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function mb(n,t,s,a,h){if(!a&&!h)return;const g=n[s],y=(n[s].x+g.metrics.advance*g.scale)*a;for(let _=t;_<=s;_++)n[_].x-=y,n[_].y+=h}function gb(n,t,s){const{horizontalAlign:a,verticalAlign:h}=Lf(s),g=t[0]-n.displaySize[0]*a,y=t[1]-n.displaySize[1]*h;return{image:n,top:y,bottom:y+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function S_(n){var t,s;let a=n.left,h=n.top,g=n.right-a,y=n.bottom-h;const _=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(s=n.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",C=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(w==="proportional"){if(_==="stretchOnly"&&g/y<C||_==="proportional"){const E=Math.ceil(y*C);a*=E/g,g=E}}else if(_==="proportional"&&w==="stretchOnly"&&C!==0&&g/y>C){const E=Math.ceil(g/C);h*=E/y,y=E}return{x1:a,y1:h,x2:a+g,y2:h+y}}function T_(n,t,s,a,h,g){const y=n.image;let _;if(y.content){const G=y.content,X=y.pixelRatio||1;_=[G[0]/X,G[1]/X,y.displaySize[0]-G[2]/X,y.displaySize[1]-G[3]/X]}const w=t.left*g,C=t.right*g;let E,P,z,R;s==="width"||s==="both"?(R=h[0]+w-a[3],P=h[0]+C+a[1]):(R=h[0]+(w+C-y.displaySize[0])/2,P=R+y.displaySize[0]);const B=t.top*g,N=t.bottom*g;return s==="height"||s==="both"?(E=h[1]+B-a[0],z=h[1]+N+a[2]):(E=h[1]+(B+N-y.displaySize[1])/2,z=E+y.displaySize[1]),{image:y,top:E,right:P,bottom:z,left:R,collisionPadding:_}}const xc=255,Ds=128,$o=xc*Ds;function k_(n,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new ur(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=s;let g=0;for(;g<a.length&&a[g]<=n;)g++;g=Math.max(0,g-1);let y=g;for(;y<a.length&&a[y]<n+1;)y++;y=Math.min(a.length-1,y);const _=a[g],w=a[y];return s.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:_,maxZoom:w,minSize:s.evaluate(new ur(_)),maxSize:s.evaluate(new ur(w)),interpolationType:h}}}function Rf(n,t,s){let a="never";const h=n.get(t);return h?a=h:n.get(s)&&(a="always"),a}const yb=Vo.VectorTileFeature.types,_b=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ud(n,t,s,a,h,g,y,_,w,C,E,P,z){const R=_?Math.min($o,Math.round(_[0])):0,B=_?Math.min($o,Math.round(_[1])):0;n.emplaceBack(t,s,Math.round(32*a),Math.round(32*h),g,y,(R<<1)+(w?1:0),B,16*C,16*E,256*P,256*z)}function Ff(n,t,s){n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s),n.emplaceBack(t.x,t.y,s)}function vb(n){for(const t of n.sections)if(cf(t.text))return!0;return!1}class Bf{constructor(t){this.layoutVertexArray=new Il,this.indexArray=new Pi,this.programConfigurations=t,this.segments=new Ft,this.dynamicLayoutVertexArray=new ac,this.opacityVertexArray=new mi,this.hasVisibleVertices=!1,this.placedSymbolArray=new cr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,X1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,K1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_b,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tt("SymbolBuffers",Bf);class Of{constructor(t,s,a){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new a,this.segments=new Ft,this.collisionVertexArray=new Ms}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Y1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}tt("CollisionBuffers",Of);class jl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yf([]),this.placementViewportMatrix=yf([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=k_(this.zoom,s["text-size"]),this.iconSizeData=k_(this.zoom,s["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=Rf(a,"text-overlap","text-allow-overlap")!=="never"||Rf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>S.ah[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new Bf(new Ra(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Bf(new Ra(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new hr,this.lineVertexArray=new fn,this.symbolInstances=new zt,this.textAnchorOffsets=new dr}calculateGlyphDependencies(t,s,a,h,g){for(let y=0;y<t.length;y++)if(s[t.charCodeAt(y)]=!0,(a||h)&&g){const _=yc[t.charAt(y)];_&&(s[_.charCodeAt(0)]=!0)}}populate(t,s,a){const h=this.layers[0],g=h.layout,y=g.get("text-font"),_=g.get("text-field"),w=g.get("icon-image"),C=(_.value.kind!=="constant"||_.value.value instanceof kn&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),E=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!C&&!E)return;const z=s.iconDependencies,R=s.glyphDependencies,B=s.availableImages,N=new ur(this.zoom);for(const{feature:G,id:X,index:pe,sourceLayerIndex:re}of t){const ce=h._featureFilter.needGeometry,xe=Ba(G,ce);if(!h._featureFilter.filter(N,xe,a))continue;let Ie,We;if(ce||(xe.geometry=Fa(G)),C){const Ze=h.getValueAndResolveTokens("text-field",xe,a,B),Ue=kn.factory(Ze),ut=this.hasRTLText=this.hasRTLText||vb(Ue);(!ut||Qn.getRTLTextPluginStatus()==="unavailable"||ut&&Qn.isParsed())&&(Ie=Q1(Ue,h,xe))}if(E){const Ze=h.getValueAndResolveTokens("icon-image",xe,a,B);We=Ze instanceof tn?Ze:tn.fromString(Ze)}if(!Ie&&!We)continue;const mt=this.sortFeaturesByKey?P.evaluate(xe,{},a):void 0;if(this.features.push({id:X,text:Ie,icon:We,index:pe,sourceLayerIndex:re,geometry:xe.geometry,properties:G.properties,type:yb[G.type],sortKey:mt}),We&&(z[We.name]=!0),Ie){const Ze=y.evaluate(xe,{},a).join(","),Ue=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const ut of Ie.sections)if(ut.image)z[ut.image.name]=!0;else{const nt=rc(Ie.toString()),Je=ut.fontStack||Ze,be=R[Je]=R[Je]||{};this.calculateGlyphDependencies(ut.text,be,Ue,this.allowVerticalPlacement,nt)}}}g.get("symbol-placement")==="line"&&(this.features=function(G){const X={},pe={},re=[];let ce=0;function xe(Ze){re.push(G[Ze]),ce++}function Ie(Ze,Ue,ut){const nt=pe[Ze];return delete pe[Ze],pe[Ue]=nt,re[nt].geometry[0].pop(),re[nt].geometry[0]=re[nt].geometry[0].concat(ut[0]),nt}function We(Ze,Ue,ut){const nt=X[Ue];return delete X[Ue],X[Ze]=nt,re[nt].geometry[0].shift(),re[nt].geometry[0]=ut[0].concat(re[nt].geometry[0]),nt}function mt(Ze,Ue,ut){const nt=ut?Ue[0][Ue[0].length-1]:Ue[0][0];return`${Ze}:${nt.x}:${nt.y}`}for(let Ze=0;Ze<G.length;Ze++){const Ue=G[Ze],ut=Ue.geometry,nt=Ue.text?Ue.text.toString():null;if(!nt){xe(Ze);continue}const Je=mt(nt,ut),be=mt(nt,ut,!0);if(Je in pe&&be in X&&pe[Je]!==X[be]){const ct=We(Je,be,ut),at=Ie(Je,be,re[ct].geometry);delete X[Je],delete pe[be],pe[mt(nt,re[at].geometry,!0)]=at,re[ct].geometry=null}else Je in pe?Ie(Je,be,ut):be in X?We(Je,be,ut):(xe(Ze),X[Je]=ce-1,pe[be]=ce-1)}return re.filter(Ze=>Ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,X)=>G.sortKey-X.sortKey)}update(t,s,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(s[t.segment+1]),g=t.dist(s[t.segment]);const y={};for(let _=t.segment+1;_<s.length;_++)y[_]={x:s[_].x,y:s[_].y,tileUnitDistanceFromAnchor:h},_<s.length-1&&(h+=s[_+1].dist(s[_]));for(let _=t.segment||0;_>=0;_--)y[_]={x:s[_].x,y:s[_].y,tileUnitDistanceFromAnchor:g},_>0&&(g+=s[_-1].dist(s[_]));for(let _=0;_<s.length;_++){const w=y[_];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,s,a,h,g,y,_,w,C,E,P,z){const R=t.indexArray,B=t.layoutVertexArray,N=t.segments.prepareSegment(4*s.length,B,R,this.canOverlap?y.sortKey:void 0),G=this.glyphOffsetArray.length,X=N.vertexLength,pe=this.allowVerticalPlacement&&_===S.ah.vertical?Math.PI/2:0,re=y.text&&y.text.sections;for(let ce=0;ce<s.length;ce++){const{tl:xe,tr:Ie,bl:We,br:mt,tex:Ze,pixelOffsetTL:Ue,pixelOffsetBR:ut,minFontScaleX:nt,minFontScaleY:Je,glyphOffset:be,isSDF:ct,sectionIndex:at}=s[ce],wt=N.vertexLength,tr=be[1];ud(B,w.x,w.y,xe.x,tr+xe.y,Ze.x,Ze.y,a,ct,Ue.x,Ue.y,nt,Je),ud(B,w.x,w.y,Ie.x,tr+Ie.y,Ze.x+Ze.w,Ze.y,a,ct,ut.x,Ue.y,nt,Je),ud(B,w.x,w.y,We.x,tr+We.y,Ze.x,Ze.y+Ze.h,a,ct,Ue.x,ut.y,nt,Je),ud(B,w.x,w.y,mt.x,tr+mt.y,Ze.x+Ze.w,Ze.y+Ze.h,a,ct,ut.x,ut.y,nt,Je),Ff(t.dynamicLayoutVertexArray,w,pe),R.emplaceBack(wt,wt+1,wt+2),R.emplaceBack(wt+1,wt+2,wt+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(be[0]),ce!==s.length-1&&at===s[ce+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,y,y.index,{},z,re&&re[at])}t.placedSymbolArray.emplaceBack(w.x,w.y,G,this.glyphOffsetArray.length-G,X,C,E,w.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],_,0,!1,0,P)}_addCollisionDebugVertex(t,s,a,h,g,y){return s.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,s,a,h,g,y,_){const w=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),C=w.vertexLength,E=g.layoutVertexArray,P=g.collisionVertexArray,z=_.anchorX,R=_.anchorY;this._addCollisionDebugVertex(E,P,y,z,R,new Q(t,s)),this._addCollisionDebugVertex(E,P,y,z,R,new Q(a,s)),this._addCollisionDebugVertex(E,P,y,z,R,new Q(a,h)),this._addCollisionDebugVertex(E,P,y,z,R,new Q(t,h)),w.vertexLength+=4;const B=g.indexArray;B.emplaceBack(C,C+1),B.emplaceBack(C+1,C+2),B.emplaceBack(C+2,C+3),B.emplaceBack(C+3,C),w.primitiveLength+=4}addDebugCollisionBoxes(t,s,a,h){for(let g=t;g<s;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Of(gi,l_.members,rn),this.iconCollisionBox=new Of(gi,l_.members,rn);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,a,h,g,y,_,w,C){const E={};for(let P=s;P<a;P++){const z=t.get(P);E.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.textFeatureIndex=z.featureIndex;break}for(let P=h;P<g;P++){const z=t.get(P);E.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.verticalTextFeatureIndex=z.featureIndex;break}for(let P=y;P<_;P++){const z=t.get(P);E.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.iconFeatureIndex=z.featureIndex;break}for(let P=w;P<C;P++){const z=t.get(P);E.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.verticalIconFeatureIndex=z.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const a=t.placedSymbolArray.get(s),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),a=Math.cos(t),h=[],g=[],y=[];for(let _=0;_<this.symbolInstances.length;++_){y.push(_);const w=this.symbolInstances.get(_);h.push(0|Math.round(s*w.anchorX+a*w.anchorY)),g.push(w.featureIndex)}return y.sort((_,w)=>h[_]-h[w]||g[w]-g[_]),y}addToSortKeyRanges(t,s){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===s?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const a=this.symbolInstances.get(s);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let C_,E_;tt("SymbolBucket",jl,{omit:["layers","collisionBoxArray","features","compareText"]}),jl.MAX_GLYPHS=65535,jl.addDynamicAttributes=Ff;var Nf={get paint(){return E_=E_||new m({"icon-opacity":new gt(ye.paint_symbol["icon-opacity"]),"icon-color":new gt(ye.paint_symbol["icon-color"]),"icon-halo-color":new gt(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new gt(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gt(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new st(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new st(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new gt(ye.paint_symbol["text-opacity"]),"text-color":new gt(ye.paint_symbol["text-color"],{runtimeType:Ar,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new gt(ye.paint_symbol["text-halo-color"]),"text-halo-width":new gt(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new gt(ye.paint_symbol["text-halo-blur"]),"text-translate":new st(ye.paint_symbol["text-translate"]),"text-translate-anchor":new st(ye.paint_symbol["text-translate-anchor"])})},get layout(){return C_=C_||new m({"symbol-placement":new st(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new st(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new st(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gt(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new st(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new st(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new st(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new st(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new st(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new st(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new gt(ye.layout_symbol["icon-size"]),"icon-text-fit":new st(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new st(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new gt(ye.layout_symbol["icon-image"]),"icon-rotate":new gt(ye.layout_symbol["icon-rotate"]),"icon-padding":new gt(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new st(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new gt(ye.layout_symbol["icon-offset"]),"icon-anchor":new gt(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new st(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new st(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new st(ye.layout_symbol["text-rotation-alignment"]),"text-field":new gt(ye.layout_symbol["text-field"]),"text-font":new gt(ye.layout_symbol["text-font"]),"text-size":new gt(ye.layout_symbol["text-size"]),"text-max-width":new gt(ye.layout_symbol["text-max-width"]),"text-line-height":new st(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new gt(ye.layout_symbol["text-letter-spacing"]),"text-justify":new gt(ye.layout_symbol["text-justify"]),"text-radial-offset":new gt(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new st(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new gt(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new gt(ye.layout_symbol["text-anchor"]),"text-max-angle":new st(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new st(ye.layout_symbol["text-writing-mode"]),"text-rotate":new gt(ye.layout_symbol["text-rotate"]),"text-padding":new st(ye.layout_symbol["text-padding"]),"text-keep-upright":new st(ye.layout_symbol["text-keep-upright"]),"text-transform":new gt(ye.layout_symbol["text-transform"]),"text-offset":new gt(ye.layout_symbol["text-offset"]),"text-allow-overlap":new st(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new st(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new st(ye.layout_symbol["text-ignore-placement"]),"text-optional":new st(ye.layout_symbol["text-optional"])})}};class I_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ki,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tt("FormatSectionOverride",I_,{omit:["defaultValue"]});class cd extends o{constructor(t){super(t,Nf)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,a,h){const g=this.layout.get(t).evaluate(s,{},a,h),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||pl(y.value)||!g?g:function(_,w){return w.replace(/{([^{}]+)}/g,(C,E)=>_&&E in _?String(_[E]):"")}(s.properties,g)}createBucket(t){return new jl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Nf.paint.overridableProperties){if(!cd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),a=new I_(s),h=new dl(a,s.property.specification);let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new Co("source",h):new Eo("composite",h,s.value.zoomStops),this.paint._values[t]=new Hi(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,a){return!(!this.layout||s.isDataDriven()||a.isDataDriven())&&cd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const a=t.get("text-field"),h=Nf.paint.properties[s];let g=!1;const y=_=>{for(const w of _)if(h.overrides&&h.overrides.hasOverride(w))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof kn)y(a.value.value.sections);else if(a.value.kind==="source"){const _=C=>{g||(C instanceof Cn&&Tr(C.value)===Yn?y(C.value.sections):C instanceof nl?y(C.sections):C.eachChild(_))},w=a.value;w._styleExpression&&_(w._styleExpression.expression)}return g}}let P_;var xb={get paint(){return P_=P_||new m({"background-color":new st(ye.paint_background["background-color"]),"background-pattern":new Cl(ye.paint_background["background-pattern"]),"background-opacity":new st(ye.paint_background["background-opacity"])})}};class wb extends o{constructor(t){super(t,xb)}}let A_;var bb={get paint(){return A_=A_||new m({"raster-opacity":new st(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new st(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new st(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new st(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new st(ye.paint_raster["raster-saturation"]),"raster-contrast":new st(ye.paint_raster["raster-contrast"]),"raster-resampling":new st(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new st(ye.paint_raster["raster-fade-duration"])})}};class Sb extends o{constructor(t){super(t,bb)}}class Tb extends o{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class kb{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const jf=63710088e-1;class qo{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qo(Qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,a=this.lat*s,h=t.lat*s,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*s);return jf*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof qo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new qo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new qo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const M_=2*Math.PI*jf;function z_(n){return M_*Math.cos(n*Math.PI/180)}function D_(n){return(180+n)/360}function L_(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function R_(n,t){return n/z_(t)}function Vf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class wc{constructor(t,s,a=0){this.x=+t,this.y=+s,this.z=+a}static fromLngLat(t,s=0){const a=qo.convert(t);return new wc(D_(a.lng),L_(a.lat),R_(s,a.lat))}toLngLat(){return new qo(360*this.x-180,Vf(this.y))}toAltitude(){return this.z*z_(Vf(this.y))}meterInMercatorCoordinateUnits(){return 1/M_*(t=Vf(this.y),1/Math.cos(t*Math.PI/180));var t}}function F_(n,t,s){var a=2*Math.PI*6378137/256/Math.pow(2,s);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Uf{constructor(t,s,a){if(!function(h,g,y){return!(h<0||h>25||y<0||y>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(t,s,a))throw new Error(`x=${s}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=a,this.key=bc(0,t,t,s,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,a){const h=(y=this.y,_=this.z,w=F_(256*(g=this.x),256*(y=Math.pow(2,_)-y-1),_),C=F_(256*(g+1),256*(y+1),_),w[0]+","+w[1]+","+C[0]+","+C[1]);var g,y,_,w,C;const E=function(P,z,R){let B,N="";for(let G=P;G>0;G--)B=1<<G-1,N+=(z&B?1:0)+(R&B?2:0);return N}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new Q((t.x*s-this.x)*Br,(t.y*s-this.y)*Br)}toString(){return`${this.z}/${this.x}/${this.y}`}}class B_{constructor(t,s){this.wrap=t,this.canonical=s,this.key=bc(t,s.z,s.z,s.x,s.y)}}class Mi{constructor(t,s,a,h,g){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=s,this.canonical=new Uf(a,+h,+g),this.key=bc(s,t,a,h,g)}clone(){return new Mi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Mi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mi(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?bc(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):bc(this.wrap*+s,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Mi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Mi(s,this.wrap,s,a,h),new Mi(s,this.wrap,s,a+1,h),new Mi(s,this.wrap,s,a,h+1),new Mi(s,this.wrap,s,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Mi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Mi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new B_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new wc(t.x-this.wrap,t.y))}}function bc(n,t,s,a,h){(n*=2)<0&&(n=-1*n-1);const g=1<<s;return(g*g*n+g*h+a).toString(36)+s.toString(36)+t.toString(36)}tt("CanonicalTileID",Uf),tt("OverscaledTileID",Mi,{omit:["posMatrix"]});class O_{constructor(t,s,a,h=1,g=1,y=1,_=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Vt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const w=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<w;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(w,C)]=this.data[this._idx(w-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,w)]=this.data[this._idx(C,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<w;C++)for(let E=0;E<w;E++){const P=this.get(C,E);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,s){const a=new Uint8Array(this.data.buffer),h=4*this._idx(t,s);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,a){return t*this.redFactor+s*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Ai({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,g=s*this.dim+this.dim,y=a*this.dim,_=a*this.dim+this.dim;switch(s){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:y=_-1;break;case 1:_=y+1}const w=-s*this.dim,C=-a*this.dim;for(let E=y;E<_;E++)for(let P=h;P<g;P++)this.data[this._idx(P,E)]=t.data[this._idx(P+w,E+C)]}}tt("DEMData",O_);class N_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const a=t[s];this._stringToNumber[a]=s,this._numberToString[s]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class j_{constructor(t,s,a,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=a,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class V_{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ao(Br,16,0),this.grid3D=new Ao(Br,16,0),this.featureIndexArray=new In,this.promoteId=s}insert(t,s,a,h,g,y){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);const w=y?this.grid3D:this.grid;for(let C=0;C<s.length;C++){const E=s[C],P=[1/0,1/0,-1/0,-1/0];for(let z=0;z<E.length;z++){const R=E[z];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}P[0]<Br&&P[1]<Br&&P[2]>=0&&P[3]>=0&&w.insert(_,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Vo.VectorTile(new Af(this.rawTileData)).layers,this.sourceLayerCoder=new N_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,a,h){this.loadVTLayers();const g=t.params||{},y=Br/t.tileSize/t.scale,_=Vu(g.filter),w=t.queryGeometry,C=t.queryPadding*y,E=$_(w),P=this.grid.query(E.minX-C,E.minY-C,E.maxX+C,E.maxY+C),z=$_(t.cameraQueryGeometry),R=this.grid3D.query(z.minX-C,z.minY-C,z.maxX+C,z.maxY+C,(G,X,pe,re)=>function(ce,xe,Ie,We,mt){for(const Ue of ce)if(xe<=Ue.x&&Ie<=Ue.y&&We>=Ue.x&&mt>=Ue.y)return!0;const Ze=[new Q(xe,Ie),new Q(xe,mt),new Q(We,mt),new Q(We,Ie)];if(ce.length>2){for(const Ue of Ze)if(Dl(ce,Ue))return!0}for(let Ue=0;Ue<ce.length-1;Ue++)if(s1(ce[Ue],ce[Ue+1],Ze))return!0;return!1}(t.cameraQueryGeometry,G-C,X-C,pe+C,re+C));for(const G of R)P.push(G);P.sort(Cb);const B={};let N;for(let G=0;G<P.length;G++){const X=P[G];if(X===N)continue;N=X;const pe=this.featureIndexArray.get(X);let re=null;this.loadMatchingFeature(B,pe.bucketIndex,pe.sourceLayerIndex,pe.featureIndex,_,g.layers,g.availableImages,s,a,h,(ce,xe,Ie)=>(re||(re=Fa(ce)),xe.queryIntersectsFeature(w,ce,Ie,re,this.z,t.transform,y,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,s,a,h,g,y,_,w,C,E,P){const z=this.bucketLayerIDs[s];if(y&&!function(G,X){for(let pe=0;pe<G.length;pe++)if(X.indexOf(G[pe])>=0)return!0;return!1}(y,z))return;const R=this.sourceLayerCoder.decode(a),B=this.vtLayers[R].feature(h);if(g.needGeometry){const G=Ba(B,!0);if(!g.filter(new ur(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!g.filter(new ur(this.tileID.overscaledZ),B))return;const N=this.getId(B,R);for(let G=0;G<z.length;G++){const X=z[G];if(y&&y.indexOf(X)<0)continue;const pe=w[X];if(!pe)continue;let re={};N&&E&&(re=E.getState(pe.sourceLayer||"_geojsonTileLayer",N));const ce=Xe({},C[X]);ce.paint=U_(ce.paint,pe.paint,B,re,_),ce.layout=U_(ce.layout,pe.layout,B,re,_);const xe=!P||P(B,pe,re);if(!xe)continue;const Ie=new j_(B,this.z,this.x,this.y,N);Ie.layer=ce;let We=t[X];We===void 0&&(We=t[X]=[]),We.push({featureIndex:h,feature:Ie,intersectionZ:xe})}}lookupSymbolFeatures(t,s,a,h,g,y,_,w){const C={};this.loadVTLayers();const E=Vu(g);for(const P of t)this.loadMatchingFeature(C,a,h,P,E,y,_,w,s);return C}hasLayer(t){for(const s of this.bucketLayerIDs)for(const a of s)if(t===a)return!0;return!1}getId(t,s){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof a=="boolean"&&(a=Number(a))),a}}function U_(n,t,s,a,h){return it(n,(g,y)=>{const _=t instanceof za?t.get(y):null;return _&&_.evaluate?_.evaluate(s,a,h):_})}function $_(n){let t=1/0,s=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),s=Math.min(s,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:t,minY:s,maxX:a,maxY:h}}function Cb(n,t){return t-n}function q_(n,t,s,a,h){const g=[];for(let y=0;y<n.length;y++){const _=n[y];let w;for(let C=0;C<_.length-1;C++){let E=_[C],P=_[C+1];E.x<t&&P.x<t||(E.x<t?E=new Q(t,E.y+(t-E.x)/(P.x-E.x)*(P.y-E.y))._round():P.x<t&&(P=new Q(t,E.y+(t-E.x)/(P.x-E.x)*(P.y-E.y))._round()),E.y<s&&P.y<s||(E.y<s?E=new Q(E.x+(s-E.y)/(P.y-E.y)*(P.x-E.x),s)._round():P.y<s&&(P=new Q(E.x+(s-E.y)/(P.y-E.y)*(P.x-E.x),s)._round()),E.x>=a&&P.x>=a||(E.x>=a?E=new Q(a,E.y+(a-E.x)/(P.x-E.x)*(P.y-E.y))._round():P.x>=a&&(P=new Q(a,E.y+(a-E.x)/(P.x-E.x)*(P.y-E.y))._round()),E.y>=h&&P.y>=h||(E.y>=h?E=new Q(E.x+(h-E.y)/(P.y-E.y)*(P.x-E.x),h)._round():P.y>=h&&(P=new Q(E.x+(h-E.y)/(P.y-E.y)*(P.x-E.x),h)._round()),w&&E.equals(w[w.length-1])||(w=[E],g.push(w)),w.push(P)))))}}return g}tt("FeatureIndex",V_,{omit:["rawTileData","sourceLayerCoder"]});class Zo extends Q{constructor(t,s,a,h){super(t,s),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new Zo(this.x,this.y,this.angle,this.segment)}}function Z_(n,t,s,a,h){if(t.segment===void 0||s===0)return!0;let g=t,y=t.segment+1,_=0;for(;_>-s/2;){if(y--,y<0)return!1;_-=n[y].dist(g),g=n[y]}_+=n[y].dist(n[y+1]),y++;const w=[];let C=0;for(;_<s/2;){const E=n[y],P=n[y+1];if(!P)return!1;let z=n[y-1].angleTo(E)-E.angleTo(P);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:_,angleDelta:z}),C+=z;_-w[0].distance>a;)C-=w.shift().angleDelta;if(C>h)return!1;y++,_+=E.dist(P)}return!0}function G_(n){let t=0;for(let s=0;s<n.length-1;s++)t+=n[s].dist(n[s+1]);return t}function H_(n,t,s){return n?.6*t*s:0}function W_(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function Eb(n,t,s,a,h,g){const y=H_(s,h,g),_=W_(s,a)*g;let w=0;const C=G_(n)/2;for(let E=0;E<n.length-1;E++){const P=n[E],z=n[E+1],R=P.dist(z);if(w+R>C){const B=(C-w)/R,N=Gr.number(P.x,z.x,B),G=Gr.number(P.y,z.y,B),X=new Zo(N,G,z.angleTo(P),E);return X._round(),!y||Z_(n,X,_,y,t)?X:void 0}w+=R}}function Ib(n,t,s,a,h,g,y,_,w){const C=H_(a,g,y),E=W_(a,h),P=E*y,z=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return t-P<t/4&&(t=P+t/4),X_(n,z?t/2*_%t:(E/2+2*g)*y*_%t,t,C,s,P,z,!1,w)}function X_(n,t,s,a,h,g,y,_,w){const C=g/2,E=G_(n);let P=0,z=t-s,R=[];for(let B=0;B<n.length-1;B++){const N=n[B],G=n[B+1],X=N.dist(G),pe=G.angleTo(N);for(;z+s<P+X;){z+=s;const re=(z-P)/X,ce=Gr.number(N.x,G.x,re),xe=Gr.number(N.y,G.y,re);if(ce>=0&&ce<w&&xe>=0&&xe<w&&z-C>=0&&z+C<=E){const Ie=new Zo(ce,xe,pe,B);Ie._round(),a&&!Z_(n,Ie,g,a,h)||R.push(Ie)}}P+=X}return _||R.length||y||(R=X_(n,P/2,s,a,h,g,y,!0,w)),R}tt("Anchor",Zo);const Vl=ti;function K_(n,t,s,a){const h=[],g=n.image,y=g.pixelRatio,_=g.paddedRect.w-2*Vl,w=g.paddedRect.h-2*Vl;let C={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=g.stretchX||[[0,_]],P=g.stretchY||[[0,w]],z=(be,ct)=>be+ct[1]-ct[0],R=E.reduce(z,0),B=P.reduce(z,0),N=_-R,G=w-B;let X=0,pe=R,re=0,ce=B,xe=0,Ie=N,We=0,mt=G;if(g.content&&a){const be=g.content,ct=be[2]-be[0],at=be[3]-be[1];(g.textFitWidth||g.textFitHeight)&&(C=S_(n)),X=hd(E,0,be[0]),re=hd(P,0,be[1]),pe=hd(E,be[0],be[2]),ce=hd(P,be[1],be[3]),xe=be[0]-X,We=be[1]-re,Ie=ct-pe,mt=at-ce}const Ze=C.x1,Ue=C.y1,ut=C.x2-Ze,nt=C.y2-Ue,Je=(be,ct,at,wt)=>{const tr=dd(be.stretch-X,pe,ut,Ze),er=pd(be.fixed-xe,Ie,be.stretch,R),Wr=dd(ct.stretch-re,ce,nt,Ue),Xi=pd(ct.fixed-We,mt,ct.stretch,B),_n=dd(at.stretch-X,pe,ut,Ze),Xr=pd(at.fixed-xe,Ie,at.stretch,R),Vn=dd(wt.stretch-re,ce,nt,Ue),Un=pd(wt.fixed-We,mt,wt.stretch,B),$n=new Q(tr,Wr),Er=new Q(_n,Wr),Kr=new Q(_n,Vn),An=new Q(tr,Vn),vn=new Q(er/y,Xi/y),qn=new Q(Xr/y,Un/y),xn=t*Math.PI/180;if(xn){const $t=Math.sin(xn),sr=Math.cos(xn),pr=[sr,-$t,$t,sr];$n._matMult(pr),Er._matMult(pr),An._matMult(pr),Kr._matMult(pr)}const zi=be.stretch+be.fixed,ri=ct.stretch+ct.fixed;return{tl:$n,tr:Er,bl:An,br:Kr,tex:{x:g.paddedRect.x+Vl+zi,y:g.paddedRect.y+Vl+ri,w:at.stretch+at.fixed-zi,h:wt.stretch+wt.fixed-ri},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vn,pixelOffsetBR:qn,minFontScaleX:Ie/y/ut,minFontScaleY:mt/y/nt,isSDF:s}};if(a&&(g.stretchX||g.stretchY)){const be=Y_(E,N,R),ct=Y_(P,G,B);for(let at=0;at<be.length-1;at++){const wt=be[at],tr=be[at+1];for(let er=0;er<ct.length-1;er++)h.push(Je(wt,ct[er],tr,ct[er+1]))}}else h.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:w+1}));return h}function hd(n,t,s){let a=0;for(const h of n)a+=Math.max(t,Math.min(s,h[1]))-Math.max(t,Math.min(s,h[0]));return a}function Y_(n,t,s){const a=[{fixed:-Vl,stretch:0}];for(const[h,g]of n){const y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return a.push({fixed:t+Vl,stretch:s}),a}function dd(n,t,s,a){return n/t*s+a}function pd(n,t,s,a){return n-t*s/a}class fd{constructor(t,s,a,h,g,y,_,w,C,E){var P;if(this.boxStartIndex=t.length,C){let z=y.top,R=y.bottom;const B=y.collisionPadding;B&&(z-=B[1],R+=B[3]);let N=R-z;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const z=!((P=y.image)===null||P===void 0)&&P.content&&(y.image.textFitWidth||y.image.textFitHeight)?S_(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};z.y1=z.y1*_-w[0],z.y2=z.y2*_+w[2],z.x1=z.x1*_-w[3],z.x2=z.x2*_+w[1];const R=y.collisionPadding;if(R&&(z.x1-=R[0]*_,z.y1-=R[1]*_,z.x2+=R[2]*_,z.y2+=R[3]*_),E){const B=new Q(z.x1,z.y1),N=new Q(z.x2,z.y1),G=new Q(z.x1,z.y2),X=new Q(z.x2,z.y2),pe=E*Math.PI/180;B._rotate(pe),N._rotate(pe),G._rotate(pe),X._rotate(pe),z.x1=Math.min(B.x,N.x,G.x,X.x),z.x2=Math.max(B.x,N.x,G.x,X.x),z.y1=Math.min(B.y,N.y,G.y,X.y),z.y2=Math.max(B.y,N.y,G.y,X.y)}t.emplaceBack(s.x,s.y,z.x1,z.y1,z.x2,z.y2,a,h,g)}this.boxEndIndex=t.length}}class Pb{constructor(t=[],s=(a,h)=>a<h?-1:a>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:a}=this,h=s[t];for(;t>0;){const g=t-1>>1,y=s[g];if(a(h,y)>=0)break;s[t]=y,t=g}s[t]=h}_down(t){const{data:s,compare:a}=this,h=this.length>>1,g=s[t];for(;t<h;){let y=1+(t<<1);const _=y+1;if(_<this.length&&a(s[_],s[y])<0&&(y=_),a(s[y],g)>=0)break;s[t]=s[y],t=y}s[t]=g}}function Ab(n,t=1,s=!1){let a=1/0,h=1/0,g=-1/0,y=-1/0;const _=n[0];for(let R=0;R<_.length;R++){const B=_[R];(!R||B.x<a)&&(a=B.x),(!R||B.y<h)&&(h=B.y),(!R||B.x>g)&&(g=B.x),(!R||B.y>y)&&(y=B.y)}const w=Math.min(g-a,y-h);let C=w/2;const E=new Pb([],Mb);if(w===0)return new Q(a,h);for(let R=a;R<g;R+=w)for(let B=h;B<y;B+=w)E.push(new Ul(R+C,B+C,C,n));let P=function(R){let B=0,N=0,G=0;const X=R[0];for(let pe=0,re=X.length,ce=re-1;pe<re;ce=pe++){const xe=X[pe],Ie=X[ce],We=xe.x*Ie.y-Ie.x*xe.y;N+=(xe.x+Ie.x)*We,G+=(xe.y+Ie.y)*We,B+=3*We}return new Ul(N/B,G/B,0,R)}(n),z=E.length;for(;E.length;){const R=E.pop();(R.d>P.d||!P.d)&&(P=R,s&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,z)),R.max-P.d<=t||(C=R.h/2,E.push(new Ul(R.p.x-C,R.p.y-C,C,n)),E.push(new Ul(R.p.x+C,R.p.y-C,C,n)),E.push(new Ul(R.p.x-C,R.p.y+C,C,n)),E.push(new Ul(R.p.x+C,R.p.y+C,C,n)),z+=4)}return s&&(console.log(`num probes: ${z}`),console.log(`best distance: ${P.d}`)),P.p}function Mb(n,t){return t.max-n.max}function Ul(n,t,s,a){this.p=new Q(n,t),this.h=s,this.d=function(h,g){let y=!1,_=1/0;for(let w=0;w<g.length;w++){const C=g[w];for(let E=0,P=C.length,z=P-1;E<P;z=E++){const R=C[E],B=C[z];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(y=!y),_=Math.min(_,Ly(h,R,B))}}return(y?1:-1)*Math.sqrt(_)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var yn;S.aq=void 0,(yn=S.aq||(S.aq={}))[yn.center=1]="center",yn[yn.left=2]="left",yn[yn.right=3]="right",yn[yn.top=4]="top",yn[yn.bottom=5]="bottom",yn[yn["top-left"]=6]="top-left",yn[yn["top-right"]=7]="top-right",yn[yn["bottom-left"]=8]="bottom-left",yn[yn["bottom-right"]=9]="bottom-right";const Go=7,$f=Number.POSITIVE_INFINITY;function J_(n,t){return t[1]!==$f?function(s,a,h){let g=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),s){case"top-right":case"top-left":case"top":y=h-Go;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+Go}switch(s){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,y]}(n,t[0],t[1]):function(s,a){let h=0,g=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(s){case"top-right":case"top-left":g=y-Go;break;case"bottom-right":case"bottom-left":g=-y+Go;break;case"bottom":g=-a+Go;break;case"top":g=a-Go}switch(s){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(n,t[0])}function Q_(n,t,s){var a;const h=n.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},s);if(g){const _=g.values,w=[];for(let C=0;C<_.length;C+=2){const E=w[C]=_[C],P=_[C+1].map(z=>z*$r);E.startsWith("top")?P[1]-=Go:E.startsWith("bottom")&&(P[1]+=Go),w[C+1]=P}return new Fn(w)}const y=h.get("text-variable-anchor");if(y){let _;_=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},s)*$r,$f]:h.get("text-offset").evaluate(t,{},s).map(C=>C*$r);const w=[];for(const C of y)w.push(C,J_(C,_));return new Fn(w)}return null}function qf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zb(n,t,s,a,h,g,y,_,w,C,E){let P=g.textMaxSize.evaluate(t,{});P===void 0&&(P=y);const z=n.layers[0].layout,R=z.get("icon-offset").evaluate(t,{},E),B=tv(s.horizontal),N=y/24,G=n.tilePixelRatio*N,X=n.tilePixelRatio*P/24,pe=n.tilePixelRatio*_,re=n.tilePixelRatio*z.get("symbol-spacing"),ce=z.get("text-padding")*n.tilePixelRatio,xe=function(be,ct,at,wt=1){const tr=be.get("icon-padding").evaluate(ct,{},at),er=tr&&tr.values;return[er[0]*wt,er[1]*wt,er[2]*wt,er[3]*wt]}(z,t,E,n.tilePixelRatio),Ie=z.get("text-max-angle")/180*Math.PI,We=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",mt=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ze=z.get("symbol-placement"),Ue=re/2,ut=z.get("icon-text-fit");let nt;a&&ut!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(nt=T_(a,s.vertical,ut,z.get("icon-text-fit-padding"),R,N)),B&&(a=T_(a,B,ut,z.get("icon-text-fit-padding"),R,N)));const Je=(be,ct)=>{ct.x<0||ct.x>=Br||ct.y<0||ct.y>=Br||function(at,wt,tr,er,Wr,Xi,_n,Xr,Vn,Un,$n,Er,Kr,An,vn,qn,xn,zi,ri,$t,sr,pr,yi,wr,$l){const Ls=at.addToLineVertexArray(wt,tr);let Rs,Ki,Di,nn,no=0,kc=0,sv=0,ov=0,Jf=-1,Qf=-1;const io={};let av=Pl("");if(at.allowVerticalPlacement&&er.vertical){const Mn=Xr.layout.get("text-rotate").evaluate(sr,{},wr)+90;Di=new fd(Vn,wt,Un,$n,Er,er.vertical,Kr,An,vn,Mn),_n&&(nn=new fd(Vn,wt,Un,$n,Er,_n,xn,zi,vn,Mn))}if(Wr){const Mn=Xr.layout.get("icon-rotate").evaluate(sr,{}),Li=Xr.layout.get("icon-text-fit")!=="none",Na=K_(Wr,Mn,yi,Li),gs=_n?K_(_n,Mn,yi,Li):void 0;Ki=new fd(Vn,wt,Un,$n,Er,Wr,xn,zi,!1,Mn),no=4*Na.length;const ja=at.iconSizeData;let Fs=null;ja.kind==="source"?(Fs=[Ds*Xr.layout.get("icon-size").evaluate(sr,{})],Fs[0]>$o&&Vt(`${at.layerIds[0]}: Value for "icon-size" is >= ${xc}. Reduce your "icon-size".`)):ja.kind==="composite"&&(Fs=[Ds*pr.compositeIconSizes[0].evaluate(sr,{},wr),Ds*pr.compositeIconSizes[1].evaluate(sr,{},wr)],(Fs[0]>$o||Fs[1]>$o)&&Vt(`${at.layerIds[0]}: Value for "icon-size" is >= ${xc}. Reduce your "icon-size".`)),at.addSymbols(at.icon,Na,Fs,$t,ri,sr,S.ah.none,wt,Ls.lineStartIndex,Ls.lineLength,-1,wr),Jf=at.icon.placedSymbolArray.length-1,gs&&(kc=4*gs.length,at.addSymbols(at.icon,gs,Fs,$t,ri,sr,S.ah.vertical,wt,Ls.lineStartIndex,Ls.lineLength,-1,wr),Qf=at.icon.placedSymbolArray.length-1)}const lv=Object.keys(er.horizontal);for(const Mn of lv){const Li=er.horizontal[Mn];if(!Rs){av=Pl(Li.text);const gs=Xr.layout.get("text-rotate").evaluate(sr,{},wr);Rs=new fd(Vn,wt,Un,$n,Er,Li,Kr,An,vn,gs)}const Na=Li.positionedLines.length===1;if(sv+=ev(at,wt,Li,Xi,Xr,vn,sr,qn,Ls,er.vertical?S.ah.horizontal:S.ah.horizontalOnly,Na?lv:[Mn],io,Jf,pr,wr),Na)break}er.vertical&&(ov+=ev(at,wt,er.vertical,Xi,Xr,vn,sr,qn,Ls,S.ah.vertical,["vertical"],io,Qf,pr,wr));const Rb=Rs?Rs.boxStartIndex:at.collisionBoxArray.length,Fb=Rs?Rs.boxEndIndex:at.collisionBoxArray.length,Bb=Di?Di.boxStartIndex:at.collisionBoxArray.length,Ob=Di?Di.boxEndIndex:at.collisionBoxArray.length,Nb=Ki?Ki.boxStartIndex:at.collisionBoxArray.length,jb=Ki?Ki.boxEndIndex:at.collisionBoxArray.length,Vb=nn?nn.boxStartIndex:at.collisionBoxArray.length,Ub=nn?nn.boxEndIndex:at.collisionBoxArray.length;let ms=-1;const gd=(Mn,Li)=>Mn&&Mn.circleDiameter?Math.max(Mn.circleDiameter,Li):Li;ms=gd(Rs,ms),ms=gd(Di,ms),ms=gd(Ki,ms),ms=gd(nn,ms);const uv=ms>-1?1:0;uv&&(ms*=$l/$r),at.glyphOffsetArray.length>=jl.MAX_GLYPHS&&Vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sr.sortKey!==void 0&&at.addToSortKeyRanges(at.symbolInstances.length,sr.sortKey);const $b=Q_(Xr,sr,wr),[qb,Zb]=function(Mn,Li){const Na=Mn.length,gs=Li==null?void 0:Li.values;if((gs==null?void 0:gs.length)>0)for(let ja=0;ja<gs.length;ja+=2){const Fs=gs[ja+1];Mn.emplaceBack(S.aq[gs[ja]],Fs[0],Fs[1])}return[Na,Mn.length]}(at.textAnchorOffsets,$b);at.symbolInstances.emplaceBack(wt.x,wt.y,io.right>=0?io.right:-1,io.center>=0?io.center:-1,io.left>=0?io.left:-1,io.vertical||-1,Jf,Qf,av,Rb,Fb,Bb,Ob,Nb,jb,Vb,Ub,Un,sv,ov,no,kc,uv,0,Kr,ms,qb,Zb)}(n,ct,be,s,a,h,nt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,G,[ce,ce,ce,ce],We,w,pe,xe,mt,R,t,g,C,E,y)};if(Ze==="line")for(const be of q_(t.geometry,0,0,Br,Br)){const ct=Ib(be,re,Ie,s.vertical||B,a,24,X,n.overscaling,Br);for(const at of ct)B&&Db(n,B.text,Ue,at)||Je(be,at)}else if(Ze==="line-center"){for(const be of t.geometry)if(be.length>1){const ct=Eb(be,Ie,s.vertical||B,a,24,X);ct&&Je(be,ct)}}else if(t.type==="Polygon")for(const be of sl(t.geometry,0)){const ct=Ab(be,16);Je(be[0],new Zo(ct.x,ct.y,0))}else if(t.type==="LineString")for(const be of t.geometry)Je(be,new Zo(be[0].x,be[0].y,0));else if(t.type==="Point")for(const be of t.geometry)for(const ct of be)Je([ct],new Zo(ct.x,ct.y,0))}function ev(n,t,s,a,h,g,y,_,w,C,E,P,z,R,B){const N=function(pe,re,ce,xe,Ie,We,mt,Ze){const Ue=xe.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,ut=[];for(const nt of re.positionedLines)for(const Je of nt.positionedGlyphs){if(!Je.rect)continue;const be=Je.rect||{};let ct=g_+1,at=!0,wt=1,tr=0;const er=(Ie||Ze)&&Je.vertical,Wr=Je.metrics.advance*Je.scale/2;if(Ze&&re.verticalizable&&(tr=nt.lineOffset/2-(Je.imageName?-($r-Je.metrics.width*Je.scale)/2:(Je.scale-1)*$r)),Je.imageName){const $t=mt[Je.imageName];at=$t.sdf,wt=$t.pixelRatio,ct=ti/wt}const Xi=Ie?[Je.x+Wr,Je.y]:[0,0];let _n=Ie?[0,0]:[Je.x+Wr+ce[0],Je.y+ce[1]-tr],Xr=[0,0];er&&(Xr=_n,_n=[0,0]);const Vn=Je.metrics.isDoubleResolution?2:1,Un=(Je.metrics.left-ct)*Je.scale-Wr+_n[0],$n=(-Je.metrics.top-ct)*Je.scale+_n[1],Er=Un+be.w/Vn*Je.scale/wt,Kr=$n+be.h/Vn*Je.scale/wt,An=new Q(Un,$n),vn=new Q(Er,$n),qn=new Q(Un,Kr),xn=new Q(Er,Kr);if(er){const $t=new Q(-Wr,Wr-_c),sr=-Math.PI/2,pr=$r/2-Wr,yi=new Q(5-_c-pr,-(Je.imageName?pr:0)),wr=new Q(...Xr);An._rotateAround(sr,$t)._add(yi)._add(wr),vn._rotateAround(sr,$t)._add(yi)._add(wr),qn._rotateAround(sr,$t)._add(yi)._add(wr),xn._rotateAround(sr,$t)._add(yi)._add(wr)}if(Ue){const $t=Math.sin(Ue),sr=Math.cos(Ue),pr=[sr,-$t,$t,sr];An._matMult(pr),vn._matMult(pr),qn._matMult(pr),xn._matMult(pr)}const zi=new Q(0,0),ri=new Q(0,0);ut.push({tl:An,tr:vn,bl:qn,br:xn,tex:be,writingMode:re.writingMode,glyphOffset:Xi,sectionIndex:Je.sectionIndex,isSDF:at,pixelOffsetTL:zi,pixelOffsetBR:ri,minFontScaleX:0,minFontScaleY:0})}return ut}(0,s,_,h,g,y,a,n.allowVerticalPlacement),G=n.textSizeData;let X=null;G.kind==="source"?(X=[Ds*h.layout.get("text-size").evaluate(y,{})],X[0]>$o&&Vt(`${n.layerIds[0]}: Value for "text-size" is >= ${xc}. Reduce your "text-size".`)):G.kind==="composite"&&(X=[Ds*R.compositeTextSizes[0].evaluate(y,{},B),Ds*R.compositeTextSizes[1].evaluate(y,{},B)],(X[0]>$o||X[1]>$o)&&Vt(`${n.layerIds[0]}: Value for "text-size" is >= ${xc}. Reduce your "text-size".`)),n.addSymbols(n.text,N,X,_,g,y,C,t,w.lineStartIndex,w.lineLength,z,B);for(const pe of E)P[pe]=n.text.placedSymbolArray.length-1;return 4*N.length}function tv(n){for(const t in n)return n[t];return null}function Db(n,t,s,a){const h=n.compareText;if(t in h){const g=h[t];for(let y=g.length-1;y>=0;y--)if(a.dist(g[y])<s)return!0}else h[t]=[];return h[t].push(a),!1}const rv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,a]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=rv[15&a];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new Zf(_,y,g,t)}constructor(t,s=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=rv.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-_%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+_+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=s,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Gf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:_}=this,w=[0,g.length-1,0],C=[];for(;w.length;){const E=w.pop()||0,P=w.pop()||0,z=w.pop()||0;if(P-z<=_){for(let G=z;G<=P;G++){const X=y[2*G],pe=y[2*G+1];X>=t&&X<=a&&pe>=s&&pe<=h&&C.push(g[G])}continue}const R=z+P>>1,B=y[2*R],N=y[2*R+1];B>=t&&B<=a&&N>=s&&N<=h&&C.push(g[R]),(E===0?t<=B:s<=N)&&(w.push(z),w.push(R-1),w.push(1-E)),(E===0?a>=B:h>=N)&&(w.push(R+1),w.push(P),w.push(1-E))}return C}within(t,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,_=[0,h.length-1,0],w=[],C=a*a;for(;_.length;){const E=_.pop()||0,P=_.pop()||0,z=_.pop()||0;if(P-z<=y){for(let G=z;G<=P;G++)iv(g[2*G],g[2*G+1],t,s)<=C&&w.push(h[G]);continue}const R=z+P>>1,B=g[2*R],N=g[2*R+1];iv(B,N,t,s)<=C&&w.push(h[R]),(E===0?t-a<=B:s-a<=N)&&(_.push(z),_.push(R-1),_.push(1-E)),(E===0?t+a>=B:s+a>=N)&&(_.push(R+1),_.push(P),_.push(1-E))}return w}}function Gf(n,t,s,a,h,g){if(h-a<=s)return;const y=a+h>>1;nv(n,t,y,a,h,g),Gf(n,t,s,a,y-1,1-g),Gf(n,t,s,y+1,h,1-g)}function nv(n,t,s,a,h,g){for(;h>a;){if(h-a>600){const C=h-a+1,E=s-a+1,P=Math.log(C),z=.5*Math.exp(2*P/3),R=.5*Math.sqrt(P*z*(C-z)/C)*(E-C/2<0?-1:1);nv(n,t,s,Math.max(a,Math.floor(s-E*z/C+R)),Math.min(h,Math.floor(s+(C-E)*z/C+R)),g)}const y=t[2*s+g];let _=a,w=h;for(Sc(n,t,a,s),t[2*h+g]>y&&Sc(n,t,a,h);_<w;){for(Sc(n,t,_,w),_++,w--;t[2*_+g]<y;)_++;for(;t[2*w+g]>y;)w--}t[2*a+g]===y?Sc(n,t,a,w):(w++,Sc(n,t,w,h)),w<=s&&(a=w+1),s<=w&&(h=w-1)}}function Sc(n,t,s,a){Hf(n,s,a),Hf(t,2*s,2*a),Hf(t,2*s+1,2*a+1)}function Hf(n,t,s){const a=n[t];n[t]=n[s],n[s]=a}function iv(n,t,s,a){const h=n-s,g=t-a;return h*h+g*g}var Wf;S.bg=void 0,(Wf=S.bg||(S.bg={})).create="create",Wf.load="load",Wf.fullLoad="fullLoad";let md=null,Tc=[];const Xf=1e3/60,Kf="loadTime",Yf="fullLoadTime",Lb={mark(n){performance.mark(n)},frame(n){const t=n;md!=null&&Tc.push(t-md),md=t},clearMetrics(){md=null,Tc=[],performance.clearMeasures(Kf),performance.clearMeasures(Yf);for(const n in S.bg)performance.clearMarks(S.bg[n])},getPerformanceMetrics(){performance.measure(Kf,S.bg.create,S.bg.load),performance.measure(Yf,S.bg.create,S.bg.fullLoad);const n=performance.getEntriesByName(Kf)[0].duration,t=performance.getEntriesByName(Yf)[0].duration,s=Tc.length,a=1/(Tc.reduce((g,y)=>g+y,0)/s/1e3),h=Tc.filter(g=>g>Xf).reduce((g,y)=>g+(y-Xf)/Xf,0);return{loadTime:n,fullLoadTime:t,fps:a,percentDroppedFrames:h/(s+h)*100,totalFrames:s}}};S.$=class extends A{},S.A=Ll,S.B=sf,S.C=function(n){if(Nr==null){const t=n.navigator?n.navigator.userAgent:null;Nr=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Nr},S.D=st,S.E=ss,S.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new kb(()=>this.process()),this.subscription=function(s,a,h,g){return s.addEventListener(a,h,!1),{unsubscribe:()=>{s.removeEventListener(a,h,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=Sn(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((s,a)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:s,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const _={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const g=[],y=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Mo(n.data,g)});this.target.postMessage(y,{transfer:g})})}receive(n){const t=n.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const a=this.abortControllers[s];return delete this.abortControllers[s],void(a&&a.abort())}if(Sn(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(zo(t.error)):h.resolve(zo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=zo(t.data),a=new AbortController;this.abortControllers[n]=a;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,s,a);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}})}completeTask(n,t,s){const a=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Mo(t):null,data:Mo(s,a)};this.target.postMessage(h,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=gr,S.H=function(){var n=new Ll(16);return Ll!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},S.I=zf,S.J=function(n,t,s){var a,h,g,y,_,w,C,E,P,z,R,B,N=s[0],G=s[1],X=s[2];return t===n?(n[12]=t[0]*N+t[4]*G+t[8]*X+t[12],n[13]=t[1]*N+t[5]*G+t[9]*X+t[13],n[14]=t[2]*N+t[6]*G+t[10]*X+t[14],n[15]=t[3]*N+t[7]*G+t[11]*X+t[15]):(h=t[1],g=t[2],y=t[3],_=t[4],w=t[5],C=t[6],E=t[7],P=t[8],z=t[9],R=t[10],B=t[11],n[0]=a=t[0],n[1]=h,n[2]=g,n[3]=y,n[4]=_,n[5]=w,n[6]=C,n[7]=E,n[8]=P,n[9]=z,n[10]=R,n[11]=B,n[12]=a*N+_*G+P*X+t[12],n[13]=h*N+w*G+z*X+t[13],n[14]=g*N+C*G+R*X+t[14],n[15]=y*N+E*G+B*X+t[15]),n},S.K=function(n,t,s){var a=s[0],h=s[1],g=s[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*g,n[9]=t[9]*g,n[10]=t[10]*g,n[11]=t[11]*g,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},S.L=Oy,S.M=function(n,t){const s={};for(let a=0;a<t.length;a++){const h=t[a];h in n&&(s[h]=n[h])}return s},S.N=qo,S.O=D_,S.P=Q,S.Q=L_,S.R=Ai,S.S=Mi,S.T=Tl,S.U=oe,S.V=ie,S.W=_t,S.X=Br,S.Y=v,S.Z=wc,S._=d,S.a=jr,S.a$=function(n,t){var s=n[0],a=n[1],h=n[2],g=n[3],y=n[4],_=n[5],w=n[6],C=n[7],E=n[8],P=n[9],z=n[10],R=n[11],B=n[12],N=n[13],G=n[14],X=n[15],pe=t[0],re=t[1],ce=t[2],xe=t[3],Ie=t[4],We=t[5],mt=t[6],Ze=t[7],Ue=t[8],ut=t[9],nt=t[10],Je=t[11],be=t[12],ct=t[13],at=t[14],wt=t[15];return Math.abs(s-pe)<=jn*Math.max(1,Math.abs(s),Math.abs(pe))&&Math.abs(a-re)<=jn*Math.max(1,Math.abs(a),Math.abs(re))&&Math.abs(h-ce)<=jn*Math.max(1,Math.abs(h),Math.abs(ce))&&Math.abs(g-xe)<=jn*Math.max(1,Math.abs(g),Math.abs(xe))&&Math.abs(y-Ie)<=jn*Math.max(1,Math.abs(y),Math.abs(Ie))&&Math.abs(_-We)<=jn*Math.max(1,Math.abs(_),Math.abs(We))&&Math.abs(w-mt)<=jn*Math.max(1,Math.abs(w),Math.abs(mt))&&Math.abs(C-Ze)<=jn*Math.max(1,Math.abs(C),Math.abs(Ze))&&Math.abs(E-Ue)<=jn*Math.max(1,Math.abs(E),Math.abs(Ue))&&Math.abs(P-ut)<=jn*Math.max(1,Math.abs(P),Math.abs(ut))&&Math.abs(z-nt)<=jn*Math.max(1,Math.abs(z),Math.abs(nt))&&Math.abs(R-Je)<=jn*Math.max(1,Math.abs(R),Math.abs(Je))&&Math.abs(B-be)<=jn*Math.max(1,Math.abs(B),Math.abs(be))&&Math.abs(N-ct)<=jn*Math.max(1,Math.abs(N),Math.abs(ct))&&Math.abs(G-at)<=jn*Math.max(1,Math.abs(G),Math.abs(at))&&Math.abs(X-wt)<=jn*Math.max(1,Math.abs(X),Math.abs(wt))},S.a0=Ft,S.a1=Uf,S.a2=Ae,S.a3=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const a of n){const h=window.document.createElement("source");Rn(a)||(t.crossOrigin="Anonymous"),h.src=a,t.appendChild(h)}})},S.a4=function(){return Le++},S.a5=He,S.a6=jl,S.a7=Vu,S.a8=Ba,S.a9=j_,S.aA=function(n){if(n.type==="custom")return new Tb(n);switch(n.type){case"background":return new wb(n);case"circle":return new l1(n);case"fill":return new k1(n);case"fill-extrusion":return new j1(n);case"heatmap":return new c1(n);case"hillshade":return new d1(n);case"line":return new W1(n);case"raster":return new Sb(n);case"symbol":return new cd(n)}},S.aB=Ye,S.aC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Mt(n.version,t.version))return[{command:"setStyle",args:[t]}];Mt(n.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Mt(n.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Mt(n.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Mt(n.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Mt(n.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Mt(n.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Mt(n.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Mt(n.light,t.light)||s.push({command:"setLight",args:[t.light]}),Mt(n.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Mt(n.sky,t.sky)||s.push({command:"setSky",args:[t.sky]}),Mt(n.projection,t.projection)||s.push({command:"setProjection",args:[t.projection]});const a={},h=[];(function(y,_,w,C){let E;for(E in _=_||{},y=y||{})Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(_,E)||Xn(E,w,C));for(E in _)Object.prototype.hasOwnProperty.call(_,E)&&(Object.prototype.hasOwnProperty.call(y,E)?Mt(y[E],_[E])||(y[E].type==="geojson"&&_[E].type==="geojson"&&$i(y,_,E)?rr(w,{command:"setGeoJSONSourceData",args:[E,_[E].data]}):Tn(E,_,w,C)):Ui(E,_,w))})(n.sources,t.sources,h,a);const g=[];n.layers&&n.layers.forEach(y=>{"source"in y&&a[y.source]?s.push({command:"removeLayer",args:[y.id]}):g.push(y)}),s=s.concat(h),function(y,_,w){_=_||[];const C=(y=y||[]).map(as),E=_.map(as),P=y.reduce(Es,{}),z=_.reduce(Es,{}),R=C.slice(),B=Object.create(null);let N,G,X,pe,re;for(let ce=0,xe=0;ce<C.length;ce++)N=C[ce],Object.prototype.hasOwnProperty.call(z,N)?xe++:(rr(w,{command:"removeLayer",args:[N]}),R.splice(R.indexOf(N,xe),1));for(let ce=0,xe=0;ce<E.length;ce++)N=E[E.length-1-ce],R[R.length-1-ce]!==N&&(Object.prototype.hasOwnProperty.call(P,N)?(rr(w,{command:"removeLayer",args:[N]}),R.splice(R.lastIndexOf(N,R.length-xe),1)):xe++,pe=R[R.length-ce],rr(w,{command:"addLayer",args:[z[N],pe]}),R.splice(R.length-ce,0,N),B[N]=!0);for(let ce=0;ce<E.length;ce++)if(N=E[ce],G=P[N],X=z[N],!B[N]&&!Mt(G,X))if(Mt(G.source,X.source)&&Mt(G["source-layer"],X["source-layer"])&&Mt(G.type,X.type)){for(re in cn(G.layout,X.layout,w,N,null,"setLayoutProperty"),cn(G.paint,X.paint,w,N,null,"setPaintProperty"),Mt(G.filter,X.filter)||rr(w,{command:"setFilter",args:[N,X.filter]}),Mt(G.minzoom,X.minzoom)&&Mt(G.maxzoom,X.maxzoom)||rr(w,{command:"setLayerZoomRange",args:[N,X.minzoom,X.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?cn(G[re],X[re],w,N,re.slice(6),"setPaintProperty"):Mt(G[re],X[re])||rr(w,{command:"setLayerProperty",args:[N,re,X[re]]}));for(re in X)Object.prototype.hasOwnProperty.call(X,re)&&!Object.prototype.hasOwnProperty.call(G,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?cn(G[re],X[re],w,N,re.slice(6),"setPaintProperty"):Mt(G[re],X[re])||rr(w,{command:"setLayerProperty",args:[N,re,X[re]]}))}else rr(w,{command:"removeLayer",args:[N]}),pe=R[R.lastIndexOf(N)+1],rr(w,{command:"addLayer",args:[X,pe]})}(g,t.layers,s)}catch(a){console.warn("Unable to compute style diff:",a),s=[{command:"setStyle",args:[t]}]}return s},S.aD=function(n){const t=[],s=n.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},S.aE=function n(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let a=0;a<t.length;a++)if(!n(t[a],s[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const a in t)if(!n(t[a],s[a]))return!1;return!0}return t===s},S.aF=it,S.aG=Ge,S.aH=class extends La{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},S.aI=Yh,S.aJ=class extends La{constructor(n,t){super(n,t),this.current=e1}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},S.aK=Ey,S.aL=Iy,S.aM=Gt,S.aN=class extends La{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},S.aO=class extends La{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},S.aP=function(n,t,s,a,h,g,y){var _=1/(t-s),w=1/(a-h),C=1/(g-y);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*C,n[11]=0,n[12]=(t+s)*_,n[13]=(h+a)*w,n[14]=(y+g)*C,n[15]=1,n},S.aQ=a1,S.aR=class extends ae{},S.aS=J1,S.aT=class extends fe{},S.aU=xf,S.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},S.aW=$y,S.aX=mn,S.aY=Pi,S.aZ=class extends ot{},S.a_=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},S.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,a,h,g)=>{const y=h||g;return t[a]=!y||y.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},S.ab=function(n,t){const s=[];for(const a in n)a in t||s.push(a);return s},S.ac=qe,S.ad=function(n,t,s){var a=Math.sin(s),h=Math.cos(s),g=t[0],y=t[1],_=t[2],w=t[3],C=t[4],E=t[5],P=t[6],z=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=g*h+C*a,n[1]=y*h+E*a,n[2]=_*h+P*a,n[3]=w*h+z*a,n[4]=C*h-g*a,n[5]=E*h-y*a,n[6]=P*h-_*a,n[7]=z*h-w*a,n},S.ae=function(n){var t=new Ll(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},S.af=td,S.ag=function(n,t){let s=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:y}=n,_=h?qe(Hr.interpolationFactor(h,t,g,y),0,1):0;n.kind==="camera"?a=Gr.number(n.minSize,n.maxSize,_):s=_}return{uSizeT:s,uSize:a}},S.ai=function(n,{uSize:t,uSizeT:s},{lowerSize:a,upperSize:h}){return n.kind==="source"?a/Ds:n.kind==="composite"?Gr.number(a/Ds,h/Ds,s):t},S.aj=Ff,S.ak=function(n,t,s,a){const h=t.y-n.y,g=t.x-n.x,y=a.y-s.y,_=a.x-s.x,w=y*g-_*h;if(w===0)return null;const C=(_*(n.y-s.y)-y*(n.x-s.x))/w;return new Q(n.x+C*g,n.y+C*h)},S.al=q_,S.am=zy,S.an=yf,S.ao=function(n){let t=1/0,s=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),s=Math.min(s,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return[t,s,a,h]},S.ap=$r,S.ar=Rf,S.as=function(n,t){var s=t[0],a=t[1],h=t[2],g=t[3],y=t[4],_=t[5],w=t[6],C=t[7],E=t[8],P=t[9],z=t[10],R=t[11],B=t[12],N=t[13],G=t[14],X=t[15],pe=s*_-a*y,re=s*w-h*y,ce=s*C-g*y,xe=a*w-h*_,Ie=a*C-g*_,We=h*C-g*w,mt=E*N-P*B,Ze=E*G-z*B,Ue=E*X-R*B,ut=P*G-z*N,nt=P*X-R*N,Je=z*X-R*G,be=pe*Je-re*nt+ce*ut+xe*Ue-Ie*Ze+We*mt;return be?(n[0]=(_*Je-w*nt+C*ut)*(be=1/be),n[1]=(h*nt-a*Je-g*ut)*be,n[2]=(N*We-G*Ie+X*xe)*be,n[3]=(z*Ie-P*We-R*xe)*be,n[4]=(w*Ue-y*Je-C*Ze)*be,n[5]=(s*Je-h*Ue+g*Ze)*be,n[6]=(G*ce-B*We-X*re)*be,n[7]=(E*We-z*ce+R*re)*be,n[8]=(y*nt-_*Ue+C*mt)*be,n[9]=(a*Ue-s*nt-g*mt)*be,n[10]=(B*Ie-N*ce+X*pe)*be,n[11]=(P*ce-E*Ie-R*pe)*be,n[12]=(_*Ze-y*ut-w*mt)*be,n[13]=(s*ut-a*Ze+h*mt)*be,n[14]=(N*re-B*xe-G*pe)*be,n[15]=(E*xe-P*re+z*pe)*be,n):null},S.at=qf,S.au=Lf,S.av=Zf,S.aw=function(){const n={},t=ye.$version;for(const s in ye.$root){const a=ye.$root[s];if(a.required){let h=null;h=s==="version"?t:a.type==="array"?[]:{},h!=null&&(n[s]=h)}}return n},S.ax=tc,S.ay=Zr,S.az=function(n){n=n.slice();const t=Object.create(null);for(let s=0;s<n.length;s++)t[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=os(n[s],t[n[s].ref]));return n},S.b=an,S.b0=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},S.b1=function(n,t,s){return n[0]=t[0]*s[0],n[1]=t[1]*s[1],n[2]=t[2]*s[2],n[3]=t[3]*s[3],n},S.b2=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},S.b3=Qe,S.b4=B_,S.b5=R_,S.b6=function(n,t,s,a,h){var g,y=1/Math.tan(t/2);return n[0]=y/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+a)*(g=1/(a-h)),n[14]=2*h*a*g):(n[10]=-1,n[14]=-2*a),n},S.b7=function(n,t,s){var a=Math.sin(s),h=Math.cos(s),g=t[4],y=t[5],_=t[6],w=t[7],C=t[8],E=t[9],P=t[10],z=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=g*h+C*a,n[5]=y*h+E*a,n[6]=_*h+P*a,n[7]=w*h+z*a,n[8]=C*h-g*a,n[9]=E*h-y*a,n[10]=P*h-_*a,n[11]=z*h-w*a,n},S.b8=de,S.b9=Pe,S.bA=u_,S.bB=function(n){return n.message===qt},S.bC=ko,S.bD=Qn,S.ba=function(n){return n*Math.PI/180},S.bb=function(n,t){const{x:s,y:a}=wc.fromLngLat(t);return!(n<0||n>25||a<0||a>=1||s<0||s>=1)},S.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},S.bd=class extends I{},S.be=jf,S.bf=Lb,S.bh=vr,S.bi=function(n,t){jr.REGISTERED_PROTOCOLS[n]=t},S.bj=function(n){delete jr.REGISTERED_PROTOCOLS[n]},S.bk=function(n,t){const s={};for(let h=0;h<n.length;h++){const g=t&&t[n[h].id]||Nh(n[h]);t&&(t[n[h].id]=g);let y=s[g];y||(y=s[g]=[]),y.push(n[h])}const a=[];for(const h in s)a.push(s[h]);return a},S.bl=tt,S.bm=N_,S.bn=V_,S.bo=__,S.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Br/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],s=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new ur(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new ur(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new ur(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:E}=n.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new ur(C),n.canonical),a["text-size"].possiblyEvaluate(new ur(E),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:E}=n.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new ur(C),n.canonical),a["icon-size"].possiblyEvaluate(new ur(E),n.canonical)]}const g=s.get("text-line-height")*$r,y=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",_=s.get("text-keep-upright"),w=s.get("text-size");for(const C of n.bucket.features){const E=s.get("text-font").evaluate(C,{},n.canonical).join(","),P=w.evaluate(C,{},n.canonical),z=h.layoutTextSize.evaluate(C,{},n.canonical),R=h.layoutIconSize.evaluate(C,{},n.canonical),B={horizontal:{},vertical:void 0},N=C.text;let G,X=[0,0];if(N){const ce=N.toString(),xe=s.get("text-letter-spacing").evaluate(C,{},n.canonical)*$r,Ie=of(ce)?xe:0,We=s.get("text-anchor").evaluate(C,{},n.canonical),mt=Q_(t,C,n.canonical);if(!mt){const nt=s.get("text-radial-offset").evaluate(C,{},n.canonical);X=nt?J_(We,[nt*$r,$f]):s.get("text-offset").evaluate(C,{},n.canonical).map(Je=>Je*$r)}let Ze=y?"center":s.get("text-justify").evaluate(C,{},n.canonical);const Ue=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(C,{},n.canonical)*$r:1/0,ut=()=>{n.bucket.allowVerticalPlacement&&rc(ce)&&(B.vertical=ad(N,n.glyphMap,n.glyphPositions,n.imagePositions,E,Ue,g,We,"left",Ie,X,S.ah.vertical,!0,z,P))};if(!y&&mt){const nt=new Set;if(Ze==="auto")for(let be=0;be<mt.values.length;be+=2)nt.add(qf(mt.values[be]));else nt.add(Ze);let Je=!1;for(const be of nt)if(!B.horizontal[be])if(Je)B.horizontal[be]=B.horizontal[0];else{const ct=ad(N,n.glyphMap,n.glyphPositions,n.imagePositions,E,Ue,g,"center",be,Ie,X,S.ah.horizontal,!1,z,P);ct&&(B.horizontal[be]=ct,Je=ct.positionedLines.length===1)}ut()}else{Ze==="auto"&&(Ze=qf(We));const nt=ad(N,n.glyphMap,n.glyphPositions,n.imagePositions,E,Ue,g,We,Ze,Ie,X,S.ah.horizontal,!1,z,P);nt&&(B.horizontal[Ze]=nt),ut(),rc(ce)&&y&&_&&(B.vertical=ad(N,n.glyphMap,n.glyphPositions,n.imagePositions,E,Ue,g,We,Ze,Ie,X,S.ah.vertical,!1,z,P))}}let pe=!1;if(C.icon&&C.icon.name){const ce=n.imageMap[C.icon.name];ce&&(G=gb(n.imagePositions[C.icon.name],s.get("icon-offset").evaluate(C,{},n.canonical),s.get("icon-anchor").evaluate(C,{},n.canonical)),pe=!!ce.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=pe:n.bucket.sdfIcons!==pe&&Vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==n.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const re=tv(B.horizontal)||B.vertical;n.bucket.iconsInText=!!re&&re.iconsInText,(re||G)&&zb(n.bucket,C,B,G,n.imageMap,h,z,R,X,pe,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},S.bq=If,S.br=kf,S.bs=Ef,S.bt=Vo,S.bu=Af,S.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},S.bw=function(n,t,s,a,h){return d(this,void 0,void 0,function*(){if(ie())try{return yield _t(n,t,s,a,h)}catch{}return function(g,y,_,w,C){const E=g.width,P=g.height;yt&&Dt||(yt=new OffscreenCanvas(E,P),Dt=yt.getContext("2d",{willReadFrequently:!0})),yt.width=E,yt.height=P,Dt.drawImage(g,0,0,E,P);const z=Dt.getImageData(y,_,w,C);return Dt.clearRect(0,0,E,P),z.data}(n,t,s,a,h)})},S.bx=O_,S.by=$,S.bz=ne,S.c=ln,S.d=n=>d(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=Xe,S.f=n=>new Promise((t,s)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=et})},a.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});a.src=n.byteLength?URL.createObjectURL(h):et}),S.g=un,S.h=(n,t)=>ai(Xe(n,{type:"json"}),t),S.i=Sn,S.j=Si,S.k=Vi,S.l=(n,t)=>ai(Xe(n,{type:"arrayBuffer"}),t),S.m=ai,S.n=function(n){return new Af(n).readFields(ub,[])},S.o=hc,S.p=y_,S.q=m,S.r=nf,S.s=Rn,S.t=Qu,S.u=Qs,S.v=ye,S.w=Vt,S.x=function([n,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(s),y:n*Math.sin(t)*Math.sin(s),z:n*Math.cos(s)}},S.y=Gr,S.z=ur}),x("worker",["./shared"],function(S){class d{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const q of L){this._layerConfigs[q.id]=q;const te=this._layers[q.id]=S.aA(q);te._featureFilter=S.a7(te.filter),this.keyCache[q.id]&&delete this.keyCache[q.id]}for(const q of D)delete this.keyCache[q],delete this._layerConfigs[q],delete this._layers[q];this.familiesBySource={};const O=S.bk(Object.values(this._layerConfigs),this.keyCache);for(const q of O){const te=q.map(_e=>this._layers[_e.id]),le=te[0];if(le.visibility==="none")continue;const he=le.source||"";let J=this.familiesBySource[he];J||(J=this.familiesBySource[he]={});const ve=le.sourceLayer||"_geojsonTileLayer";let ke=J[ve];ke||(ke=J[ve]=[]),ke.push(te)}}}class ${constructor(L){const D={},O=[];for(const he in L){const J=L[he],ve=D[he]={};for(const ke in J){const _e=J[+ke];if(!_e||_e.bitmap.width===0||_e.bitmap.height===0)continue;const Fe={x:0,y:0,w:_e.bitmap.width+2,h:_e.bitmap.height+2};O.push(Fe),ve[ke]={rect:Fe,metrics:_e.metrics}}}const{w:q,h:te}=S.p(O),le=new S.o({width:q||1,height:te||1});for(const he in L){const J=L[he];for(const ve in J){const ke=J[+ve];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;const _e=D[he][ve].rect;S.o.copy(ke.bitmap,le,{x:0,y:0},{x:_e.x+1,y:_e.y+1},ke.bitmap)}}this.image=le,this.positions=D}}S.bl("GlyphAtlas",$);class ne{constructor(L){this.tileID=new S.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,O,q){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new S.a5;const te=new S.bm(Object.keys(L.layers).sort()),le=new S.bn(this.tileID,this.promoteId);le.bucketLayerIDs=[];const he={},J={featureIndex:le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O},ve=D.familiesBySource[this.source];for(const Et in ve){const Zt=L.layers[Et];if(!Zt)continue;Zt.version===1&&S.w(`Vector tile source "${this.source}" layer "${Et}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const nr=te.encode(Et),Fr=[];for(let Vr=0;Vr<Zt.length;Vr++){const en=Zt.feature(Vr),Is=le.getId(en,Et);Fr.push({feature:en,id:Is,index:Vr,sourceLayerIndex:nr})}for(const Vr of ve[Et]){const en=Vr[0];en.source!==this.source&&S.w(`layer.source = ${en.source} does not equal this.source = ${this.source}`),en.minzoom&&this.zoom<Math.floor(en.minzoom)||en.maxzoom&&this.zoom>=en.maxzoom||en.visibility!=="none"&&(ge(Vr,this.zoom,O),(he[en.id]=en.createBucket({index:le.bucketLayerIDs.length,layers:Vr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nr,sourceID:this.source})).populate(Fr,J,this.tileID.canonical),le.bucketLayerIDs.push(Vr.map(Is=>Is.id)))}}const ke=S.aF(J.glyphDependencies,Et=>Object.keys(Et).map(Number));this.inFlightDependencies.forEach(Et=>Et==null?void 0:Et.abort()),this.inFlightDependencies=[];let _e=Promise.resolve({});if(Object.keys(ke).length){const Et=new AbortController;this.inFlightDependencies.push(Et),_e=q.sendAsync({type:"GG",data:{stacks:ke,source:this.source,tileID:this.tileID,type:"glyphs"}},Et)}const Fe=Object.keys(J.iconDependencies);let De=Promise.resolve({});if(Fe.length){const Et=new AbortController;this.inFlightDependencies.push(Et),De=q.sendAsync({type:"GI",data:{icons:Fe,source:this.source,tileID:this.tileID,type:"icons"}},Et)}const ht=Object.keys(J.patternDependencies);let Ot=Promise.resolve({});if(ht.length){const Et=new AbortController;this.inFlightDependencies.push(Et),Ot=q.sendAsync({type:"GI",data:{icons:ht,source:this.source,tileID:this.tileID,type:"patterns"}},Et)}const[St,Lt,Pt]=yield Promise.all([_e,De,Ot]),xr=new $(St),fr=new S.bo(Lt,Pt);for(const Et in he){const Zt=he[Et];Zt instanceof S.a6?(ge(Zt.layers,this.zoom,O),S.bp({bucket:Zt,glyphMap:St,glyphPositions:xr.positions,imageMap:Lt,imagePositions:fr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Zt.hasPattern&&(Zt instanceof S.bq||Zt instanceof S.br||Zt instanceof S.bs)&&(ge(Zt.layers,this.zoom,O),Zt.addFeatures(J,this.tileID.canonical,fr.patternPositions))}return this.status="done",{buckets:Object.values(he).filter(Et=>!Et.isEmpty()),featureIndex:le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xr.image,imageAtlas:fr,glyphMap:this.returnDependencies?St:null,iconMap:this.returnDependencies?Lt:null,glyphPositions:this.returnDependencies?xr.positions:null}})}}function ge(W,L,D){const O=new S.z(L);for(const q of W)q.recalculate(O,D)}class Q{constructor(L,D,O){this.actor=L,this.layerIndex=D,this.availableImages=O,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const O=yield S.l(L.request,D);try{return{vectorTile:new S.bt.VectorTile(new S.bu(O.data)),rawData:O.data,cacheControl:O.cacheControl,expires:O.expires}}catch(q){const te=new Uint8Array(O.data);let le=`Unable to parse the tile at ${L.request.url}, `;throw le+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${q.message}`,new Error(le)}})}loadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid,O=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request),q=new ne(L);this.loading[D]=q;const te=new AbortController;q.abort=te;try{const le=yield this.loadVectorTile(L,te);if(delete this.loading[D],!le)return null;const he=le.rawData,J={};le.expires&&(J.expires=le.expires),le.cacheControl&&(J.cacheControl=le.cacheControl);const ve={};if(O){const _e=O.finish();_e&&(ve.resourceTiming=JSON.parse(JSON.stringify(_e)))}q.vectorTile=le.vectorTile;const ke=q.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=q,this.fetching[D]={rawTileData:he,cacheControl:J,resourceTiming:ve};try{const _e=yield ke;return S.e({rawTileData:he.slice(0)},_e,J,ve)}finally{delete this.fetching[D]}}catch(le){throw delete this.loading[D],q.status="done",this.loaded[D]=q,le}})}reloadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const O=this.loaded[D];if(O.showCollisionBoxes=L.showCollisionBoxes,O.status==="parsing"){const q=yield O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor);let te;if(this.fetching[D]){const{rawTileData:le,cacheControl:he,resourceTiming:J}=this.fetching[D];delete this.fetching[D],te=S.e({rawTileData:le.slice(0)},q,he,J)}else te=q;return te}if(O.status==="done"&&O.vectorTile)return O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return S._(this,void 0,void 0,function*(){const D=this.loading,O=L.uid;D&&D[O]&&D[O].abort&&(D[O].abort.abort(),delete D[O])})}removeTile(L){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class V{constructor(){this.loaded={}}loadTile(L){return S._(this,void 0,void 0,function*(){const{uid:D,encoding:O,rawImageData:q,redFactor:te,greenFactor:le,blueFactor:he,baseShift:J}=L,ve=q.width+2,ke=q.height+2,_e=S.b(q)?new S.R({width:ve,height:ke},yield S.bw(q,-1,-1,ve,ke)):q,Fe=new S.bx(D,_e,O,te,le,he,J);return this.loaded=this.loaded||{},this.loaded[D]=Fe,Fe})}removeTile(L){const D=this.loaded,O=L.uid;D&&D[O]&&delete D[O]}}function Ce(W,L){if(W.length!==0){Ee(W[0],L);for(var D=1;D<W.length;D++)Ee(W[D],!L)}}function Ee(W,L){for(var D=0,O=0,q=0,te=W.length,le=te-1;q<te;le=q++){var he=(W[q][0]-W[le][0])*(W[le][1]+W[q][1]),J=D+he;O+=Math.abs(D)>=Math.abs(he)?D-J+he:he-J+D,D=J}D+O>=0!=!!L&&W.reverse()}var Me=S.by(function W(L,D){var O,q=L&&L.type;if(q==="FeatureCollection")for(O=0;O<L.features.length;O++)W(L.features[O],D);else if(q==="GeometryCollection")for(O=0;O<L.geometries.length;O++)W(L.geometries[O],D);else if(q==="Feature")W(L.geometry,D);else if(q==="Polygon")Ce(L.coordinates,D);else if(q==="MultiPolygon")for(O=0;O<L.coordinates.length;O++)Ce(L.coordinates[O],D);return L});const pt=S.bt.VectorTileFeature.prototype.toGeoJSON;var oe={exports:{}},ie=S.bz,de=S.bt.VectorTileFeature,Pe=qe;function qe(W,L){this.options=L||{},this.features=W,this.length=W.length}function Qe(W,L){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=L||4096}qe.prototype.feature=function(W){return new Qe(this.features[W],this.options.extent)},Qe.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var L=0;L<W.length;L++){for(var D=W[L],O=[],q=0;q<D.length;q++)O.push(new ie(D[q][0],D[q][1]));this.geometry.push(O)}return this.geometry},Qe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,L=1/0,D=-1/0,O=1/0,q=-1/0,te=0;te<W.length;te++)for(var le=W[te],he=0;he<le.length;he++){var J=le[he];L=Math.min(L,J.x),D=Math.max(D,J.x),O=Math.min(O,J.y),q=Math.max(q,J.y)}return[L,O,D,q]},Qe.prototype.toGeoJSON=de.prototype.toGeoJSON;var Xe=S.bA,Le=Pe;function it(W){var L=new Xe;return function(D,O){for(var q in D.layers)O.writeMessage(3,Ge,D.layers[q])}(W,L),L.finish()}function Ge(W,L){var D;L.writeVarintField(15,W.version||1),L.writeStringField(1,W.name||""),L.writeVarintField(5,W.extent||4096);var O={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<W.length;D++)O.feature=W.feature(D),L.writeMessage(2,Ye,O);var q=O.keys;for(D=0;D<q.length;D++)L.writeStringField(3,q[D]);var te=O.values;for(D=0;D<te.length;D++)L.writeMessage(4,Nr,te[D])}function Ye(W,L){var D=W.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,Kt,W),L.writeVarintField(3,D.type),L.writeMessage(4,Sn,D)}function Kt(W,L){var D=W.feature,O=W.keys,q=W.values,te=W.keycache,le=W.valuecache;for(var he in D.properties){var J=D.properties[he],ve=te[he];if(J!==null){ve===void 0&&(O.push(he),te[he]=ve=O.length-1),L.writeVarint(ve);var ke=typeof J;ke!=="string"&&ke!=="boolean"&&ke!=="number"&&(J=JSON.stringify(J));var _e=ke+":"+J,Fe=le[_e];Fe===void 0&&(q.push(J),le[_e]=Fe=q.length-1),L.writeVarint(Fe)}}}function Vt(W,L){return(L<<3)+(7&W)}function Yt(W){return W<<1^W>>31}function Sn(W,L){for(var D=W.loadGeometry(),O=W.type,q=0,te=0,le=D.length,he=0;he<le;he++){var J=D[he],ve=1;O===1&&(ve=J.length),L.writeVarint(Vt(1,ve));for(var ke=O===3?J.length-1:J.length,_e=0;_e<ke;_e++){_e===1&&O!==1&&L.writeVarint(Vt(2,ke-1));var Fe=J[_e].x-q,De=J[_e].y-te;L.writeVarint(Yt(Fe)),L.writeVarint(Yt(De)),q+=Fe,te+=De}O===3&&L.writeVarint(Vt(7,1))}}function Nr(W,L){var D=typeof W;D==="string"?L.writeStringField(1,W):D==="boolean"?L.writeBooleanField(7,W):D==="number"&&(W%1!=0?L.writeDoubleField(3,W):W<0?L.writeSVarintField(6,W):L.writeVarintField(5,W))}oe.exports=it,oe.exports.fromVectorTileJs=it,oe.exports.fromGeojsonVt=function(W,L){L=L||{};var D={};for(var O in W)D[O]=new Le(W[O].features,L),D[O].name=O,D[O].version=L.version,D[O].extent=L.extent;return it({layers:D})},oe.exports.GeoJSONWrapper=Le;var an=S.by(oe.exports);const et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},_t=Math.fround||(yt=new Float32Array(1),W=>(yt[0]=+W,yt[0]));var yt;const Dt=3,qt=5,ln=6;class jr{constructor(L){this.options=Object.assign(Object.create(et),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:O,maxZoom:q}=this.options;D&&console.time("total time");const te=`prepare ${L.length} points`;D&&console.time(te),this.points=L;const le=[];for(let J=0;J<L.length;J++){const ve=L[J];if(!ve.geometry)continue;const[ke,_e]=ve.geometry.coordinates,Fe=_t(vr(ke)),De=_t(Zr(_e));le.push(Fe,De,1/0,J,-1,1),this.options.reduce&&le.push(0)}let he=this.trees[q+1]=this._createTree(le);D&&console.timeEnd(te);for(let J=q;J>=O;J--){const ve=+Date.now();he=this.trees[J]=this._createTree(this._cluster(he,J)),D&&console.log("z%d: %d clusters in %dms",J,he.numItems,+Date.now()-ve)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let O=((L[0]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,L[1]));let te=L[2]===180?180:((L[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)O=-180,te=180;else if(O>te){const _e=this.getClusters([O,q,180,le],D),Fe=this.getClusters([-180,q,te,le],D);return _e.concat(Fe)}const he=this.trees[this._limitZoom(D)],J=he.range(vr(O),Zr(le),vr(te),Zr(q)),ve=he.data,ke=[];for(const _e of J){const Fe=this.stride*_e;ke.push(ve[Fe+qt]>1?un(ve,Fe,this.clusterProps):this.points[ve[Fe+Dt]])}return ke}getChildren(L){const D=this._getOriginId(L),O=this._getOriginZoom(L),q="No cluster with the specified id.",te=this.trees[O];if(!te)throw new Error(q);const le=te.data;if(D*this.stride>=le.length)throw new Error(q);const he=this.options.radius/(this.options.extent*Math.pow(2,O-1)),J=te.within(le[D*this.stride],le[D*this.stride+1],he),ve=[];for(const ke of J){const _e=ke*this.stride;le[_e+4]===L&&ve.push(le[_e+qt]>1?un(le,_e,this.clusterProps):this.points[le[_e+Dt]])}if(ve.length===0)throw new Error(q);return ve}getLeaves(L,D,O){const q=[];return this._appendLeaves(q,L,D=D||10,O=O||0,0),q}getTile(L,D,O){const q=this.trees[this._limitZoom(L)],te=Math.pow(2,L),{extent:le,radius:he}=this.options,J=he/le,ve=(O-J)/te,ke=(O+1+J)/te,_e={features:[]};return this._addTileFeatures(q.range((D-J)/te,ve,(D+1+J)/te,ke),q.data,D,O,te,_e),D===0&&this._addTileFeatures(q.range(1-J/te,ve,1,ke),q.data,te,O,te,_e),D===te-1&&this._addTileFeatures(q.range(0,ve,J/te,ke),q.data,-1,O,te,_e),_e.features.length?_e:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const O=this.getChildren(L);if(D++,O.length!==1)break;L=O[0].properties.cluster_id}return D}_appendLeaves(L,D,O,q,te){const le=this.getChildren(D);for(const he of le){const J=he.properties;if(J&&J.cluster?te+J.point_count<=q?te+=J.point_count:te=this._appendLeaves(L,J.cluster_id,O,q,te):te<q?te++:L.push(he),L.length===O)break}return te}_createTree(L){const D=new S.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let O=0;O<L.length;O+=this.stride)D.add(L[O],L[O+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,O,q,te,le){for(const he of L){const J=he*this.stride,ve=D[J+qt]>1;let ke,_e,Fe;if(ve)ke=gr(D,J,this.clusterProps),_e=D[J],Fe=D[J+1];else{const Ot=this.points[D[J+Dt]];ke=Ot.properties;const[St,Lt]=Ot.geometry.coordinates;_e=vr(St),Fe=Zr(Lt)}const De={type:1,geometry:[[Math.round(this.options.extent*(_e*te-O)),Math.round(this.options.extent*(Fe*te-q))]],tags:ke};let ht;ht=ve||this.options.generateId?D[J+Dt]:this.points[D[J+Dt]].id,ht!==void 0&&(De.id=ht),le.features.push(De)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:O,extent:q,reduce:te,minPoints:le}=this.options,he=O/(q*Math.pow(2,D)),J=L.data,ve=[],ke=this.stride;for(let _e=0;_e<J.length;_e+=ke){if(J[_e+2]<=D)continue;J[_e+2]=D;const Fe=J[_e],De=J[_e+1],ht=L.within(J[_e],J[_e+1],he),Ot=J[_e+qt];let St=Ot;for(const Lt of ht){const Pt=Lt*ke;J[Pt+2]>D&&(St+=J[Pt+qt])}if(St>Ot&&St>=le){let Lt,Pt=Fe*Ot,xr=De*Ot,fr=-1;const Et=((_e/ke|0)<<5)+(D+1)+this.points.length;for(const Zt of ht){const nr=Zt*ke;if(J[nr+2]<=D)continue;J[nr+2]=D;const Fr=J[nr+qt];Pt+=J[nr]*Fr,xr+=J[nr+1]*Fr,J[nr+4]=Et,te&&(Lt||(Lt=this._map(J,_e,!0),fr=this.clusterProps.length,this.clusterProps.push(Lt)),te(Lt,this._map(J,nr)))}J[_e+4]=Et,ve.push(Pt/St,xr/St,1/0,Et,-1,St),te&&ve.push(fr)}else{for(let Lt=0;Lt<ke;Lt++)ve.push(J[_e+Lt]);if(St>1)for(const Lt of ht){const Pt=Lt*ke;if(!(J[Pt+2]<=D)){J[Pt+2]=D;for(let xr=0;xr<ke;xr++)ve.push(J[Pt+xr])}}}}return ve}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,O){if(L[D+qt]>1){const le=this.clusterProps[L[D+ln]];return O?Object.assign({},le):le}const q=this.points[L[D+Dt]].properties,te=this.options.map(q);return O&&te===q?Object.assign({},te):te}}function un(W,L,D){return{type:"Feature",id:W[L+Dt],properties:gr(W,L,D),geometry:{type:"Point",coordinates:[(O=W[L],360*(O-.5)),ai(W[L+1])]}};var O}function gr(W,L,D){const O=W[L+qt],q=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O,te=W[L+ln],le=te===-1?{}:Object.assign({},D[te]);return Object.assign(le,{cluster:!0,cluster_id:W[L+Dt],point_count:O,point_count_abbreviated:q})}function vr(W){return W/360+.5}function Zr(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function ai(W){const L=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Rn(W,L,D,O){let q=O;const te=L+(D-L>>1);let le,he=D-L;const J=W[L],ve=W[L+1],ke=W[D],_e=W[D+1];for(let Fe=L+3;Fe<D;Fe+=3){const De=is(W[Fe],W[Fe+1],J,ve,ke,_e);if(De>q)le=Fe,q=De;else if(De===q){const ht=Math.abs(Fe-te);ht<he&&(le=Fe,he=ht)}}q>O&&(le-L>3&&Rn(W,L,le,O),W[le+2]=q,D-le>3&&Rn(W,le,D,O))}function is(W,L,D,O,q,te){let le=q-D,he=te-O;if(le!==0||he!==0){const J=((W-D)*le+(L-O)*he)/(le*le+he*he);J>1?(D=q,O=te):J>0&&(D+=le*J,O+=he*J)}return le=W-D,he=L-O,le*le+he*he}function li(W,L,D,O){const q={id:W??null,type:L,geometry:D,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")Vi(q,D);else if(L==="Polygon")Vi(q,D[0]);else if(L==="MultiLineString")for(const te of D)Vi(q,te);else if(L==="MultiPolygon")for(const te of D)Vi(q,te[0]);return q}function Vi(W,L){for(let D=0;D<L.length;D+=3)W.minX=Math.min(W.minX,L[D]),W.minY=Math.min(W.minY,L[D+1]),W.maxX=Math.max(W.maxX,L[D]),W.maxY=Math.max(W.maxY,L[D+1])}function Si(W,L,D,O){if(!L.geometry)return;const q=L.geometry.coordinates;if(q&&q.length===0)return;const te=L.geometry.type,le=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let he=[],J=L.id;if(D.promoteId?J=L.properties[D.promoteId]:D.generateId&&(J=O||0),te==="Point")ss(q,he);else if(te==="MultiPoint")for(const ve of q)ss(ve,he);else if(te==="LineString")ye(q,he,le,!1);else if(te==="MultiLineString"){if(D.lineMetrics){for(const ve of q)he=[],ye(ve,he,le,!1),W.push(li(J,"LineString",he,L.properties));return}Ti(q,he,le,!1)}else if(te==="Polygon")Ti(q,he,le,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(const ve of L.geometry.geometries)Si(W,{id:J,geometry:ve,properties:L.properties},D,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ve of q){const ke=[];Ti(ve,ke,le,!0),he.push(ke)}}W.push(li(J,te,he,L.properties))}function ss(W,L){L.push(os(W[0]),Mt(W[1]),0)}function ye(W,L,D,O){let q,te,le=0;for(let J=0;J<W.length;J++){const ve=os(W[J][0]),ke=Mt(W[J][1]);L.push(ve,ke,0),J>0&&(le+=O?(q*ke-ve*te)/2:Math.sqrt(Math.pow(ve-q,2)+Math.pow(ke-te,2))),q=ve,te=ke}const he=L.length-3;L[2]=1,Rn(L,0,he,D),L[he+2]=1,L.size=Math.abs(le),L.start=0,L.end=L.size}function Ti(W,L,D,O){for(let q=0;q<W.length;q++){const te=[];ye(W[q],te,D,O),L.push(te)}}function os(W){return W/360+.5}function Mt(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function rr(W,L,D,O,q,te,le,he){if(O/=L,te>=(D/=L)&&le<O)return W;if(le<D||te>=O)return null;const J=[];for(const ve of W){const ke=ve.geometry;let _e=ve.type;const Fe=q===0?ve.minX:ve.minY,De=q===0?ve.maxX:ve.maxY;if(Fe>=D&&De<O){J.push(ve);continue}if(De<D||Fe>=O)continue;let ht=[];if(_e==="Point"||_e==="MultiPoint")Ui(ke,ht,D,O,q);else if(_e==="LineString")Xn(ke,ht,D,O,q,!1,he.lineMetrics);else if(_e==="MultiLineString")$i(ke,ht,D,O,q,!1);else if(_e==="Polygon")$i(ke,ht,D,O,q,!0);else if(_e==="MultiPolygon")for(const Ot of ke){const St=[];$i(Ot,St,D,O,q,!0),St.length&&ht.push(St)}if(ht.length){if(he.lineMetrics&&_e==="LineString"){for(const Ot of ht)J.push(li(ve.id,_e,Ot,ve.tags));continue}_e!=="LineString"&&_e!=="MultiLineString"||(ht.length===1?(_e="LineString",ht=ht[0]):_e="MultiLineString"),_e!=="Point"&&_e!=="MultiPoint"||(_e=ht.length===3?"Point":"MultiPoint"),J.push(li(ve.id,_e,ht,ve.tags))}}return J.length?J:null}function Ui(W,L,D,O,q){for(let te=0;te<W.length;te+=3){const le=W[te+q];le>=D&&le<=O&&cn(L,W[te],W[te+1],W[te+2])}}function Xn(W,L,D,O,q,te,le){let he=Tn(W);const J=q===0?as:Es;let ve,ke,_e=W.start;for(let St=0;St<W.length-3;St+=3){const Lt=W[St],Pt=W[St+1],xr=W[St+2],fr=W[St+3],Et=W[St+4],Zt=q===0?Lt:Pt,nr=q===0?fr:Et;let Fr=!1;le&&(ve=Math.sqrt(Math.pow(Lt-fr,2)+Math.pow(Pt-Et,2))),Zt<D?nr>D&&(ke=J(he,Lt,Pt,fr,Et,D),le&&(he.start=_e+ve*ke)):Zt>O?nr<O&&(ke=J(he,Lt,Pt,fr,Et,O),le&&(he.start=_e+ve*ke)):cn(he,Lt,Pt,xr),nr<D&&Zt>=D&&(ke=J(he,Lt,Pt,fr,Et,D),Fr=!0),nr>O&&Zt<=O&&(ke=J(he,Lt,Pt,fr,Et,O),Fr=!0),!te&&Fr&&(le&&(he.end=_e+ve*ke),L.push(he),he=Tn(W)),le&&(_e+=ve)}let Fe=W.length-3;const De=W[Fe],ht=W[Fe+1],Ot=q===0?De:ht;Ot>=D&&Ot<=O&&cn(he,De,ht,W[Fe+2]),Fe=he.length-3,te&&Fe>=3&&(he[Fe]!==he[0]||he[Fe+1]!==he[1])&&cn(he,he[0],he[1],he[2]),he.length&&L.push(he)}function Tn(W){const L=[];return L.size=W.size,L.start=W.start,L.end=W.end,L}function $i(W,L,D,O,q,te){for(const le of W)Xn(le,L,D,O,q,te,!1)}function cn(W,L,D,O){W.push(L,D,O)}function as(W,L,D,O,q,te){const le=(te-L)/(O-L);return cn(W,te,D+(q-D)*le,1),le}function Es(W,L,D,O,q,te){const le=(te-D)/(q-D);return cn(W,L+(O-L)*le,te,1),le}function Ae(W,L){const D=[];for(let O=0;O<W.length;O++){const q=W[O],te=q.type;let le;if(te==="Point"||te==="MultiPoint"||te==="LineString")le=Kn(q.geometry,L);else if(te==="MultiLineString"||te==="Polygon"){le=[];for(const he of q.geometry)le.push(Kn(he,L))}else if(te==="MultiPolygon"){le=[];for(const he of q.geometry){const J=[];for(const ve of he)J.push(Kn(ve,L));le.push(J)}}D.push(li(q.id,te,le,q.tags))}return D}function Kn(W,L){const D=[];D.size=W.size,W.start!==void 0&&(D.start=W.start,D.end=W.end);for(let O=0;O<W.length;O+=3)D.push(W[O]+L,W[O+1],W[O+2]);return D}function ar(W,L){if(W.transformed)return W;const D=1<<W.z,O=W.x,q=W.y;for(const te of W.features){const le=te.geometry,he=te.type;if(te.geometry=[],he===1)for(let J=0;J<le.length;J+=2)te.geometry.push(Pr(le[J],le[J+1],L,D,O,q));else for(let J=0;J<le.length;J++){const ve=[];for(let ke=0;ke<le[J].length;ke+=2)ve.push(Pr(le[J][ke],le[J][ke+1],L,D,O,q));te.geometry.push(ve)}}return W.transformed=!0,W}function Pr(W,L,D,O,q,te){return[Math.round(D*(W*O-q)),Math.round(D*(L*O-te))]}function ki(W,L,D,O,q){const te=L===q.maxZoom?0:q.tolerance/((1<<L)*q.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:W.length,source:null,x:D,y:O,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const he of W)Re(le,he,te,q);return le}function Re(W,L,D,O){const q=L.geometry,te=L.type,le=[];if(W.minX=Math.min(W.minX,L.minX),W.minY=Math.min(W.minY,L.minY),W.maxX=Math.max(W.maxX,L.maxX),W.maxY=Math.max(W.maxY,L.maxY),te==="Point"||te==="MultiPoint")for(let he=0;he<q.length;he+=3)le.push(q[he],q[he+1]),W.numPoints++,W.numSimplified++;else if(te==="LineString")kt(le,q,W,D,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(let he=0;he<q.length;he++)kt(le,q[he],W,D,te==="Polygon",he===0);else if(te==="MultiPolygon")for(let he=0;he<q.length;he++){const J=q[he];for(let ve=0;ve<J.length;ve++)kt(le,J[ve],W,D,!0,ve===0)}if(le.length){let he=L.tags||null;if(te==="LineString"&&O.lineMetrics){he={};for(const ve in L.tags)he[ve]=L.tags[ve];he.mapbox_clip_start=q.start/q.size,he.mapbox_clip_end=q.end/q.size}const J={geometry:le,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:he};L.id!==null&&(J.id=L.id),W.features.push(J)}}function kt(W,L,D,O,q,te){const le=O*O;if(O>0&&L.size<(q?le:O))return void(D.numPoints+=L.length/3);const he=[];for(let J=0;J<L.length;J+=3)(O===0||L[J+2]>le)&&(D.numSimplified++,he.push(L[J],L[J+1])),D.numPoints++;q&&function(J,ve){let ke=0;for(let _e=0,Fe=J.length,De=Fe-2;_e<Fe;De=_e,_e+=2)ke+=(J[_e]-J[De])*(J[_e+1]+J[De+1]);if(ke>0===ve)for(let _e=0,Fe=J.length;_e<Fe/2;_e+=2){const De=J[_e],ht=J[_e+1];J[_e]=J[Fe-2-_e],J[_e+1]=J[Fe-1-_e],J[Fe-2-_e]=De,J[Fe-1-_e]=ht}}(he,te),W.push(he)}const ft={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ar{constructor(L,D){const O=(D=this.options=function(te,le){for(const he in le)te[he]=le[he];return te}(Object.create(ft),D)).debug;if(O&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let q=function(te,le){const he=[];if(te.type==="FeatureCollection")for(let J=0;J<te.features.length;J++)Si(he,te.features[J],le,J);else Si(he,te.type==="Feature"?te:{geometry:te},le);return he}(L,D);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(te,le){const he=le.buffer/le.extent;let J=te;const ve=rr(te,1,-1-he,he,0,-1,2,le),ke=rr(te,1,1-he,2+he,0,-1,2,le);return(ve||ke)&&(J=rr(te,1,-he,1+he,0,-1,2,le)||[],ve&&(J=Ae(ve,1).concat(J)),ke&&(J=J.concat(Ae(ke,-1)))),J}(q,D),q.length&&this.splitTile(q,0,0,0),O&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,O,q,te,le,he){const J=[L,D,O,q],ve=this.options,ke=ve.debug;for(;J.length;){q=J.pop(),O=J.pop(),D=J.pop(),L=J.pop();const _e=1<<D,Fe=yr(D,O,q);let De=this.tiles[Fe];if(!De&&(ke>1&&console.time("creation"),De=this.tiles[Fe]=ki(L,D,O,q,ve),this.tileCoords.push({z:D,x:O,y:q}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,O,q,De.numFeatures,De.numPoints,De.numSimplified),console.timeEnd("creation"));const Fr=`z${D}`;this.stats[Fr]=(this.stats[Fr]||0)+1,this.total++}if(De.source=L,te==null){if(D===ve.indexMaxZoom||De.numPoints<=ve.indexMaxPoints)continue}else{if(D===ve.maxZoom||D===te)continue;if(te!=null){const Fr=te-D;if(O!==le>>Fr||q!==he>>Fr)continue}}if(De.source=null,L.length===0)continue;ke>1&&console.time("clipping");const ht=.5*ve.buffer/ve.extent,Ot=.5-ht,St=.5+ht,Lt=1+ht;let Pt=null,xr=null,fr=null,Et=null,Zt=rr(L,_e,O-ht,O+St,0,De.minX,De.maxX,ve),nr=rr(L,_e,O+Ot,O+Lt,0,De.minX,De.maxX,ve);L=null,Zt&&(Pt=rr(Zt,_e,q-ht,q+St,1,De.minY,De.maxY,ve),xr=rr(Zt,_e,q+Ot,q+Lt,1,De.minY,De.maxY,ve),Zt=null),nr&&(fr=rr(nr,_e,q-ht,q+St,1,De.minY,De.maxY,ve),Et=rr(nr,_e,q+Ot,q+Lt,1,De.minY,De.maxY,ve),nr=null),ke>1&&console.timeEnd("clipping"),J.push(Pt||[],D+1,2*O,2*q),J.push(xr||[],D+1,2*O,2*q+1),J.push(fr||[],D+1,2*O+1,2*q),J.push(Et||[],D+1,2*O+1,2*q+1)}}getTile(L,D,O){L=+L,D=+D,O=+O;const q=this.options,{extent:te,debug:le}=q;if(L<0||L>24)return null;const he=1<<L,J=yr(L,D=D+he&he-1,O);if(this.tiles[J])return ar(this.tiles[J],te);le>1&&console.log("drilling down to z%d-%d-%d",L,D,O);let ve,ke=L,_e=D,Fe=O;for(;!ve&&ke>0;)ke--,_e>>=1,Fe>>=1,ve=this.tiles[yr(ke,_e,Fe)];return ve&&ve.source?(le>1&&(console.log("found parent tile z%d-%d-%d",ke,_e,Fe),console.time("drilling down")),this.splitTile(ve.source,ke,_e,Fe,L,D,O),le>1&&console.timeEnd("drilling down"),this.tiles[J]?ar(this.tiles[J],te):null):null}}function yr(W,L,D){return 32*((1<<W)*D+L)+W}function vt(W,L){return L?W.properties[L]:W.id}function ui(W,L){if(W==null)return!0;if(W.type==="Feature")return vt(W,L)!=null;if(W.type==="FeatureCollection"){const D=new Set;for(const O of W.features){const q=vt(O,L);if(q==null||D.has(q))return!1;D.add(q)}return!0}return!1}function Yn(W,L){const D=new Map;if(W!=null)if(W.type==="Feature")D.set(vt(W,L),W);else for(const O of W.features)D.set(vt(O,L),O);return D}class ci extends Q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const O=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const q=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!q)return null;const te=new class{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=he.length,this._features=he}feature(he){return new class{constructor(J){this._feature=J,this.extent=S.X,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ve of this._feature.geometry)J.push([new S.P(ve[0],ve[1])]);return J}{const J=[];for(const ve of this._feature.geometry){const ke=[];for(const _e of ve)ke.push(new S.P(_e[0],_e[1]));J.push(ke)}return J}}toGeoJSON(J,ve,ke){return pt.call(this,J,ve,ke)}}(this._features[he])}}(q.features);let le=an(te);return le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),{vectorTile:te,rawData:le.buffer}})}loadData(L){return S._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const O=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new jr(function({superclusterOptions:le,clusterProperties:he}){if(!he||!le)return le;const J={},ve={},ke={accumulated:null,zoom:0},_e={properties:null},Fe=Object.keys(he);for(const De of Fe){const[ht,Ot]=he[De],St=S.bC(Ot),Lt=S.bC(typeof ht=="string"?[ht,["accumulated"],["get",De]]:ht);J[De]=St.value,ve[De]=Lt.value}return le.map=De=>{_e.properties=De;const ht={};for(const Ot of Fe)ht[Ot]=J[Ot].evaluate(ke,_e);return ht},le.reduce=(De,ht)=>{_e.properties=ht;for(const Ot of Fe)ke.accumulated=De[Ot],De[Ot]=ve[Ot].evaluate(ke,_e)},le}(L)).load((yield this._pendingData).features):(q=yield this._pendingData,new Ar(q,L.geojsonVtOptions)),this.loaded={};const te={};if(O){const le=O.finish();le&&(te.resourceTiming={},te.resourceTiming[L.source]=JSON.parse(JSON.stringify(le)))}return te}catch(te){if(delete this._pendingRequest,S.bB(te))return{abandoned:!0};throw te}var q})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return S._(this,void 0,void 0,function*(){let O=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof O!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(Me(O,!0),L.filter){const q=S.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(q.result==="error")throw new Error(q.value.map(le=>`${le.key}: ${le.message}`).join(", "));O={type:"FeatureCollection",features:O.features.filter(le=>q.value.evaluate({zoom:0},le))}}return O})}loadGeoJSON(L,D){return S._(this,void 0,void 0,function*(){const{promoteId:O}=L;if(L.request){const q=yield S.h(L.request,D);return this._dataUpdateable=ui(q.data,O)?Yn(q.data,O):void 0,q.data}if(typeof L.data=="string")try{const q=JSON.parse(L.data);return this._dataUpdateable=ui(q,O)?Yn(q,O):void 0,q}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(q,te,le){var he,J,ve,ke;if(te.removeAll&&q.clear(),te.remove)for(const _e of te.remove)q.delete(_e);if(te.add)for(const _e of te.add){const Fe=vt(_e,le);Fe!=null&&q.set(Fe,_e)}if(te.update)for(const _e of te.update){let Fe=q.get(_e.id);if(Fe==null)continue;const De=!_e.removeAllProperties&&(((he=_e.removeProperties)===null||he===void 0?void 0:he.length)>0||((J=_e.addOrUpdateProperties)===null||J===void 0?void 0:J.length)>0);if((_e.newGeometry||_e.removeAllProperties||De)&&(Fe=Object.assign({},Fe),q.set(_e.id,Fe),De&&(Fe.properties=Object.assign({},Fe.properties))),_e.newGeometry&&(Fe.geometry=_e.newGeometry),_e.removeAllProperties)Fe.properties={};else if(((ve=_e.removeProperties)===null||ve===void 0?void 0:ve.length)>0)for(const ht of _e.removeProperties)Object.prototype.hasOwnProperty.call(Fe.properties,ht)&&delete Fe.properties[ht];if(((ke=_e.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0)for(const{key:ht,value:Ot}of _e.addOrUpdateProperties)Fe.properties[ht]=Ot}}(this._dataUpdateable,L.dataDiff,O),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class hn{constructor(L){this.self=L,this.actor=new S.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,O)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=O},this.self.addProtocol=S.bi,this.self.removeProtocol=S.bj,this.self.registerRTLTextPlugin=D=>{if(S.bD.isParsed())throw new Error("RTL text plugin already registered.");S.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,O)=>this._getDEMWorkerSource(D,O.source).loadTile(O)),this.actor.registerMessageHandler("RDT",(D,O)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,O.source).removeTile(O)})),this.actor.registerMessageHandler("GCEZ",(D,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,O.type,O.source).getClusterExpansionZoom(O)})),this.actor.registerMessageHandler("GCC",(D,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,O.type,O.source).getClusterChildren(O)})),this.actor.registerMessageHandler("GCL",(D,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,O.type,O.source).getClusterLeaves(O)})),this.actor.registerMessageHandler("LD",(D,O)=>this._getWorkerSource(D,O.type,O.source).loadData(O)),this.actor.registerMessageHandler("GD",(D,O)=>this._getWorkerSource(D,O.type,O.source).getData()),this.actor.registerMessageHandler("LT",(D,O)=>this._getWorkerSource(D,O.type,O.source).loadTile(O)),this.actor.registerMessageHandler("RT",(D,O)=>this._getWorkerSource(D,O.type,O.source).reloadTile(O)),this.actor.registerMessageHandler("AT",(D,O)=>this._getWorkerSource(D,O.type,O.source).abortTile(O)),this.actor.registerMessageHandler("RMT",(D,O)=>this._getWorkerSource(D,O.type,O.source).removeTile(O)),this.actor.registerMessageHandler("RS",(D,O)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][O.type]||!this.workerSources[D][O.type][O.source])return;const q=this.workerSources[D][O.type][O.source];delete this.workerSources[D][O.type][O.source],q.removeSource!==void 0&&q.removeSource(O)})),this.actor.registerMessageHandler("RM",D=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,O)=>S._(this,void 0,void 0,function*(){this.referrer=O})),this.actor.registerMessageHandler("SRPS",(D,O)=>this._syncRTLPluginState(D,O)),this.actor.registerMessageHandler("IS",(D,O)=>S._(this,void 0,void 0,function*(){this.self.importScripts(O)})),this.actor.registerMessageHandler("SI",(D,O)=>this._setImages(D,O)),this.actor.registerMessageHandler("UL",(D,O)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(O.layers,O.removedIds)})),this.actor.registerMessageHandler("SL",(D,O)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(O)}))}_setImages(L,D){return S._(this,void 0,void 0,function*(){this.availableImages[L]=D;for(const O in this.workerSources[L]){const q=this.workerSources[L][O];for(const te in q)q[te].availableImages=D}})}_syncRTLPluginState(L,D){return S._(this,void 0,void 0,function*(){if(S.bD.isParsed())return S.bD.getState();if(D.pluginStatus!=="loading")return S.bD.setState(D),D;const O=D.pluginURL;if(this.self.importScripts(O),S.bD.isParsed()){const q={pluginStatus:"loaded",pluginURL:O};return S.bD.setState(q),q}throw S.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${O}`)})}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new d),D}_getWorkerSource(L,D,O){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][O]){const q={sendAsync:(te,le)=>(te.targetMapId=L,this.actor.sendAsync(te,le))};switch(D){case"vector":this.workerSources[L][D][O]=new Q(q,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][O]=new ci(q,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][O]=new this.externalWorkerSourceTypes[D](q,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][O]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new V),this.demWorkerSources[L][D]}}return S.i(self)&&(self.worker=new hn(self)),hn}),x("index",["exports","./shared"],function(S,d){var $="4.7.1";let ne,ge;const Q={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((e,o)=>{const u=requestAnimationFrame(e);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),o(d.c())})}),getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,o.drawImage(m,0,0,m.width,m.height),o},resolveURL:m=>(ne||(ne=document.createElement("a")),ne.href=m,ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ge==null&&(ge=matchMedia("(prefers-reduced-motion: reduce)")),ge.matches)}};class V{static testProp(e){if(!V.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in V.docStyle)return e[o];return e[0]}static create(e,o,u){const c=window.document.createElement(e);return o!==void 0&&(c.className=o),u&&u.appendChild(c),c}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(e,o){e.style[V.transformProp]=o}static addEventListener(e,o,u,c={}){e.addEventListener(o,u,"passive"in c?c:c.capture)}static removeEventListener(e,o,u,c={}){e.removeEventListener(o,u,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,u){const c=o.boundingClientRect;return new d.P((u.clientX-c.left)/o.x-e.clientLeft,(u.clientY-c.top)/o.y-e.clientTop)}static mousePos(e,o){const u=V.getScale(e);return V.getPoint(e,u,o)}static touchPos(e,o){const u=[],c=V.getScale(e);for(let f=0;f<o.length;f++)u.push(V.getPoint(e,c,o[f]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const Ce={supported:!1,testSupport:function(m){!pt&&Me&&(oe?ie(m):Ee=m)}};let Ee,Me,pt=!1,oe=!1;function ie(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Me),m.isContextLost())return;Ce.supported=!0}catch{}m.deleteTexture(e),pt=!0}var de;typeof document<"u"&&(Me=document.createElement("img"),Me.onload=()=>{Ee&&ie(Ee),Ee=null,oe=!0},Me.onerror=()=>{pt=!0,Ee=null},Me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,o,u,c;m.resetRequestQueue=()=>{e=[],o=0,u=0,c={}},m.addThrottleControl=k=>{const I=u++;return c[I]=k,I},m.removeThrottleControl=k=>{delete c[k],v()},m.getImage=(k,I,A=!0)=>new Promise((M,F)=>{Ce.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),d.e(k,{type:"image"}),e.push({abortController:I,requestParameters:k,supportImageRefresh:A,state:"queued",onError:j=>{F(j)},onSuccess:j=>{M(j)}}),v()});const f=k=>d._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:I,supportImageRefresh:A,onError:M,onSuccess:F,abortController:j}=k,U=A===!1&&!d.i(self)&&!d.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce((Y,ee)=>Y&&ee==="accept",!0));o++;const H=U?b(I,j):d.m(I,j);try{const Y=yield H;delete k.abortController,k.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?F(Y):Y.data&&F({data:yield(K=Y.data,typeof createImageBitmap=="function"?d.d(K):d.f(K)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete k.abortController,M(Y)}finally{o--,v()}var K}),v=()=>{const k=(()=>{for(const I of Object.keys(c))if(c[I]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=o;I<k&&e.length>0;I++){const A=e.shift();A.abortController.signal.aborted?I--:f(A)}},b=(k,I)=>new Promise((A,M)=>{const F=new Image,j=k.url,U=k.credentials;U&&U==="include"?F.crossOrigin="use-credentials":(U&&U==="same-origin"||!d.s(j))&&(F.crossOrigin="anonymous"),I.signal.addEventListener("abort",()=>{F.src="",M(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,A({data:F})},F.onerror=()=>{F.onerror=F.onload=null,I.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=j})}(de||(de={})),de.resetRequestQueue();class Pe{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function qe(m){var e=new d.A(3);return e[0]=m[0],e[1]=m[1],e[2]=m[2],e}var Qe,Xe=function(m,e,o){return m[0]=e[0]-o[0],m[1]=e[1]-o[1],m[2]=e[2]-o[2],m};Qe=new d.A(3),d.A!=Float32Array&&(Qe[0]=0,Qe[1]=0,Qe[2]=0);var Le=function(m){var e=m[0],o=m[1];return e*e+o*o};function it(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const o=[];for(const{id:u,url:c}of m){const f=`${u}${c}`;o.indexOf(f)===-1&&(o.push(f),e.push({id:u,url:c}))}}return e}function Ge(m,e,o){const u=m.split("?");return u[0]+=`${e}${o}`,u.join("?")}(function(){var m=new d.A(2);d.A!=Float32Array&&(m[0]=0,m[1]=0)})();class Ye{constructor(e,o,u,c){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(o,c)}update(e,o,u){const{width:c,height:f}=e,v=!(this.size&&this.size[0]===c&&this.size[1]===f||u),{context:b}=this,{gl:k}=b;if(this.useMipmap=!!(o&&o.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!o||o.premultiply!==!1)),v)this.size=[c,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,e):k.texImage2D(k.TEXTURE_2D,0,this.format,c,f,0,this.format,k.UNSIGNED_BYTE,e.data);else{const{x:I,y:A}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?k.texSubImage2D(k.TEXTURE_2D,0,I,A,k.RGBA,k.UNSIGNED_BYTE,e):k.texSubImage2D(k.TEXTURE_2D,0,I,A,c,f,k.RGBA,k.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(e,o,u){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),u!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,u||e),this.filter=e),o!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Kt(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Vt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let u=!0;const c=o.data||o.spriteData;return this._validateStretch(o.stretchX,c&&c.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,c&&c.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,o){if(!e)return!0;let u=0;for(const c of e){if(c[0]<u||c[1]<c[0]||o<c[1])return!1;u=c[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const u=o.spriteData,c=u&&u.width||o.data.width,f=u&&u.height||o.data.height;return!(e[0]<0||c<e[0]||e[1]<0||f<e[1]||e[2]<0||c<e[2]||e[3]<0||f<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,u=!0){const c=this.getImage(e);if(u&&(c.data.width!==o.data.width||c.data.height!==o.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=c.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((o,u)=>{let c=!0;if(!this.isLoaded())for(const f of e)this.images[f]||(c=!1);this.isLoaded()||c?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})})}_getImagesForIds(e){const o={};for(const u of e){let c=this.getImage(u);c||(this.fire(new d.k("styleimagemissing",{id:u})),c=this.getImage(u)),c?o[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],u=this.getImage(e);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const c={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new d.I(c,u);this.patterns[e]={bin:c,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ye(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:o,h:u}=d.p(e),c=this.atlasImage;c.resize({width:o||1,height:u||1});for(const f in this.patterns){const{bin:v}=this.patterns[f],b=v.x+1,k=v.y+1,I=this.getImage(f).data,A=I.width,M=I.height;d.R.copy(I,c,{x:0,y:0},{x:b,y:k},{width:A,height:M}),d.R.copy(I,c,{x:0,y:M-1},{x:b,y:k-1},{width:A,height:1}),d.R.copy(I,c,{x:0,y:0},{x:b,y:k+M},{width:A,height:1}),d.R.copy(I,c,{x:A-1,y:0},{x:b-1,y:k},{width:1,height:M}),d.R.copy(I,c,{x:0,y:0},{x:b+A,y:k},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||d.w(`Image with ID: "${o}" was not found`),Kt(u)&&this.updateImage(o,u)}}}const Yt=1e20;function Sn(m,e,o,u,c,f,v,b,k){for(let I=e;I<e+u;I++)Nr(m,o*f+I,f,c,v,b,k);for(let I=o;I<o+c;I++)Nr(m,I*f+e,1,u,v,b,k)}function Nr(m,e,o,u,c,f,v){f[0]=0,v[0]=-Yt,v[1]=Yt,c[0]=m[e];for(let b=1,k=0,I=0;b<u;b++){c[b]=m[e+b*o];const A=b*b;do{const M=f[k];I=(c[b]-c[M]+A-M*M)/(b-M)/2}while(I<=v[k]&&--k>-1);k++,f[k]=b,v[k]=I,v[k+1]=Yt}for(let b=0,k=0;b<u;b++){for(;v[k+1]<b;)k++;const I=f[k],A=b-I;m[e+b*o]=c[I]+A*A}}class an{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const o=[];for(const f in e)for(const v of e[f])o.push(this._getAndCacheGlyphsPromise(f,v));const u=yield Promise.all(o),c={};for(const{stack:f,id:v,glyph:b}of u)c[f]||(c[f]={}),c[f][v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return c})}_getAndCacheGlyphsPromise(e,o){return d._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=u.glyphs[o];if(c!==void 0)return{stack:e,id:o,glyph:c};if(c=this._tinySDF(u,e,o),c)return u.glyphs[o]=c,{stack:e,id:o,glyph:c};const f=Math.floor(o/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[f])return{stack:e,id:o,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[f]){const b=an.loadGlyphRange(e,f,this.url,this.requestManager);u.requests[f]=b}const v=yield u.requests[f];for(const b in v)this._doesCharSupportLocalGlyph(+b)||(u.glyphs[+b]=v[+b]);return u.ranges[f]=!0,{stack:e,id:o,glyph:v[o]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,o,u){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(u))return;let f=e.tinySDF;if(!f){let b="400";/bold/i.test(o)?b="900":/medium/i.test(o)?b="500":/light/i.test(o)&&(b="200"),f=e.tinySDF=new an.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:b})}const v=f.draw(String.fromCharCode(u));return{id:u,bitmap:new d.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}an.loadGlyphRange=function(m,e,o,u){return d._(this,void 0,void 0,function*(){const c=256*e,f=c+255,v=u.transformRequest(o.replace("{fontstack}",m).replace("{range}",`${c}-${f}`),"Glyphs"),b=yield d.l(v,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${f}`);const k={};for(const I of d.n(b.data))k[I.id]=I;return k})},an.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=o;const b=this.size=m+4*e,k=this._createCanvas(b),I=this.ctx=k.getContext("2d",{willReadFrequently:!0});I.font=`${v} ${f} ${m}px ${c}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(m),v=Math.ceil(o),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),k=Math.min(this.size-this.buffer,v+Math.ceil(u)),I=b+2*this.buffer,A=k+2*this.buffer,M=Math.max(I*A,0),F=new Uint8ClampedArray(M),j={data:F,width:I,height:A,glyphWidth:b,glyphHeight:k,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(b===0||k===0)return j;const{ctx:U,buffer:H,gridInner:K,gridOuter:Y}=this;U.clearRect(H,H,b,k),U.fillText(m,H,H+v);const ee=U.getImageData(H,H,b,k);Y.fill(Yt,0,M),K.fill(0,0,M);for(let Z=0;Z<k;Z++)for(let ae=0;ae<b;ae++){const ue=ee.data[4*(Z*b+ae)+3]/255;if(ue===0)continue;const fe=(Z+H)*I+ae+H;if(ue===1)Y[fe]=0,K[fe]=Yt;else{const Te=.5-ue;Y[fe]=Te>0?Te*Te:0,K[fe]=Te<0?Te*Te:0}}Sn(Y,0,0,I,A,I,this.f,this.v,this.z),Sn(K,H,H,b,k,I,this.f,this.v,this.z);for(let Z=0;Z<M;Z++){const ae=Math.sqrt(Y[Z])-Math.sqrt(K[Z]);F[Z]=Math.round(255-255*(ae/this.radius+this.cutoff))}return j}};class et{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,o){return d.x(e.expression.evaluate(o))}interpolate(e,o,u){return{x:d.y.number(e.x,o.x,u),y:d.y.number(e.y,o.y,u),z:d.y.number(e.z,o.z,u)}}}let _t;class yt extends d.E{constructor(e){super(),_t=_t||new d.q({anchor:new d.D(d.v.light.anchor),position:new et,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(_t),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(d.r,e,o))for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u){return(!u||u.validate!==!1)&&d.t(this,e.call(d.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const Dt=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class qt extends d.E{constructor(e){super(),this._transitionable=new d.T(Dt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,o={}){if(!this._validate(d.B,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u={}){return(u==null?void 0:u.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ln{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const u=e.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,o)),this.dashEntry[u]}getDashRanges(e,o,u){const c=[];let f=e.length%2==1?-e[e.length-1]*u:0,v=e[0]*u,b=!0;c.push({left:f,right:v,isDash:b,zeroLength:e[0]===0});let k=e[0];for(let I=1;I<e.length;I++){b=!b;const A=e[I];f=k*u,k+=A,v=k*u,c.push({left:f,right:v,isDash:b,zeroLength:A===0})}return c}addRoundDash(e,o,u){const c=o/2;for(let f=-u;f<=u;f++){const v=this.width*(this.nextRow+u+f);let b=0,k=e[b];for(let I=0;I<this.width;I++){I/k.right>1&&(k=e[++b]);const A=Math.abs(I-k.left),M=Math.abs(I-k.right),F=Math.min(A,M);let j;const U=f/u*(c+1);if(k.isDash){const H=c-Math.abs(U);j=Math.sqrt(F*F+H*H)}else j=c-Math.sqrt(F*F+U*U);this.data[v+I]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const k=e[b],I=e[b+1];k.zeroLength?e.splice(b,1):I&&I.isDash===k.isDash&&(I.left=k.left,e.splice(b,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const c=this.width*this.nextRow;let f=0,v=e[f];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++f]);const k=Math.abs(b-v.left),I=Math.abs(b-v.right),A=Math.min(k,I);this.data[c+b]=Math.max(0,Math.min(255,(v.isDash?A:-A)+128))}}addDash(e,o){const u=o?7:0,c=2*u+1;if(this.nextRow+c>this.height)return d.w("LineAtlas out of space"),null;let f=0;for(let b=0;b<e.length;b++)f+=e[b];if(f!==0){const b=this.width/f,k=this.getDashRanges(e,this.width,b);o?this.addRoundDash(k,b,u):this.addRegularDash(k)}const v={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:f};return this.nextRow+=c,this.dirty=!0,v}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const jr="maplibre_preloaded_worker_pool";class un{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<un.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jr]}numActive(){return Object.keys(this.active).length}}const gr=Math.floor(Q.hardwareConcurrency/2);let vr,Zr;function ai(){return vr||(vr=new un),vr}un.workerCount=d.C(globalThis)?Math.max(Math.min(gr,3),1):1;class Rn{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let c=0;c<u.length;c++){const f=new d.F(u[c],o);f.name=`Worker ${c}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const u=[];for(const c of this.actors)u.push(c.sendAsync({type:e,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const u of this.actors)u.registerMessageHandler(e,o)}}function is(){return Zr||(Zr=new Rn(ai(),d.G),Zr.registerMessageHandler("GR",(m,e,o)=>d.m(e,o))),Zr}function li(m,e){const o=d.H();return d.J(o,o,[1,1,0]),d.K(o,o,[.5*m.width,.5*m.height,1]),d.L(o,o,m.calculatePosMatrix(e.toUnwrapped()))}function Vi(m,e,o,u,c,f){const v=function(M,F,j){if(M)for(const U of M){const H=F[U];if(H&&H.source===j&&H.type==="fill-extrusion")return!0}else for(const U in F){const H=F[U];if(H.source===j&&H.type==="fill-extrusion")return!0}return!1}(c&&c.layers,e,m.id),b=f.maxPitchScaleFactor(),k=m.tilesIn(u,b,v);k.sort(Si);const I=[];for(const M of k)I.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,o,m._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,c,f,b,li(m.transform,M.tileID))});const A=function(M){const F={},j={};for(const U of M){const H=U.queryResults,K=U.wrappedTileID,Y=j[K]=j[K]||{};for(const ee in H){const Z=H[ee],ae=Y[ee]=Y[ee]||{},ue=F[ee]=F[ee]||[];for(const fe of Z)ae[fe.featureIndex]||(ae[fe.featureIndex]=!0,ue.push(fe))}}return F}(I);for(const M in A)A[M].forEach(F=>{const j=F.feature,U=m.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=U});return A}function Si(m,e){const o=m.tileID,u=e.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function ss(m,e,o){return d._(this,void 0,void 0,function*(){let u=m;if(m.url?u=(yield d.h(e.transformRequest(m.url,"Source"),o)).data:yield Q.frameAsync(o),!u)return null;const c=d.M(d.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(c.vectorLayerIds=u.vector_layers.map(f=>f.id)),c})}class ye{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const o=this._sw,u=this._ne;let c,f;if(e instanceof d.N)c=e,f=e;else{if(!(e instanceof ye))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ye.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return o||u?(o.lng=Math.min(c.lng,o.lng),o.lat=Math.min(c.lat,o.lat),u.lng=Math.max(f.lng,u.lng),u.lat=Math.max(f.lat,u.lat)):(this._sw=new d.N(c.lng,c.lat),this._ne=new d.N(f.lng,f.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:u}=d.N.convert(e);let c=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&c}static convert(e){return e instanceof ye?e:e&&new ye(e)}static fromLngLat(e,o=0){const u=360*o/40075017,c=u/Math.cos(Math.PI/180*e.lat);return new ye(new d.N(e.lng-c,e.lat-u),new d.N(e.lng+c,e.lat+u))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),o=new d.N(this._ne.lng,this._ne.lat);return new ye(e,e.lng>o.lng?new d.N(o.lng+360,o.lat):o)}}class Ti{constructor(e,o,u){this.bounds=ye.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),u=Math.floor(d.O(this.bounds.getWest())*o),c=Math.floor(d.Q(this.bounds.getNorth())*o),f=Math.ceil(d.O(this.bounds.getEast())*o),v=Math.ceil(d.Q(this.bounds.getSouth())*o);return e.x>=u&&e.x<f&&e.y>=c&&e.y<v}}class os extends d.E{constructor(e,o,u,c){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(o,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ss(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new Ti(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((f,v)=>{e.reloadPromise={resolve:f,reject:v}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const f=yield e.actor.sendAsync({type:c,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,f)}catch(f){if(delete e.abortController,e.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Mt extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},o),d.e(this,d.M(o,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ss(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new Ti(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield de.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const c=this.map.painter.context,f=c.gl,v=u.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new Ye(c,v,f.RGBA,{useMipmap:!0}),e.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class rr extends Mt{constructor(e,o,u,c){super(e,o,u,c),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield de.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const f=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const v=d.b(f)&&d.U()?f:yield this.readImageNow(f),b={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const k=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=k,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const o=e.width+2,u=e.height+2;try{return new d.R({width:o,height:u},yield d.W(e,-1,-1,o,u))}catch{}}return Q.getImageData(e,1)})}_getNeighboringTiles(e){const o=e.canonical,u=Math.pow(2,o.z),c=(o.x-1+u)%u,f=o.x===0?e.wrap-1:e.wrap,v=(o.x+1+u)%u,b=o.x+1===u?e.wrap+1:e.wrap,k={};return k[new d.S(e.overscaledZ,f,o.z,c,o.y).key]={backfilled:!1},k[new d.S(e.overscaledZ,b,o.z,v,o.y).key]={backfilled:!1},o.y>0&&(k[new d.S(e.overscaledZ,f,o.z,c,o.y-1).key]={backfilled:!1},k[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new d.S(e.overscaledZ,b,o.z,v,o.y-1).key]={backfilled:!1}),o.y+1<u&&(k[new d.S(e.overscaledZ,f,o.z,c,o.y+1).key]={backfilled:!1},k[new d.S(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new d.S(e.overscaledZ,b,o.z,v,o.y+1).key]={backfilled:!1}),k}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Ui extends d.E{constructor(e,o,u,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(c),this._data=o.data,this._options=d.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const f=d.X/this.tileSize;o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*f,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*f,extent:d.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.X,radius:(o.clusterRadius||50)*f,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:u}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const o=d.e({type:this.type},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(Q.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let c=null;u.resourceTiming&&u.resourceTiming[this.id]&&(c=u.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&d.e(f,{resourceTiming:c}),this.fire(new d.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:o,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,o==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Xn=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Tn extends d.E{constructor(e,o,u,c){super(),this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=o}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield de.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new d.j(o))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(d.Z.fromLngLat);this.tileID=function(c){let f=1/0,v=1/0,b=-1/0,k=-1/0;for(const F of c)f=Math.min(f,F.x),v=Math.min(v,F.y),b=Math.max(b,F.x),k=Math.max(k,F.y);const I=Math.max(b-f,k-v),A=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),M=Math.pow(2,A);return new d.a1(A,Math.floor((f+b)/2*M),Math.floor((v+k)/2*M))}(o),this.minzoom=this.maxzoom=this.tileID.z;const u=o.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,d.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,d.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Xn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ye(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class $i extends Tn{constructor(e,o,u,c){super(e,o,u,c),this.roundZoom=!0,this.type="video",this.options=o}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield d.a3(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new d.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Xn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new Ye(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class cn extends Tn{constructor(e,o,u,c){super(e,o,u,c),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(v=>typeof v!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Xn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ye(o,this.canvas,u.RGBA,{premultiply:!0});let c=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,c=!0)}c&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const as={},Es=m=>{switch(m){case"geojson":return Ui;case"image":return Tn;case"raster":return Mt;case"raster-dem":return rr;case"vector":return os;case"video":return $i;case"canvas":return cn}return as[m]},Ae="RTLPluginLoaded";class Kn extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=is()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Q.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(Ae))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ar=null;function Pr(){return ar||(ar=new Kn),ar}class ki{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,f){const v={};if(!f)return v;for(const b of c){const k=b.layerIds.map(I=>f.getLayer(I)).filter(Boolean);if(k.length!==0){b.layers=k,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(I=>k.filter(A=>A.id===I)[0]));for(const I of k)v[I.id]=b}}return v}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof d.a6){if(this.hasSymbolBuckets=!0,!u)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof d.a6&&f.hasRTLText){this.hasRTLText=!0,Pr().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(c).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const c=this.buckets[u];c.uploadPending()&&c.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ye(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ye(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,u,c,f,v,b,k,I,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:f,scale:v,tileSize:this.tileSize,pixelPosMatrix:A,transform:k,params:b,queryPadding:this.queryPadding*I},e,o,u):{}}querySourceFeatures(e,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const c=u.loadVTLayers(),f=o&&o.sourceLayer?o.sourceLayer:"",v=c._geojsonTileLayer||c[f];if(!v)return;const b=d.a7(o&&o.filter),{z:k,x:I,y:A}=this.tileID.canonical,M={z:k,x:I,y:A};for(let F=0;F<v.length;F++){const j=v.feature(F);if(b.needGeometry){const K=d.a8(j,!0);if(!b.filter(new d.z(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!b.filter(new d.z(this.tileID.overscaledZ),j))continue;const U=u.getId(j,f),H=new d.a9(j,k,I,A,U);H.tile=M,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const u=d.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let c=!1;if(this.expirationTime>u)c=!1;else if(o)if(this.expirationTime<o)c=!0;else{const f=this.expirationTime-o;f?this.expirationTime=u+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!o.style.hasLayer(c))continue;const f=this.buckets[c],v=f.layers[0].sourceLayer||"_geojsonTileLayer",b=u[v],k=e[v];if(!b||!k||Object.keys(k).length===0)continue;f.update(k,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=o&&o.style&&o.style.getLayer(c);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Q.now()+e}setDependencies(e,o){const u={};for(const c of o)u[c]=!0;this.dependencies[e]=u}hasDependency(e,o){for(const u of e){const c=this.dependencies[u];if(c){for(const f of o)if(c[f])return!0}}return!1}}class Re{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,u){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:o,timeout:void 0};if(u!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},u)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const u=e.wrapped().key,c=o===void 0?0:this.data[u].indexOf(o),f=this.data[u][c];return this.data[u].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(f.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const u in this.data)for(const c of this.data[u])e(c.value)||o.push(c);for(const u of o)this.remove(u.value.tileID,u)}}class kt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,u){const c=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},d.e(this.stateChanges[e][c],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==c&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const f in this.state[e][c])u[f]||(this.deletedStates[e][c][f]=null)}else for(const f in u)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][f]===null&&delete this.deletedStates[e][c][f]}removeFeatureState(e,o,u){if(this.deletedStates[e]===null)return;const c=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&o!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][u]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(u in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][u]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,o){const u=String(o),c=d.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][o];if(f===null)return{};for(const v in f)delete c[v]}return c}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const u={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const v in this.stateChanges[c])this.state[c][v]||(this.state[c][v]={}),d.e(this.state[c][v],this.stateChanges[c][v]),f[v]=this.state[c][v];u[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const v in this.state[c])f[v]={},this.state[c][v]={};else for(const v in this.deletedStates[c]){if(this.deletedStates[c][v]===null)this.state[c][v]={};else for(const b of Object.keys(this.deletedStates[c][v]))delete this.state[c][v][b];f[v]=this.state[c][v]}u[c]=u[c]||{},d.e(u[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const c in e)e[c].setFeatureState(u,o)}}class ft extends d.E{constructor(e,o,u){super(),this.id=e,this.dispatcher=u,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,f,v,b)=>{const k=new(Es(f.type))(c,f,v,b);if(k.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${k.id}`);return k})(e,o,u,this),this._tiles={},this._cache=new Re(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new kt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,u)}catch(c){e.state="errored",c.status!==404?this._source.fire(new d.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ar).map(e=>e.key)}getRenderableIds(e){const o=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&o.push(this._tiles[u]);return e?o.sort((u,c)=>{const f=u.tileID,v=c.tileID,b=new d.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),k=new d.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-v.overscaledZ||k.y-b.y||k.x-b.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(Ar).map(u=>u.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){return d._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,e,o))})}_tileLoaded(e,o,u){e.timeAdded=Q.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const o=this.getRenderableIds();for(let c=0;c<o.length;c++){const f=o[c];if(e.neighboringTiles&&e.neighboringTiles[f]){const v=this.getTileByID(f);u(e,v),u(v,e)}}function u(c,f){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let v=f.tileID.canonical.x-c.tileID.canonical.x;const b=f.tileID.canonical.y-c.tileID.canonical.y,k=Math.pow(2,c.tileID.canonical.z),I=f.tileID.key;v===0&&b===0||Math.abs(b)>1||(Math.abs(v)>1&&(Math.abs(v+k)===1?v+=k:Math.abs(v-k)===1&&(v-=k)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,v,b),c.neighboringTiles&&c.neighboringTiles[I]&&(c.neighboringTiles[I].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,u,c){for(const f in this._tiles){let v=this._tiles[f];if(c[f]||!v.hasData()||v.tileID.overscaledZ<=o||v.tileID.overscaledZ>u)continue;let b=v.tileID;for(;v&&v.tileID.overscaledZ>o+1;){const I=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[I.key],v&&v.hasData()&&(b=I)}let k=b;for(;k.overscaledZ>o;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]){c[b.key]=b;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=e.overscaledZ-1;u>=o;u--){const c=e.scaledTo(u),f=this._getLoadedTile(c);if(f)return f}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(f)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){const u={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+o),u[f.tileID.key]=f}this._tiles=u;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,o,u,c,f,v){const b={},k={},I=Object.keys(e),A=Q.now();for(const M of I){const F=e[M],j=this._tiles[M];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=A)continue;const U=this.findLoadedParent(F,o),H=this.findLoadedSibling(F),K=U||H||null;K&&(this._addTile(K.tileID),b[K.tileID.key]=K.tileID),k[M]=F}this._retainLoadedChildren(k,c,u,e);for(const M in b)e[M]||(this._coveredTiles[M]=!0,e[M]=b[M]);if(v){const M={},F={};for(const j of f)this._tiles[j.key].hasData()?M[j.key]=j:F[j.key]=j;for(const j in F){const U=F[j].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(M[U[0].key]=e[U[0].key]=U[0],M[U[1].key]=e[U[1].key]=U[1],M[U[2].key]=e[U[2].key]=U[2],M[U[3].key]=e[U[3].key]=U[3],delete F[j])}for(const j in F){const U=F[j],H=this.findLoadedParent(U,this._source.minzoom),K=this.findLoadedSibling(U),Y=H||K||null;if(Y){M[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(const ee in M)M[ee].isChildOf(Y.tileID)&&delete M[ee]}}for(const j in this._tiles)M[j]||(this._coveredTiles[j]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.S(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(u=u.filter(A=>this._source.hasTile(A)))):u=[];const c=e.coveringZoomLevel(this._source),f=Math.max(c-ft.maxOverzooming,this._source.minzoom),v=Math.max(c+ft.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const M of u)if(M.canonical.z>this._source.minzoom){const F=M.scaledTo(M.canonical.z-1);A[F.key]=F;const j=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));A[j.key]=j}u=u.concat(Object.values(A))}const b=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(u,c);yr(this._source.type)&&this._updateCoveredAndRetainedTiles(k,f,v,c,u,o);for(const A in k)this._tiles[A].clearFadeHold();const I=d.ab(this._tiles,k);for(const A of I){const M=this._tiles[A];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var u;const c={},f={},v=Math.max(o-ft.maxOverzooming,this._source.minzoom),b=Math.max(o+ft.maxUnderzooming,this._source.minzoom),k={};for(const I of e){const A=this._addTile(I);c[I.key]=I,A.hasData()||o<this._source.maxzoom&&(k[I.key]=I)}this._retainLoadedChildren(k,o,b,c);for(const I of e){let A=this._tiles[I.key];if(A.hasData())continue;if(o+1>this._source.maxzoom){const F=I.children(this._source.maxzoom)[0],j=this.getTile(F);if(j&&j.hasData()){c[F.key]=F;continue}}else{const F=I.children(this._source.maxzoom);if(c[F[0].key]&&c[F[1].key]&&c[F[2].key]&&c[F[3].key])continue}let M=A.wasRequested();for(let F=I.overscaledZ-1;F>=v;--F){const j=I.scaledTo(F);if(f[j.key])break;if(f[j.key]=!0,A=this.getTile(j),!A&&M&&(A=this._addTile(j)),A){const U=A.hasData();if((U||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||M)&&(c[j.key]=j),M=A.wasRequested(),U)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let u,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){u=this._loadedParentTiles[c.key];break}o.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(u=this._getLoadedTile(f),u)break;c=f}for(const f of o)this._loadedParentTiles[f]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const o=this._tiles[e].tileID,u=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=u}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const u=o;return o||(o=new ki(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,u||this._source.fire(new d.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=o.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){const o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,u){const c=[],f=this.transform;if(!f)return c;const v=u?f.getCameraQueryGeometry(e):e,b=e.map(U=>f.pointCoordinate(U,this.terrain)),k=v.map(U=>f.pointCoordinate(U,this.terrain)),I=this.getIds();let A=1/0,M=1/0,F=-1/0,j=-1/0;for(const U of k)A=Math.min(A,U.x),M=Math.min(M,U.y),F=Math.max(F,U.x),j=Math.max(j,U.y);for(let U=0;U<I.length;U++){const H=this._tiles[I[U]];if(H.holdingForFade())continue;const K=H.tileID,Y=Math.pow(2,f.zoom-H.tileID.overscaledZ),ee=o*H.queryPadding*d.X/H.tileSize/Y,Z=[K.getTilePoint(new d.Z(A,M)),K.getTilePoint(new d.Z(F,j))];if(Z[0].x-ee<d.X&&Z[0].y-ee<d.X&&Z[1].x+ee>=0&&Z[1].y+ee>=0){const ae=b.map(fe=>K.getTilePoint(fe)),ue=k.map(fe=>K.getTilePoint(fe));c.push({tile:H,tileID:K,queryGeometry:ae,cameraQueryGeometry:ue,scale:Y})}}return c}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of o)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(yr(this._source.type)){const e=Q.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,u){this._state.updateState(e=e||"_geojsonTileLayer",o,u)}removeFeatureState(e,o,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,u)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,u){const c=this._tiles[e];c&&c.setDependencies(o,u)}reloadTilesForDependencies(e,o){for(const u in this._tiles)this._tiles[u].hasDependency(e,o)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,o))}}function Ar(m,e){const o=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-o||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function yr(m){return m==="raster"||m==="image"||m==="video"}ft.maxOverzooming=10,ft.maxUnderzooming=3;class vt{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let o=1,u=this._distances[o];const c=e*this.paddedLength+this.padding;for(;u<c&&o<this._distances.length;)u=this._distances[++o];const f=o-1,v=this._distances[f],b=u-v,k=b>0?(c-v)/b:0;return this.points[f].mult(1-k).add(this.points[o].mult(k))}}function ui(m,e){let o=!0;return m==="always"||m!=="never"&&e!=="never"||(o=!1),o}class Yn{constructor(e,o,u){const c=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(o/u);for(let v=0;v<this.xCellCount*this.yCellCount;v++)c.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,u,c,f){this._forEachCell(o,u,c,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(f)}insertCircle(e,o,u,c){this._forEachCell(o-c,u-c,o+c,u+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(u),this.circles.push(c)}_insertBoxCell(e,o,u,c,f,v){this.boxCells[f].push(v)}_insertCircleCell(e,o,u,c,f,v){this.circleCells[f].push(v)}_query(e,o,u,c,f,v,b){if(u<0||e>this.width||c<0||o>this.height)return[];const k=[];if(e<=0&&o<=0&&this.width<=u&&this.height<=c){if(f)return[{key:null,x1:e,y1:o,x2:u,y2:c}];for(let I=0;I<this.boxKeys.length;I++)k.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const A=this.circles[3*I],M=this.circles[3*I+1],F=this.circles[3*I+2];k.push({key:this.circleKeys[I],x1:A-F,y1:M-F,x2:A+F,y2:M+F})}}else this._forEachCell(e,o,u,c,this._queryCell,k,{hitTest:f,overlapMode:v,seenUids:{box:{},circle:{}}},b);return k}query(e,o,u,c){return this._query(e,o,u,c,!1,null)}hitTest(e,o,u,c,f,v){return this._query(e,o,u,c,!0,f,v).length>0}hitTestCircle(e,o,u,c,f){const v=e-u,b=e+u,k=o-u,I=o+u;if(b<0||v>this.width||I<0||k>this.height)return!1;const A=[];return this._forEachCell(v,k,b,I,this._queryCellCircle,A,{hitTest:!0,overlapMode:c,circle:{x:e,y:o,radius:u},seenUids:{box:{},circle:{}}},f),A.length>0}_queryCell(e,o,u,c,f,v,b,k){const{seenUids:I,hitTest:A,overlapMode:M}=b,F=this.boxCells[f];if(F!==null){const U=this.bboxes;for(const H of F)if(!I.box[H]){I.box[H]=!0;const K=4*H,Y=this.boxKeys[H];if(e<=U[K+2]&&o<=U[K+3]&&u>=U[K+0]&&c>=U[K+1]&&(!k||k(Y))&&(!A||!ui(M,Y.overlapMode))&&(v.push({key:Y,x1:U[K],y1:U[K+1],x2:U[K+2],y2:U[K+3]}),A))return!0}}const j=this.circleCells[f];if(j!==null){const U=this.circles;for(const H of j)if(!I.circle[H]){I.circle[H]=!0;const K=3*H,Y=this.circleKeys[H];if(this._circleAndRectCollide(U[K],U[K+1],U[K+2],e,o,u,c)&&(!k||k(Y))&&(!A||!ui(M,Y.overlapMode))){const ee=U[K],Z=U[K+1],ae=U[K+2];if(v.push({key:Y,x1:ee-ae,y1:Z-ae,x2:ee+ae,y2:Z+ae}),A)return!0}}}return!1}_queryCellCircle(e,o,u,c,f,v,b,k){const{circle:I,seenUids:A,overlapMode:M}=b,F=this.boxCells[f];if(F!==null){const U=this.bboxes;for(const H of F)if(!A.box[H]){A.box[H]=!0;const K=4*H,Y=this.boxKeys[H];if(this._circleAndRectCollide(I.x,I.y,I.radius,U[K+0],U[K+1],U[K+2],U[K+3])&&(!k||k(Y))&&!ui(M,Y.overlapMode))return v.push(!0),!0}}const j=this.circleCells[f];if(j!==null){const U=this.circles;for(const H of j)if(!A.circle[H]){A.circle[H]=!0;const K=3*H,Y=this.circleKeys[H];if(this._circlesCollide(U[K],U[K+1],U[K+2],I.x,I.y,I.radius)&&(!k||k(Y))&&!ui(M,Y.overlapMode))return v.push(!0),!0}}}_forEachCell(e,o,u,c,f,v,b,k){const I=this._convertToXCellCoord(e),A=this._convertToYCellCoord(o),M=this._convertToXCellCoord(u),F=this._convertToYCellCoord(c);for(let j=I;j<=M;j++)for(let U=A;U<=F;U++)if(f.call(this,e,o,u,c,this.xCellCount*U+j,v,b,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,u,c,f,v){const b=c-e,k=f-o,I=u+v;return I*I>b*b+k*k}_circleAndRectCollide(e,o,u,c,f,v,b){const k=(v-c)/2,I=Math.abs(e-(c+k));if(I>k+u)return!1;const A=(b-f)/2,M=Math.abs(o-(f+A));if(M>A+u)return!1;if(I<=k||M<=A)return!0;const F=I-k,j=M-A;return F*F+j*j<=u*u}}function ci(m,e,o,u,c){const f=d.H();return e?(d.K(f,f,[1/c,1/c,1]),o||d.ad(f,f,u.angle)):d.L(f,u.labelPlaneMatrix,m),f}function hn(m,e,o,u,c){if(e){const f=d.ae(m);return d.K(f,f,[c,c,1]),o||d.ad(f,f,-u.angle),f}return u.glCoordMatrix}function W(m,e,o,u){let c;u?(c=[m,e,u(m,e),1],d.af(c,c,o)):(c=[m,e,0,1],Ot(c,c,o));const f=c[3];return{point:new d.P(c[0]/f,c[1]/f),signedDistanceFromCamera:f,isOccluded:!1}}function L(m,e){return .5+m/e*.5}function D(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function O(m,e,o,u,c,f,v,b,k,I,A,M,F,j,U){const H=u?m.textSizeData:m.iconSizeData,K=d.ag(H,o.transform.zoom),Y=[256/o.width*2+1,256/o.height*2+1],ee=u?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ee.clear();const Z=m.lineVertexArray,ae=u?m.text.placedSymbolArray:m.icon.placedSymbolArray,ue=o.transform.width/o.transform.height;let fe=!1;for(let Te=0;Te<ae.length;Te++){const ze=ae.get(Te);if(ze.hidden||ze.writingMode===d.ah.vertical&&!fe){ht(ze.numGlyphs,ee);continue}fe=!1;const $e=W(ze.anchorX,ze.anchorY,e,U);if(!D($e.point,Y)){ht(ze.numGlyphs,ee);continue}const Ke=L(o.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),Ne=d.ai(H,K,ze),Oe=v?Ne/Ke:Ne*Ke,ot={getElevation:U,labelPlaneMatrix:c,lineVertexArray:Z,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:I,tileAnchorPoint:new d.P(ze.anchorX,ze.anchorY),unwrappedTileID:A,width:M,height:F,translation:j},bt=le(ot,ze,Oe,!1,b,e,f,m.glyphOffsetArray,ee,ue,k);fe=bt.useVertical,(bt.notEnoughRoom||fe||bt.needsFlipping&&le(ot,ze,Oe,!0,b,e,f,m.glyphOffsetArray,ee,ue,k).notEnoughRoom)&&ht(ze.numGlyphs,ee)}u?m.text.dynamicLayoutVertexBuffer.updateData(ee):m.icon.dynamicLayoutVertexBuffer.updateData(ee)}function q(m,e,o,u,c,f,v,b){const k=f.glyphStartIndex+f.numGlyphs,I=f.lineStartIndex,A=f.lineStartIndex+f.lineLength,M=e.getoffsetX(f.glyphStartIndex),F=e.getoffsetX(k-1),j=Fe(m*M,o,u,c,f.segment,I,A,b,v);if(!j)return null;const U=Fe(m*F,o,u,c,f.segment,I,A,b,v);return U?b.projectionCache.anyProjectionOccluded?null:{first:j,last:U}:null}function te(m,e,o,u){return m===d.ah.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*u?{useVertical:!0}:(m===d.ah.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function le(m,e,o,u,c,f,v,b,k,I,A){const M=o/24,F=e.lineOffsetX*M,j=e.lineOffsetY*M;let U;if(e.numGlyphs>1){const H=e.glyphStartIndex+e.numGlyphs,K=e.lineStartIndex,Y=e.lineStartIndex+e.lineLength,ee=q(M,b,F,j,u,e,A,m);if(!ee)return{notEnoughRoom:!0};const Z=W(ee.first.point.x,ee.first.point.y,v,m.getElevation).point,ae=W(ee.last.point.x,ee.last.point.y,v,m.getElevation).point;if(c&&!u){const ue=te(e.writingMode,Z,ae,I);if(ue)return ue}U=[ee.first];for(let ue=e.glyphStartIndex+1;ue<H-1;ue++)U.push(Fe(M*b.getoffsetX(ue),F,j,u,e.segment,K,Y,m,A));U.push(ee.last)}else{if(c&&!u){const K=W(m.tileAnchorPoint.x,m.tileAnchorPoint.y,f,m.getElevation).point,Y=e.lineStartIndex+e.segment+1,ee=new d.P(m.lineVertexArray.getx(Y),m.lineVertexArray.gety(Y)),Z=W(ee.x,ee.y,f,m.getElevation),ae=Z.signedDistanceFromCamera>0?Z.point:function(fe,Te,ze,$e,Ke,Ne){return he(fe,Te,ze,1,Ke,Ne)}(m.tileAnchorPoint,ee,K,0,f,m),ue=te(e.writingMode,K,ae,I);if(ue)return ue}const H=Fe(M*b.getoffsetX(e.glyphStartIndex),F,j,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,m,A);if(!H||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[H]}for(const H of U)d.aj(k,H.point,H.angle);return{}}function he(m,e,o,u,c,f){const v=m.add(m.sub(e)._unit()),b=c!==void 0?W(v.x,v.y,c,f.getElevation).point:ve(v.x,v.y,f).point,k=o.sub(b);return o.add(k._mult(u/k.mag()))}function J(m,e,o){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const c=new d.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),f=ve(c.x,c.y,e);if(f.signedDistanceFromCamera>0)return u.projections[m]=f.point,u.anyProjectionOccluded=u.anyProjectionOccluded||f.isOccluded,f.point;const v=m-o.direction;return function(b,k,I,A,M){return he(b,k,I,A,void 0,M)}(o.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),c,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function ve(m,e,o){const u=m+o.translation[0],c=e+o.translation[1];let f;return!o.pitchWithMap&&o.projection.useSpecialProjectionForSymbols?(f=o.projection.projectTileCoordinates(u,c,o.unwrappedTileID,o.getElevation),f.point.x=(.5*f.point.x+.5)*o.width,f.point.y=(.5*-f.point.y+.5)*o.height):(f=W(u,c,o.labelPlaneMatrix,o.getElevation),f.isOccluded=!1),f}function ke(m,e,o){return m._unit()._perp()._mult(e*o)}function _e(m,e,o,u,c,f,v,b,k){if(b.projectionCache.offsets[m])return b.projectionCache.offsets[m];const I=o.add(e);if(m+k.direction<u||m+k.direction>=c)return b.projectionCache.offsets[m]=I,I;const A=J(m+k.direction,b,k),M=ke(A.sub(o),v,k.direction),F=o.add(M),j=A.add(M);return b.projectionCache.offsets[m]=d.ak(f,I,F,j)||I,b.projectionCache.offsets[m]}function Fe(m,e,o,u,c,f,v,b,k){const I=u?m-e:m+e;let A=I>0?1:-1,M=0;u&&(A*=-1,M=Math.PI),A<0&&(M+=Math.PI);let F,j=A>0?f+c:f+c+1;b.projectionCache.cachedAnchorPoint?F=b.projectionCache.cachedAnchorPoint:(F=ve(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=F);let U,H,K=F,Y=F,ee=0,Z=0;const ae=Math.abs(I),ue=[];let fe;for(;ee+Z<=ae;){if(j+=A,j<f||j>=v)return null;ee+=Z,Y=K,H=U;const $e={absOffsetX:ae,direction:A,distanceFromAnchor:ee,previousVertex:Y};if(K=J(j,b,$e),o===0)ue.push(Y),fe=K.sub(Y);else{let Ke;const Ne=K.sub(Y);Ke=Ne.mag()===0?ke(J(j+A,b,$e).sub(K),o,A):ke(Ne,o,A),H||(H=Y.add(Ke)),U=_e(j,Ke,K,f,v,H,o,b,$e),ue.push(H),fe=U.sub(H)}Z=fe.mag()}const Te=fe._mult((ae-ee)/Z)._add(H||Y),ze=M+Math.atan2(K.y-Y.y,K.x-Y.x);return ue.push(Te),{point:Te,angle:k?ze:0,path:ue}}const De=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ht(m,e){for(let o=0;o<m;o++){const u=e.length;e.resize(u+4),e.float32.set(De,3*u)}}function Ot(m,e,o){const u=e[0],c=e[1];return m[0]=o[0]*u+o[4]*c+o[12],m[1]=o[1]*u+o[5]*c+o[13],m[3]=o[3]*u+o[7]*c+o[15],m}const St=100;class Lt{constructor(e,o,u=new Yn(e.width+200,e.height+200,25),c=new Yn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=o,this.grid=u,this.ignoredGrid=c,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+St,this.screenBottomBoundary=e.height+St,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,u,c,f,v,b,k,I,A,M){const F=e.anchorPointX+k[0],j=e.anchorPointY+k[1],U=this.projectAndGetPerspectiveRatio(c,F,j,f,A),H=u*U.perspectiveRatio;let K;if(v||b)K=this._projectCollisionBox(e,H,c,f,v,b,k,U,A,M);else{const ue=U.point.x+(M?M.x*H:0),fe=U.point.y+(M?M.y*H:0);K={allPointsOccluded:!1,box:[ue+e.x1*H,fe+e.y1*H,ue+e.x2*H,fe+e.y2*H]}}const[Y,ee,Z,ae]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?K.allPointsOccluded:this.mapProjection.isOccluded(F,j,f))||U.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Y,ee,Z,ae)||o!=="always"&&this.grid.hitTest(Y,ee,Z,ae,o,I)?{box:[Y,ee,Z,ae],placeable:!1,offscreen:!1}:{box:[Y,ee,Z,ae],placeable:!0,offscreen:this.isOffscreen(Y,ee,Z,ae)}}placeCollisionCircles(e,o,u,c,f,v,b,k,I,A,M,F,j,U,H,K){const Y=[],ee=new d.P(o.anchorX,o.anchorY),Z=this.getPerspectiveRatio(v,ee.x,ee.y,b,K),ae=(M?f/Z:f*Z)/d.ap,ue={getElevation:K,labelPlaneMatrix:k,lineVertexArray:u,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ee,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:H},fe=q(ae,c,o.lineOffsetX*ae,o.lineOffsetY*ae,!1,o,!1,ue);let Te=!1,ze=!1,$e=!0;if(fe){const Ke=.5*j*Z+U,Ne=new d.P(-100,-100),Oe=new d.P(this.screenRightBoundary,this.screenBottomBoundary),ot=new vt,bt=fe.first,Ve=fe.last;let He=[];for(let It=bt.path.length-1;It>=1;It--)He.push(bt.path[It]);for(let It=1;It<Ve.path.length;It++)He.push(Ve.path[It]);const xt=2.5*Ke;if(I){const It=this.projectPathToScreenSpace(He,ue,I);He=It.some(zt=>zt.signedDistanceFromCamera<=0)?[]:It.map(zt=>zt.point)}let cr=[];if(He.length>0){const It=He[0].clone(),zt=He[0].clone();for(let hr=1;hr<He.length;hr++)It.x=Math.min(It.x,He[hr].x),It.y=Math.min(It.y,He[hr].y),zt.x=Math.max(zt.x,He[hr].x),zt.y=Math.max(zt.y,He[hr].y);cr=It.x>=Ne.x&&zt.x<=Oe.x&&It.y>=Ne.y&&zt.y<=Oe.y?[He]:zt.x<Ne.x||It.x>Oe.x||zt.y<Ne.y||It.y>Oe.y?[]:d.al([He],Ne.x,Ne.y,Oe.x,Oe.y)}for(const It of cr){ot.reset(It,.25*Ke);let zt=0;zt=ot.length<=.5*Ke?1:Math.ceil(ot.paddedLength/xt)+1;for(let hr=0;hr<zt;hr++){const fn=hr/Math.max(zt-1,1),Ii=ot.lerp(fn),dr=Ii.x+St,Nn=Ii.y+St;Y.push(dr,Nn,Ke,0);const In=dr-Ke,mn=Nn-Ke,Pn=dr+Ke,Wi=Nn+Ke;if($e=$e&&this.isOffscreen(In,mn,Pn,Wi),ze=ze||this.isInsideGrid(In,mn,Pn,Wi),e!=="always"&&this.grid.hitTestCircle(dr,Nn,Ke,e,F)&&(Te=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Te}}}}return{circles:!A&&Te||!ze||Z<this.perspectiveRatioCutoff?[]:Y,offscreen:$e,collisionDetected:Te}}projectPathToScreenSpace(e,o,u){return e.map(c=>W(c.x,c.y,u,o.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,c=1/0,f=-1/0,v=-1/0;for(const A of e){const M=new d.P(A.x+St,A.y+St);u=Math.min(u,M.x),c=Math.min(c,M.y),f=Math.max(f,M.x),v=Math.max(v,M.y),o.push(M)}const b=this.grid.query(u,c,f,v).concat(this.ignoredGrid.query(u,c,f,v)),k={},I={};for(const A of b){const M=A.key;if(k[M.bucketInstanceId]===void 0&&(k[M.bucketInstanceId]={}),k[M.bucketInstanceId][M.featureIndex])continue;const F=[new d.P(A.x1,A.y1),new d.P(A.x2,A.y1),new d.P(A.x2,A.y2),new d.P(A.x1,A.y2)];d.am(o,F)&&(k[M.bucketInstanceId][M.featureIndex]=!0,I[M.bucketInstanceId]===void 0&&(I[M.bucketInstanceId]=[]),I[M.bucketInstanceId].push(M.featureIndex))}return I}insertCollisionBox(e,o,u,c,f,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:v,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,u,c,f,v){const b=u?this.ignoredGrid:this.grid,k={bucketInstanceId:c,featureIndex:f,collisionGroupID:v,overlapMode:o};for(let I=0;I<e.length;I+=4)b.insertCircle(k,e[I],e[I+1],e[I+2])}projectAndGetPerspectiveRatio(e,o,u,c,f){let v;f?(v=[o,u,f(o,u),1],d.af(v,v,e)):(v=[o,u,0,1],Ot(v,v,e));const b=v[3];return{point:new d.P((v[0]/b+1)/2*this.transform.width+St,(-v[1]/b+1)/2*this.transform.height+St),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}getPerspectiveRatio(e,o,u,c,f){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(o,u,c,f):W(o,u,e,f);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,o,u,c){return u<St||e>=this.screenRightBoundary||c<St||o>this.screenBottomBoundary}isInsideGrid(e,o,u,c){return u>=0&&e<this.gridRightBoundary&&c>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,u,c,f,v,b,k,I,A){let M=new d.P(1,0),F=new d.P(0,1);const j=new d.P(e.anchorPointX+b[0],e.anchorPointY+b[1]);if(v&&!f){const $e=this.projectAndGetPerspectiveRatio(u,j.x+1,j.y,c,I).point.sub(k.point).unit(),Ke=Math.atan($e.y/$e.x)+($e.x<0?Math.PI:0),Ne=Math.sin(Ke),Oe=Math.cos(Ke);M=new d.P(Oe,Ne),F=new d.P(-Ne,Oe)}else if(!v&&f){const $e=-this.transform.angle,Ke=Math.sin($e),Ne=Math.cos($e);M=new d.P(Ne,Ke),F=new d.P(-Ke,Ne)}let U=k.point,H=o;if(f){U=j;const $e=this.transform.zoom-Math.floor(this.transform.zoom);H=Math.pow(2,-$e),H*=this.mapProjection.getPitchedTextCorrection(this.transform,j,c),A||(H*=d.ac(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}A&&(U=U.add(M.mult(A.x*H)).add(F.mult(A.y*H)));const K=e.x1*H,Y=e.x2*H,ee=(K+Y)/2,Z=e.y1*H,ae=e.y2*H,ue=(Z+ae)/2,fe=[{offsetX:K,offsetY:Z},{offsetX:ee,offsetY:Z},{offsetX:Y,offsetY:Z},{offsetX:Y,offsetY:ue},{offsetX:Y,offsetY:ae},{offsetX:ee,offsetY:ae},{offsetX:K,offsetY:ae},{offsetX:K,offsetY:ue}];let Te=[];for(const{offsetX:$e,offsetY:Ke}of fe)Te.push(new d.P(U.x+M.x*$e+F.x*Ke,U.y+M.y*$e+F.y*Ke));let ze=!1;if(f){const $e=Te.map(Ke=>this.projectAndGetPerspectiveRatio(u,Ke.x,Ke.y,c,I));ze=$e.some(Ke=>!Ke.isOccluded),Te=$e.map(Ke=>Ke.point)}else ze=!0;return{box:d.ao(Te),allPointsOccluded:!ze}}}function Pt(m,e,o){return e*(d.X/(m.tileSize*Math.pow(2,o-m.tileID.overscaledZ)))}class xr{constructor(e,o,u,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):c&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class fr{constructor(e,o,u,c,f){this.text=new xr(e?e.text:null,o,u,f),this.icon=new xr(e?e.icon:null,o,c,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Et{constructor(e,o,u){this.text=e,this.icon=o,this.skipFade=u}}class Zt{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class nr{constructor(e,o,u,c,f){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=c,this.tileID=f}}class Fr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[e]}}function Vr(m,e,o,u,c){const{horizontalAlign:f,verticalAlign:v}=d.au(m);return new d.P(-(f-.5)*e+u[0]*c,-(v-.5)*o+u[1]*c)}class en{constructor(e,o,u,c,f,v){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new Lt(this.transform,o),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Fr(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(u,c)=>o.getElevation(e,u,c):null}getBucketParts(e,o,u,c){const f=u.getBucket(o),v=u.latestFeatureIndex;if(!f||!v||o.id!==f.layerIds[0])return;const b=u.collisionBoxArray,k=f.layers[0].layout,I=f.layers[0].paint,A=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),M=u.tileSize/d.X,F=u.tileID.toUnwrapped(),j=this.transform.calculatePosMatrix(F),U=k.get("text-pitch-alignment")==="map",H=k.get("text-rotation-alignment")==="map",K=Pt(u,1,this.transform.zoom),Y=this.collisionIndex.mapProjection.translatePosition(this.transform,u,I.get("text-translate"),I.get("text-translate-anchor")),ee=this.collisionIndex.mapProjection.translatePosition(this.transform,u,I.get("icon-translate"),I.get("icon-translate-anchor")),Z=ci(j,U,H,this.transform,K);let ae=null;if(U){const fe=hn(j,U,H,this.transform,K);ae=d.L([],this.transform.labelPlaneMatrix,fe)}this.retainedQueryData[f.bucketInstanceId]=new nr(f.bucketInstanceId,v,f.sourceLayerIndex,f.index,u.tileID);const ue={bucket:f,layout:k,translationText:Y,translationIcon:ee,posMatrix:j,unwrappedTileID:F,textLabelPlaneMatrix:Z,labelToScreenMatrix:ae,scale:A,textPixelRatio:M,holdingForFade:u.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:d.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(c)for(const fe of f.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:ze,symbolInstanceEnd:$e}=fe;e.push({sortKey:Te,symbolInstanceStart:ze,symbolInstanceEnd:$e,parameters:ue})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(e,o,u,c,f,v,b,k,I,A,M,F,j,U,H,K,Y,ee,Z){const ae=d.aq[e.textAnchor],ue=[e.textOffset0,e.textOffset1],fe=Vr(ae,u,c,ue,f),Te=this.collisionIndex.placeCollisionBox(o,F,k,I,A,b,v,K,M.predicate,Z,fe);if((!ee||this.collisionIndex.placeCollisionBox(ee,F,k,I,A,b,v,Y,M.predicate,Z,fe).placeable)&&Te.placeable){let ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(ze=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ue,width:u,height:c,anchor:ae,textBoxScale:f,prevAnchor:ze},this.markUsedJustification(U,ae,j,H),U.allowVerticalPlacement&&(this.markUsedOrientation(U,H,j),this.placedOrientations[j.crossTileID]=H),{shift:fe,placedGlyphBoxes:Te}}}placeLayerBucketPart(e,o,u){const{bucket:c,layout:f,translationText:v,translationIcon:b,posMatrix:k,unwrappedTileID:I,textLabelPlaneMatrix:A,labelToScreenMatrix:M,textPixelRatio:F,holdingForFade:j,collisionBoxArray:U,partiallyEvaluatedTextSize:H,collisionGroup:K}=e.parameters,Y=f.get("text-optional"),ee=f.get("icon-optional"),Z=d.ar(f,"text-overlap","text-allow-overlap"),ae=Z==="always",ue=d.ar(f,"icon-overlap","icon-allow-overlap"),fe=ue==="always",Te=f.get("text-rotation-alignment")==="map",ze=f.get("text-pitch-alignment")==="map",$e=f.get("icon-text-fit")!=="none",Ke=f.get("symbol-z-order")==="viewport-y",Ne=ae&&(fe||!c.hasIconData()||ee),Oe=fe&&(ae||!c.hasTextData()||Y);!c.collisionArrays&&U&&c.deserializeCollisionBoxes(U);const ot=this._getTerrainElevationFunc(this.retainedQueryData[c.bucketInstanceId].tileID),bt=(Ve,He,xt)=>{var cr,It;if(o[Ve.crossTileID])return;if(j)return void(this.placements[Ve.crossTileID]=new Et(!1,!1,!1));let zt=!1,hr=!1,fn=!0,Ii=null,dr={box:null,placeable:!1,offscreen:null},Nn={placeable:!1},In=null,mn=null,Pn=null,Wi=0,Ro=0,El=0;He.textFeatureIndex?Wi=He.textFeatureIndex:Ve.useRuntimeCollisionCircles&&(Wi=Ve.featureIndex),He.verticalTextFeatureIndex&&(Ro=He.verticalTextFeatureIndex);const Fo=He.textBox;if(Fo){const mi=rn=>{let gn=d.ah.horizontal;if(c.allowVerticalPlacement&&!rn&&this.prevPlacement){const ei=this.prevPlacement.placedOrientations[Ve.crossTileID];ei&&(this.placedOrientations[Ve.crossTileID]=ei,gn=ei,this.markUsedOrientation(c,gn,Ve))}return gn},gi=(rn,gn)=>{if(c.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&He.verticalTextBox){for(const ei of c.writingModes)if(ei===d.ah.vertical?(dr=gn(),Nn=dr):dr=rn(),dr&&dr.placeable)break}else dr=rn()},Ms=Ve.textAnchorOffsetStartIndex,Pi=Ve.textAnchorOffsetEndIndex;if(Pi===Ms){const rn=(gn,ei)=>{const Ft=this.collisionIndex.placeCollisionBox(gn,Z,F,k,I,ze,Te,v,K.predicate,ot);return Ft&&Ft.placeable&&(this.markUsedOrientation(c,ei,Ve),this.placedOrientations[Ve.crossTileID]=ei),Ft};gi(()=>rn(Fo,d.ah.horizontal),()=>{const gn=He.verticalTextBox;return c.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&gn?rn(gn,d.ah.vertical):{box:null,offscreen:null}}),mi(dr&&dr.placeable)}else{let rn=d.aq[(It=(cr=this.prevPlacement)===null||cr===void 0?void 0:cr.variableOffsets[Ve.crossTileID])===null||It===void 0?void 0:It.anchor];const gn=(Ft,eo,Bo)=>{const Oo=Ft.x2-Ft.x1,Wh=Ft.y2-Ft.y1,hf=Ve.textBoxScale,Xh=$e&&ue==="never"?eo:null;let zs=null,Kh=Z==="never"?1:2,Pl="never";rn&&Kh++;for(let Da=0;Da<Kh;Da++){for(let Al=Ms;Al<Pi;Al++){const Ml=c.textAnchorOffsets.get(Al);if(rn&&Ml.textAnchor!==rn)continue;const No=this.attemptAnchorPlacement(Ml,Ft,Oo,Wh,hf,Te,ze,F,k,I,K,Pl,Ve,c,Bo,v,b,Xh,ot);if(No&&(zs=No.placedGlyphBoxes,zs&&zs.placeable))return zt=!0,Ii=No.shift,zs}rn?rn=null:Pl=Z}return u&&!zs&&(zs={box:this.collisionIndex.placeCollisionBox(Fo,"always",F,k,I,ze,Te,v,K.predicate,ot,new d.P(0,0)).box,offscreen:!1,placeable:!1}),zs};gi(()=>gn(Fo,He.iconBox,d.ah.horizontal),()=>{const Ft=He.verticalTextBox;return c.allowVerticalPlacement&&(!dr||!dr.placeable)&&Ve.numVerticalGlyphVertices>0&&Ft?gn(Ft,He.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),dr&&(zt=dr.placeable,fn=dr.offscreen);const ei=mi(dr&&dr.placeable);if(!zt&&this.prevPlacement){const Ft=this.prevPlacement.variableOffsets[Ve.crossTileID];Ft&&(this.variableOffsets[Ve.crossTileID]=Ft,this.markUsedJustification(c,Ft.anchor,Ve,ei))}}}if(In=dr,zt=In&&In.placeable,fn=In&&In.offscreen,Ve.useRuntimeCollisionCircles){const mi=c.text.placedSymbolArray.get(Ve.centerJustifiedTextSymbolIndex),gi=d.ai(c.textSizeData,H,mi),Ms=f.get("text-padding");mn=this.collisionIndex.placeCollisionCircles(Z,mi,c.lineVertexArray,c.glyphOffsetArray,gi,k,I,A,M,u,ze,K.predicate,Ve.collisionCircleDiameter,Ms,v,ot),mn.circles.length&&mn.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),zt=ae||mn.circles.length>0&&!mn.collisionDetected,fn=fn&&mn.offscreen}if(He.iconFeatureIndex&&(El=He.iconFeatureIndex),He.iconBox){const mi=gi=>this.collisionIndex.placeCollisionBox(gi,ue,F,k,I,ze,Te,b,K.predicate,ot,$e&&Ii?Ii:void 0);Nn&&Nn.placeable&&He.verticalIconBox?(Pn=mi(He.verticalIconBox),hr=Pn.placeable):(Pn=mi(He.iconBox),hr=Pn.placeable),fn=fn&&Pn.offscreen}const fi=Y||Ve.numHorizontalGlyphVertices===0&&Ve.numVerticalGlyphVertices===0,Il=ee||Ve.numIconVertices===0;fi||Il?Il?fi||(hr=hr&&zt):zt=hr&&zt:hr=zt=hr&&zt;const ac=hr&&Pn.placeable;if(zt&&In.placeable&&this.collisionIndex.insertCollisionBox(In.box,Z,f.get("text-ignore-placement"),c.bucketInstanceId,Nn&&Nn.placeable&&Ro?Ro:Wi,K.ID),ac&&this.collisionIndex.insertCollisionBox(Pn.box,ue,f.get("icon-ignore-placement"),c.bucketInstanceId,El,K.ID),mn&&zt&&this.collisionIndex.insertCollisionCircles(mn.circles,Z,f.get("text-ignore-placement"),c.bucketInstanceId,Wi,K.ID),u&&this.storeCollisionData(c.bucketInstanceId,xt,He,In,Pn,mn),Ve.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ve.crossTileID]=new Et(zt||Ne,hr||Oe,fn||c.justReloaded),o[Ve.crossTileID]=!0};if(Ke){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ve=c.getSortedSymbolIndexes(this.transform.angle);for(let He=Ve.length-1;He>=0;--He){const xt=Ve[He];bt(c.symbolInstances.get(xt),c.collisionArrays[xt],xt)}}else for(let Ve=e.symbolInstanceStart;Ve<e.symbolInstanceEnd;Ve++)bt(c.symbolInstances.get(Ve),c.collisionArrays[Ve],Ve);if(u&&c.bucketInstanceId in this.collisionCircleArrays){const Ve=this.collisionCircleArrays[c.bucketInstanceId];d.as(Ve.invProjMatrix,k),Ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}storeCollisionData(e,o,u,c,f,v){if(u.textBox||u.iconBox){let b,k;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(o)?k=b.get(o):(k={text:null,icon:null},b.set(o,k)),u.textBox&&(k.text=c.box),u.iconBox&&(k.icon=f.box)}if(v){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=new Zt);for(let k=0;k<v.circles.length;k+=4)b.circles.push(v.circles[k+0]),b.circles.push(v.circles[k+1]),b.circles.push(v.circles[k+2]),b.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,o,u,c){let f;f=c===d.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.at(o)];const v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const b of v)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=f>=0&&b!==f?0:u.crossTileID)}markUsedOrientation(e,o,u){const c=o===d.ah.horizontal||o===d.ah.horizontalOnly?o:0,f=o===d.ah.vertical?o:0,v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const b of v)e.text.placedSymbolArray.get(b).placedOrientation=c;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const c=o?o.symbolFadeChange(e):1,f=o?o.opacities:{},v=o?o.variableOffsets:{},b=o?o.placedOrientations:{};for(const k in this.placements){const I=this.placements[k],A=f[k];A?(this.opacities[k]=new fr(A,c,I.text,I.icon),u=u||I.text!==A.text.placed||I.icon!==A.icon.placed):(this.opacities[k]=new fr(null,c,I.text,I.icon,I.skipFade),u=u||I.text||I.icon)}for(const k in f){const I=f[k];if(!this.opacities[k]){const A=new fr(I,c,!1,!1);A.isHidden()||(this.opacities[k]=A,u=u||I.text.placed||I.icon.placed)}}for(const k in v)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=v[k]);for(const k in b)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=b[k]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const u={};for(const c of o){const f=c.getBucket(e);f&&c.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,c.tileID,u,c.collisionBoxArray)}}updateBucketOpacities(e,o,u,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],v=f.layout,b=new fr(null,0,!1,!1,!0),k=v.get("text-allow-overlap"),I=v.get("icon-allow-overlap"),A=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",U=new fr(null,0,k&&(I||!e.hasIconData()||v.get("icon-optional")),I&&(k||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const H=(Y,ee,Z)=>{for(let ae=0;ae<ee/4;ae++)Y.opacityVertexArray.emplaceBack(Z);Y.hasVisibleVertices=Y.hasVisibleVertices||Z!==Ps},K=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const ee=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:ae,crossTileID:ue}=ee;let fe=this.opacities[ue];u[ue]?fe=b:fe||(fe=U,this.opacities[ue]=fe),u[ue]=!0;const Te=ee.numIconVertices>0,ze=this.placedOrientations[ee.crossTileID],$e=ze===d.ah.vertical,Ke=ze===d.ah.horizontal||ze===d.ah.horizontalOnly;if(Z>0||ae>0){const Oe=tn(fe.text);H(e.text,Z,$e?Ps:Oe),H(e.text,ae,Ke?Ps:Oe);const ot=fe.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(He=>{He>=0&&(e.text.placedSymbolArray.get(He).hidden=ot||$e?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=ot||Ke?1:0);const bt=this.variableOffsets[ee.crossTileID];bt&&this.markUsedJustification(e,bt.anchor,ee,ze);const Ve=this.placedOrientations[ee.crossTileID];Ve&&(this.markUsedJustification(e,"left",ee,Ve),this.markUsedOrientation(e,Ve,ee))}if(Te){const Oe=tn(fe.icon),ot=!(j&&ee.verticalPlacedIconSymbolIndex&&$e);ee.placedIconSymbolIndex>=0&&(H(e.icon,ee.numIconVertices,ot?Oe:Ps),e.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=fe.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,ee.numVerticalIconVertices,ot?Ps:Oe),e.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}const Ne=K&&K.has(Y)?K.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Oe=e.collisionArrays[Y];if(Oe){let ot=new d.P(0,0);if(Oe.textBox||Oe.verticalTextBox){let bt=!0;if(A){const Ve=this.variableOffsets[ue];Ve?(ot=Vr(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale),M&&ot._rotate(F?this.transform.angle:-this.transform.angle)):bt=!1}if(Oe.textBox||Oe.verticalTextBox){let Ve;Oe.textBox&&(Ve=$e),Oe.verticalTextBox&&(Ve=Ke),Is(e.textCollisionBox.collisionVertexArray,fe.text.placed,!bt||Ve,Ne.text,ot.x,ot.y)}}if(Oe.iconBox||Oe.verticalIconBox){const bt=!!(!Ke&&Oe.verticalIconBox);let Ve;Oe.iconBox&&(Ve=bt),Oe.verticalIconBox&&(Ve=!bt),Is(e.iconCollisionBox.collisionVertexArray,fe.icon.placed,Ve,Ne.icon,j?ot.x:0,j?ot.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Y.invProjMatrix,e.placementViewportMatrix=Y.viewportMatrix,e.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Is(m,e,o,u,c,f){u&&u.length!==0||(u=[0,0,0,0]);const v=u[0]-St,b=u[1]-St,k=u[2]-St,I=u[3]-St;m.emplaceBack(e?1:0,o?1:0,c||0,f||0,v,b),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,k,b),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,k,I),m.emplaceBack(e?1:0,o?1:0,c||0,f||0,v,I)}const Gt=Math.pow(2,25),fa=Math.pow(2,24),$s=Math.pow(2,17),kn=Math.pow(2,16),dn=Math.pow(2,9),ma=Math.pow(2,8),Fn=Math.pow(2,1);function tn(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,o=Math.floor(127*m.opacity);return o*Gt+e*fa+o*$s+e*kn+o*dn+e*ma+o*Fn+e}const Ps=0;function ls(){return{isOccluded:(m,e,o)=>!1,getPitchedTextCorrection:(m,e,o)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,e,o,u){throw new Error("Not implemented.")},translatePosition:(m,e,o,u)=>function(c,f,v,b,k=!1){if(!v[0]&&!v[1])return[0,0];const I=k?b==="map"?c.angle:0:b==="viewport"?-c.angle:0;if(I){const A=Math.sin(I),M=Math.cos(I);v=[v[0]*M-v[1]*A,v[0]*A+v[1]*M]}return[k?v[0]:Pt(f,v[0],c.zoom),k?v[1]:Pt(f,v[1],c.zoom)]}(m,e,o,u),getCircleRadiusCorrection:m=>1}}class Tr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,u,c,f){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(v,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((b,k)=>b.sortKey-k.sortKey));this._currentPartIndex<v.length;)if(o.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,f())return!0;return!1}}class us{constructor(e,o,u,c,f,v,b,k){this.placement=new en(e,ls(),o,v,b,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,o,u){const c=Q.now(),f=()=>!this._forceFullPlacement&&Q.now()-c>2;for(;this._currentPlacementIndex>=0;){const v=o[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Tr(v)),this._inProgressLayer.continuePlacement(u[v.source],this.placement,this._showCollisionBoxes,v,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Cn=512/d.X/2;class mr{constructor(e,o,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const c=new Map;for(let f=0;f<o.length;f++){const v=o.get(f),b=v.key,k=c.get(b);k?k.push(v):c.set(b,[v])}for(const[f,v]of c){const b={positions:v.map(k=>({x:Math.floor(k.anchorX*Cn),y:Math.floor(k.anchorY*Cn)})),crossTileIDs:v.map(k=>k.crossTileID)};if(b.positions.length>128){const k=new d.av(b.positions.length,16,Uint16Array);for(const{x:I,y:A}of b.positions)k.add(I,A);k.finish(),delete b.positions,b.index=k}this._symbolsByKey[f]=b}}getScaledCoordinates(e,o){const{x:u,y:c,z:f}=this.tileID.canonical,{x:v,y:b,z:k}=o.canonical,I=Cn/Math.pow(2,k-f),A=(b*d.X+e.anchorY)*I,M=c*d.X*Cn;return{x:Math.floor((v*d.X+e.anchorX)*I-u*d.X*Cn),y:Math.floor(A-M)}}findMatches(e,o,u){const c=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let f=0;f<e.length;f++){const v=e.get(f);if(v.crossTileID)continue;const b=this._symbolsByKey[v.key];if(!b)continue;const k=this.getScaledCoordinates(v,o);if(b.index){const I=b.index.range(k.x-c,k.y-c,k.x+c,k.y+c).sort();for(const A of I){const M=b.crossTileIDs[A];if(!u[M]){u[M]=!0,v.crossTileID=M;break}}}else if(b.positions)for(let I=0;I<b.positions.length;I++){const A=b.positions[I],M=b.crossTileIDs[I];if(Math.abs(A.x-k.x)<=c&&Math.abs(A.y-k.y)<=c&&!u[M]){u[M]=!0,v.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class yo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class En{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const u in this.indexes){const c=this.indexes[u],f={};for(const v in c){const b=c[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+o),f[b.tileID.key]=b}this.indexes[u]=f}this.lng=e}addBucket(e,o,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<o.symbolInstances.length;f++)o.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const v=this.indexes[f];if(Number(f)>e.overscaledZ)for(const b in v){const k=v[b];k.tileID.isChildOf(e)&&k.findMatches(o.symbolInstances,e,c)}else{const b=v[e.scaledTo(Number(f)).key];b&&b.findMatches(o.symbolInstances,e,c)}}for(let f=0;f<o.symbolInstances.length;f++){const v=o.symbolInstances.get(f);v.crossTileID||(v.crossTileID=u.generate(),c[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new mr(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const u of o.getCrossTileIDsLists())for(const c of u)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let o=!1;for(const u in this.indexes){const c=this.indexes[u];for(const f in c)e[c[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,c[f]),delete c[f],o=!0)}return o}}class ga{constructor(){this.layerIndexes={},this.crossTileIDs=new yo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,u){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new En);let f=!1;const v={};c.handleWrapJump(u);for(const b of o){const k=b.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(b.tileID,k,this.crossTileIDs)&&(f=!0),v[k.bucketInstanceId]=!0)}return c.removeStaleBuckets(v)&&(f=!0),f}pruneUnusedLayers(e){const o={};e.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Bn=(m,e)=>d.t(m,e&&e.filter(o=>o.identifier!=="source.canvas")),wu=d.aw();class qs extends d.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const c=this.sourceCaches[u].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Rn(ai(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,c)=>this.getGlyphs(u,c)),this.dispatcher.registerMessageHandler("GI",(u,c)=>this.getImages(u,c)),this.imageManager=new Vt,this.imageManager.setEventedParent(this),this.glyphManager=new an(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new ln(256,512),this.crossTileSymbolIndex=new ga,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),Pr().on(Ae,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const c=this.sourceCaches[u.sourceId];if(!c)return;const f=c.getSource();if(f&&f.vectorLayerIds)for(const v in this._layers){const b=this._layers[v];b.source===f.id&&this._validateLayer(b)}})}loadURL(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const f=this._loadStyleRequest;d.h(c,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,o,u)}).catch(v=>{this._loadStyleRequest=null,v&&!f.signal.aborted&&this.fire(new d.j(v))})}loadJSON(e,o={},u){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(wu,{validate:!1})}_load(e,o,u){var c;const f=o.transformStyle?o.transformStyle(u,e):e;if(!o.validate||!Bn(this,d.u(f))){this._loaded=!0,this.stylesheet=f;for(const v in f.sources)this.addSource(v,f.sources[v],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new yt(this.stylesheet.light),this.sky=new qt(this.stylesheet.sky),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of e){const u=d.aA(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(e,o=!1,u=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,v,b,k){return d._(this,void 0,void 0,function*(){const I=it(f),A=b>1?"@2x":"",M={},F={};for(const{id:j,url:U}of I){const H=v.transformRequest(Ge(U,A,".json"),"SpriteJSON");M[j]=d.h(H,k);const K=v.transformRequest(Ge(U,A,".png"),"SpriteImage");F[j]=de.getImage(K,k)}return yield Promise.all([...Object.values(M),...Object.values(F)]),function(j,U){return d._(this,void 0,void 0,function*(){const H={};for(const K in j){H[K]={};const Y=Q.getImageCanvasContext((yield U[K]).data),ee=(yield j[K]).data;for(const Z in ee){const{width:ae,height:ue,x:fe,y:Te,sdf:ze,pixelRatio:$e,stretchX:Ke,stretchY:Ne,content:Oe,textFitWidth:ot,textFitHeight:bt}=ee[Z];H[K][Z]={data:null,pixelRatio:$e,sdf:ze,stretchX:Ke,stretchY:Ne,content:Oe,textFitWidth:ot,textFitHeight:bt,spriteData:{width:ae,height:ue,x:fe,y:Te,context:Y}}}}return H})}(M,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const v in f){this._spritesImagesIds[v]=[];const b=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(k=>!(k in f)):[];for(const k of b)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in f[v]){const I=v==="default"?k:`${v}:${k}`;this._spritesImagesIds[v].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,f[v][k],!1):this.imageManager.addImage(I,f[v][k]),o&&(this._changedImages[I]=!0)}}}).catch(f=>{this._spriteRequest=null,c=f,this.fire(new d.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),u&&u(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const o=this.sourceCaches[e.source];if(!o)return;const u=e.sourceLayer;if(!u)return;const c=o.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.j(new Error(`Source layer "${u}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?d.aB(u):u);const c=[];for(const f of e)if(u[f]){const v=o?d.aB(u[f]):u[f];c.push(v)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const c=this._layers[u];c.type!=="custom"&&(e[u]=c.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const c=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(c.length||f.length)&&this._updateWorkerLayers(c,f);for(const v in this._updatedSources){const b=this._updatedSources[v];if(b==="reload")this._reloadSource(v);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const c in this.sourceCaches){const f=this.sourceCaches[c];u[c]=f.used,f.used=!1}for(const c of this._order){const f=this._layers[c];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const c in u){const f=this.sourceCaches[c];!!u[c]!=!!f.used&&f.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,o&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var u;this._checkLoaded();const c=this.serialize();if(e=o.transformStyle?o.transformStyle(c,e):e,((u=o.validate)===null||u===void 0||u)&&Bn(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const f=d.aC(c,e),v=this._getOperationsToPerform(f);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const b of v.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const o=[],u=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":o.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":o.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,c.args));break;case"setSky":o.push(()=>this.setSky.apply(this,c.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":o.push(()=>{});break;default:u.push(c.command)}return{operations:o,unimplemented:u}}addImage(e,o){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(d.u.source,`sources.${e}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const c=this.sourceCaches[e]=new ft(e,o,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,u={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new d.j(new Error(`Layer "${c}" already exists on this map.`)));let f;if(e.type==="custom"){if(Bn(this,d.aD(e)))return;f=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=d.aB(e),e=d.e(e,{source:c})),this._validate(d.u.layer,`layers.${c}`,e,{arrayIndex:-1},u))return;f=d.aA(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:c}})}const v=o?this._order.indexOf(o):this._order.length;if(o&&v===-1)this.fire(new d.j(new Error(`Cannot add layer "${c}" before non-existing layer "${o}".`)));else{if(this._order.splice(v,0,c),this._layerOrderChanged=!0,this._layers[c]=f,this._removedLayers[c]&&f.source&&f.type!=="custom"){const b=this._removedLayers[c];delete this._removedLayers[c],b.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const u=this._order.indexOf(e);this._order.splice(u,1);const c=o?this._order.indexOf(o):this._order.length;o&&c===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,u){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===o&&c.maxzoom===u||(o!=null&&(c.minzoom=o),u!=null&&(c.maxzoom=u),this._updateLayer(c)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,u={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!d.aE(c.filter,o))return o==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(d.u.filter,`layers.${c.id}.filter`,o,null,u)||(c.filter=d.aB(o),this._updateLayer(c)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,o,u,c={}){this._checkLoaded();const f=this.getLayer(e);f?d.aE(f.getLayoutProperty(o),u)||(f.setLayoutProperty(o,u,c),this._updateLayer(f)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const u=this.getLayer(e);if(u)return u.getLayoutProperty(o);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,u,c={}){this._checkLoaded();const f=this.getLayer(e);f?d.aE(f.getPaintProperty(o),u)||(f.setPaintProperty(o,u,c)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const u=e.source,c=e.sourceLayer,f=this.sourceCaches[u];if(f===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const v=f.getSource().type;v==="geojson"&&c?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||c?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(c,e.id,o)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const u=e.source,c=this.sourceCaches[u];if(c===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const f=c.getSource().type,v=f==="vector"?e.sourceLayer:void 0;f!=="vector"||v?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(v,e.id,o):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,u=e.sourceLayer,c=this.sourceCaches[o];if(c!==void 0)return c.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(u,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,f=>f.serialize()),o=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,c=this.stylesheet;return d.aG({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:e,layers:o,terrain:u},f=>f!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=v=>this._layers[v].type==="fill-extrusion",u={},c=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(o(b)){u[b]=v;for(const k of e){const I=k[b];if(I)for(const A of I)c.push(A)}}}c.sort((v,b)=>b.intersectionZ-v.intersectionZ);const f=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(o(b))for(let k=c.length-1;k>=0;k--){const I=c[k].feature;if(u[I.layer.id]<v)break;f.push(I),c.pop()}else for(const k of e){const I=k[b];if(I)for(const A of I)f.push(A.feature)}}return f}queryRenderedFeatures(e,o,u){o&&o.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);const c={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const b of o.layers){const k=this._layers[b];if(!k)return this.fire(new d.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];c[k.source]=!0}}const f=[];o.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const b in this.sourceCaches)o.layers&&!c[b]||f.push(Vi(this.sourceCaches[b],this._layers,v,e,o,u));return this.placement&&f.push(function(b,k,I,A,M,F,j){const U={},H=F.queryRenderedSymbols(A),K=[];for(const Y of Object.keys(H).map(Number))K.push(j[Y]);K.sort(Si);for(const Y of K){const ee=Y.featureIndex.lookupSymbolFeatures(H[Y.bucketInstanceId],k,Y.bucketIndex,Y.sourceLayerIndex,M.filter,M.layers,M.availableImages,b);for(const Z in ee){const ae=U[Z]=U[Z]||[],ue=ee[Z];ue.sort((fe,Te)=>{const ze=Y.featureSortOrder;if(ze){const $e=ze.indexOf(fe.featureIndex);return ze.indexOf(Te.featureIndex)-$e}return Te.featureIndex-fe.featureIndex});for(const fe of ue)ae.push(fe)}}for(const Y in U)U[Y].forEach(ee=>{const Z=ee.feature,ae=I[b[Y].source].getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=ae});return U}(this._layers,v,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,o){o&&o.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[e];return u?function(c,f){const v=c.getRenderableIds().map(I=>c.getTileByID(I)),b=[],k={};for(let I=0;I<v.length;I++){const A=v[I],M=A.tileID.canonical.key;k[M]||(k[M]=!0,A.querySourceFeatures(b,f))}return b}(u,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const u=this.light.getLight();let c=!1;for(const v in e)if(!d.aE(e[v],u[v])){c=!0;break}if(!c)return;const f={now:Q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(f)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){const u=this.getSky();let c=!1;if(!e&&!u)return;if(e&&!u)c=!0;else if(!e&&u)c=!0;else for(const v in e)if(!d.aE(e[v],u[v])){c=!0;break}if(!c)return;const f={now:Q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(f)}_validate(e,o,u,c,f={}){return(!f||f.validate!==!1)&&Bn(this,e.call(d.u,d.e({key:o,style:this.serialize(),value:u,styleSpec:d.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Pr().off(Ae,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,u,c,f=!1){let v=!1,b=!1;const k={};for(const I of this._order){const A=this._layers[I];if(A.type!=="symbol")continue;if(!k[A.source]){const F=this.sourceCaches[A.source];k[A.source]=F.getRenderableIds(!0).map(j=>F.getTileByID(j)).sort((j,U)=>U.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(U.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(A,k[A.source],e.center.lng);v=v||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Q.now(),e.zoom))&&(this.pauseablePlacement=new us(e,this.map.terrain,this._order,f,o,u,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Q.now()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const I of this._order){const A=this._layers[I];A.type==="symbol"&&this.placement.updateLayerOpacities(A,k[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Q.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,o.icons),u})}getGlyphs(e,o){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),c=this.sourceCaches[o.source];return c&&c.setDependencies(o.tileID.key,o.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,u={},c){this._checkLoaded();const f=[{id:e,url:o}],v=[...it(this.stylesheet.sprite),...f];this._validate(d.u.sprite,"sprite",v,null,u)||(this.stylesheet.sprite=v,this._loadSprite(f,!0,c))}removeSprite(e){this._checkLoaded();const o=it(this.stylesheet.sprite);if(o.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex(u=>u.id===e),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return it(this.stylesheet.sprite)}setSprite(e,o={},u){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var cs=d.Y([{name:"a_pos",type:"Int16",components:2}]);const se={prelude:we(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:we(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:we(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:we(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:we("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:we(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:we(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:we("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:we("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:we("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:we(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:we(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:we(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:we(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:we(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:we(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:we(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:we(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:we(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:we(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:we(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:we(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:we(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:we(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:we(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:we(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:we("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:we("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:we("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:we("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function we(m,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),c=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=f?f.concat(c):c,b={};return{fragmentSource:m=m.replace(o,(k,I,A,M,F)=>(b[F]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(o,(k,I,A,M,F)=>{const j=M==="float"?"vec2":"vec4",U=F.match(/color/)?"color":j;return b[F]?I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${j} a_${F};
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${j} a_${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`}),staticAttributes:u,staticUniforms:v}}class Se{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,u,c,f,v,b,k,I){this.context=e;let A=this.boundPaintVertexBuffers.length!==c.length;for(let M=0;!A&&M<c.length;M++)this.boundPaintVertexBuffers[M]!==c[M]&&(A=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||A||this.boundIndexBuffer!==f||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==I?this.freshBind(o,u,c,f,v,b,k,I):(e.bindVertexArray.set(this.vao),b&&b.bind(),f&&f.dynamicDraw&&f.bind(),k&&k.bind(),I&&I.bind())}freshBind(e,o,u,c,f,v,b,k){const I=e.numAttributes,A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=c,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=k,o.enableAttributes(M,e);for(const F of u)F.enableAttributes(M,e);v&&v.enableAttributes(M,e),b&&b.enableAttributes(M,e),k&&k.enableAttributes(M,e),o.bind(),o.setVertexAttribPointers(M,e,f);for(const F of u)F.bind(),F.setVertexAttribPointers(M,e,f);v&&(v.bind(),v.setVertexAttribPointers(M,e,f)),c&&c.bind(),b&&(b.bind(),b.setVertexAttribPointers(M,e,f)),k&&(k.bind(),k.setVertexAttribPointers(M,e,f)),A.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const je=(m,e,o,u,c)=>({u_matrix:m,u_texture:0,u_ele_delta:e,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(c):0,u_horizon_color:u?u.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function lt(m){const e=[];for(let o=0;o<m.length;o++){if(m[o]===null)continue;const u=m[o].split(" ");e.push(u.pop())}return e}class Tt{constructor(e,o,u,c,f,v){const b=e.gl;this.program=b.createProgram();const k=lt(o.staticAttributes),I=u?u.getBinderAttributes():[],A=k.concat(I),M=se.prelude.staticUniforms?lt(se.prelude.staticUniforms):[],F=o.staticUniforms?lt(o.staticUniforms):[],j=u?u.getBinderUniforms():[],U=M.concat(F).concat(j),H=[];for(const fe of U)H.indexOf(fe)<0&&H.push(fe);const K=u?u.defines():[];f&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;");const Y=K.concat(se.prelude.fragmentSource,o.fragmentSource).join(`
`),ee=K.concat(se.prelude.vertexSource,o.vertexSource).join(`
`),Z=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(Z,Y),b.compileShader(Z),!b.getShaderParameter(Z,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(Z)}`);b.attachShader(this.program,Z);const ae=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(ae,ee),b.compileShader(ae),!b.getShaderParameter(ae,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(ae)}`);b.attachShader(this.program,ae),this.attributes={};const ue={};this.numAttributes=A.length;for(let fe=0;fe<this.numAttributes;fe++)A[fe]&&(b.bindAttribLocation(this.program,fe,A[fe]),this.attributes[A[fe]]=fe);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(ae),b.deleteShader(Z);for(let fe=0;fe<H.length;fe++){const Te=H[fe];if(Te&&!ue[Te]){const ze=b.getUniformLocation(this.program,Te);ze&&(ue[Te]=ze)}}this.fixedUniforms=c(e,ue),this.terrainUniforms=((fe,Te)=>({u_depth:new d.aH(fe,Te.u_depth),u_terrain:new d.aH(fe,Te.u_terrain),u_terrain_dim:new d.aI(fe,Te.u_terrain_dim),u_terrain_matrix:new d.aJ(fe,Te.u_terrain_matrix),u_terrain_unpack:new d.aK(fe,Te.u_terrain_unpack),u_terrain_exaggeration:new d.aI(fe,Te.u_terrain_exaggeration)}))(e,ue),this.binderUniforms=u?u.getUniforms(e,ue):[]}draw(e,o,u,c,f,v,b,k,I,A,M,F,j,U,H,K,Y,ee){const Z=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(c),e.setColorMode(f),e.setCullFace(v),k){e.activeTexture.set(Z.TEXTURE2),Z.bindTexture(Z.TEXTURE_2D,k.depthTexture),e.activeTexture.set(Z.TEXTURE3),Z.bindTexture(Z.TEXTURE_2D,k.texture);for(const ue in this.terrainUniforms)this.terrainUniforms[ue].set(k[ue])}for(const ue in this.fixedUniforms)this.fixedUniforms[ue].set(b[ue]);H&&H.setUniforms(e,this.binderUniforms,j,{zoom:U});let ae=0;switch(o){case Z.LINES:ae=2;break;case Z.TRIANGLES:ae=3;break;case Z.LINE_STRIP:ae=1}for(const ue of F.get()){const fe=ue.vaos||(ue.vaos={});(fe[I]||(fe[I]=new Se)).bind(e,this,A,H?H.getPaintVertexBuffers():[],M,ue.vertexOffset,K,Y,ee),Z.drawElements(o,ue.primitiveLength*ae,Z.UNSIGNED_SHORT,ue.primitiveOffset*ae*2)}}}function Ct(m,e,o){const u=1/Pt(o,1,e.transform.tileZoom),c=Math.pow(2,o.tileID.overscaledZ),f=o.tileSize*Math.pow(2,e.transform.tileZoom)/c,v=f*(o.tileID.canonical.x+o.tileID.wrap*c),b=f*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Ur=(m,e,o,u)=>{const c=e.style.light,f=c.properties.get("position"),v=[f.x,f.y,f.z],b=function(){var I=new d.A(9);return d.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();c.properties.get("anchor")==="viewport"&&function(I,A){var M=Math.sin(A),F=Math.cos(A);I[0]=F,I[1]=M,I[2]=0,I[3]=-M,I[4]=F,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(b,-e.transform.angle),function(I,A,M){var F=A[0],j=A[1],U=A[2];I[0]=F*M[0]+j*M[3]+U*M[6],I[1]=F*M[1]+j*M[4]+U*M[7],I[2]=F*M[2]+j*M[5]+U*M[8]}(v,v,b);const k=c.properties.get("color");return{u_matrix:m,u_lightpos:v,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+o,u_opacity:u}},lr=(m,e,o,u,c,f,v)=>d.e(Ur(m,e,o,u),Ct(f,e,v),{u_height_factor:-Math.pow(2,c.overscaledZ)/v.tileSize/8}),Wt=m=>({u_matrix:m}),On=(m,e,o,u)=>d.e(Wt(m),Ct(o,e,u)),bu=(m,e)=>({u_matrix:m,u_world:e}),Su=(m,e,o,u,c)=>d.e(On(m,e,o,u),{u_world:c}),Nt=(m,e,o,u)=>{const c=m.transform;let f,v;if(u.paint.get("circle-pitch-alignment")==="map"){const b=Pt(o,1,c.zoom);f=!0,v=[b,b]}else f=!1,v=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(e.posMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:v}},Mr=(m,e,o)=>({u_matrix:m,u_inv_matrix:e,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}),hs=(m,e,o=1)=>({u_matrix:m,u_color:e,u_overlay:0,u_overlay_scale:o}),Gr=m=>({u_matrix:m}),Hr=(m,e,o,u)=>({u_matrix:m,u_extrude_scale:Pt(e,1,o),u_intensity:u}),qi=(m,e,o,u)=>{const c=d.H();d.aP(c,0,m.width,m.height,0,0,1);const f=m.context.gl;return{u_matrix:c,u_world:[f.drawingBufferWidth,f.drawingBufferHeight],u_image:o,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function tl(m,e){const o=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new d.Z(0,u/o).toLngLat().lat,new d.Z(0,(u+1)/o).toLngLat().lat]}const rl=(m,e,o,u)=>{const c=m.transform;return{u_matrix:vh(m,e,o,u),u_ratio:1/Pt(e,1,c.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},yh=(m,e,o,u,c)=>d.e(rl(m,e,o,c),{u_image:0,u_image_height:u}),_o=(m,e,o,u,c)=>{const f=m.transform,v=_h(e,f);return{u_matrix:vh(m,e,o,c),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Pt(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Up=(m,e,o,u,c,f)=>{const v=m.lineAtlas,b=_h(e,m.transform),k=o.layout.get("line-cap")==="round",I=v.getDash(u.from,k),A=v.getDash(u.to,k),M=I.width*c.fromScale,F=A.width*c.toScale;return d.e(rl(m,e,o,f),{u_patternscale_a:[b/M,-I.height/2],u_patternscale_b:[b/F,-A.height/2],u_sdfgamma:v.width/(256*Math.min(M,F)*m.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:A.y,u_mix:c.t})};function _h(m,e){return 1/Pt(m,1,e.tileZoom)}function vh(m,e,o,u){return m.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const $p=(m,e,o,u,c)=>{return{u_matrix:m,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(v=c.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(f=c.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:qp(c.paint.get("raster-hue-rotate"))};var f,v};function qp(m){m*=Math.PI/180;const e=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const xh=(m,e,o,u,c,f,v,b,k,I,A,M,F,j)=>{const U=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:U.width/U.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:k,u_coord_matrix:I,u_is_text:+M,u_pitch_with_map:+u,u_is_along_line:c,u_is_variable_anchor:f,u_texsize:F,u_texture:0,u_translation:A,u_pitched_scale:j}},ya=(m,e,o,u,c,f,v,b,k,I,A,M,F,j,U)=>{const H=v.transform;return d.e(xh(m,e,o,u,c,f,v,b,k,I,A,M,F,U),{u_gamma_scale:u?Math.cos(H._pitch)*H.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},Tu=(m,e,o,u,c,f,v,b,k,I,A,M,F,j)=>d.e(ya(m,e,o,u,c,f,v,b,k,I,A,!0,M,!0,j),{u_texsize_icon:F,u_texture_icon:1}),nl=(m,e,o)=>({u_matrix:m,u_opacity:e,u_color:o}),ku=(m,e,o,u,c,f)=>d.e(function(v,b,k,I){const A=k.imageManager.getPattern(v.from.toString()),M=k.imageManager.getPattern(v.to.toString()),{width:F,height:j}=k.imageManager.getPixelSize(),U=Math.pow(2,I.tileID.overscaledZ),H=I.tileSize*Math.pow(2,k.transform.tileZoom)/U,K=H*(I.tileID.canonical.x+I.tileID.wrap*U),Y=H*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[F,j],u_mix:b.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/Pt(I,1,k.transform.tileZoom),u_pixel_coord_upper:[K>>16,Y>>16],u_pixel_coord_lower:[65535&K,65535&Y]}}(u,f,o,c),{u_matrix:m,u_opacity:e}),Cu={fillExtrusion:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_lightpos:new d.aN(m,e.u_lightpos),u_lightintensity:new d.aI(m,e.u_lightintensity),u_lightcolor:new d.aN(m,e.u_lightcolor),u_vertical_gradient:new d.aI(m,e.u_vertical_gradient),u_opacity:new d.aI(m,e.u_opacity)}),fillExtrusionPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_lightpos:new d.aN(m,e.u_lightpos),u_lightintensity:new d.aI(m,e.u_lightintensity),u_lightcolor:new d.aN(m,e.u_lightcolor),u_vertical_gradient:new d.aI(m,e.u_vertical_gradient),u_height_factor:new d.aI(m,e.u_height_factor),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade),u_opacity:new d.aI(m,e.u_opacity)}),fill:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix)}),fillPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),fillOutline:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world)}),fillOutlinePattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world),u_image:new d.aH(m,e.u_image),u_texsize:new d.aO(m,e.u_texsize),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),circle:(m,e)=>({u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(m,e.u_scale_with_map),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_extrude_scale:new d.aO(m,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_matrix:new d.aJ(m,e.u_matrix)}),collisionBox:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_pixel_extrude_scale:new d.aO(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_inv_matrix:new d.aJ(m,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_viewport_size:new d.aO(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new d.aL(m,e.u_color),u_matrix:new d.aJ(m,e.u_matrix),u_overlay:new d.aH(m,e.u_overlay),u_overlay_scale:new d.aI(m,e.u_overlay_scale)}),clippingMask:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix)}),heatmap:(m,e)=>({u_extrude_scale:new d.aI(m,e.u_extrude_scale),u_intensity:new d.aI(m,e.u_intensity),u_matrix:new d.aJ(m,e.u_matrix)}),heatmapTexture:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_world:new d.aO(m,e.u_world),u_image:new d.aH(m,e.u_image),u_color_ramp:new d.aH(m,e.u_color_ramp),u_opacity:new d.aI(m,e.u_opacity)}),hillshade:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_latrange:new d.aO(m,e.u_latrange),u_light:new d.aO(m,e.u_light),u_shadow:new d.aL(m,e.u_shadow),u_highlight:new d.aL(m,e.u_highlight),u_accent:new d.aL(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_image:new d.aH(m,e.u_image),u_dimension:new d.aO(m,e.u_dimension),u_zoom:new d.aI(m,e.u_zoom),u_unpack:new d.aK(m,e.u_unpack)}),line:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_image:new d.aH(m,e.u_image),u_image_height:new d.aI(m,e.u_image_height)}),linePattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texsize:new d.aO(m,e.u_texsize),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_image:new d.aH(m,e.u_image),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_scale:new d.aN(m,e.u_scale),u_fade:new d.aI(m,e.u_fade)}),lineSDF:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ratio:new d.aI(m,e.u_ratio),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(m,e.u_units_to_pixels),u_patternscale_a:new d.aO(m,e.u_patternscale_a),u_patternscale_b:new d.aO(m,e.u_patternscale_b),u_sdfgamma:new d.aI(m,e.u_sdfgamma),u_image:new d.aH(m,e.u_image),u_tex_y_a:new d.aI(m,e.u_tex_y_a),u_tex_y_b:new d.aI(m,e.u_tex_y_b),u_mix:new d.aI(m,e.u_mix)}),raster:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_tl_parent:new d.aO(m,e.u_tl_parent),u_scale_parent:new d.aI(m,e.u_scale_parent),u_buffer_scale:new d.aI(m,e.u_buffer_scale),u_fade_t:new d.aI(m,e.u_fade_t),u_opacity:new d.aI(m,e.u_opacity),u_image0:new d.aH(m,e.u_image0),u_image1:new d.aH(m,e.u_image1),u_brightness_low:new d.aI(m,e.u_brightness_low),u_brightness_high:new d.aI(m,e.u_brightness_high),u_saturation_factor:new d.aI(m,e.u_saturation_factor),u_contrast_factor:new d.aI(m,e.u_contrast_factor),u_spin_weights:new d.aN(m,e.u_spin_weights)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texture:new d.aH(m,e.u_texture),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texture:new d.aH(m,e.u_texture),u_gamma_scale:new d.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_is_halo:new d.aH(m,e.u_is_halo),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new d.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(m,e.u_is_size_feature_constant),u_size_t:new d.aI(m,e.u_size_t),u_size:new d.aI(m,e.u_size),u_camera_to_center_distance:new d.aI(m,e.u_camera_to_center_distance),u_pitch:new d.aI(m,e.u_pitch),u_rotate_symbol:new d.aH(m,e.u_rotate_symbol),u_aspect_ratio:new d.aI(m,e.u_aspect_ratio),u_fade_change:new d.aI(m,e.u_fade_change),u_matrix:new d.aJ(m,e.u_matrix),u_label_plane_matrix:new d.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(m,e.u_coord_matrix),u_is_text:new d.aH(m,e.u_is_text),u_pitch_with_map:new d.aH(m,e.u_pitch_with_map),u_is_along_line:new d.aH(m,e.u_is_along_line),u_is_variable_anchor:new d.aH(m,e.u_is_variable_anchor),u_texsize:new d.aO(m,e.u_texsize),u_texsize_icon:new d.aO(m,e.u_texsize_icon),u_texture:new d.aH(m,e.u_texture),u_texture_icon:new d.aH(m,e.u_texture_icon),u_gamma_scale:new d.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(m,e.u_device_pixel_ratio),u_is_halo:new d.aH(m,e.u_is_halo),u_translation:new d.aO(m,e.u_translation),u_pitched_scale:new d.aI(m,e.u_pitched_scale)}),background:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_opacity:new d.aI(m,e.u_opacity),u_color:new d.aL(m,e.u_color)}),backgroundPattern:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_opacity:new d.aI(m,e.u_opacity),u_image:new d.aH(m,e.u_image),u_pattern_tl_a:new d.aO(m,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(m,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(m,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(m,e.u_pattern_br_b),u_texsize:new d.aO(m,e.u_texsize),u_mix:new d.aI(m,e.u_mix),u_pattern_size_a:new d.aO(m,e.u_pattern_size_a),u_pattern_size_b:new d.aO(m,e.u_pattern_size_b),u_scale_a:new d.aI(m,e.u_scale_a),u_scale_b:new d.aI(m,e.u_scale_b),u_pixel_coord_upper:new d.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texture:new d.aH(m,e.u_texture),u_ele_delta:new d.aI(m,e.u_ele_delta),u_fog_matrix:new d.aJ(m,e.u_fog_matrix),u_fog_color:new d.aL(m,e.u_fog_color),u_fog_ground_blend:new d.aI(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(m,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(m,e.u_horizon_color),u_horizon_fog_blend:new d.aI(m,e.u_horizon_fog_blend)}),terrainDepth:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_ele_delta:new d.aI(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_matrix:new d.aJ(m,e.u_matrix),u_texture:new d.aH(m,e.u_texture),u_terrain_coords_id:new d.aI(m,e.u_terrain_coords_id),u_ele_delta:new d.aI(m,e.u_ele_delta)}),sky:(m,e)=>({u_sky_color:new d.aL(m,e.u_sky_color),u_horizon_color:new d.aL(m,e.u_horizon_color),u_horizon:new d.aI(m,e.u_horizon),u_sky_horizon_blend:new d.aI(m,e.u_sky_horizon_blend)})};class Zi{constructor(e,o,u){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Eu{constructor(e,o,u,c){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=c,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let u=0;u<this.attributes.length;u++){const c=o.attributes[this.attributes[u].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,o,u){for(let c=0;c<this.attributes.length;c++){const f=this.attributes[c],v=o.attributes[f.name];v!==void 0&&e.vertexAttribPointer(v,f.components,e[Zp[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zs=new WeakMap;function As(m){var e;if(Zs.has(m))return Zs.get(m);{const o=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Zs.set(m,o),o}}class Ht{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class il extends Ht{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Gp extends Ht{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class vo extends Ht{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Hp extends Ht{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class wh extends Ht{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Wp extends Ht{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class bh extends Ht{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Iu extends Ht{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Sh extends Ht{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Th extends Ht{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class kh extends Ht{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ch extends Ht{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Gs extends Ht{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Eh extends Ht{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Xp extends Ht{getDefault(){return d.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ih extends Ht{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class _a extends Ht{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class Kp extends Ht{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class sl extends Ht{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Yp extends Ht{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Jp extends Ht{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ph extends Ht{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ah extends Ht{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Mh extends Ht{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Pu extends Ht{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class zh extends Ht{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ol extends Ht{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ds extends Ht{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const u=this.gl;As(u)?u.bindVertexArray(e):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Au extends Ht{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Mu extends Ht{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class zu extends Ht{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class al extends Ht{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class Du extends al{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Hs extends al{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Lu extends al{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Qp{constructor(e,o,u,c,f){this.context=e,this.width=o,this.height=u;const v=e.gl,b=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Du(e,b),c)this.depthAttachment=f?new Lu(e,b):new Hs(e,b);else if(f)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class kr{constructor(e,o,u){this.blendFunction=e,this.blendColor=o,this.mask=u}}kr.Replace=[1,0],kr.disabled=new kr(kr.Replace,d.aM.transparent,[!1,!1,!1,!1]),kr.unblended=new kr(kr.Replace,d.aM.transparent,[!0,!0,!0,!0]),kr.alphaBlended=new kr([1,771],d.aM.transparent,[!0,!0,!0,!0]);class ef{constructor(e){var o,u;if(this.gl=e,this.clearColor=new il(this),this.clearDepth=new Gp(this),this.clearStencil=new vo(this),this.colorMask=new Hp(this),this.depthMask=new wh(this),this.stencilMask=new Wp(this),this.stencilFunc=new bh(this),this.stencilOp=new Iu(this),this.stencilTest=new Sh(this),this.depthRange=new Th(this),this.depthTest=new kh(this),this.depthFunc=new Ch(this),this.blend=new Gs(this),this.blendFunc=new Eh(this),this.blendColor=new Xp(this),this.blendEquation=new Ih(this),this.cullFace=new _a(this),this.cullFaceSide=new Kp(this),this.frontFace=new sl(this),this.program=new Yp(this),this.activeTexture=new Jp(this),this.viewport=new Ph(this),this.bindFramebuffer=new Ah(this),this.bindRenderbuffer=new Mh(this),this.bindTexture=new Pu(this),this.bindVertexBuffer=new zh(this),this.bindElementBuffer=new ol(this),this.bindVertexArray=new ds(this),this.pixelStoreUnpack=new Au(this),this.pixelStoreUnpackPremultiplyAlpha=new Mu(this),this.pixelStoreUnpackFlipY=new zu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),As(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new Zi(this,e,o)}createVertexBuffer(e,o,u){return new Eu(this,e,o,u)}createRenderbuffer(e,o,u){const c=this.gl,f=c.createRenderbuffer();return this.bindRenderbuffer.set(f),c.renderbufferStorage(c.RENDERBUFFER,e,o,u),this.bindRenderbuffer.set(null),f}createFramebuffer(e,o,u,c){return new Qp(this,e,o,u,c)}clear({color:e,depth:o,stencil:u}){const c=this.gl;let f=0;e&&(f|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(f|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(f|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),c.clear(f)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,kr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return As(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return As(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class At{constructor(e,o,u){this.func=e,this.mask=o,this.range=u}}At.ReadOnly=!1,At.ReadWrite=!0,At.disabled=new At(519,At.ReadOnly,[0,1]);const ll=7680;class ir{constructor(e,o,u,c,f,v){this.test=e,this.ref=o,this.mask=u,this.fail=c,this.depthFail=f,this.pass=v}}ir.disabled=new ir({func:519,mask:0},0,0,ll,ll,ll);class Jt{constructor(e,o,u){this.enable=e,this.mode=o,this.frontFace=u}}let Ws;function va(m,e,o,u,c){const f=m.context,v=f.gl,b=m.useProgram("collisionBox"),k=[];let I=0,A=0;for(let Y=0;Y<u.length;Y++){const ee=u[Y],Z=e.getTile(ee).getBucket(o);if(!Z)continue;const ae=c?Z.textCollisionBox:Z.iconCollisionBox,ue=Z.collisionCircleArray;if(ue.length>0){const fe=d.H();d.aQ(fe,Z.placementInvProjMatrix,m.transform.glCoordMatrix),d.aQ(fe,fe,Z.placementViewportMatrix),k.push({circleArray:ue,circleOffset:A,transform:ee.posMatrix,invTransform:fe,coord:ee}),I+=ue.length/4,A=I}ae&&b.draw(f,v.LINES,At.disabled,ir.disabled,m.colorModeForRenderPass(),Jt.disabled,{u_matrix:ee.posMatrix,u_pixel_extrude_scale:[1/(M=m.transform).width,1/M.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee),o.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,m.transform.zoom,null,null,ae.collisionVertexBuffer)}var M;if(!c||!k.length)return;const F=m.useProgram("collisionCircle"),j=new d.aR;j.resize(4*I),j._trim();let U=0;for(const Y of k)for(let ee=0;ee<Y.circleArray.length/4;ee++){const Z=4*ee,ae=Y.circleArray[Z+0],ue=Y.circleArray[Z+1],fe=Y.circleArray[Z+2],Te=Y.circleArray[Z+3];j.emplace(U++,ae,ue,fe,Te,0),j.emplace(U++,ae,ue,fe,Te,1),j.emplace(U++,ae,ue,fe,Te,2),j.emplace(U++,ae,ue,fe,Te,3)}(!Ws||Ws.length<2*I)&&(Ws=function(Y){const ee=2*Y,Z=new d.aT;Z.resize(ee),Z._trim();for(let ae=0;ae<ee;ae++){const ue=6*ae;Z.uint16[ue+0]=4*ae+0,Z.uint16[ue+1]=4*ae+1,Z.uint16[ue+2]=4*ae+2,Z.uint16[ue+3]=4*ae+2,Z.uint16[ue+4]=4*ae+3,Z.uint16[ue+5]=4*ae+0}return Z}(I));const H=f.createIndexBuffer(Ws,!0),K=f.createVertexBuffer(j,d.aS.members,!0);for(const Y of k){const ee=Mr(Y.transform,Y.invTransform,m.transform);F.draw(f,v.TRIANGLES,At.disabled,ir.disabled,m.colorModeForRenderPass(),Jt.disabled,ee,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y.coord),o.id,K,H,d.a0.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}K.destroy(),H.destroy()}Jt.disabled=new Jt(!1,1029,2305),Jt.backCCW=new Jt(!0,1029,2305);const xa=d.an(new Float32Array(16));function Ru(m,e,o,u,c,f){const{horizontalAlign:v,verticalAlign:b}=d.au(m);return new d.P((-(v-.5)*e/c+u[0])*f,(-(b-.5)*o/c+u[1])*f)}function Xs(m,e,o,u,c,f){const v=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=u.mult(f);o||(b=b.rotate(-c));const k=v.add(b);return W(k.x,k.y,e.labelPlaneMatrix,e.getElevation).point}if(o){const b=ve(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),k=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return m.add(u.rotate(k))}return m.add(u)}function xo(m,e,o,u,c,f,v,b,k,I,A,M,F,j){const U=m.text.placedSymbolArray,H=m.text.dynamicLayoutVertexArray,K=m.icon.dynamicLayoutVertexArray,Y={};H.clear();for(let ee=0;ee<U.length;ee++){const Z=U.get(ee),ae=Z.hidden||!Z.crossTileID||m.allowVerticalPlacement&&!Z.placedOrientation?null:u[Z.crossTileID];if(ae){const ue=new d.P(Z.anchorX,Z.anchorY),fe={getElevation:j,width:c.width,height:c.height,labelPlaneMatrix:f,pitchWithMap:o,projection:A,tileAnchorPoint:ue,translation:M,unwrappedTileID:F},Te=o?W(ue.x,ue.y,v,j):ve(ue.x,ue.y,fe),ze=L(c.cameraToCenterDistance,Te.signedDistanceFromCamera);let $e=d.ai(m.textSizeData,k,Z)*ze/d.ap;o&&($e*=m.tilePixelRatio/b);const{width:Ke,height:Ne,anchor:Oe,textOffset:ot,textBoxScale:bt}=ae,Ve=Ru(Oe,Ke,Ne,ot,bt,$e),He=A.getPitchedTextCorrection(c,ue.add(new d.P(M[0],M[1])),F),xt=Xs(Te.point,fe,e,Ve,c.angle,He),cr=m.allowVerticalPlacement&&Z.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let It=0;It<Z.numGlyphs;It++)d.aj(H,xt,cr);I&&Z.associatedIconIndex>=0&&(Y[Z.associatedIconIndex]={shiftedAnchor:xt,angle:cr})}else ht(Z.numGlyphs,H)}if(I){K.clear();const ee=m.icon.placedSymbolArray;for(let Z=0;Z<ee.length;Z++){const ae=ee.get(Z);if(ae.hidden)ht(ae.numGlyphs,K);else{const ue=Y[Z];if(ue)for(let fe=0;fe<ae.numGlyphs;fe++)d.aj(K,ue.shiftedAnchor,ue.angle);else ht(ae.numGlyphs,K)}}m.icon.dynamicLayoutVertexBuffer.updateData(K)}m.text.dynamicLayoutVertexBuffer.updateData(H)}function hi(m,e,o){return o.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Fu(m,e,o,u,c,f,v,b,k,I,A,M){const F=m.context,j=F.gl,U=m.transform,H=ls(),K=b==="map",Y=k==="map",ee=b!=="viewport"&&o.layout.get("symbol-placement")!=="point",Z=K&&!Y&&!ee,ae=!Y&&ee,ue=!o.layout.get("symbol-sort-key").isConstant();let fe=!1;const Te=m.depthModeForSublayer(0,At.ReadOnly),ze=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$e=[],Ke=H.getCircleRadiusCorrection(U);for(const Ne of u){const Oe=e.getTile(Ne),ot=Oe.getBucket(o);if(!ot)continue;const bt=c?ot.text:ot.icon;if(!bt||!bt.segments.get().length||!bt.hasVisibleVertices)continue;const Ve=bt.programConfigurations.get(o.id),He=c||ot.sdfIcons,xt=c?ot.textSizeData:ot.iconSizeData,cr=Y||U.pitch!==0,It=m.useProgram(hi(He,c,ot),Ve),zt=d.ag(xt,U.zoom),hr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ne);let fn,Ii,dr,Nn,In=[0,0],mn=null;if(c)Ii=Oe.glyphAtlasTexture,dr=j.LINEAR,fn=Oe.glyphAtlasTexture.size,ot.iconsInText&&(In=Oe.imageAtlasTexture.size,mn=Oe.imageAtlasTexture,Nn=cr||m.options.rotating||m.options.zooming||xt.kind==="composite"||xt.kind==="camera"?j.LINEAR:j.NEAREST);else{const Ft=o.layout.get("icon-size").constantOr(0)!==1||ot.iconsNeedLinear;Ii=Oe.imageAtlasTexture,dr=He||m.options.rotating||m.options.zooming||Ft||cr?j.LINEAR:j.NEAREST,fn=Oe.imageAtlasTexture.size}const Pn=Pt(Oe,1,m.transform.zoom),Wi=ae?Ne.posMatrix:xa,Ro=ci(Wi,Y,K,m.transform,Pn),El=hn(Wi,Y,K,m.transform,Pn),Fo=hn(Ne.posMatrix,Y,K,m.transform,Pn),fi=H.translatePosition(m.transform,Oe,f,v),Il=ze&&ot.hasTextData(),ac=o.layout.get("icon-text-fit")!=="none"&&Il&&ot.hasIconData();if(ee){const Ft=m.style.map.terrain?(Bo,Oo)=>m.style.map.terrain.getElevation(Ne,Bo,Oo):null,eo=o.layout.get("text-rotation-alignment")==="map";O(ot,Ne.posMatrix,m,c,Ro,Fo,Y,I,eo,H,Ne.toUnwrapped(),U.width,U.height,fi,Ft)}const mi=Ne.posMatrix,gi=c&&ze||ac,Ms=ee||gi?xa:Ro,Pi=El,rn=He&&o.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let gn;gn=He?ot.iconsInText?Tu(xt.kind,zt,Z,Y,ee,gi,m,mi,Ms,Pi,fi,fn,In,Ke):ya(xt.kind,zt,Z,Y,ee,gi,m,mi,Ms,Pi,fi,c,fn,!0,Ke):xh(xt.kind,zt,Z,Y,ee,gi,m,mi,Ms,Pi,fi,c,fn,Ke);const ei={program:It,buffers:bt,uniformValues:gn,atlasTexture:Ii,atlasTextureIcon:mn,atlasInterpolation:dr,atlasInterpolationIcon:Nn,isSDF:He,hasHalo:rn};if(ue&&ot.canOverlap){fe=!0;const Ft=bt.segments.get();for(const eo of Ft)$e.push({segments:new d.a0([eo]),sortKey:eo.sortKey,state:ei,terrainData:hr})}else $e.push({segments:bt.segments,sortKey:0,state:ei,terrainData:hr})}fe&&$e.sort((Ne,Oe)=>Ne.sortKey-Oe.sortKey);for(const Ne of $e){const Oe=Ne.state;if(F.activeTexture.set(j.TEXTURE0),Oe.atlasTexture.bind(Oe.atlasInterpolation,j.CLAMP_TO_EDGE),Oe.atlasTextureIcon&&(F.activeTexture.set(j.TEXTURE1),Oe.atlasTextureIcon&&Oe.atlasTextureIcon.bind(Oe.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),Oe.isSDF){const ot=Oe.uniformValues;Oe.hasHalo&&(ot.u_is_halo=1,Bu(Oe.buffers,Ne.segments,o,m,Oe.program,Te,A,M,ot,Ne.terrainData)),ot.u_is_halo=0}Bu(Oe.buffers,Ne.segments,o,m,Oe.program,Te,A,M,Oe.uniformValues,Ne.terrainData)}}function Bu(m,e,o,u,c,f,v,b,k,I){const A=u.context;c.draw(A,A.gl.TRIANGLES,f,v,b,Jt.disabled,k,I,o.id,m.layoutVertexBuffer,m.indexBuffer,e,o.paint,u.transform.zoom,m.programConfigurations.get(o.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Ou(m,e,o,u){const c=m.context,f=c.gl,v=ir.disabled,b=new kr([f.ONE,f.ONE],d.aM.transparent,[!0,!0,!0,!0]),k=e.getBucket(o);if(!k)return;const I=u.key;let A=o.heatmapFbos.get(I);A||(A=wa(c,e.tileSize,e.tileSize),o.heatmapFbos.set(I,A)),c.bindFramebuffer.set(A.framebuffer),c.viewport.set([0,0,e.tileSize,e.tileSize]),c.clear({color:d.aM.transparent});const M=k.programConfigurations.get(o.id),F=m.useProgram("heatmap",M),j=m.style.map.terrain.getTerrainData(u);F.draw(c,f.TRIANGLES,At.disabled,v,b,Jt.disabled,Hr(u.posMatrix,e,m.transform.zoom,o.paint.get("heatmap-intensity")),j,o.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,o.paint,m.transform.zoom,M)}function Ks(m,e,o){const u=m.context,c=u.gl;u.setColorMode(m.colorModeForRenderPass());const f=ba(u,e),v=o.key,b=e.heatmapFbos.get(v);b&&(u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,b.colorAttachment.get()),u.activeTexture.set(c.TEXTURE1),f.bind(c.LINEAR,c.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(u,c.TRIANGLES,At.disabled,ir.disabled,m.colorModeForRenderPass(),Jt.disabled,qi(m,e,0,1),null,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,m.transform.zoom),b.destroy(),e.heatmapFbos.delete(v))}function wa(m,e,o){var u,c;const f=m.gl,v=f.createTexture();f.bindTexture(f.TEXTURE_2D,v),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);const b=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:f.UNSIGNED_BYTE,k=(c=m.RGBA16F)!==null&&c!==void 0?c:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,k,e,o,0,f.RGBA,b,null);const I=m.createFramebuffer(e,o,!1,!1);return I.colorAttachment.set(v),I}function ba(m,e){return e.colorRampTexture||(e.colorRampTexture=new Ye(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function wo(m,e,o,u,c){if(!o||!u||!u.imageAtlas)return;const f=u.imageAtlas.patternPositions;let v=f[o.to.toString()],b=f[o.from.toString()];if(!v&&b&&(v=b),!b&&v&&(b=v),!v||!b){const k=c.getPaintProperty(e);v=f[k],b=f[k]}v&&b&&m.setConstantPatternPositions(v,b)}function Sa(m,e,o,u,c,f,v){const b=m.context.gl,k="fill-pattern",I=o.paint.get(k),A=I&&I.constantOr(1),M=o.getCrossfadeParameters();let F,j,U,H,K;v?(j=A&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=b.LINES):(j=A?"fillPattern":"fill",F=b.TRIANGLES);const Y=I.constantOr(null);for(const ee of u){const Z=e.getTile(ee);if(A&&!Z.patternsLoaded())continue;const ae=Z.getBucket(o);if(!ae)continue;const ue=ae.programConfigurations.get(o.id),fe=m.useProgram(j,ue),Te=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee);A&&(m.context.activeTexture.set(b.TEXTURE0),Z.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),ue.updatePaintBuffers(M)),wo(ue,k,Y,Z,o);const ze=Te?ee:null,$e=m.translatePosMatrix(ze?ze.posMatrix:ee.posMatrix,Z,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(v){H=ae.indexBuffer2,K=ae.segments2;const Ke=[b.drawingBufferWidth,b.drawingBufferHeight];U=j==="fillOutlinePattern"&&A?Su($e,m,M,Z,Ke):bu($e,Ke)}else H=ae.indexBuffer,K=ae.segments,U=A?On($e,m,M,Z):Wt($e);fe.draw(m.context,F,c,m.stencilModeForClipping(ee),f,Jt.disabled,U,Te,o.id,ae.layoutVertexBuffer,H,K,o.paint,m.transform.zoom,ue)}}function ul(m,e,o,u,c,f,v){const b=m.context,k=b.gl,I="fill-extrusion-pattern",A=o.paint.get(I),M=A.constantOr(1),F=o.getCrossfadeParameters(),j=o.paint.get("fill-extrusion-opacity"),U=A.constantOr(null);for(const H of u){const K=e.getTile(H),Y=K.getBucket(o);if(!Y)continue;const ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(H),Z=Y.programConfigurations.get(o.id),ae=m.useProgram(M?"fillExtrusionPattern":"fillExtrusion",Z);M&&(m.context.activeTexture.set(k.TEXTURE0),K.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Z.updatePaintBuffers(F)),wo(Z,I,U,K,o);const ue=m.translatePosMatrix(H.posMatrix,K,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),fe=o.paint.get("fill-extrusion-vertical-gradient"),Te=M?lr(ue,m,fe,j,H,F,K):Ur(ue,m,fe,j);ae.draw(b,b.gl.TRIANGLES,c,f,v,Jt.backCCW,Te,ee,o.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,o.paint,m.transform.zoom,Z,m.style.map.terrain&&Y.centroidVertexBuffer)}}function bo(m,e,o,u,c,f,v){const b=m.context,k=b.gl,I=o.fbo;if(!I)return;const A=m.useProgram("hillshade"),M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(e);b.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,I.colorAttachment.get()),A.draw(b,k.TRIANGLES,c,f,v,Jt.disabled,((F,j,U,H)=>{const K=U.paint.get("hillshade-shadow-color"),Y=U.paint.get("hillshade-highlight-color"),ee=U.paint.get("hillshade-accent-color");let Z=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(Z-=F.transform.angle);const ae=!F.options.moving;return{u_matrix:H?H.posMatrix:F.transform.calculatePosMatrix(j.tileID.toUnwrapped(),ae),u_image:0,u_latrange:tl(0,j.tileID),u_light:[U.paint.get("hillshade-exaggeration"),Z],u_shadow:K,u_highlight:Y,u_accent:ee}})(m,o,u,M?e:null),M,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function So(m,e,o,u,c,f){const v=m.context,b=v.gl,k=e.dem;if(k&&k.data){const I=k.dim,A=k.stride,M=k.getPixels();if(v.activeTexture.set(b.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||m.getTileTexture(A),e.demTexture){const j=e.demTexture;j.update(M,{premultiply:!1}),j.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else e.demTexture=new Ye(v,M,b.RGBA,{premultiply:!1}),e.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);v.activeTexture.set(b.TEXTURE0);let F=e.fbo;if(!F){const j=new Ye(v,{width:I,height:I,data:null},b.RGBA);j.bind(b.LINEAR,b.CLAMP_TO_EDGE),F=e.fbo=v.createFramebuffer(I,I,!0,!1),F.colorAttachment.set(j.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,I,I]),m.useProgram("hillshadePrepare").draw(v,b.TRIANGLES,u,c,f,Jt.disabled,((j,U)=>{const H=U.stride,K=d.H();return d.aP(K,0,d.X,-d.X,0,0,1),d.J(K,K,[0,-d.X,0]),{u_matrix:K,u_image:1,u_dimension:[H,H],u_zoom:j.overscaledZ,u_unpack:U.getUnpackVector()}})(e.tileID,k),null,o.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Dh(m,e,o,u,c,f){const v=u.paint.get("raster-fade-duration");if(!f&&v>0){const b=Q.now(),k=(b-m.timeAdded)/v,I=e?(b-e.timeAdded)/v:-1,A=o.getSource(),M=c.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(m.tileID.overscaledZ-M),j=F&&m.refreshedUponExpiration?1:d.ac(F?k:1-I,0,1);return m.refreshedUponExpiration&&k>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Nu=new d.aM(1,0,0,1),Ut=new d.aM(0,1,0,1),cl=new d.aM(0,0,1,1),tf=new d.aM(1,0,1,1),Lh=new d.aM(0,1,1,1);function To(m,e,o,u){hl(m,0,e+o/2,m.transform.width,o,u)}function Rh(m,e,o,u){hl(m,e-o/2,0,o,m.transform.height,u)}function hl(m,e,o,u,c,f){const v=m.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*m.pixelRatio,o*m.pixelRatio,u*m.pixelRatio,c*m.pixelRatio),v.clear({color:f}),b.disable(b.SCISSOR_TEST)}function Fh(m,e,o){const u=m.context,c=u.gl,f=o.posMatrix,v=m.useProgram("debug"),b=At.disabled,k=ir.disabled,I=m.colorModeForRenderPass(),A="$debug",M=m.style.map.terrain&&m.style.map.terrain.getTerrainData(o);u.activeTexture.set(c.TEXTURE0);const F=e.getTileByID(o.key).latestRawTileData,j=Math.floor((F&&F.byteLength||0)/1024),U=e.getTile(o).tileSize,H=512/Math.min(U,512)*(o.overscaledZ/m.transform.zoom)*.5;let K=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(K+=` => ${o.overscaledZ}`),function(Y,ee){Y.initDebugOverlayCanvas();const Z=Y.debugOverlayCanvas,ae=Y.context.gl,ue=Y.debugOverlayCanvas.getContext("2d");ue.clearRect(0,0,Z.width,Z.height),ue.shadowColor="white",ue.shadowBlur=2,ue.lineWidth=1.5,ue.strokeStyle="white",ue.textBaseline="top",ue.font="bold 36px Open Sans, sans-serif",ue.fillText(ee,5,5),ue.strokeText(ee,5,5),Y.debugOverlayTexture.update(Z),Y.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(m,`${K} ${j}kB`),v.draw(u,c.TRIANGLES,b,k,kr.alphaBlended,Jt.disabled,hs(f,d.aM.transparent,H),null,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),v.draw(u,c.LINE_STRIP,b,k,I,Jt.disabled,hs(f,d.aM.red),M,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Bh(m,e,o){const u=m.context,c=u.gl,f=m.colorModeForRenderPass(),v=new At(c.LEQUAL,At.ReadWrite,m.depthRangeFor3D),b=m.useProgram("terrain"),k=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,m.width,m.height]);for(const I of o){const A=m.renderToTexture.getTexture(I),M=e.getTerrainData(I.tileID);u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,A.texture);const F=m.transform.calculatePosMatrix(I.tileID.toUnwrapped()),j=e.getMeshFrameDelta(m.transform.zoom),U=m.transform.calculateFogMatrix(I.tileID.toUnwrapped()),H=je(F,j,U,m.style.sky,m.transform.pitch);b.draw(u,c.TRIANGLES,v,ir.disabled,f,Jt.backCCW,H,M,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class dl{constructor(e,o,u){this.vertexBuffer=e,this.indexBuffer=o,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class pl{constructor(e,o){this.context=new ef(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ft.maxUnderzooming+ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ga}resize(e,o,u){if(this.width=Math.floor(e*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,o=new d.aX;o.emplaceBack(0,0),o.emplaceBack(d.X,0),o.emplaceBack(0,d.X),o.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(o,cs.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const u=new d.aX;u.emplaceBack(0,0),u.emplaceBack(d.X,0),u.emplaceBack(0,d.X),u.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(u,cs.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const c=new d.$;c.emplaceBack(0,0,0,0),c.emplaceBack(d.X,0,d.X,0),c.emplaceBack(0,d.X,0,d.X),c.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,Xn.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const f=new d.aX;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,cs.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const v=new d.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const b=new d.aY;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(b);const k=this.context.gl;this.stencilClearMode=new ir({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.H();d.aP(u,0,this.width,this.height,0,0,1),d.K(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,At.disabled,this.stencilClearMode,kr.disabled,Jt.disabled,Gr(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;const u=this.context,c=u.gl;this.nextStencilID+o.length>256&&this.clearStencil(),u.setColorMode(kr.disabled),u.setDepthMode(At.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of o){const b=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);f.draw(u,c.TRIANGLES,At.disabled,new ir({func:c.ALWAYS,mask:0},b,255,c.KEEP,c.KEEP,c.REPLACE),kr.disabled,Jt.disabled,Gr(v.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new ir({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new ir({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){const o=this.context.gl,u=e.sort((v,b)=>b.overscaledZ-v.overscaledZ),c=u[u.length-1].overscaledZ,f=u[0].overscaledZ-c+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const v={};for(let b=0;b<f;b++)v[b+c]=new ir({func:o.GEQUAL,mask:255},b+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=f,[v,u]}return[{[c]:ir.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new kr([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?kr.unblended:kr.alphaBlended}depthModeForSublayer(e,o,u){if(!this.opaquePassEnabledForLayer())return At.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new At(u||this.context.gl.LEQUAL,o,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Q.now()),this.imageManager.beginFrame();const u=this.style._order,c=this.style.sourceCaches,f={},v={},b={};for(const k in c){const I=c[k];I.used&&I.prepare(this.context),f[k]=I.getVisibleCoordinates(),v[k]=f[k].slice().reverse(),b[k]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<u.length;k++)if(this.style._layers[u[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of u){const I=this.style._layers[k];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const A=v[I.source];(I.type==="custom"||A.length)&&this.renderLayer(this,c[I.source],I,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(k,I){const A=k.context,M=A.gl,F=((Y,ee,Z)=>({u_sky_color:Y.properties.get("sky-color"),u_horizon_color:Y.properties.get("horizon-color"),u_horizon:(ee.height/2+ee.getHorizon())*Z,u_sky_horizon_blend:Y.properties.get("sky-horizon-blend")*ee.height/2*Z}))(I,k.style.map.transform,k.pixelRatio),j=new At(M.LEQUAL,At.ReadWrite,[0,1]),U=ir.disabled,H=k.colorModeForRenderPass(),K=k.useProgram("sky");if(!I.mesh){const Y=new d.aX;Y.emplaceBack(-1,-1),Y.emplaceBack(1,-1),Y.emplaceBack(1,1),Y.emplaceBack(-1,1);const ee=new d.aY;ee.emplaceBack(0,1,2),ee.emplaceBack(0,2,3),I.mesh=new dl(A.createVertexBuffer(Y,cs.members),A.createIndexBuffer(ee),d.a0.simpleSegment(0,0,Y.length,ee.length))}K.draw(A,M.TRIANGLES,j,U,H,Jt.disabled,F,void 0,"sky",I.mesh.vertexBuffer,I.mesh.indexBuffer,I.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[u[this.currentLayer]],I=c[k.source],A=f[k.source];this._renderTileClippingMasks(k,A),this.renderLayer(this,I,k,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const k=this.style._layers[u[this.currentLayer]],I=c[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const A=(k.type==="symbol"?b:v)[k.source];this._renderTileClippingMasks(k,f[k.source]),this.renderLayer(this,I,k,A)}if(this.options.showTileBoundaries){const k=function(I,A){let M=null;const F=Object.values(I._layers).flatMap(K=>K.source&&!K.isHidden(A)?[I.sourceCaches[K.source]]:[]),j=F.filter(K=>K.getSource().type==="vector"),U=F.filter(K=>K.getSource().type!=="vector"),H=K=>{(!M||M.getSource().maxzoom<K.getSource().maxzoom)&&(M=K)};return j.forEach(K=>H(K)),M||U.forEach(K=>H(K)),M}(this.style,this.transform.zoom);k&&function(I,A,M){for(let F=0;F<M.length;F++)Fh(I,A,M[F])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const I=k.transform.padding;To(k,k.transform.height-(I.top||0),3,Nu),To(k,I.bottom||0,3,Ut),Rh(k,I.left||0,3,cl),Rh(k,k.transform.width-(I.right||0),3,tf);const A=k.transform.centerPoint;(function(M,F,j,U){hl(M,F-1,j-10,2,20,U),hl(M,F-10,j-1,20,2,U)})(k,A.x,k.transform.height-A.y,Lh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!d.a_(o,u):!d.a$(o,u)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(d.b0(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,v){const b=f.context,k=b.gl,I=kr.unblended,A=new At(k.LEQUAL,At.ReadWrite,[0,1]),M=v.getTerrainMesh(),F=v.sourceCache.getRenderableTiles(),j=f.useProgram("terrainDepth");b.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),b.clear({color:d.aM.transparent,depth:1});for(const U of F){const H=v.getTerrainData(U.tileID),K={u_matrix:f.transform.calculatePosMatrix(U.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(f.transform.zoom)};j.draw(b,k.TRIANGLES,A,ir.disabled,I,Jt.backCCW,K,H,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,v){const b=f.context,k=b.gl,I=kr.unblended,A=new At(k.LEQUAL,At.ReadWrite,[0,1]),M=v.getTerrainMesh(),F=v.getCoordsTexture(),j=v.sourceCache.getRenderableTiles(),U=f.useProgram("terrainCoords");b.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),b.clear({color:d.aM.transparent,depth:1}),v.coordsIndex=[];for(const H of j){const K=v.getTerrainData(H.tileID);b.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,F.texture);const Y={u_matrix:f.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(f.transform.zoom)};U.draw(b,k.TRIANGLES,A,ir.disabled,I,Jt.backCCW,Y,K,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),v.coordsIndex.push(H.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(e,o,u,c){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(c||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(f,v,b,k,I){if(f.renderPass!=="translucent")return;const A=ir.disabled,M=f.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,j,U,H,K,Y,ee,Z,ae){const ue=j.transform,fe=ls(),Te=K==="map",ze=Y==="map";for(const $e of F){const Ke=H.getTile($e),Ne=Ke.getBucket(U);if(!Ne||!Ne.text||!Ne.text.segments.get().length)continue;const Oe=d.ag(Ne.textSizeData,ue.zoom),ot=Pt(Ke,1,j.transform.zoom),bt=ci($e.posMatrix,ze,Te,j.transform,ot),Ve=U.layout.get("icon-text-fit")!=="none"&&Ne.hasIconData();if(Oe){const He=Math.pow(2,ue.zoom-Ke.tileID.overscaledZ),xt=j.style.map.terrain?(It,zt)=>j.style.map.terrain.getElevation($e,It,zt):null,cr=fe.translatePosition(ue,Ke,ee,Z);xo(Ne,Te,ze,ae,ue,bt,$e.posMatrix,He,Oe,Ve,fe,cr,$e.toUnwrapped(),xt)}}}(k,f,b,v,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),I),b.paint.get("icon-opacity").constantOr(1)!==0&&Fu(f,v,b,k,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),A,M),b.paint.get("text-opacity").constantOr(1)!==0&&Fu(f,v,b,k,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),A,M),v.map.showCollisionBoxes&&(va(f,v,b,k,!0),va(f,v,b,k,!1))})(e,o,u,c,this.style.placement.variableOffsets);break;case"circle":(function(f,v,b,k){if(f.renderPass!=="translucent")return;const I=b.paint.get("circle-opacity"),A=b.paint.get("circle-stroke-width"),M=b.paint.get("circle-stroke-opacity"),F=!b.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const j=f.context,U=j.gl,H=f.depthModeForSublayer(0,At.ReadOnly),K=ir.disabled,Y=f.colorModeForRenderPass(),ee=[];for(let Z=0;Z<k.length;Z++){const ae=k[Z],ue=v.getTile(ae),fe=ue.getBucket(b);if(!fe)continue;const Te=fe.programConfigurations.get(b.id),ze=f.useProgram("circle",Te),$e=fe.layoutVertexBuffer,Ke=fe.indexBuffer,Ne=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ae),Oe={programConfiguration:Te,program:ze,layoutVertexBuffer:$e,indexBuffer:Ke,uniformValues:Nt(f,ae,ue,b),terrainData:Ne};if(F){const ot=fe.segments.get();for(const bt of ot)ee.push({segments:new d.a0([bt]),sortKey:bt.sortKey,state:Oe})}else ee.push({segments:fe.segments,sortKey:0,state:Oe})}F&&ee.sort((Z,ae)=>Z.sortKey-ae.sortKey);for(const Z of ee){const{programConfiguration:ae,program:ue,layoutVertexBuffer:fe,indexBuffer:Te,uniformValues:ze,terrainData:$e}=Z.state;ue.draw(j,U.TRIANGLES,H,K,Y,Jt.disabled,ze,$e,b.id,fe,Te,Z.segments,b.paint,f.transform.zoom,ae)}})(e,o,u,c);break;case"heatmap":(function(f,v,b,k){if(b.paint.get("heatmap-opacity")===0)return;const I=f.context;if(f.style.map.terrain){for(const A of k){const M=v.getTile(A);v.hasRenderableParent(A)||(f.renderPass==="offscreen"?Ou(f,M,b,A):f.renderPass==="translucent"&&Ks(f,b,A))}I.viewport.set([0,0,f.width,f.height])}else f.renderPass==="offscreen"?function(A,M,F,j){const U=A.context,H=U.gl,K=ir.disabled,Y=new kr([H.ONE,H.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(ee,Z,ae){const ue=ee.gl;ee.activeTexture.set(ue.TEXTURE1),ee.viewport.set([0,0,Z.width/4,Z.height/4]);let fe=ae.heatmapFbos.get(d.aU);fe?(ue.bindTexture(ue.TEXTURE_2D,fe.colorAttachment.get()),ee.bindFramebuffer.set(fe.framebuffer)):(fe=wa(ee,Z.width/4,Z.height/4),ae.heatmapFbos.set(d.aU,fe))})(U,A,F),U.clear({color:d.aM.transparent});for(let ee=0;ee<j.length;ee++){const Z=j[ee];if(M.hasRenderableParent(Z))continue;const ae=M.getTile(Z),ue=ae.getBucket(F);if(!ue)continue;const fe=ue.programConfigurations.get(F.id),Te=A.useProgram("heatmap",fe),{zoom:ze}=A.transform;Te.draw(U,H.TRIANGLES,At.disabled,K,Y,Jt.disabled,Hr(Z.posMatrix,ae,ze,F.paint.get("heatmap-intensity")),null,F.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,F.paint,A.transform.zoom,fe)}U.viewport.set([0,0,A.width,A.height])}(f,v,b,k):f.renderPass==="translucent"&&function(A,M){const F=A.context,j=F.gl;F.setColorMode(A.colorModeForRenderPass());const U=M.heatmapFbos.get(d.aU);U&&(F.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,U.colorAttachment.get()),F.activeTexture.set(j.TEXTURE1),ba(F,M).bind(j.LINEAR,j.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(F,j.TRIANGLES,At.disabled,ir.disabled,A.colorModeForRenderPass(),Jt.disabled,qi(A,M,0,1),null,M.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,M.paint,A.transform.zoom))}(f,b)})(e,o,u,c);break;case"line":(function(f,v,b,k){if(f.renderPass!=="translucent")return;const I=b.paint.get("line-opacity"),A=b.paint.get("line-width");if(I.constantOr(1)===0||A.constantOr(1)===0)return;const M=f.depthModeForSublayer(0,At.ReadOnly),F=f.colorModeForRenderPass(),j=b.paint.get("line-dasharray"),U=b.paint.get("line-pattern"),H=U.constantOr(1),K=b.paint.get("line-gradient"),Y=b.getCrossfadeParameters(),ee=H?"linePattern":j?"lineSDF":K?"lineGradient":"line",Z=f.context,ae=Z.gl;let ue=!0;for(const fe of k){const Te=v.getTile(fe);if(H&&!Te.patternsLoaded())continue;const ze=Te.getBucket(b);if(!ze)continue;const $e=ze.programConfigurations.get(b.id),Ke=f.context.program.get(),Ne=f.useProgram(ee,$e),Oe=ue||Ne.program!==Ke,ot=f.style.map.terrain&&f.style.map.terrain.getTerrainData(fe),bt=U.constantOr(null);if(bt&&Te.imageAtlas){const xt=Te.imageAtlas,cr=xt.patternPositions[bt.to.toString()],It=xt.patternPositions[bt.from.toString()];cr&&It&&$e.setConstantPatternPositions(cr,It)}const Ve=ot?fe:null,He=H?_o(f,Te,b,Y,Ve):j?Up(f,Te,b,j,Y,Ve):K?yh(f,Te,b,ze.lineClipsArray.length,Ve):rl(f,Te,b,Ve);if(H)Z.activeTexture.set(ae.TEXTURE0),Te.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),$e.updatePaintBuffers(Y);else if(j&&(Oe||f.lineAtlas.dirty))Z.activeTexture.set(ae.TEXTURE0),f.lineAtlas.bind(Z);else if(K){const xt=ze.gradients[b.id];let cr=xt.texture;if(b.gradientVersion!==xt.version){let It=256;if(b.stepInterpolant){const zt=v.getSource().maxzoom,hr=fe.canonical.z===zt?Math.ceil(1<<f.transform.maxZoom-fe.canonical.z):1;It=d.ac(d.aV(ze.maxLineLength/d.X*1024*hr),256,Z.maxTextureSize)}xt.gradient=d.aW({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:It,image:xt.gradient||void 0,clips:ze.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new Ye(Z,xt.gradient,ae.RGBA),xt.version=b.gradientVersion,cr=xt.texture}Z.activeTexture.set(ae.TEXTURE0),cr.bind(b.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Ne.draw(Z,ae.TRIANGLES,M,f.stencilModeForClipping(fe),F,Jt.disabled,He,ot,b.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,b.paint,f.transform.zoom,$e,ze.layoutVertexBuffer2),ue=!1}})(e,o,u,c);break;case"fill":(function(f,v,b,k){const I=b.paint.get("fill-color"),A=b.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=f.colorModeForRenderPass(),F=b.paint.get("fill-pattern"),j=f.opaquePassEnabledForLayer()&&!F.constantOr(1)&&I.constantOr(d.aM.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===j){const U=f.depthModeForSublayer(1,f.renderPass==="opaque"?At.ReadWrite:At.ReadOnly);Sa(f,v,b,k,U,M,!1)}if(f.renderPass==="translucent"&&b.paint.get("fill-antialias")){const U=f.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,At.ReadOnly);Sa(f,v,b,k,U,M,!0)}})(e,o,u,c);break;case"fill-extrusion":(function(f,v,b,k){const I=b.paint.get("fill-extrusion-opacity");if(I!==0&&f.renderPass==="translucent"){const A=new At(f.context.gl.LEQUAL,At.ReadWrite,f.depthRangeFor3D);if(I!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))ul(f,v,b,k,A,ir.disabled,kr.disabled),ul(f,v,b,k,A,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const M=f.colorModeForRenderPass();ul(f,v,b,k,A,ir.disabled,M)}}})(e,o,u,c);break;case"hillshade":(function(f,v,b,k){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const I=f.context,A=f.depthModeForSublayer(0,At.ReadOnly),M=f.colorModeForRenderPass(),[F,j]=f.renderPass==="translucent"?f.stencilConfigForOverlap(k):[{},k];for(const U of j){const H=v.getTile(U);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&f.renderPass==="offscreen"?So(f,H,b,A,ir.disabled,M):f.renderPass==="translucent"&&bo(f,U,H,b,A,F[U.overscaledZ],M)}I.viewport.set([0,0,f.width,f.height])})(e,o,u,c);break;case"raster":(function(f,v,b,k){if(f.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!k.length)return;const I=f.context,A=I.gl,M=v.getSource(),F=f.useProgram("raster"),j=f.colorModeForRenderPass(),[U,H]=M instanceof Tn?[{},k]:f.stencilConfigForOverlap(k),K=H[H.length-1].overscaledZ,Y=!f.options.moving;for(const ee of H){const Z=f.depthModeForSublayer(ee.overscaledZ-K,b.paint.get("raster-opacity")===1?At.ReadWrite:At.ReadOnly,A.LESS),ae=v.getTile(ee);ae.registerFadeDuration(b.paint.get("raster-fade-duration"));const ue=v.findLoadedParent(ee,0),fe=v.findLoadedSibling(ee),Te=Dh(ae,ue||fe||null,v,b,f.transform,f.style.map.terrain);let ze,$e;const Ke=b.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),ae.texture.bind(Ke,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(A.TEXTURE1),ue?(ue.texture.bind(Ke,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,ue.tileID.overscaledZ-ae.tileID.overscaledZ),$e=[ae.tileID.canonical.x*ze%1,ae.tileID.canonical.y*ze%1]):ae.texture.bind(Ke,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ae.texture.useMipmap&&I.extTextureFilterAnisotropic&&f.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Ne=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ee),Oe=Ne?ee:null,ot=Oe?Oe.posMatrix:f.transform.calculatePosMatrix(ee.toUnwrapped(),Y),bt=$p(ot,$e||[0,0],ze||1,Te,b);M instanceof Tn?F.draw(I,A.TRIANGLES,Z,ir.disabled,j,Jt.disabled,bt,Ne,b.id,M.boundsBuffer,f.quadTriangleIndexBuffer,M.boundsSegments):F.draw(I,A.TRIANGLES,Z,U[ee.overscaledZ],j,Jt.disabled,bt,Ne,b.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(e,o,u,c);break;case"background":(function(f,v,b,k){const I=b.paint.get("background-color"),A=b.paint.get("background-opacity");if(A===0)return;const M=f.context,F=M.gl,j=f.transform,U=j.tileSize,H=b.paint.get("background-pattern");if(f.isPatternMissing(H))return;const K=!H&&I.a===1&&A===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==K)return;const Y=ir.disabled,ee=f.depthModeForSublayer(0,K==="opaque"?At.ReadWrite:At.ReadOnly),Z=f.colorModeForRenderPass(),ae=f.useProgram(H?"backgroundPattern":"background"),ue=k||j.coveringTiles({tileSize:U,terrain:f.style.map.terrain});H&&(M.activeTexture.set(F.TEXTURE0),f.imageManager.bind(f.context));const fe=b.getCrossfadeParameters();for(const Te of ue){const ze=k?Te.posMatrix:f.transform.calculatePosMatrix(Te.toUnwrapped()),$e=H?ku(ze,A,f,H,{tileID:Te,tileSize:U},fe):nl(ze,A,I),Ke=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Te);ae.draw(M,F.TRIANGLES,ee,Y,Z,Jt.disabled,$e,Ke,b.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(e,0,u,c);break;case"custom":(function(f,v,b){const k=f.context,I=b.implementation;if(f.renderPass==="offscreen"){const A=I.prerender;A&&(f.setCustomLayerDefaults(),k.setColorMode(f.colorModeForRenderPass()),A.call(I,k.gl,f.transform.customLayerMatrix()),k.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),k.setColorMode(f.colorModeForRenderPass()),k.setStencilMode(ir.disabled);const A=I.renderingMode==="3d"?new At(f.context.gl.LEQUAL,At.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,At.ReadOnly);k.setDepthMode(A),I.render(k.gl,f.transform.customLayerMatrix(),{farZ:f.transform.farZ,nearZ:f.transform.nearZ,fov:f.transform._fov,modelViewProjectionMatrix:f.transform.modelViewProjectionMatrix,projectionMatrix:f.transform.projectionMatrix}),k.setDirty(),f.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,o,u,c,f){if(!u[0]&&!u[1])return e;const v=f?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(v){const I=Math.sin(v),A=Math.cos(v);u=[u[0]*A-u[1]*I,u[0]*I+u[1]*A]}const b=[f?u[0]:Pt(o,u[0],this.transform.zoom),f?u[1]:Pt(o,u[1],this.transform.zoom),0],k=new Float32Array(16);return d.J(k,e,b),k}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!o||!u}useProgram(e,o){this.cache=this.cache||{};const u=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new Tt(this.context,se[e],o,Cu[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ye(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class ko{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,u){const c=Math.pow(2,u),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const k=1/(b=d.af([],b,e))[3]/o*c;return d.b1(b,b,[k,k,1/b[3],k])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const k=function(F,j){var U=j[0],H=j[1],K=j[2],Y=U*U+H*H+K*K;return Y>0&&(Y=1/Math.sqrt(Y)),F[0]=j[0]*Y,F[1]=j[1]*Y,F[2]=j[2]*Y,F}([],function(F,j,U){var H=j[0],K=j[1],Y=j[2],ee=U[0],Z=U[1],ae=U[2];return F[0]=K*ae-Y*Z,F[1]=Y*ee-H*ae,F[2]=H*Z-K*ee,F}([],Xe([],f[b[0]],f[b[1]]),Xe([],f[b[2]],f[b[1]]))),I=-((A=k)[0]*(M=f[b[1]])[0]+A[1]*M[1]+A[2]*M[2]);var A,M;return k.concat(I)});return new ko(f,v)}}class Co{constructor(e,o){this.min=e,this.max=o,this.center=function(u,c,f){return u[0]=.5*c[0],u[1]=.5*c[1],u[2]=.5*c[2],u}([],function(u,c,f){return u[0]=c[0]+f[0],u[1]=c[1]+f[1],u[2]=c[2]+f[2],u}([],this.min,this.max))}quadrant(e){const o=[e%2==0,e<2],u=qe(this.min),c=qe(this.max);for(let f=0;f<o.length;f++)u[f]=o[f]?this.min[f]:this.center[f],c[f]=o[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new Co(u,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let c=0;c<e.planes.length;c++){const f=e.planes[c];let v=0;for(let b=0;b<o.length;b++)d.b2(f,o[b])>=0&&v++;if(v===0)return 0;v!==o.length&&(u=!1)}if(u)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const k=e.points[b][c]-this.min[c];f=Math.min(f,k),v=Math.max(v,k)}if(v<0||f>this.max[c]-this.min[c])return 0}return 1}}class Eo{constructor(e=0,o=0,u=0,c=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=u,this.right=c}interpolate(e,o,u){return o.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,o.top,u)),o.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,o.bottom,u)),o.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,o.left,u)),o.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,o.right,u)),this}getCenter(e,o){const u=d.ac((this.left+e-this.right)/2,0,e),c=d.ac((this.top+o-this.bottom)/2,0,o);return new d.P(u,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Eo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ju=85.051129;class Io{constructor(e,o,u,c,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Eo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Io(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const o=-d.b3(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var u=new d.A(4);return d.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,c,f){var v=c[0],b=c[1],k=c[2],I=c[3],A=Math.sin(f),M=Math.cos(f);u[0]=v*M+k*A,u[1]=b*M+I*A,u[2]=v*-A+k*M,u[3]=b*-A+I*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const o=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,u){this._unmodified=!1,this._edgeInsets.interpolate(e,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){const o=[new d.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new d.P(0,0)),c=this.pointCoordinate(new d.P(this.width,0)),f=this.pointCoordinate(new d.P(this.width,this.height)),v=this.pointCoordinate(new d.P(0,this.height)),b=Math.floor(Math.min(u.x,c.x,f.x,v.x)),k=Math.floor(Math.max(u.x,c.x,f.x,v.x)),I=1;for(let A=b-I;A<=k+I;A++)A!==0&&o.push(new d.b4(A,e))}return o}coveringTiles(e){var o,u;let c=this.coveringZoomLevel(e);const f=c;if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),b=d.Z.fromLngLat(this.center),k=Math.pow(2,c),I=[k*v.x,k*v.y,0],A=[k*b.x,k*b.y,0],M=ko.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,c);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=c);const j=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,U=Z=>({aabb:new Co([Z*k,0,0],[(Z+1)*k,k,0]),zoom:0,x:0,y:0,wrap:Z,fullyVisible:!1}),H=[],K=[],Y=c,ee=e.reparseOverscaled?f:c;if(this._renderWorldCopies)for(let Z=1;Z<=3;Z++)H.push(U(-Z)),H.push(U(Z));for(H.push(U(0));H.length>0;){const Z=H.pop(),ae=Z.x,ue=Z.y;let fe=Z.fullyVisible;if(!fe){const Ne=Z.aabb.intersects(M);if(Ne===0)continue;fe=Ne===2}const Te=e.terrain?I:A,ze=Z.aabb.distanceX(Te),$e=Z.aabb.distanceY(Te),Ke=Math.max(Math.abs(ze),Math.abs($e));if(Z.zoom===Y||Ke>j+(1<<Y-Z.zoom)-2&&Z.zoom>=F){const Ne=Y-Z.zoom,Oe=I[0]-.5-(ae<<Ne),ot=I[1]-.5-(ue<<Ne);K.push({tileID:new d.S(Z.zoom===Y?ee:Z.zoom,Z.wrap,Z.zoom,ae,ue),distanceSq:Le([A[0]-.5-ae,A[1]-.5-ue]),tileDistanceToCamera:Math.sqrt(Oe*Oe+ot*ot)})}else for(let Ne=0;Ne<4;Ne++){const Oe=(ae<<1)+Ne%2,ot=(ue<<1)+(Ne>>1),bt=Z.zoom+1;let Ve=Z.aabb.quadrant(Ne);if(e.terrain){const He=new d.S(bt,Z.wrap,bt,Oe,ot),xt=e.terrain.getMinMaxElevation(He),cr=(o=xt.minElevation)!==null&&o!==void 0?o:this.elevation,It=(u=xt.maxElevation)!==null&&u!==void 0?u:this.elevation;Ve=new Co([Ve.min[0],Ve.min[1],cr],[Ve.max[0],Ve.max[1],It])}H.push({aabb:Ve,zoom:bt,x:Oe,y:ot,wrap:Z.wrap,fullyVisible:fe})}}return K.sort((Z,ae)=>Z.distanceSq-ae.distanceSq).map(Z=>Z.tileID)}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const o=d.ac(e.lat,-85.051129,ju);return new d.P(d.O(e.lng)*this.worldSize,d.Q(o)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const o=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,e),f=e.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-f))return;const v=u+o-f,b=Math.cos(this._pitch)*this.cameraToCenterDistance/v/d.b5(1,c.lat),k=this.scaleZoom(b/this.tileSize);this._elevation=f,this._center=c,this.zoom=k}setLocationAtPoint(e,o){const u=this.pointCoordinate(o),c=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(e),v=new d.Z(f.x-(u.x-c.x),f.y-(u.y-c.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){const F=o.pointCoordinate(e);if(F!=null)return F}const u=[e.x,e.y,0,1],c=[e.x,e.y,1,1];d.af(u,u,this.pixelMatrixInverse),d.af(c,c,this.pixelMatrixInverse);const f=u[3],v=c[3],b=u[1]/f,k=c[1]/v,I=u[2]/f,A=c[2]/v,M=I===A?0:(0-I)/(A-I);return new d.Z(d.y.number(u[0]/f,c[0]/v,M)/this.worldSize,d.y.number(b,k,M)/this.worldSize)}coordinatePoint(e,o=0,u=this.pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,o,1];return d.af(c,c,u),new d.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ye().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ye([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,ju])}calculateTileMatrix(e){const o=e.canonical,u=this.worldSize/this.zoomScale(o.z),c=o.x+Math.pow(2,o.z)*e.wrap,f=d.an(new Float64Array(16));return d.J(f,f,[c*u,o.y*u,0]),d.K(f,f,[u/d.X,u/d.X,1]),f}calculatePosMatrix(e,o=!1){const u=e.key,c=o?this._alignedPosMatrixCache:this._posMatrixCache;if(c[u])return c[u];const f=this.calculateTileMatrix(e);return d.L(f,o?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,f),c[u]=new Float32Array(f),c[u]}calculateFogMatrix(e){const o=e.key,u=this._fogMatrixCache;if(u[o])return u[o];const c=this.calculateTileMatrix(e);return d.L(c,this.fogMatrix,c),u[o]=new Float32Array(c),u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,o){o=d.ac(+o,this.minZoom,this.maxZoom);const u={center:new d.N(e.lng,e.lat),zoom:o};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const Z=179.9999999999;c=[-Z,Z]}const f=this.tileSize*this.zoomScale(u.zoom);let v=0,b=f,k=0,I=f,A=0,M=0;const{x:F,y:j}=this.size;if(this.latRange){const Z=this.latRange;v=d.Q(Z[1])*f,b=d.Q(Z[0])*f,b-v<j&&(A=j/(b-v))}c&&(k=d.b3(d.O(c[0])*f,0,f),I=d.b3(d.O(c[1])*f,0,f),I<k&&(I+=f),I-k<F&&(M=F/(I-k)));const{x:U,y:H}=this.project.call({worldSize:f},e);let K,Y;const ee=Math.max(M||0,A||0);if(ee){const Z=new d.P(M?(I+k)/2:U,A?(b+v)/2:H);return u.center=this.unproject.call({worldSize:f},Z).wrap(),u.zoom+=this.scaleZoom(ee),u}if(this.latRange){const Z=j/2;H-Z<v&&(Y=v+Z),H+Z>b&&(Y=b-Z)}if(c){const Z=(k+I)/2;let ae=U;this._renderWorldCopies&&(ae=d.b3(U,Z-f/2,Z+f/2));const ue=F/2;ae-ue<k&&(K=k+ue),ae+ue>I&&(K=I-ue)}if(K!==void 0||Y!==void 0){const Z=new d.P(K??U,Y??H);u.center=this.unproject.call({worldSize:f},Z).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,o=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let c=d.an(new Float64Array(16));d.K(c,c,[this.width/2,-this.height/2,1]),d.J(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=d.an(new Float64Array(16)),d.K(c,c,[1,-1,1]),d.J(c,c,[-1,-1,0]),d.K(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),b=f-v*this._pixelPerMeter/Math.cos(this._pitch),k=v<0?b:f,I=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),M=Math.sin(A)*k/Math.sin(d.ac(Math.PI-I-A,.01,Math.PI-.01)),F=this.getHorizon(),j=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),U=Math.sin(j)*k/Math.sin(d.ac(Math.PI-I-j,.01,Math.PI-.01)),H=Math.min(M,U);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*H+k),this.nearZ=this.height/50,c=new Float64Array(16),d.b6(c,this._fov,this.width/this.height,this.nearZ,this.farZ),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,this.projectionMatrix=d.ae(c),d.K(c,c,[1,-1,1]),d.J(c,c,[0,0,-this.cameraToCenterDistance]),d.b7(c,c,this._pitch),d.ad(c,c,this.angle),d.J(c,c,[-o,-u,0]),this.mercatorMatrix=d.K([],c,[this.worldSize,this.worldSize,this.worldSize]),d.K(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,c),d.J(c,c,[0,0,-this.elevation]),this.modelViewProjectionMatrix=c,this.invModelViewProjectionMatrix=d.as([],c),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,f,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-o,-u,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,c);const K=this.width%2/2,Y=this.height%2/2,ee=Math.cos(this.angle),Z=Math.sin(this.angle),ae=o-Math.round(o)+ee*K+Z*Y,ue=u-Math.round(u)+ee*Y+Z*K,fe=new Float64Array(c);if(d.J(fe,fe,[ae>.5?ae-1:ae,ue>.5?ue-1:ue,0]),this.alignedModelViewProjectionMatrix=fe,c=d.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let u=o.x,c=o.y,f=o.x,v=o.y;for(const b of e)u=Math.min(u,b.x),c=Math.min(c,b.y),f=Math.max(f,b.x),v=Math.max(v,b.y);return[new d.P(u,c),new d.P(f,c),new d.P(f,v),new d.P(u,v),new d.P(u,c)]}}lngLatToCameraDepth(e,o){const u=this.locationCoordinate(e),c=[u.x*this.worldSize,u.y*this.worldSize,o,1];return d.af(c,c,this.modelViewProjectionMatrix),c[2]/c[3]}}function Ta(m,e){let o,u=!1,c=null,f=null;const v=()=>{c=null,u&&(m.apply(f,o),c=setTimeout(v,e),u=!1)};return(...b)=>(u=!0,f=this,o=b,c||v(),c)}class fl{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(u=c)}),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const u=o.join("/");let c=u;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${u}`);let f=window.location.hash.replace(c,"");f.startsWith("#&")?f=f.slice(0,1)+f.slice(2):f==="#"&&(f="");let v=window.location.href.replace(/(#.+)?$/,f);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Ta(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,c=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,c),v=Math.round(o.lng*f)/f,b=Math.round(o.lat*f)/f,k=this._map.getBearing(),I=this._map.getPitch();let A="";if(A+=e?`/${v}/${b}/${u}`:`${u}/${b}/${v}`,(k||I)&&(A+="/"+Math.round(10*k)/10),I&&(A+=`/${Math.round(I)}`),this._hashName){const M=this._hashName;let F=!1;const j=window.location.hash.slice(1).split("&").map(U=>{const H=U.split("=")[0];return H===M?(F=!0,`${H}=${A}`):U}).filter(U=>U);return F||j.push(`${M}=${A}`),`#${j.join("&")}`}return`#${A}`}}const ml={linearity:.3,easing:d.b8(0,0,.3,1)},Vu=d.e({deceleration:2500,maxSpeed:1400},ml),rf=d.e({deceleration:20,maxSpeed:1400},ml),Oh=d.e({deceleration:1e3,maxSpeed:360},ml),gl=d.e({deceleration:1e3,maxSpeed:90},ml);class Uu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Q.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=Q.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)o.zoom+=f.zoomDelta||0,o.bearing+=f.bearingDelta||0,o.pitch+=f.pitchDelta||0,f.panDelta&&o.pan._add(f.panDelta),f.around&&(o.around=f.around),f.pinchAround&&(o.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(o.pan.mag()){const f=Ca(o.pan.mag(),u,d.e({},Vu,e||{}));c.offset=o.pan.mult(f.amount/o.pan.mag()),c.center=this._map.transform.center,ka(c,f)}if(o.zoom){const f=Ca(o.zoom,u,rf);c.zoom=this._map.transform.zoom+f.amount,ka(c,f)}if(o.bearing){const f=Ca(o.bearing,u,Oh);c.bearing=this._map.transform.bearing+d.ac(f.amount,-179,179),ka(c,f)}if(o.pitch){const f=Ca(o.pitch,u,gl);c.pitch=this._map.transform.pitch+f.amount,ka(c,f)}if(c.zoom||c.bearing){const f=o.pinchAround===void 0?o.around:o.pinchAround;c.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),d.e(c,{noMoveStart:!0})}}function ka(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Ca(m,e,o){const{maxSpeed:u,linearity:c,deceleration:f}=o,v=d.ac(m*c/(e/1e3),-u,u),b=Math.abs(v)/(f*c);return{easing:o.easing,duration:1e3*b,amount:v*(b/2)}}class pn extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u,c={}){const f=V.mousePos(o.getCanvas(),u),v=o.unproject(f);super(e,d.e({point:f,lngLat:v,originalEvent:u},c)),this._defaultPrevented=!1,this.target=o}}class Ys extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){const c=e==="touchend"?u.changedTouches:u.touches,f=V.touchPos(o.getCanvasContainer(),c),v=f.map(k=>o.unproject(k)),b=f.reduce((k,I,A,M)=>k.add(I.div(M.length)),new d.P(0,0));super(e,{points:f,point:b,lngLats:v,lngLat:o.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class Nh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class jh{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Nh(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new pn(e.type,this._map,e))}mouseup(e){this._map.fire(new pn(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new pn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new pn(e.type,this._map,e))}mouseover(e){this._map.fire(new pn(e.type,this._map,e))}mouseout(e){this._map.fire(new pn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ys(e.type,this._map,e))}touchmove(e){this._map.fire(new Ys(e.type,this._map,e))}touchend(e){this._map.fire(new Ys(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ys(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new pn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new pn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ci{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class Jn{constructor(e,o){this._map=e,this._tr=new Ci(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(V.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=u,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(c.x,u.x),v=Math.max(c.x,u.x),b=Math.min(c.y,u.y),k=Math.max(c.y,u.y);V.setTransform(this._box,`translate(${f}px,${b}px)`),this._box.style.width=v-f+"px",this._box.style.height=k-b+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const u=this._startPos,c=o;if(this.reset(),V.suppressClick(),u.x!==c.x||u.y!==c.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(u,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new d.k(e,{originalEvent:o}))}}function Ea(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const o={};for(let u=0;u<m.length;u++)o[m[u].identifier]=e[u];return o}class $u{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(c){const f=new d.P(0,0);for(const v of c)f._add(v);return f.div(c.length)}(o),this.touches=Ea(u,o)))}touchmove(e,o,u){if(this.aborted||!this.centroid)return;const c=Ea(u,o);for(const f in this.touches){const v=c[f];(!v||v.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(e,o,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class yl{constructor(e){this.singleTap=new $u(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,u){this.singleTap.touchstart(e,o,u)}touchmove(e,o,u){this.singleTap.touchmove(e,o,u)}touchend(e,o,u){const c=this.singleTap.touchend(e,o,u);if(c){const f=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(c)<30;if(f&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class Po{constructor(e){this._tr=new Ci(e),this._zoomIn=new yl({numTouches:1,numTaps:2}),this._zoomOut=new yl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,u){this._zoomIn.touchstart(e,o,u),this._zoomOut.touchstart(e,o,u)}touchmove(e,o,u){this._zoomIn.touchmove(e,o,u),this._zoomOut.touchmove(e,o,u)}touchend(e,o,u){const c=this._zoomIn.touchend(e,o,u),f=this._zoomOut.touchend(e,o,u),v=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(c)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ps{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=o.length?o[0]:o;return!this._moved&&c.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(u,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&V.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const qu={0:1,2:2};class _l{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=V.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(o,u){const c=qu[u];return o.buttons===void 0||(o.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return V.mouseButton(e)===this._eventButton}}class Zu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const vl=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}},Gu=({enable:m,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{const u=new _l({checkCorrectEvent:c=>V.mouseButton(c)===0&&c.ctrlKey||V.mouseButton(c)===2});return new ps({clickTolerance:e,move:(c,f)=>({bearingDelta:(f.x-c.x)*o}),moveStateManager:u,enable:m,assignEvents:vl})},Hu=({enable:m,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{const u=new _l({checkCorrectEvent:c=>V.mouseButton(c)===0&&c.ctrlKey||V.mouseButton(c)===2});return new ps({clickTolerance:e,move:(c,f)=>({pitchDelta:(f.y-c.y)*o}),moveStateManager:u,enable:m,assignEvents:vl})};class Js{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,u){return this._calculateTransform(e,o,u)}touchmove(e,o,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,o,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,u){this._calculateTransform(e,o,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,u){u.length>0&&(this._active=!0);const c=Ea(u,o),f=new d.P(0,0),v=new d.P(0,0);let b=0;for(const I in c){const A=c[I],M=this._touches[I];M&&(f._add(A),v._add(A.sub(M)),b++,c[I]=A)}if(this._touches=c,this._shouldBePrevented(b)||!v.mag())return;const k=v.div(b);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(b),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,u){if(!this._firstTwoTouches)return;e.preventDefault();const[c,f]=this._firstTwoTouches,v=Ia(u,o,c),b=Ia(u,o,f);if(!v||!b)return;const k=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],k,e)}touchend(e,o,u){if(!this._firstTwoTouches)return;const[c,f]=this._firstTwoTouches,v=Ia(u,o,c),b=Ia(u,o,f);v&&b||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ia(m,e,o){for(let u=0;u<m.length;u++)if(m[u].identifier===o)return e[u]}function Wu(m,e){return Math.log(m/e)/Math.LN2}class Xu extends xl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Wu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wu(this._distance,u),pinchAround:o}}}function Ku(m,e){return 180*m.angleWith(e)/Math.PI}class Yu extends xl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,u){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ku(this._vector,c),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,u=Ku(e,this._startVector);return Math.abs(u)<o}}function wl(m){return Math.abs(m.y)>Math.abs(m.x)}class Pa extends xl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,u){super.touchstart(e,o,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,wl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,f,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,u){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,f=o.mag()>=2;if(!c&&!f)return;if(!c||!f)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const v=e.y>0==o.y>0;return wl(e)&&wl(o)&&v}}const Vh={panStep:100,bearingStep:15,pitchStep:10};class di{constructor(e){this._tr=new Ci(e);const o=Vh;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,u=0,c=0,f=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(u=0,c=0),{cameraAnimation:b=>{const k=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Gi,zoom:o?Math.round(k.zoom)+o*(e.shiftKey?2:1):k.zoom,bearing:k.bearing+u*this._bearingStep,pitch:k.pitch+c*this._pitchStep,offset:[-f*this._panStep,-v*this._panStep],center:k.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gi(m){return m*(2-m)}const Ju=4.000244140625;class Ei{constructor(e,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Ci(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=Q.now(),c=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Ju==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=V.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=o.y>u.transform.height/2-u.transform.getHorizon()?d.N.convert(this._aroundCenter?u.center:u.unproject(o)):d.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Ju?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&I!==0&&(I=1/I);const A=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(A*I))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,c=this._easing;let f,v=!1;const b=Q.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&c&&b){const k=Math.min(b/200,1),I=c(k);f=d.y.number(u,o,I),k<1?this._frameId||(this._frameId=!0):v=!0}else f=o,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=d.b9;if(this._prevEase){const u=this._prevEase,c=(Q.now()-u.start)/u.duration,f=u.easing(c+.01)-u.easing(c),v=.27/Math.sqrt(f*f+1e-4)*.01,b=Math.sqrt(.0729-v*v);o=d.b8(v,b,.25,1)}return this._prevEase={start:Q.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Qs{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nf{constructor(e){this._tr=new Ci(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sf{constructor(){this._tap=new yl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,u){if(!this._swipePoint)if(this._tapTime){const c=o[0],f=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(c)<30;f&&v?u.length>0&&(this._swipePoint=c,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,o,u)}touchmove(e,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const c=o[0],f=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,o,u)}touchend(e,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const c=this._tap.touchend(e,o,u);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(e,o,u){this._el=e,this._mousePan=o,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $h{constructor(e,o,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qu{constructor(e,o,u,c){this._el=e,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ao{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=o,this._container.appendChild(c);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=u,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const pi=m=>m.zoom||m.drag||m.pitch||m.rotate;class tt extends d.k{}function bl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class ec{constructor(e,o){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,f)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=c.type==="renderFrame"?void 0:c,b={needsRenderFrame:!1},k={},I={},A=c.touches,M=A?this._getMapTouches(A):void 0,F=M?V.touchPos(this._map.getCanvas(),M):V.mousePos(this._map.getCanvas(),c);for(const{handlerName:H,handler:K,allowed:Y}of this._handlers){if(!K.isEnabled())continue;let ee;this._blockedByActive(I,Y,H)?K.reset():K[f||c.type]&&(ee=K[f||c.type](c,F,M),this.mergeHandlerResult(b,k,ee,H,v),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||K.isActive())&&(I[H]=K)}const j={};for(const H in this._previousActiveHandlers)I[H]||(j[H]=v);this._previousActiveHandlers=I,(Object.keys(j).length||bl(b))&&(this._changes.push([b,k,j]),this._triggerRenderFrame()),(Object.keys(I).length||bl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=b;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Uu(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,f,v]of this._listeners)V.addEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,o,u]of this._listeners)V.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new jh(o,e));const c=o.boxZoom=new Jn(o,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const f=o.cooperativeGestures=new Ao(o,e.cooperativeGestures);this._add("cooperativeGestures",f),e.cooperativeGestures&&f.enable();const v=new Po(o),b=new nf(o);o.doubleClickZoom=new Qs(b,v),this._add("tapZoom",v),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const k=new sf;this._add("tapDragZoom",k);const I=o.touchPitch=new Pa(o);this._add("touchPitch",I),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const A=Gu(e),M=Hu(e);o.dragRotate=new $h(e,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const F=(({enable:ee,clickTolerance:Z})=>{const ae=new _l({checkCorrectEvent:ue=>V.mouseButton(ue)===0&&!ue.ctrlKey});return new ps({clickTolerance:Z,move:(ue,fe)=>({around:fe,panDelta:fe.sub(ue)}),activateOnStart:!0,moveStateManager:ae,enable:ee,assignEvents:vl})})(e),j=new Js(e,o);o.dragPan=new Uh(u,F,j),this._add("mousePan",F),this._add("touchPan",j,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const U=new Yu,H=new Xu;o.touchZoomRotate=new Qu(u,H,U,k),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);const K=o.scrollZoom=new Ei(o,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const Y=o.keyboard=new di(o);this._add("keyboard",Y),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Cr(o))}_add(e,o,u){this._handlers.push({handlerName:e,handler:o,allowed:u}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,u){for(const c in e)if(c!==u&&(!o||o.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const u of e)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(e,o,u,c,f){if(!u)return;d.e(e,u);const v={handlerName:c,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(o.zoom=v),u.panDelta!==void 0&&(o.drag=v),u.pitchDelta!==void 0&&(o.pitch=v),u.bearingDelta!==void 0&&(o.rotate=v)}_applyChanges(){const e={},o={},u={};for(const[c,f,v]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),d.e(o,f),d.e(u,v);this._updateMapTransform(e,o,u),this._changes=[]}_updateMapTransform(e,o,u){const c=this._map,f=c._getTransformForUpdate(),v=c.terrain;if(!(bl(e)||v&&this._terrainMovement))return this._fireEvents(o,u,!0);let{panDelta:b,zoomDelta:k,bearingDelta:I,pitchDelta:A,around:M,pinchAround:F}=e;F!==void 0&&(M=F),c._stop(!0),M=M||c.transform.centerPoint;const j=f.pointLocation(b?M.sub(b):M);I&&(f.bearing+=I),A&&(f.pitch+=A),k&&(f.zoom+=k),v?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(b)):f.setLocationAtPoint(j,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(j,M)):f.setLocationAtPoint(j,M),c._applyUpdatedTransform(f),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,u,!0)}_fireEvents(e,o,u){const c=pi(this._eventsInProgress),f=pi(e),v={};for(const M in e){const{originalEvent:F}=e[M];this._eventsInProgress[M]||(v[`${M}start`]=F),this._eventsInProgress[M]=e[M]}!c&&f&&this._fireEvent("movestart",f.originalEvent);for(const M in v)this._fireEvent(M,v[M]);f&&this._fireEvent("move",f.originalEvent);for(const M in e){const{originalEvent:F}=e[M];this._fireEvent(M,F)}const b={};let k;for(const M in this._eventsInProgress){const{handlerName:F,originalEvent:j}=this._eventsInProgress[M];this._handlersById[F].isActive()||(delete this._eventsInProgress[M],k=o[F]||j,b[`${M}end`]=k)}for(const M in b)this._fireEvent(M,b[M]);const I=pi(this._eventsInProgress),A=(c||f)&&!I;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(u&&A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!M||!M.essential&&Q.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:k})),F(this._map.getBearing())&&this._map.resetNorth()):(F(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new d.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new tt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class qh extends d.E{constructor(e,o){super(),this._renderFrameCallback=()=>{const u=Math.min((Q.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,u){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},o),u)}panTo(e,o,u){return this.easeTo(d.e({center:e},o),u)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,u){return this.easeTo(d.e({zoom:e},o),u)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,u){return this.easeTo(d.e({bearing:e},o),u)}resetNorth(e,o){return this.rotateTo(0,d.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=ye.convert(e).adjustAntiMeridian();const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,o)}_cameraForBoxAndBearing(e,o,u,c){const f={top:0,bottom:0,right:0,left:0};if(typeof(c=d.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const Ne=c.padding;c.padding={top:Ne,bottom:Ne,right:Ne,left:Ne}}c.padding=d.e(f,c.padding);const v=this.transform,b=v.padding,k=new ye(e,o),I=v.project(k.getNorthWest()),A=v.project(k.getNorthEast()),M=v.project(k.getSouthEast()),F=v.project(k.getSouthWest()),j=d.ba(-u),U=I.rotate(j),H=A.rotate(j),K=M.rotate(j),Y=F.rotate(j),ee=new d.P(Math.max(U.x,H.x,Y.x,K.x),Math.max(U.y,H.y,Y.y,K.y)),Z=new d.P(Math.min(U.x,H.x,Y.x,K.x),Math.min(U.y,H.y,Y.y,K.y)),ae=ee.sub(Z),ue=(v.width-(b.left+b.right+c.padding.left+c.padding.right))/ae.x,fe=(v.height-(b.top+b.bottom+c.padding.top+c.padding.bottom))/ae.y;if(fe<0||ue<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Te=Math.min(v.scaleZoom(v.scale*Math.min(ue,fe)),c.maxZoom),ze=d.P.convert(c.offset),$e=new d.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(d.ba(u)),Ke=ze.add($e).mult(v.scale/v.zoomScale(Te));return{center:v.unproject(I.add(M).div(2).sub(Ke)),zoom:Te,bearing:u}}fitBounds(e,o,u){return this._fitInternal(this.cameraForBounds(e,o),o,u)}fitScreenCoordinates(e,o,u,c,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(o)),u,c),c,f)}_fitInternal(e,o,u){return e?(delete(o=d.e(e,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(e,o){this.stop();const u=this._getTransformForUpdate();let c=!1,f=!1,v=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(c=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=d.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(f=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(v=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new d.k("movestart",o)).fire(new d.k("move",o)),c&&this.fire(new d.k("zoomstart",o)).fire(new d.k("zoom",o)).fire(new d.k("zoomend",o)),f&&this.fire(new d.k("rotatestart",o)).fire(new d.k("rotate",o)).fire(new d.k("rotateend",o)),v&&this.fire(new d.k("pitchstart",o)).fire(new d.k("pitch",o)).fire(new d.k("pitchend",o)),this.fire(new d.k("moveend",o))}calculateCameraOptionsFromTo(e,o,u,c=0){const f=d.Z.fromLngLat(e,o),v=d.Z.fromLngLat(u,c),b=v.x-f.x,k=v.y-f.y,I=v.z-f.z,A=Math.hypot(b,k,I);if(A===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(b,k),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),j=180*Math.atan2(b,-k)/Math.PI;let U=180*Math.acos(M/A)/Math.PI;return U=I<0?90-U:90+U,{center:v.toLngLat(),zoom:F,pitch:U,bearing:j}}easeTo(e,o){var u;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&Q.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),f=c.zoom,v=c.bearing,b=c.pitch,k=c.padding,I="bearing"in e?this._normalizeBearing(e.bearing,v):v,A="pitch"in e?+e.pitch:b,M="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let j=c.centerPoint.add(F);const U=c.pointLocation(j),{center:H,zoom:K}=c.getConstrained(d.N.convert(e.center||U),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(H,c);const Y=c.project(U),ee=c.project(H).sub(Y),Z=c.zoomScale(K-f);let ae,ue;e.around&&(ae=d.N.convert(e.around),ue=c.locationPoint(ae));const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==f,this._rotating=this._rotating||v!==I,this._pitching=this._pitching||A!==b,this._padding=!c.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,fe),this.terrain&&this._prepareElevation(H),this._ease(Te=>{if(this._zooming&&(c.zoom=d.y.number(f,K,Te)),this._rotating&&(c.bearing=d.y.number(v,I,Te)),this._pitching&&(c.pitch=d.y.number(b,A,Te)),this._padding&&(c.interpolatePadding(k,M,Te),j=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Te),ae)c.setLocationAtPoint(ae,ue);else{const ze=c.zoomScale(c.zoom-f),$e=K>f?Math.min(2,Z):Math.max(.5,Z),Ke=Math.pow($e,1-Te),Ne=c.unproject(Y.add(ee.mult(Te*Ke)).mult(ze));c.setLocationAtPoint(c.renderWorldCopies?Ne.wrap():Ne,j)}this._applyUpdatedTransform(c),this._fireMoveEvents(o)},Te=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,Te)},e),this}_prepareEase(e,o,u={}){this._moving=!0,o||u.moving||this.fire(new d.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(o-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const o=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(o.lngLat,e.zoom);if(o.altitude<u){const c=this.calculateCameraOptionsFromTo(o.lngLat,u,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(this.terrain&&o.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&o.push(c=>this.transformCameraUpdate(c)),!o.length)return;const u=e.clone();for(const c of o){const f=u.clone(),{center:v,zoom:b,pitch:k,bearing:I,elevation:A}=c(f);v&&(f.center=v),b!==void 0&&(f.zoom=b),k!==void 0&&(f.pitch=k),I!==void 0&&(f.bearing=I),A!==void 0&&(f.elevation=A),u.apply(f)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,c=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new d.k("zoomend",e)),c&&this.fire(new d.k("rotateend",e)),f&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,o){var u;if(!e.essential&&Q.prefersReducedMotion){const He=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,o)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const c=this._getTransformForUpdate(),f=c.zoom,v=c.bearing,b=c.pitch,k=c.padding,I="bearing"in e?this._normalizeBearing(e.bearing,v):v,A="pitch"in e?+e.pitch:b,M="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let j=c.centerPoint.add(F);const U=c.pointLocation(j),{center:H,zoom:K}=c.getConstrained(d.N.convert(e.center||U),(u=e.zoom)!==null&&u!==void 0?u:f);this._normalizeCenter(H,c);const Y=c.zoomScale(K-f),ee=c.project(U),Z=c.project(H).sub(ee);let ae=e.curve;const ue=Math.max(c.width,c.height),fe=ue/Y,Te=Z.mag();if("minZoom"in e){const He=d.ac(Math.min(e.minZoom,f,K),c.minZoom,c.maxZoom),xt=ue/c.zoomScale(He-f);ae=Math.sqrt(xt/Te*2)}const ze=ae*ae;function $e(He){const xt=(fe*fe-ue*ue+(He?-1:1)*ze*ze*Te*Te)/(2*(He?fe:ue)*ze*Te);return Math.log(Math.sqrt(xt*xt+1)-xt)}function Ke(He){return(Math.exp(He)-Math.exp(-He))/2}function Ne(He){return(Math.exp(He)+Math.exp(-He))/2}const Oe=$e(!1);let ot=function(He){return Ne(Oe)/Ne(Oe+ae*He)},bt=function(He){return ue*((Ne(Oe)*(Ke(xt=Oe+ae*He)/Ne(xt))-Ke(Oe))/ze)/Te;var xt},Ve=($e(!0)-Oe)/ae;if(Math.abs(Te)<1e-6||!isFinite(Ve)){if(Math.abs(ue-fe)<1e-6)return this.easeTo(e,o);const He=fe<ue?-1:1;Ve=Math.abs(Math.log(fe/ue))/ae,bt=()=>0,ot=xt=>Math.exp(He*ae*xt)}return e.duration="duration"in e?+e.duration:1e3*Ve/("screenSpeed"in e?+e.screenSpeed/ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==I,this._pitching=A!==b,this._padding=!c.isPaddingEqual(M),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(H),this._ease(He=>{const xt=He*Ve,cr=1/ot(xt);c.zoom=He===1?K:f+c.scaleZoom(cr),this._rotating&&(c.bearing=d.y.number(v,I,He)),this._pitching&&(c.pitch=d.y.number(b,A,He)),this._padding&&(c.interpolatePadding(k,M,He),j=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(He);const It=He===1?H:c.unproject(ee.add(Z.mult(bt(xt))).mult(cr));c.setLocationAtPoint(c.renderWorldCopies?It.wrap():It,j),this._applyUpdatedTransform(c),this._fireMoveEvents(o)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,o)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,o,u){u.animate===!1||u.duration===0?(e(1),o()):(this._easeStart=Q.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=d.b3(e,-180,180);const u=Math.abs(e-o);return Math.abs(e-360-o)<u&&(e-=360),Math.abs(e+360-o)<u&&(e+=360),e}_normalizeCenter(e,o){if(!o.renderWorldCopies||o.lngRange)return;const u=e.lng-o.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Mo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class zo{constructor(e=Mo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const u=this._map._getUIString(`AttributionControl.${o}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const o=this._map.style.sourceCaches;for(const c in o){const f=o[c];if(f.used||f.usedForTerrain){const v=f.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,f)=>c.length-f.length),e=e.filter((c,f)=>{for(let v=f+1;v<e.length;v++)if(e[v].indexOf(c)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class tc{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const o=V.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Rt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const c of u)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var rc=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class of extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];const u={};for(const c of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))u[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),d.aP(c.posMatrix,0,d.X,0,d.X,0,1),this._tiles[c.key]=new ki(c,this.tileSize));for(const c in this._tiles)u[c]||delete this._tiles[c]}freeRtt(e){for(const o in this._tiles){const u=this._tiles[o];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const o={};for(const u of this._renderableTilesKeys){const c=this._tiles[u].tileID;if(c.canonical.equals(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16),d.aP(f.posMatrix,0,d.X,0,d.X,0,1),o[u]=f}else if(c.canonical.isChildOf(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const v=c.canonical.z-e.canonical.z,b=c.canonical.x-(c.canonical.x>>v<<v),k=c.canonical.y-(c.canonical.y>>v<<v),I=d.X>>v;d.aP(f.posMatrix,0,I,0,I,0,1),d.J(f.posMatrix,f.posMatrix,[-b*I,-k*I,0]),o[u]=f}else if(e.canonical.isChildOf(c.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const v=e.canonical.z-c.canonical.z,b=e.canonical.x-(e.canonical.x>>v<<v),k=e.canonical.y-(e.canonical.y>>v<<v),I=d.X>>v;d.aP(f.posMatrix,0,d.X,0,d.X,0,1),d.J(f.posMatrix,f.posMatrix,[b*I,k*I,0]),d.K(f.posMatrix,f.posMatrix,[1/2**v,1/2**v,0]),o[u]=f}}return o}getSourceTile(e,o){const u=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>u.maxzoom&&(c=u.maxzoom),c<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&o)for(;c>=u.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(c--).key);return f}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=e)}}class nc{constructor(e,o,u){this.painter=e,this.sourceCache=new of(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,u,c=d.X){var f;if(!(o>=0&&o<c&&u>=0&&u<c))return 0;const v=this.getTerrainData(e),b=(f=v.tile)===null||f===void 0?void 0:f.dem;if(!b)return 0;const k=function(U,H,K){var Y=H[0],ee=H[1];return U[0]=K[0]*Y+K[4]*ee+K[12],U[1]=K[1]*Y+K[5]*ee+K[13],U}([],[o/c*d.X,u/c*d.X],v.u_terrain_matrix),I=[k[0]*b.dim,k[1]*b.dim],A=Math.floor(I[0]),M=Math.floor(I[1]),F=I[0]-A,j=I[1]-M;return b.get(A,M)*(1-F)*(1-j)+b.get(A+1,M)*F*(1-j)+b.get(A,M+1)*(1-F)*j+b.get(A+1,M+1)*F*j}getElevationForLngLatZoom(e,o){if(!d.bb(o,e.wrap()))return 0;const{tileID:u,mercatorX:c,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(u,c%d.X,f%d.X,d.X)}getElevation(e,o,u,c=d.X){return this.getDEMElevation(e,o,u,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,f=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ye(c,f,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ye(c,new d.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const c=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new Ye(c,o.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),o.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const c=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?f=e.canonical.z-c:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>f<<f),b=e.canonical.y-(e.canonical.y>>f<<f),k=d.bc(new Float64Array(16),[1/(d.X<<f),1/(d.X<<f),0]);d.J(k,k,[v*d.X,b*d.X,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,u=o.width/devicePixelRatio,c=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ye(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ye(o.context,{width:u,height:c,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,c,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,v=0;f<this._coordsTextureSize;f++)for(let b=0;b<this._coordsTextureSize;b++,v+=4)o[v+0]=255&b,o[v+1]=255&f,o[v+2]=b>>8<<4|f>>8,o[v+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),c=new Ye(e,u,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,c=u.gl,f=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(f,b-v-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const k=o[0]+(o[2]>>4<<8),I=o[1]+((15&o[2])<<8),A=this.coordsIndex[255-o[3]],M=A&&this.sourceCache.getTileByID(A);if(!M)return null;const F=this._coordsTextureSize,j=(1<<M.tileID.canonical.z)*F;return new d.Z((M.tileID.canonical.x*F+k)/j+M.tileID.wrap,(M.tileID.canonical.y*F+I)/j,this.getElevation(M.tileID,k,I,F))}depthAtPoint(e){const o=new Uint8Array(4),u=this.painter.context,c=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,o=new d.bd,u=new d.aY,c=this.meshSize,f=d.X/c,v=c*c;for(let M=0;M<=c;M++)for(let F=0;F<=c;F++)o.emplaceBack(F*f,M*f,0);for(let M=0;M<v;M+=c+1)for(let F=0;F<c;F++)u.emplaceBack(F+M,c+F+M+1,c+F+M+2),u.emplaceBack(F+M,c+F+M+2,F+M+1);const b=o.length,k=b+2*(c+1);for(const M of[0,1])for(let F=0;F<=c;F++)for(const j of[0,1])o.emplaceBack(F*f,M*d.X,j);for(let M=0;M<2*c;M+=2)u.emplaceBack(k+M,k+M+1,k+M+3),u.emplaceBack(k+M,k+M+3,k+M+2),u.emplaceBack(b+M,b+M+3,b+M+1),u.emplaceBack(b+M,b+M+2,b+M+3);const I=o.length,A=I+2*(c+1);for(const M of[0,1])for(let F=0;F<=c;F++)for(const j of[0,1])o.emplaceBack(M*d.X,F*f,j);for(let M=0;M<2*c;M+=2)u.emplaceBack(I+M,I+M+1,I+M+3),u.emplaceBack(I+M,I+M+3,I+M+2),u.emplaceBack(A+M,A+M+3,A+M+1),u.emplaceBack(A+M,A+M+2,A+M+3);return this._mesh=new dl(e.createVertexBuffer(o,rc.members),e.createIndexBuffer(u),d.a0.simpleSegment(0,0,o.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var u;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(u=this.getMinMaxElevation(c).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,o){const u=d.Z.fromLngLat(e.wrap()),c=(1<<o)*d.X,f=u.x*c,v=u.y*c,b=Math.floor(f/d.X),k=Math.floor(v/d.X);return{tileID:new d.S(o,0,o,b,k),mercatorX:f,mercatorY:v}}}class af{constructor(e,o,u){this._context=e,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new Ye(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:e,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>e.id!==o),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Do={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Zh{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new af(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(o)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const c=e.sourceCaches[u].getVisibleCoordinates();for(const f of c){const v=this.terrain.sourceCache.getTerrainCoords(f);for(const b in v)this._coordsDescendingInv[u][b]||(this._coordsDescendingInv[u][b]=[]),this._coordsDescendingInv[u][b].push(v[b])}}this._coordsDescendingInvStr={};for(const u of e._order){const c=e._layers[u],f=c.source;if(Do[c.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const v in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][v]=this._coordsDescendingInv[f][v].map(b=>b.key).sort().join()}}for(const u of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[c][u.tileID.key];f&&f!==u.rttCoords[c]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const o=e.type,u=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Do[o]&&(this._prevType&&Do[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!c))return!0;if(Do[this._prevType]||Do[o]&&c){this._prevType=o;const f=this._stacks.length-1,v=this._stacks[f]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(Bh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[f]){const I=this.pool.getObjectForId(b.rtt[f].id);if(I.stamp===b.rtt[f].stamp){this.pool.useObject(I);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),b.rtt[f]={id:k.id,stamp:k.stamp},u.context.bindFramebuffer.set(k.fbo.framebuffer),u.context.clear({color:d.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let I=0;I<v.length;I++){const A=u.style._layers[v[I]],M=A.source?this._coordsDescendingInv[A.source][b.tileID.key]:[b.tileID];u.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),u._renderTileClippingMasks(A,M),u.renderLayer(u,u.style.sourceCaches[A.source],A,M),A.source&&(b.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][b.tileID.key])}}return Bh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Do[o]}return!1}}const ic={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gh=$,lf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Mo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},sc=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},uf={showCompass:!0,showZoom:!0,visualizePitch:!1};class cf{constructor(e,o,u=!1){this.mousedown=v=>{this.startMouse(d.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),V.mousePos(this.element,v)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,V.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=e.dragRotate._mouseRotate.getClickTolerance(),f=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=Gu({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:b,bearingDegreesPerPixelMoved:k=.8})=>{const I=new Zu;return new ps({clickTolerance:b,move:(A,M)=>({bearingDelta:(M.x-A.x)*k}),moveStateManager:I,enable:v,assignEvents:sc})})({clickTolerance:c,enable:!0}),this.map=e,u&&(this.mousePitch=Hu({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:b,pitchDegreesPerPixelMoved:k=-.5})=>{const I=new Zu;return new ps({clickTolerance:b,move:(A,M)=>({pitchDelta:(M.y-A.y)*k}),moveStateManager:I,enable:v,assignEvents:sc})})({clickTolerance:f,enable:!0})),V.addEventListener(o,"mousedown",this.mousedown),V.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),V.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),V.disableDrag()}moveMouse(e,o){const u=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(e,o)||{};f&&u.setPitch(u.getPitch()+f)}}moveTouch(e,o){const u=this.map,{bearingDelta:c}=this.touchRotate.dragMove(e,o)||{};if(c&&u.setBearing(u.getBearing()+c),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(e,o)||{};f&&u.setPitch(u.getPitch()+f)}}off(){const e=this.element;V.removeEventListener(e,"mousedown",this.mousedown),V.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let Qn;function ur(m,e,o){const u=new d.N(m.lng,m.lat);if(m=new d.N(m.lng,m.lat),e){const c=new d.N(m.lng-360,m.lat),f=new d.N(m.lng+360,m.lat),v=o.locationPoint(m).distSqr(e);o.locationPoint(c).distSqr(e)<v?m=c:o.locationPoint(f).distSqr(e)<v&&(m=f)}for(;Math.abs(m.lng-o.center.lng)>180;){const c=o.locationPoint(m);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m.lng!==u.lng&&o.locationPoint(m).y>o.height/2-o.getHorizon()?m:u}const Lo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Sl(m,e,o){const u=m.classList;for(const c in Lo)u.remove(`maplibregl-${o}-anchor-${c}`);u.add(`maplibregl-${o}-anchor-${e}`)}class Tl extends d.E{constructor(e){if(super(),this._onKeyPress=o=>{const u=o.code,c=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,c=this._element;this._popup&&(u===c||c.contains(u))&&this.togglePopup()},this._update=o=>{var u;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ur(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${Lo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${f}`),Q.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const o=V.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${c}px`),o.setAttributeNS(null,"viewBox",`0 0 ${c} ${u}`);const f=V.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const v=V.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const b=V.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of k){const ee=V.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",Y.rx),ee.setAttributeNS(null,"ry",Y.ry),b.appendChild(ee)}const I=V.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const A=V.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(A);const M=V.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const F=V.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(F);const j=V.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const U=V.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=V.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const K=V.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),U.appendChild(H),U.appendChild(K),v.appendChild(b),v.appendChild(I),v.appendChild(M),v.appendChild(j),v.appendChild(U),o.appendChild(v),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(o),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Sl(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,u;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,f=c.terrain.depthAtPoint(this._pos),v=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,v)-f<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/c.transform._pixelPerMeter,k=Math.sin(c.getPitch()*Math.PI/180)*b,I=c.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),A=c.transform.lngLatToCameraDepth(this._lngLat,v+k)-I>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return e===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Hh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Aa=0,Ma=!1;const Hi={maxWidth:100,unit:"metric"};function za(m,e,o){const u=o&&o.maxWidth||100,c=m._container.clientHeight/2,f=m.unproject([0,c]),v=m.unproject([u,c]),b=f.distanceTo(v);if(o&&o.unit==="imperial"){const k=3.2808*b;k>5280?st(e,u,k/5280,m._getUIString("ScaleControl.Miles")):st(e,u,k,m._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?st(e,u,b/1852,m._getUIString("ScaleControl.NauticalMiles")):b>=1e3?st(e,u,b/1e3,m._getUIString("ScaleControl.Kilometers")):st(e,u,b,m._getUIString("ScaleControl.Meters"))}function st(m,e,o,u){const c=function(f){const v=Math.pow(10,`${Math.floor(f)}`.length-1);let b=f/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(k){const I=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*I)/I}(b),v*b}(o);m.style.width=e*(c/o)+"px",m.innerHTML=`${c}&nbsp;${u}`}const gt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},kl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cl(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-m),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const e=d.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return Cl(new d.P(0,0))}const oc=$;S.AJAXError=d.bh,S.Evented=d.E,S.LngLat=d.N,S.MercatorCoordinate=d.Z,S.Point=d.P,S.addProtocol=d.bi,S.config=d.a,S.removeProtocol=d.bj,S.AttributionControl=zo,S.BoxZoomHandler=Jn,S.CanvasSource=cn,S.CooperativeGesturesHandler=Ao,S.DoubleClickZoomHandler=Qs,S.DragPanHandler=Uh,S.DragRotateHandler=$h,S.EdgeInsets=Eo,S.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o==null?void 0:o.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Ui,S.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new d.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,c=this._map.getBearing(),f=d.e({bearing:c},this.options.fitBoundsOptions),v=ye.fromLngLat(o,u);this._map.fitBounds(v,f,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ma)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Tl({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Tl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Hh,m)}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(Qn!==void 0&&!e)return Qn;if(window.navigator.permissions===void 0)return Qn=!!window.navigator.geolocation,Qn;try{Qn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Qn=!!window.navigator.geolocation}return Qn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Aa=0,Ma=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),o=m.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),o=m.getNorthEast(),u=e.distanceTo(o),c=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Aa--,Ma=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Aa++,Aa>1?(m={maximumAge:6e5,timeout:0},Ma=!0):(m=this.options.positionOptions,Ma=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=fl,S.ImageSource=Tn,S.KeyboardHandler=di,S.LngLatBounds=ye,S.LogoControl=tc,S.Map=class extends qh{constructor(m){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},lf),m);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Io(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Rt,this._controls=[],this._mapId=d.a4(),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ic),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=de.addThrottleControl(()=>this.isMoving()),this._requestManager=new Pe(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const u=Ta(c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())},50);this._resizeObserver=new ResizeObserver(c=>{o?u(c):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ec(this,e),this._hash=e.hash&&new fl(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new zo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new tc,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new d.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new d.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,o,u)}resize(m){var e;const o=this._containerDimensions(),u=o[0],c=o[1],f=this._getClampedPixelRatio(u,c);if(this._resizeCanvas(u,c,f),this.painter.resize(u,c,f),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const k=this._getClampedPixelRatio(u,c);this._resizeCanvas(u,c,k),this.painter.resize(u,c,k)}this.transform.resize(u,c),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,c);const v=!this._moving;return v&&(this.stop(),this.fire(new d.k("movestart",m)).fire(new d.k("move",m))),this.fire(new d.k("resize",m)),v&&this.fire(new d.k("moveend",m)),this}_getClampedPixelRatio(m,e){const{0:o,1:u}=this._maxCanvasSize,c=this.getPixelRatio(),f=m*c,v=e*c;return Math.min(f>o?o/f:1,v>u?u/v:1)*c}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(ye.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(d.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,o){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:f=>{const v=e.filter(k=>this.getLayer(k)),b=v.length!==0?this.queryRenderedFeatures(f.point,{layers:v}):[];b.length?u||(u=!0,o.call(this,new pn(m,this,f.originalEvent,{features:b}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:v=>{const b=e.filter(k=>this.getLayer(k));(b.length!==0?this.queryRenderedFeatures(v.point,{layers:b}):[]).length?u=!0:u&&(u=!1,o.call(this,new pn(m,this,v.originalEvent)))},mouseout:v=>{u&&(u=!1,o.call(this,new pn(m,this,v.originalEvent)))}}}}{const u=c=>{const f=e.filter(b=>this.getLayer(b)),v=f.length!==0?this.queryRenderedFeatures(c.point,{layers:f}):[];v.length&&(c.features=v,o.call(this,c),delete c.features)};return{layers:e,listener:o,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,o){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let c=0;c<u.length;c++){const f=u[c];if(f.listener===o&&f.layers.length===e.length&&f.layers.every(v=>e.includes(v))){for(const v in f.delegates)this.off(v,f.delegates[v]);return void u.splice(c,1)}}}on(m,e,o){if(o===void 0)return super.on(m,e);const u=this._createDelegatedListener(m,typeof e=="string"?[e]:e,o);this._saveDelegatedListener(m,u);for(const c in u.delegates)this.on(c,u.delegates[c]);return this}once(m,e,o){if(o===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,c=this._createDelegatedListener(m,u,o);for(const f in c.delegates){const v=c.delegates[f];c.delegates[f]=(...b)=>{this._removeDelegatedListener(m,u,o),v(...b)}}this._saveDelegatedListener(m,c);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(m,e,o){return o===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let o;const u=m instanceof d.P||Array.isArray(m),c=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},c instanceof d.P||typeof c[0]=="number")o=[d.P.convert(c)];else{const f=d.P.convert(c[0]),v=d.P.convert(c[1]);o=[f,new d.P(v.x,f.y),v,new d.P(f.x,v.y),f]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new qs(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,o):this.style.loadJSON(m,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new qs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const o=this._requestManager.transformRequest(m,"Style");d.h(o,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new d.j(u))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(o){d.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new nc(this.painter,e,m),this.painter.renderToTexture=new Zh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const o=m[e]._tiles;for(const u in o){const c=o[u];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,o={}){const{pixelRatio:u=1,sdf:c=!1,stretchX:f,stretchY:v,content:b,textFitWidth:k,textFitHeight:I}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:M,data:F}=e,j=e;return this.style.addImage(m,{data:new d.R({width:A,height:M},new Uint8Array(F)),pixelRatio:u,stretchX:f,stretchY:v,content:b,textFitWidth:k,textFitHeight:I,sdf:c,version:0,userImage:j}),j.onAdd&&j.onAdd(this,m),this}}{const{width:A,height:M,data:F}=Q.getImageData(e);this.style.addImage(m,{data:new d.R({width:A,height:M},F),pixelRatio:u,stretchX:f,stretchY:v,content:b,textFitWidth:k,textFitHeight:I,sdf:c,version:0})}}updateImage(m,e){const o=this.style.getImage(m);if(!o)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||d.b(e)?Q.getImageData(e):e,{width:c,height:f,data:v}=u;if(c===void 0||f===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==o.data.width||f!==o.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||d.b(e));return o.data.replace(v,b),this.style.updateImage(m,o),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return de.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,o){return this.style.setLayerZoomRange(m,e,o),this._update(!0)}setFilter(m,e,o={}){return this.style.setFilter(m,e,o),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,o,u={}){return this.style.setPaintProperty(m,e,o,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,o,u={}){return this.style.setLayoutProperty(m,e,o,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,o,u=>{u||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,o=>{o||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=V.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const c=this._controlContainer=V.create("div","maplibregl-control-container",m),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{f[v]=V.create("div",`maplibregl-ctrl-${v} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,o){this._canvas.width=Math.floor(o*m),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const o=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!o){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new pl(o,this.transform),Ce.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,f=Q.now();this.style.zoomHistory.update(c,f);const v=new d.z(c,{now:f,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=v.crossFadingFactor();b===1&&b===this._crossFadingFactor||(o=!0,this._crossFadingFactor=b),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),de.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(m=>{d.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Gh}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=pn,S.MapTouchEvent=Ys,S.MapWheelEvent=Nh,S.Marker=Tl,S.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);e.title=u,e.setAttribute("aria-label",u)},this.options=d.e({},uf,m),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const o=V.create("button",m,this._container);return o.type="button",o.addEventListener("click",e),o}},S.Popup=class extends d.E{constructor(m){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ur(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const f=Cl(this.options.offset);if(!c){const b=this._container.offsetWidth,k=this._container.offsetHeight;let I;I=u.y+f.bottom.y<k?["top"]:u.y>this._map.transform.height-k?["bottom"]:[],u.x<b/2?I.push("left"):u.x>this._map.transform.width-b/2&&I.push("right"),c=I.length===0?"bottom":I.join("-")}let v=u.add(f[c]);this.options.subpixelPositioning||(v=v.round()),V.setTransform(this._container,`${Lo[c]} translate(${v.x}px,${v.y}px)`),Sl(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(gt),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=m;u=o.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(kl);m&&m.focus()}},S.RasterDEMTileSource=rr,S.RasterTileSource=Mt,S.ScaleControl=class{constructor(m){this._onMove=()=>{za(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,za(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Hi),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=Ei,S.Style=qs,S.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=Pa,S.TwoFingersTouchRotateHandler=Yu,S.TwoFingersTouchZoomHandler=Xu,S.TwoFingersTouchZoomRotateHandler=Qu,S.VectorTileSource=os,S.VideoSource=$i,S.addSourceType=(m,e)=>d._(void 0,void 0,void 0,function*(){if(Es(m))throw new Error(`A source type called "${m}" already exists.`);((o,u)=>{as[o]=u})(m,e)}),S.clearPrewarmedResources=function(){const m=vr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(jr),vr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return Pr().getRTLTextPluginStatus()},S.getVersion=function(){return oc},S.getWorkerCount=function(){return un.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(m){return is().broadcast("IS",m)},S.prewarm=function(){ai().acquire(jr)},S.setMaxParallelImageRequests=function(m){d.a.MAX_PARALLEL_IMAGE_REQUESTS=m},S.setRTLTextPlugin=function(m,e){return Pr().setRTLTextPlugin(m,e)},S.setWorkerCount=function(m){un.workerCount=m},S.setWorkerUrl=function(m){d.a.WORKER_URL=m}});var T=l;return T})})(Jw);var yk=Jw.exports;const ao=kx(yk);function _k({lat:r,lng:i,locations:l,zoom:p=14}){const x=rt.useRef(null),T=rt.useRef(null),S=rt.useRef([]),[d,$]=rt.useState({minZoom:0,maxZoom:22});return rt.useEffect(()=>{(async()=>{try{const Q=await(await fetch("/tiles/taiwan/style.json")).json(),V=Object.values(Q.sources)[0];if(V){const Ce=V.minzoom||0,Ee=V.maxzoom||22;$({minZoom:Ce,maxZoom:Ee})}}catch(ge){console.error("Failed to fetch zoom limits:",ge)}})()},[]),rt.useEffect(()=>{if(T.current)return;const ne=l||(r!==void 0&&i!==void 0?[{lat:r,lng:i}]:[]);if(ne.length===0)return;const ge=ne[0];T.current=new ao.Map({container:x.current,style:"/tiles/taiwan/style.json",center:[ge.lng,ge.lat],zoom:p,minZoom:d.minZoom,maxZoom:d.maxZoom-.05,dragRotate:!1,touchPitch:!1,cooperativeGestures:!0}),T.current.touchZoomRotate.disableRotation();const Q=["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0","#FF9800","#00BCD4","#E91E63"];if(ne.forEach((V,Ce)=>{const Ee=Q[Ce%Q.length],Me=document.createElement("div");if(Me.style.width="30px",Me.style.height="40px",Me.innerHTML=`
        <svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg" style="display: block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
          <path d="M15 0C8.373 0 3 5.373 3 12c0 9 12 28 12 28s12-19 12-28c0-6.627-5.373-12-12-12z" 
                fill="${Ee}" 
                stroke="white" 
                stroke-width="2"/>
          <circle cx="15" cy="12" r="4" fill="white"/>
        </svg>
      `,V.label){const oe=document.createElement("div");oe.textContent=V.label,oe.style.position="absolute",oe.style.bottom="44px",oe.style.left="50%",oe.style.transform="translateX(-50%)",oe.style.backgroundColor="white",oe.style.color="#333",oe.style.padding="2px 6px",oe.style.borderRadius="3px",oe.style.fontSize="12px",oe.style.fontWeight="bold",oe.style.whiteSpace="nowrap",oe.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",oe.style.pointerEvents="none",Me.appendChild(oe)}const pt=new ao.Marker({element:Me,anchor:"bottom"}).setLngLat([V.lng,V.lat]).addTo(T.current);S.current.push(pt)}),ne.length>1){const V=new ao.LngLatBounds;ne.forEach(Ce=>{V.extend([Ce.lng,Ce.lat])}),T.current.fitBounds(V,{padding:50,maxZoom:15})}return T.current.addControl(new ao.NavigationControl({showCompass:!1,showZoom:!0,visualizePitch:!1}),"top-right"),T.current.on("zoom",()=>{console.log("Current zoom level:",T.current.getZoom())}),console.log("Map initialized with zoom:",p,"minZoom:",d.minZoom,"maxZoom:",d.maxZoom),()=>{S.current.forEach(V=>V.remove()),S.current=[],T.current&&(T.current.remove(),T.current=null)}},[d]),rt.useEffect(()=>{if(!T.current)return;const ne=l||(r!==void 0&&i!==void 0?[{lat:r,lng:i}]:[]);if(ne.length===0)return;S.current.forEach(Q=>Q.remove()),S.current=[];const ge=["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0","#FF9800","#00BCD4","#E91E63"];if(ne.forEach((Q,V)=>{const Ce=ge[V%ge.length],Ee=document.createElement("div");if(Ee.style.width="30px",Ee.style.height="40px",Ee.innerHTML=`
        <svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg" style="display: block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
          <path d="M15 0C8.373 0 3 5.373 3 12c0 9 12 28 12 28s12-19 12-28c0-6.627-5.373-12-12-12z" 
                fill="${Ce}" 
                stroke="white" 
                stroke-width="2"/>
          <circle cx="15" cy="12" r="4" fill="white"/>
        </svg>
      `,Q.label){const pt=document.createElement("div");pt.textContent=Q.label,pt.style.position="absolute",pt.style.bottom="44px",pt.style.left="50%",pt.style.transform="translateX(-50%)",pt.style.backgroundColor="white",pt.style.color="#333",pt.style.padding="2px 6px",pt.style.borderRadius="3px",pt.style.fontSize="12px",pt.style.fontWeight="bold",pt.style.whiteSpace="nowrap",pt.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",pt.style.pointerEvents="none",Ee.appendChild(pt)}const Me=new ao.Marker({element:Ee,anchor:"bottom"}).setLngLat([Q.lng,Q.lat]).addTo(T.current);S.current.push(Me)}),ne.length===1)T.current.setCenter([ne[0].lng,ne[0].lat]);else if(ne.length>1){const Q=new ao.LngLatBounds;ne.forEach(V=>{Q.extend([V.lng,V.lat])}),T.current.fitBounds(Q,{padding:50,maxZoom:15})}},[r,i,l]),me.jsx("div",{ref:x,style:{width:"98%",margin:"0 auto",boxShadow:"0 4px 8px rgba(0,0,0,0.2)",height:"240px",borderRadius:"8px",overflow:"hidden"}})}function vk({onConfirm:r,onCancel:i,initialLat:l=25.033,initialLng:p=121.5654,initialText:x="",lastLocation:T=null}){const S=rt.useRef(null),d=rt.useRef(null),$=rt.useRef([]),ne=5,ge=Le=>{const it=/([\u4e00-\u9fa5a-zA-Z0-9_\-]+)?@\(([-+]?\d*\.?\d+)\s*,\s*([-+]?\d*\.?\d+)\)/g,Ge=[];let Ye;for(;(Ye=it.exec(Le))!==null;){const Kt={lat:parseFloat(Ye[2]),lng:parseFloat(Ye[3]),label:Ye[1]?Ye[1].trim():""};if(Ge.push(Kt),Ge.length>=ne)break}return Ge},Q=()=>{if(x){const Le=ge(x);if(Le.length>0)return Le}return T?[{lat:T.lat,lng:T.lng,label:""}]:[{lat:l,lng:p,label:""}]},V=()=>{if(x){const Le=ge(x);if(Le.length>0)return Le.length===1?13:12}return T&&T.zoom?T.zoom:13},[Ce,Ee]=rt.useState(Q()),[Me,pt]=rt.useState(0),[oe,ie]=rt.useState({minZoom:0,maxZoom:22});rt.useEffect(()=>{(async()=>{try{const Ge=await(await fetch("/tiles/taiwan/style.json")).json(),Ye=Object.values(Ge.sources)[0];if(Ye){const Kt=Ye.minzoom||0,Vt=Ye.maxzoom||22;ie({minZoom:Kt,maxZoom:Vt})}}catch(it){console.error("Failed to fetch zoom limits:",it)}})()},[]),rt.useEffect(()=>{if(d.current)return;const Le=V();return d.current=new ao.Map({container:S.current,style:"/tiles/taiwan/style.json",center:[Ce[0].lng,Ce[0].lat],zoom:Le,minZoom:oe.minZoom,maxZoom:oe.maxZoom-.05,dragRotate:!1,touchPitch:!1}),d.current.touchZoomRotate.disableRotation(),d.current.on("click",it=>{const{lng:Ge,lat:Ye}=it.lngLat;de(Me,{lat:Ye,lng:Ge})}),d.current.addControl(new ao.NavigationControl({showCompass:!1,showZoom:!0,visualizePitch:!1}),"top-right"),d.current.on("load",()=>{Ee([...Ce])}),()=>{$.current.forEach(it=>it.remove()),$.current=[],d.current&&(d.current.remove(),d.current=null)}},[oe]),rt.useEffect(()=>{if(!d.current)return;$.current.forEach(it=>it.remove()),$.current=[];const Le=["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0"];Ce.forEach((it,Ge)=>{const Ye=Le[Ge%Le.length],Kt=document.createElement("div");Kt.style.width="30px",Kt.style.height="40px",Kt.style.cursor="pointer",Kt.innerHTML=`
        <svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg" style="display: block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
          <path d="M15 0C8.373 0 3 5.373 3 12c0 9 12 28 12 28s12-19 12-28c0-6.627-5.373-12-12-12z" 
                fill="${Ye}" 
                stroke="${Me===Ge?"#FFD700":"white"}" 
                stroke-width="${Me===Ge?"3":"2"}"/>
          <circle cx="15" cy="12" r="4" fill="white"/>
        </svg>
      `;const Vt=new ao.Marker({element:Kt,anchor:"bottom",draggable:!0}).setLngLat([it.lng,it.lat]).addTo(d.current);Vt.on("dragend",()=>{const Yt=Vt.getLngLat();de(Ge,{lat:Yt.lat,lng:Yt.lng})}),Kt.addEventListener("click",Yt=>{Yt.stopPropagation(),pt(Ge)}),$.current.push(Vt)})},[Ce,Me]);const de=(Le,it)=>{Ee(Ge=>{const Ye=[...Ge];return Ye[Le]={...Ye[Le],...it},Ye})},Pe=(Le,it)=>{Ee(Ge=>{const Ye=[...Ge];return Ye[Le]={...Ye[Le],label:it},Ye})},qe=()=>{if(Ce.length<ne){const Le=d.current.getCenter();Ee(it=>[...it,{lat:Le.lat,lng:Le.lng,label:""}]),pt(Ce.length)}},Qe=Le=>{Ce.length>1&&(Ee(it=>it.filter((Ge,Ye)=>Ye!==Le)),pt(Math.max(0,Math.min(Me,Ce.length-2))))},Xe=()=>{const it=Ce.map(Ye=>{const Kt=Ye.lat.toFixed(6),Vt=Ye.lng.toFixed(6),Yt=Ye.label.trim();return Yt?`${Yt}@(${Kt},${Vt})`:`@(${Kt},${Vt})`}).join(" "),Ge=d.current?{center:d.current.getCenter(),zoom:d.current.getZoom()}:null;r(it,Ge)};return me.jsx("div",{className:"modal-overlay",onClick:i,children:me.jsxs("div",{className:"modal-content location-picker-modal",onClick:Le=>Le.stopPropagation(),children:[me.jsx("div",{className:"modal-header",children:""}),me.jsxs("div",{className:"modal-body",children:[me.jsxs("div",{className:"location-picker-instructions",children:[" (",Ce.length,"/",ne,")"]}),me.jsx("div",{ref:S,className:"location-picker-map",style:{width:"100%",height:"400px",borderRadius:"8px",overflow:"hidden",marginBottom:"12px"}}),me.jsx("div",{className:"location-list",children:Ce.map((Le,it)=>me.jsx("div",{className:`location-item ${Me===it?"selected":""}`,onClick:()=>pt(it),children:me.jsxs("div",{className:"location-item-header",children:[me.jsx("span",{className:"location-number",style:{backgroundColor:["#FF5252","#2196F3","#4CAF50","#FFC107","#9C27B0"][it%5]},children:it+1}),me.jsxs("div",{className:"location-coords-small",children:[me.jsxs("span",{children:[Le.lat.toFixed(6),","]}),me.jsx("span",{children:Le.lng.toFixed(6)})]}),me.jsx("input",{type:"text",className:"location-label-input-small",placeholder:" ()",value:Le.label,onChange:Ge=>Pe(it,Ge.target.value),onClick:Ge=>Ge.stopPropagation(),maxLength:20}),Ce.length>1&&me.jsx("button",{className:"btn-remove-location",onClick:Ge=>{Ge.stopPropagation(),Qe(it)},title:"",children:""})]})},it))}),Ce.length<ne&&me.jsx("button",{className:"btn-add-location",onClick:qe,children:"+ "})]}),me.jsxs("div",{className:"modal-actions",children:[me.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:i,children:""}),me.jsx("button",{className:"modal-btn modal-btn-confirm",onClick:Xe,children:""})]})]})})}const Sx="YourChannelName",_s=["hsl(0, 70%, 85%)","hsl(30, 70%, 85%)","hsl(60, 70%, 85%)","hsl(90, 70%, 85%)","hsl(120, 70%, 85%)","hsl(150, 70%, 85%)","hsl(180, 70%, 85%)","hsl(210, 70%, 85%)","hsl(240, 70%, 85%)","hsl(270, 70%, 85%)","hsl(300, 70%, 85%)","hsl(330, 70%, 85%)","hsl(0, 0%, 85%)","hsl(0, 0%, 75%)","hsl(45, 80%, 85%)","hsl(15, 80%, 85%)"];function Tx(){const r="abcdefghijklmnopqrstuvwxyz0123456789",i=crypto.getRandomValues(new Uint8Array(8));let l="";for(let p=0;p<8;p++)l+=r[i[p]%36];return l}function xk(r){let i=0;for(let p=0;p<r.length;p++)i=r.charCodeAt(p)+((i<<5)-i);return{bg:`hsl(${Math.abs(i)%360}, 70%, 85%)`,text:"#333"}}function vs(r){return new Blob([r]).size}const Yr=150;function wk(){const[r,i]=rt.useState(null),[l,p]=rt.useState([]),[x,T]=rt.useState(!1),[S,d]=rt.useState(!1),[$,ne]=rt.useState(null),[ge,Q]=rt.useState(Sx),[V,Ce]=rt.useState(""),[Ee,Me]=rt.useState(!1),[pt,oe]=rt.useState(""),[ie,de]=rt.useState(0),[Pe,qe]=rt.useState(null),[Qe,Xe]=rt.useState(""),[Le,it]=rt.useState(0),[Ge,Ye]=rt.useState({show:!1,type:"alert",title:"",message:"",onConfirm:null}),[Kt,Vt]=rt.useState(null),[Yt,Sn]=rt.useState(0),[Nr,an]=rt.useState("newest"),[et,_t]=rt.useState(""),[yt,Dt]=rt.useState(!1),[qt,ln]=rt.useState(!0),jr=rt.useRef(0),un=rt.useRef(null),gr=rt.useRef(null),[vr,Zr]=rt.useState(0),[ai,Rn]=rt.useState(0),[is,li]=rt.useState(!1),[Vi,Si]=rt.useState(!1),ss=rt.useRef(Nr),[ye,Ti]=rt.useState(null),[os,Mt]=rt.useState(""),[rr,Ui]=rt.useState(0),[Xn,Tn]=rt.useState(0),$i=rt.useRef(null),[cn,as]=rt.useState(null),Es=rt.useRef({}),[Ae,Kn]=rt.useState({}),[ar,Pr]=rt.useState(null),[ki,Re]=rt.useState({top:0,left:0}),kt=rt.useRef(null),ft=rt.useRef({}),Ar=rt.useRef({x:0,y:0}),[yr,vt]=rt.useState(!1),[ui,Yn]=rt.useState(!1),[ci,hn]=rt.useState(""),[W,L]=rt.useState(!1),[D,O]=rt.useState(""),[q,te]=rt.useState(""),[le,he]=rt.useState(!1),[J,ve]=rt.useState({});rt.useEffect(()=>{(async()=>{if(V)try{const Se=await(await fetch(`/api/user/${V}/last-location`)).json();Se.success&&Se.location&&ve(je=>({...je,[V]:Se.location}))}catch(we){console.error("Failed to fetch user last location:",we)}})()},[V]);const ke=async(se=!1,we=null)=>{try{const Se=we||ge,lt=await(await fetch(`/api/boards/${Se}/notes?is_include_deleted=${se}`)).json();lt.success&&(p(lt.notes),_e(lt.notes,Se))}catch(Se){console.error("Failed to fetch notes:",Se)}},_e=async(se,we=null)=>{const Se=we||ge,je={},lt=[];se.forEach(Tt=>{lt.push(Tt),Tt.replyNotes&&lt.push(...Tt.replyNotes)});for(const Tt of lt)if(Tt.noteId)try{const Ur=await(await fetch(`/api/boards/${Se}/notes/${Tt.noteId}/acks`)).json();Ur.success&&(je[Tt.noteId]=Ur.acks)}catch(Ct){console.error(`Failed to fetch ACKs for note ${Tt.noteId}:`,Ct)}Kn(je)},Fe=async se=>{try{const Se=await(await fetch(`/api/boards/${ge}/notes/${se}/acks`)).json();Se.success&&Kn(je=>({...je,[se]:Se.acks}))}catch(we){console.error(`Failed to fetch ACKs for note ${se}:`,we)}};rt.useEffect(()=>((async()=>{try{const je=await(await fetch("/api/config/channel_name")).json();je.success&&Q(je.channel_name)}catch(Se){console.error("Failed to fetch channel name from backend:",Se)}try{const je=await(await fetch("/api/user/uuid")).json();if(je.success)Ce(je.uuid);else{const lt=Tx();Ce(lt)}}catch(Se){console.error("Failed to fetch UUID from backend:",Se);const je=Tx();Ce(je)}try{const je=await(await fetch("/api/user/admin/status")).json();je.success&&vt(je.is_admin)}catch(Se){console.error("Failed to fetch admin status:",Se)}try{const je=await(await fetch("/api/config/post_passcode_required")).json();je.success&&L(je.required)}catch(Se){console.error("Failed to fetch post passcode config:",Se)}const we=Jd();i(we),we.on("lora_status",Se=>{T(Se.online),d(Se.channel_validated!==!1),ne(Se.error_message||null),Se.online&&Se.channel_validated===!1&&(console.log(" LoRa  Channel "),Se.error_message&&console.log("   "+Se.error_message))})})(),()=>{r&&r.close()}),[]),rt.useEffect(()=>{if(!r)return;const se=je=>{ke(yt,ge)},we=je=>{console.log("ACK received:",je),je.note_id&&Fe(je.note_id)},Se=je=>{console.error("USB connection error:",je.message),Ye({show:!0,type:"alert",title:"",message:je.message,onConfirm:()=>Ye(lt=>({...lt,show:!1}))})};return r.on("refresh_notes",se),r.on("ack_received",we),r.on("usb_connection_error",Se),()=>{r.off("refresh_notes",se),r.off("ack_received",we),r.off("usb_connection_error",Se)}},[r,yt,ge]),rt.useEffect(()=>{ge!==Sx&&ke(yt)},[yt,ge]),rt.useEffect(()=>{if(ss.current!==Nr){Si(!0);const se=setTimeout(()=>{Si(!1)},600);return ss.current=Nr,()=>clearTimeout(se)}},[Nr]),rt.useEffect(()=>{const se=we=>{ar&&kt.current&&!kt.current.contains(we.target)&&(we.target.closest(".ack-counter")||Pr(null))};if(ar)return document.addEventListener("mousedown",se),()=>{document.removeEventListener("mousedown",se)}},[ar]),rt.useEffect(()=>{const se=()=>{if(window.innerWidth>768){ln(!0);return}const we=window.scrollY,Se=we-jr.current,je=document.documentElement.scrollHeight,lt=window.innerHeight,Tt=we+lt>=je-50;we<10?ln(!0):Se>5&&we>50&&!Tt?ln(!1):Se<-5&&!Tt&&ln(!0),jr.current=we};return window.addEventListener("scroll",se,{passive:!0}),()=>window.removeEventListener("scroll",se)},[]),rt.useEffect(()=>{Ee&&gr.current&&setTimeout(()=>{if(gr.current){const se=gr.current.getBoundingClientRect(),Se=window.scrollY+se.top-100;window.scrollTo({top:Se,behavior:"smooth"}),gr.current.focus()}},150)},[Ee]),rt.useEffect(()=>{if(cn){let se=!1;const we=()=>{const Ct=Es.current[cn];if(Ct&&!se){const Ur=Ct.getBoundingClientRect(),Wt=window.scrollY+Ur.top-100;return window.scrollTo({top:Wt,behavior:"smooth"}),se=!0,setTimeout(()=>{Ct&&Ct.classList.add("note-paste-animation")},500),!0}return!1};let Se=0;const je=10,lt=setInterval(()=>{Se++,(we()||Se>=je)&&clearInterval(lt)},100),Tt=setTimeout(()=>{as(null)},3e3);return()=>{clearInterval(lt),clearTimeout(Tt)}}},[cn,l]);const De=(se,we="")=>{Ye({show:!0,type:"alert",title:we,message:se,onConfirm:()=>Ye({...Ge,show:!1})})},ht=(se,we="")=>new Promise(Se=>{Ye({show:!0,type:"confirm",title:we,message:se,onConfirm:()=>{Ye({...Ge,show:!1}),Se(!0)},onCancel:()=>{Ye({...Ge,show:!1}),Se(!1)}})}),Ot=async()=>{yr?await ht("","")&&Pt():(Yn(!0),hn(""))},St=async()=>{if(!ci.trim()){De("");return}try{const we=await(await fetch("/api/user/admin/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({passcode:ci})})).json();we.success&&we.is_admin?(vt(!0),Yn(!1),hn(""),De("","")):(De("",""),hn(""))}catch(se){console.error("Failed to authenticate admin:",se),De(""+se.message,"")}},Lt=()=>{Yn(!1),hn("")},Pt=async()=>{try{const we=await(await fetch("/api/user/admin/logout",{method:"POST",headers:{"Content-Type":"application/json"}})).json();we.success?(vt(!1),De("","")):De(""+(we.error||""),"")}catch(se){console.error("Failed to logout admin:",se),De(""+se.message,"")}},xr=async se=>{if(await ht("",""))try{const je=await(await fetch(`/api/boards/${ge}/notes/${se}/pin`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();je.success?De("",""):De(""+(je.error||""),"")}catch(Se){console.error("Failed to pin note:",Se),De(""+Se.message,"")}},fr=()=>{Me(!0),oe(""),de(0),Zr(0),O("")},Et=()=>{Me(!1),oe(""),de(0),Zr(0),O("")},Zt=se=>{Ti(se),Mt(""),Ui(0),Tn(0),te("")},nr=()=>{Ti(null),Mt(""),Ui(0),Tn(0),te("")},Fr=async()=>{const se=os.trim();if(!se){De("");return}if(!yr&&W&&!q.trim()){De("");return}try{const Se=await(await fetch(`/api/boards/${ge}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:se,author_key:V,color_index:rr,parent_note_id:ye,post_passcode:q})})).json();Se.success?(Ti(null),Mt(""),Ui(0),Tn(0),te(""),Se.note&&Se.note.noteId&&as(Se.note.noteId)):De(""+(Se.error||""),"")}catch(we){console.error("Failed to create reply:",we),De(""+we.message,"")}},Vr=se=>{const we=se.target.value,Se=vs(we);!is&&Se>Yr||(Mt(we),Tn(Se))},en=async()=>{const se=pt.trim();if(!se){De("");return}if(!yr&&W&&!D.trim()){De("");return}try{const Se=await(await fetch(`/api/boards/${ge}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:se,author_key:V,color_index:ie,post_passcode:D})})).json();Se.success?(Me(!1),oe(""),de(0),Zr(0),O(""),Se.note&&Se.note.noteId&&as(Se.note.noteId)):De(""+(Se.error||""),"")}catch(we){console.error("Failed to create note:",we),De(""+we.message,"")}},Is=se=>{qe(se.noteId),Xe(se.text),Rn(vs(se.text));const we=_s.findIndex(Se=>Se===se.bgColor);it(we>=0?we:0)},Gt=()=>{qe(null),Xe(""),it(0),Rn(0)},fa=async se=>{const we=Qe.trim();if(!we){De("");return}try{const je=await(await fetch(`/api/boards/${ge}/notes/${se}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:we,author_key:V,color_index:Le})})).json();je.success?(qe(null),Xe(""),it(0),Rn(0)):De(""+(je.error||""),"")}catch(Se){console.error("Failed to update note:",Se),De(""+Se.message,"")}},$s=async(se,we=!1,Se=null)=>{let je=!1,lt=l.find(lr=>lr.noteId===se);if(lt)je=!0;else for(const lr of l)if(lr.replyNotes&&(lt=lr.replyNotes.find(Wt=>Wt.noteId===se),lt)){je=!1;break}let Tt="";if(je&&(Tt+=`

 `),!await ht(Tt,""))return;const Ur=Se||V;try{let lr;we?lr=await fetch(`/api/boards/${ge}/notes/${se}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({author_key:Ur})}):lr=await fetch(`/api/boards/${ge}/notes/${se}/archive`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author_key:Ur,is_admin:yr&&Se!==null})});const Wt=await lr.json();Wt.success||De(""+(Wt.error||""),"")}catch(lr){console.error("Failed to delete note:",lr),De(""+lr.message,"")}},kn=async(se,we=null)=>{if(!await ht("",""))return;const je=yr&&we&&we!==V;try{const Tt=await(await fetch(`/api/boards/${ge}/notes/${se}/resend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author_key:V,is_admin:je})})).json();Tt.success?De(` ( ${Tt.resent_count} )`,""):De(""+(Tt.error||""),"")}catch(lt){console.error("Failed to resend note:",lt),De(""+lt.message,"")}},dn=se=>{const we=_s.findIndex(Se=>Se===se.bgColor);Sn(we>=0?we:0),Vt(se)},ma=()=>{Vt(null),Sn(0)},Fn=async()=>{if(!Kt)return;const se=Kt.userId===V,we=yr&&!se;try{const je=await(await fetch(`/api/boards/${ge}/notes/${Kt.noteId}/color`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author_key:V,color_index:Yt,is_admin:we})})).json();je.success?ma():De(""+(je.error||""),"")}catch(Se){console.error("Failed to change color:",Se),De(""+Se.message,"")}},tn=se=>{switch(se){case"LoRa received":return"LoRa";case"sent":case"LoRa sent":return"LoRa";case"local":return" ";case"LAN only":return" ";default:return se}},Ps=()=>[...l.filter(Se=>{if(et.trim()){const je=et.toLowerCase(),lt=(Se.text||"").toLowerCase(),Tt=(Se.sender||"").toLowerCase();return lt.includes(je)||Tt.includes(je)?!0:(Se.replyNotes||[]).some(lr=>{const Wt=(lr.text||"").toLowerCase(),On=(lr.sender||"").toLowerCase();return Wt.includes(je)||On.includes(je)})}return!0})].sort((Se,je)=>{if(Se.isPinedNote&&!je.isPinedNote)return-1;if(!Se.isPinedNote&&je.isPinedNote)return 1;if(Nr==="newest")return new Date(je.timestamp||0)-new Date(Se.timestamp||0);if(Nr==="oldest")return new Date(Se.timestamp||0)-new Date(je.timestamp||0);if(Nr==="color"){const lt=_s.indexOf(Se.bgColor),Tt=_s.indexOf(je.bgColor);return lt-Tt}return 0}),ls=se=>{const we=se.target.value,Se=vs(we);!is&&Se>Yr||(oe(we),Zr(Se))},Tr=se=>{const we=se.target.value,Se=vs(we);!is&&Se>Yr||(Xe(we),Rn(Se))},us=()=>{li(!0)},Cn=(se,we=!1)=>{li(!1);const Se=se.target.value;if(vs(Se)>Yr){let lt=Se;for(;vs(lt)>Yr;)lt=lt.slice(0,-1);we?(Xe(lt),Rn(vs(lt))):(oe(lt),Zr(vs(lt)))}},mr=()=>{he(!0)},yo=()=>{he(!1)},En=async se=>{if(!(!se||!V))try{await fetch(`/api/user/${V}/last-location`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lat:se.center.lat,lng:se.center.lng,zoom:se.zoom})}),ve(we=>({...we,[V]:{lat:se.center.lat,lng:se.center.lng,zoom:se.zoom}}))}catch(we){console.error("Failed to save user last location:",we)}},ga=(se,we)=>{const Se=/([\u4e00-\u9fa5a-zA-Z0-9_\-]+)?@\(([-+]?\d*\.?\d+)\s*,\s*([-+]?\d*\.?\d+)\)/g;if(Pe){const lt=Qe.replace(Se,"").trim(),Tt=lt?`${lt} ${se}`:se,Ct=vs(Tt);Ct<=Yr?(Xe(Tt),Rn(Ct),he(!1),En(we),gr.current&&gr.current.focus()):De("","")}else if(ye){const lt=os.replace(Se,"").trim(),Tt=lt?`${lt} ${se}`:se,Ct=vs(Tt);Ct<=Yr?(Mt(Tt),Tn(Ct),he(!1),En(we),$i.current&&$i.current.focus()):De("","")}else{const lt=pt.replace(Se,"").trim(),Tt=lt?`${lt} ${se}`:se,Ct=vs(Tt);Ct<=Yr?(oe(Tt),Zr(Ct),he(!1),En(we),gr.current&&gr.current.focus()):De("","")}},Bn=se=>{const we=/([\u4e00-\u9fa5a-zA-Z0-9_\-]+)?@\(([-+]?\d*\.?\d+)\s*,\s*([-+]?\d*\.?\d+)\)/g,Se=[];let je;for(;(je=we.exec(se))!==null;){const lt={lat:parseFloat(je[2]),lng:parseFloat(je[3])};je[1]&&je[1].trim()&&(lt.label=je[1].trim()),Se.push(lt)}return Se.length>0?Se:null},wu=(se,we)=>{if(!we.trim())return se;const Se=se.toLowerCase(),je=we.toLowerCase(),lt=[];let Tt=0,Ct=Se.indexOf(je);for(;Ct!==-1;)Ct>Tt&&lt.push(se.substring(Tt,Ct)),lt.push(me.jsx("mark",{style:{backgroundColor:"yellow",color:"#333"},children:se.substring(Ct,Ct+we.length)},`${Ct}-${Tt}`)),Tt=Ct+we.length,Ct=Se.indexOf(je,Tt);return Tt<se.length&&lt.push(se.substring(Tt)),lt.length>0?lt:se},qs=(se,we,Se=!1)=>{se.sender;const je=se.userId||"unknown-id",lt=se.text,Tt=se.time||"",Ct=se.status||"local",Ur=se.bgColor||xk(je).bg,lr=je===V,Wt=lr&&Ct==="LAN only"&&!se.archived,On=lr&&Ct!=="LAN only"&&!se.archived,bu=yr&&!lr&&!se.archived&&Ct!=="LAN only";return Pe===se.noteId?me.jsxs("div",{className:"sticky-note draft-note",style:{backgroundColor:_s[Le],color:"#333"},children:[me.jsx("div",{className:"draft-header",children:""}),me.jsx("textarea",{className:"draft-textarea",value:Qe,onChange:Tr,onCompositionStart:us,onCompositionEnd:Nt=>Cn(Nt,!0),placeholder:"...",autoFocus:!0}),me.jsx("div",{className:"draft-tools",children:me.jsx("button",{className:"btn-location-picker",onClick:mr,title:"",children:" "})}),me.jsxs("div",{className:"byte-counter-container",children:[me.jsx("div",{className:"byte-counter-bar",children:me.jsx("div",{className:"byte-counter-fill",style:{width:`${Math.min(ai/Yr*100,100)}%`,backgroundColor:ai>Yr?"#d32f2f":"#3498db"}})}),me.jsxs("div",{className:"byte-counter-text",style:{color:ai>Yr?"#d32f2f":"#666"},children:[ai,"/",Yr]})]}),me.jsx("div",{className:"color-picker",children:_s.map((Nt,Mr)=>me.jsx("div",{className:`color-option ${Le===Mr?"selected":""}`,style:{backgroundColor:Nt},onClick:()=>it(Mr)},Mr))}),me.jsxs("div",{className:"draft-actions",children:[me.jsx("button",{className:"btn-cancel",onClick:Gt,children:""}),me.jsx("button",{className:"btn-submit",onClick:()=>fa(se.noteId),children:""})]})]},se.noteId||we):me.jsxs("div",{ref:Nt=>{se.noteId&&(Es.current[se.noteId]=Nt)},className:`sticky-note ${Ct==="local"?"note-failed":""} ${Vi?"reordering":""} ${Se?"reply-note":""}`,style:{backgroundColor:Ur,color:"#333"},children:[(se.archived||se.isTempParentNote||se.isPinedNote)&&me.jsx("div",{className:"note-label",children:se.archived?"":se.isPinedNote?"":""}),me.jsx("div",{className:"note-content",children:wu(lt,et)}),Bn(lt)&&me.jsx("div",{style:{marginTop:"10px",marginBottom:"10px"},children:me.jsx(_k,{locations:Bn(lt)})}),me.jsxs("div",{className:"note-footer",children:[me.jsx("span",{className:"note-time",children:Tt}),me.jsx("span",{className:"note-footer-right",children:(Ct==="sent"||Ct==="LoRa sent")&&(se.userId===V||yr)&&!se.archived?me.jsxs("span",{className:"note-status clickable",onClick:Nt=>{Nt.stopPropagation(),kn(se.noteId,se.userId)},title:"",children:[tn(Ct),me.jsxs("span",{className:"ack-counter-wrapper",children:[me.jsx("span",{ref:Nt=>{se.noteId&&(ft.current[se.noteId]=Nt)},className:"ack-counter",onClick:Nt=>{if(Nt.stopPropagation(),ar===se.noteId)Pr(null);else{const Mr=Nt.currentTarget.getBoundingClientRect();Re({top:Mr.bottom+8,left:Mr.right-150}),Pr(se.noteId)}},children:Ae[se.noteId]&&Ae[se.noteId].length||0}),me.jsx("span",{className:"ack-counter-touch-overlay",onTouchStart:Nt=>{Ar.current={x:Nt.touches[0].clientX,y:Nt.touches[0].clientY}},onTouchEnd:Nt=>{const Mr=Nt.changedTouches[0].clientX,hs=Nt.changedTouches[0].clientY,Gr=Math.abs(Mr-Ar.current.x),Hr=Math.abs(hs-Ar.current.y);if(Gr<10&&Hr<10)if(Nt.preventDefault(),Nt.stopPropagation(),ar===se.noteId)Pr(null);else{const qi=ft.current[se.noteId].getBoundingClientRect();Re({top:qi.bottom+8,left:qi.right-150}),Pr(se.noteId)}}})]})]}):Ct==="sent"||Ct==="LoRa sent"?me.jsxs("span",{className:"note-status",children:[tn(Ct),me.jsxs("span",{className:"ack-counter-wrapper",children:[me.jsx("span",{ref:Nt=>{se.noteId&&(ft.current[se.noteId]=Nt)},className:"ack-counter",onClick:Nt=>{if(Nt.stopPropagation(),ar===se.noteId)Pr(null);else{const Mr=Nt.currentTarget.getBoundingClientRect();Re({top:Mr.bottom+8,left:Mr.right-150}),Pr(se.noteId)}},children:Ae[se.noteId]&&Ae[se.noteId].length||0}),me.jsx("span",{className:"ack-counter-touch-overlay",onTouchStart:Nt=>{Ar.current={x:Nt.touches[0].clientX,y:Nt.touches[0].clientY}},onTouchEnd:Nt=>{const Mr=Nt.changedTouches[0].clientX,hs=Nt.changedTouches[0].clientY,Gr=Math.abs(Mr-Ar.current.x),Hr=Math.abs(hs-Ar.current.y);if(Gr<10&&Hr<10)if(Nt.preventDefault(),Nt.stopPropagation(),ar===se.noteId)Pr(null);else{const qi=ft.current[se.noteId].getBoundingClientRect();Re({top:qi.bottom+8,left:qi.right-150}),Pr(se.noteId)}}})]})]}):me.jsx("span",{className:"note-status",children:tn(Ct)})})]}),Wt&&me.jsxs("div",{className:"note-actions",children:[me.jsx("button",{className:"btn-edit",onClick:()=>Is(se),children:""}),me.jsx("button",{className:"btn-delete",onClick:()=>$s(se.noteId,!0),children:""})]}),On&&me.jsxs("div",{className:"note-actions",children:[me.jsx("button",{className:"btn-delete",onClick:()=>$s(se.noteId,!1),children:""}),me.jsx("button",{className:"btn-color",onClick:()=>dn(se),children:""}),yr&&!Se&&!se.replyLoraMessageId&&!se.isTempParentNote&&!se.archived&&!se.isPinedNote&&me.jsx("button",{className:"btn-pin",onClick:()=>xr(se.noteId),children:""})]}),bu&&me.jsxs("div",{className:"note-actions",children:[me.jsx("button",{className:"btn-delete",onClick:()=>$s(se.noteId,!1,je),children:""}),me.jsx("button",{className:"btn-color",onClick:()=>dn(se),children:""}),!Se&&!se.replyLoraMessageId&&!se.isTempParentNote&&!se.isPinedNote&&me.jsx("button",{className:"btn-pin",onClick:()=>xr(se.noteId),children:""})]})]},se.noteId||we)},cs=(se,we)=>{const je=[...se.replyNotes||[]].sort((Wt,On)=>new Date(Wt.timestamp||0)-new Date(On.timestamp||0)),lt=[se,...je].filter(Wt=>Wt.loraMessageId),Tt=ye&&lt.some(Wt=>Wt.loraMessageId===ye),Ct=je.length>0?je[je.length-1]:se,Ur=Ct.loraMessageId,lr=Ct.status;return me.jsxs("div",{className:"note-with-replies",children:[qs(se,we,!1),je.length>0&&me.jsx("div",{className:"reply-notes-container",children:je.map((Wt,On)=>qs(Wt,`${we}-reply-${On}`,!0))}),Tt?me.jsx("div",{className:"reply-notes-container",children:me.jsxs("div",{className:"sticky-note draft-note reply-note",style:{backgroundColor:_s[rr],color:"#333"},children:[me.jsx("div",{className:"draft-header",children:""}),me.jsx("textarea",{ref:$i,className:"draft-textarea",value:os,onChange:Vr,onCompositionStart:us,onCompositionEnd:Wt=>Cn(Wt,!1),placeholder:"...",autoFocus:!0}),me.jsx("div",{className:"draft-tools",children:me.jsx("button",{className:"btn-location-picker",onClick:mr,title:"",children:" "})}),me.jsxs("div",{className:"byte-counter-container",children:[me.jsx("div",{className:"byte-counter-bar",children:me.jsx("div",{className:"byte-counter-fill",style:{width:`${Math.min(Xn/Yr*100,100)}%`,backgroundColor:Xn>Yr?"#d32f2f":"#3498db"}})}),me.jsxs("div",{className:"byte-counter-text",style:{color:Xn>Yr?"#d32f2f":"#666"},children:[Xn,"/",Yr]})]}),me.jsx("div",{className:"color-picker",children:_s.map((Wt,On)=>me.jsx("div",{className:`color-option ${rr===On?"selected":""}`,style:{backgroundColor:Wt},onClick:()=>Ui(On)},On))}),!yr&&W&&me.jsx("div",{className:"passcode-input-container",children:me.jsx("input",{type:"password",className:"passcode-input",placeholder:"",value:q,onChange:Wt=>te(Wt.target.value)})}),me.jsxs("div",{className:"draft-actions",children:[me.jsx("button",{className:"btn-cancel",onClick:nr,children:""}),me.jsx("button",{className:"btn-submit",onClick:Fr,children:""})]})]})}):!ye&&Ur&&lr!=="LAN only"?me.jsx("div",{className:"reply-notes-container",children:me.jsx("button",{className:"add-reply-btn",onClick:()=>Zt(Ur),disabled:Ee||ye!==null,children:"+"})}):null]},se.noteId||we)};return me.jsxs(me.Fragment,{children:[me.jsxs("header",{className:qt?"header-visible":"header-hidden",children:[me.jsxs("div",{className:"header-left",children:[me.jsxs("div",{className:"app-name",children:["MeshBridge: ",ge," "]}),me.jsx("div",{className:"app-link",children:"noteboard.meshbridge.com"})]}),me.jsxs("div",{className:"status-container",style:{position:"relative"},children:[me.jsx("div",{className:`status-dot ${x?S?"online":"warning":""}`}),me.jsx("div",{className:"status-text",children:x?"LoRa ":"LoRa "}),x&&!S&&$&&me.jsx("div",{className:"status-tooltip",children:$})]}),me.jsx("div",{className:"user-role-container",onClick:Ot,style:{cursor:"pointer"},children:me.jsx("div",{className:"user-role-label",children:yr?"":""})})]}),me.jsxs("div",{className:"noteboard-container",children:[me.jsxs("div",{className:`filter-bar ${Ee?"disabled":""}`,children:[me.jsxs("div",{className:"filter-group",children:[me.jsx("label",{className:"filter-label",children:""}),me.jsxs("select",{className:"filter-select",value:Nr,onChange:se=>an(se.target.value),disabled:Ee,children:[me.jsx("option",{value:"newest",children:""}),me.jsx("option",{value:"oldest",children:""}),me.jsx("option",{value:"color",children:""})]})]}),me.jsxs("div",{className:"filter-group",children:[me.jsx("label",{className:"filter-label",children:""}),me.jsx("input",{type:"text",className:"filter-input",placeholder:"",value:et,onChange:se=>_t(se.target.value),disabled:Ee}),et&&me.jsx("button",{className:"clear-btn",onClick:()=>_t(""),disabled:Ee,children:""})]}),me.jsx("div",{className:"filter-group",children:me.jsxs("label",{className:"filter-checkbox",children:[me.jsx("input",{type:"checkbox",checked:yt,onChange:se=>Dt(se.target.checked),disabled:Ee}),me.jsx("span",{children:""})]})})]}),me.jsxs("div",{className:"notes-grid",children:[Ps().map((se,we)=>cs(se,we)),Ee&&me.jsxs("div",{ref:un,className:"sticky-note draft-note",style:{backgroundColor:_s[ie],color:"#333"},children:[me.jsx("div",{className:"draft-header",children:""}),me.jsx("textarea",{ref:gr,className:"draft-textarea",value:pt,onChange:ls,onCompositionStart:us,onCompositionEnd:se=>Cn(se,!1),placeholder:"...",autoFocus:!0}),me.jsx("div",{className:"draft-tools",children:me.jsx("button",{className:"btn-location-picker",onClick:mr,title:"",children:" "})}),me.jsxs("div",{className:"byte-counter-container",children:[me.jsx("div",{className:"byte-counter-bar",children:me.jsx("div",{className:"byte-counter-fill",style:{width:`${Math.min(vr/Yr*100,100)}%`,backgroundColor:vr>Yr?"#d32f2f":"#3498db"}})}),me.jsxs("div",{className:"byte-counter-text",style:{color:vr>Yr?"#d32f2f":"#666"},children:[vr,"/",Yr]})]}),me.jsx("div",{className:"color-picker",children:_s.map((se,we)=>me.jsx("div",{className:`color-option ${ie===we?"selected":""}`,style:{backgroundColor:se},onClick:()=>de(we)},we))}),!yr&&W&&me.jsx("div",{className:"passcode-input-container",children:me.jsx("input",{type:"password",className:"passcode-input",placeholder:"",value:D,onChange:se=>O(se.target.value)})}),me.jsxs("div",{className:"draft-actions",children:[me.jsx("button",{className:"btn-cancel",onClick:Et,children:""}),me.jsx("button",{className:"btn-submit",onClick:en,children:""})]})]})]})]}),!Ee&&!ye&&me.jsx("button",{className:"fab",onClick:fr,children:"+"}),me.jsxs("footer",{className:"app-footer",children:[me.jsxs("div",{className:"footer-left",children:["uid=",V]}),me.jsx("div",{className:"footer-right",children:"MeshNoteboard v0.3.0"})]}),Ge.show&&me.jsx("div",{className:"modal-overlay modal-overlay-top",onClick:()=>Ge.type==="alert"&&Ge.onConfirm(),children:me.jsxs("div",{className:"modal-content",onClick:se=>se.stopPropagation(),children:[me.jsx("div",{className:"modal-header",children:Ge.title}),me.jsx("div",{className:"modal-body",children:Ge.message}),me.jsxs("div",{className:"modal-actions",children:[Ge.type==="confirm"&&me.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:Ge.onCancel,children:""}),me.jsx("button",{className:"modal-btn modal-btn-confirm",onClick:Ge.onConfirm,children:(Ge.type==="confirm","")})]})]})}),Kt&&me.jsx("div",{className:"modal-overlay",onClick:ma,children:me.jsxs("div",{className:"modal-content color-picker-modal",onClick:se=>se.stopPropagation(),children:[me.jsx("div",{className:"modal-header",children:""}),me.jsx("div",{className:"modal-body",children:me.jsx("div",{className:"color-picker",children:_s.map((se,we)=>me.jsx("div",{className:`color-option ${Yt===we?"selected":""}`,style:{backgroundColor:se},onClick:()=>Sn(we)},we))})}),me.jsxs("div",{className:"modal-actions",children:[me.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:ma,children:""}),me.jsx("button",{className:"modal-btn modal-btn-confirm",onClick:Fn,children:""})]})]})}),ar&&Ae[ar]&&me.jsxs("div",{className:"ack-tooltip",ref:kt,style:{top:`${ki.top}px`,left:`${ki.left}px`},children:[me.jsx("button",{className:"ack-tooltip-close",onClick:se=>{se.stopPropagation(),Pr(null)},children:""}),me.jsx("div",{className:"ack-tooltip-header",children:""}),me.jsx("div",{className:"ack-tooltip-list",children:Ae[ar].map((se,we)=>me.jsx("div",{className:"ack-tooltip-item",children:se.displayId},se.ackId||we))})]}),ui&&me.jsx("div",{className:"modal-overlay",onClick:Lt,children:me.jsxs("div",{className:"modal-content",onClick:se=>se.stopPropagation(),children:[me.jsx("div",{className:"modal-header",children:""}),me.jsxs("div",{className:"modal-body",children:[me.jsx("p",{children:""}),me.jsx("input",{type:"password",className:"admin-passcode-input",placeholder:"",value:ci,onChange:se=>hn(se.target.value),onKeyPress:se=>{se.key==="Enter"&&St()},autoFocus:!0})]}),me.jsxs("div",{className:"modal-actions",children:[me.jsx("button",{className:"modal-btn modal-btn-cancel",onClick:Lt,children:""}),me.jsx("button",{className:"modal-btn modal-btn-confirm",onClick:St,children:""})]})]})}),le&&me.jsx(vk,{onConfirm:ga,onCancel:yo,initialText:Pe?Qe:pt,lastLocation:V?J[V]:null})]})}Pm.createRoot(document.getElementById("root")).render(me.jsx(l2.StrictMode,{children:me.jsx(wk,{})}));
